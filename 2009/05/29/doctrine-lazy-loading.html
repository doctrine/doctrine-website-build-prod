<!DOCTYPE html>
<html>
    <head>
        <title>Doctrine Lazy Loading - Doctrine: PHP Open Source Project</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
            <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2009/05/29/doctrine-lazy-loading.html"
        },
        "headline": "Doctrine Lazy Loading",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2009-05-29T00:00:00-04:00",
        "dateModified": "2009-05-29T00:00:00-04:00",
        "author": {
            "@type": "Person",
            "name": "jwage"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "Did you know?
        
    

                
    Did you know that in Doctrine if you don&amp;#039;t sp"
    }
    </script>
    <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/prismjs.css?d2443b"
                            integrity="sha384-IcJ7eow//K0xRBscZjnk8kawYxbm2eUAZ9D6Xf/n0yuAi1NCvwOkep1S8XqPNB3E"
                        crossorigin="anonymous"
    />

        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?e935b6"
                        integrity="sha384-0+XwQ7PUNkbj10v4XDjjp7VJzfahtyhEtNyFDNmWQaR7ohGXNow7qYgClWx6rQoS"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/2009/05/29/doctrine-lazy-loading.html" />
        <meta property="og:title" content="Doctrine Lazy Loading - Doctrine: PHP Open Source Project" />
        <meta property="og:description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine-website/edit/master/source/blog/2009-05-29-doctrine-lazy-loading.md" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
            <article>
        <div class="row">
            <div class="col-lg-8 col-12">
                <header>
                    <h2>Doctrine Lazy Loading</h2>
                </header>

                <p class="lead">
                    Posted on <date>May 29, 2009</date>
                                            by
                                                    jwage
                                                            </p>
            </div>

            <div class="col-lg-4 col-12">
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>
            </div>
        </div>

        <hr />

        <div>
                
            
                <h1 class="section-header ">
    <a href="#did-you-know">
        Did you know?
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Did you know that in Doctrine if you don&#039;t specifically select a property or join a relationship in your DQL query, you can lazily load that data? Here is a simple example to demonstrate.</p>

                    <pre class="code-block-table" id="2be6c1bbebbe044d3a91ea4002030001b6a33fc2"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="2be6c1bbebbe044d3a91ea4002030001b6a33fc2"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$q = Doctrine::getTable(<span class="hljs-string">'User'</span>)</code><code class="line language-php">  -&gt;createQuery(<span class="hljs-string">'u'</span>)</code><code class="line language-php">  -&gt;select(<span class="hljs-string">'u.id, u.username'</span>)</code><code class="line language-php">  -&gt;where(<span class="hljs-string">'u.username = ?'</span>, <span class="hljs-string">'jwage'</span>);</code><code class="line language-php"></code><code class="line language-php">$user = $q-&gt;fetchOne();</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Notice how I only selected the <code>id</code> and <code>username</code>, but we have an additional column named <code>email_address</code>. If I were to access that property it would lazily load the data.</p>

                    <pre class="code-block-table" id="753ac1edfcc2977b65c511a05e69d70168657e5a"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="753ac1edfcc2977b65c511a05e69d70168657e5a"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-keyword">echo</span> $user[<span class="hljs-string">'email_address'</span>]</code><code class="line language-php"></code><code class="line language-php">**NOTE** The above code would result in an additional query to the</code><code class="line language-php">database that would lazy load all unloaded properties of an object</code><code class="line language-php">in proxy state. A record is in proxy state when it has one <span class="hljs-keyword">or</span> more</code><code class="line language-php">properties that have not been loaded from the database.</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h1 class="section-header ">
    <a href="#be-aware">
        Be aware
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>This can be both a curse and a blessing because if you lazily load many properties and relationships this means you will have a high query count per page. In Doctrine 1.x lazy loading is on by default so it is often overly used. The problem is people aren&#039;t even aware that it is happening.</p>

                <h1 class="section-header ">
    <a href="#more-examples">
        More Examples
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Imagine you had a <code>User</code> and <code>Profile</code> model where <code>User</code> has one <code>Profile</code> and <code>Profile</code> has one <code>User</code>, a simple one-to-one relationship. If I were to write a DQL query where I retrieve an individual user record like the following.</p>

                    <pre class="code-block-table" id="e5e3da9a8be7dc7a7e9dd898e929d5e5529bd884"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="e5e3da9a8be7dc7a7e9dd898e929d5e5529bd884"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$q = Doctrine::getTable(<span class="hljs-string">'User'</span>)</code><code class="line language-php">  -&gt;createQuery(<span class="hljs-string">'u'</span>)</code><code class="line language-php">  -&gt;where(<span class="hljs-string">'u.username = ?'</span>, <span class="hljs-string">'jwage'</span>);</code><code class="line language-php"></code><code class="line language-php">$user = $q-&gt;fetchOne();</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>But then I wanted to retrieve the <code>Profile</code> for that <code>User</code> I could do so by simply accessing the <code>Profile</code> property on <code>User</code>.</p>

                    <pre class="code-block-table" id="ccaab743e8732636675b70629d2d76b3831f0c5a"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="ccaab743e8732636675b70629d2d76b3831f0c5a"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$profile = $user-&gt;Profile;</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>The above code would result in an additional query to the database that loads the <code>Profile</code> record for the <code>User</code> in question. Now if I were to be rendering a list of twenty <code>User</code> objects and I lazily load the profile of each user that means I would have 21 queries total! That is too many! In that case it would be smart to <code>leftJoin()</code> the <code>Profile</code> object like the following.</p>

                    <pre class="code-block-table" id="f279f4dea5593b9858e8ca214949623f18d82a0c"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f279f4dea5593b9858e8ca214949623f18d82a0c"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$q = Doctrine::getTable(<span class="hljs-string">'User'</span>)</code><code class="line language-php">  -&gt;createQuery(<span class="hljs-string">'u'</span>)</code><code class="line language-php">  -&gt;leftJoin(<span class="hljs-string">'u.Profile p'</span>);</code><code class="line language-php"></code><code class="line language-php">$users = $q-&gt;execute();</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now when I access the <code>Profile</code> relationship of an individual object the data would already be present and no lazy loading would be required.</p>

                <h1 class="section-header ">
    <a href="#why">
        Why?
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>I made this blog post because I noticed this feature being abused and overly used just because it makes things easier. The goal is to make you aware of what is happening so that you can effectively use lazy loading and not end up having applications with very high query counts per page.</p>

                
    <p>I&#039;ve seen this many times and the blame is often put on Doctrine but really it is the tool not being used properly. So, be aware of when you are lazy loading properties and the total number of queries you execute per page. Make sure you always join required relationships and only select the properties you need to access. It doesn&#039;t make sense to load data if you&#039;re not going to be using it.</p>

                <h1 class="section-header ">
    <a href="#how">
        How?
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>If you need help with keeping track of how many queries you have per page, frameworks like <a href="https://symfony.com/legacy/doc/gentle-introduction/1_4/en/16-Application-Management-Tools#chapter_16_sub_web_debug_toolbar">Symfony</a> and <a href="https://framework.zend.com/">Zend Framework</a> give you debug tools to show you how many queries you have per page. Or of course you can always use the <a href="https://www.doctrine-project.org/projects/doctrine1/en/latest/manual/component-overview.html#profiler">Profiling</a> tool built in to Doctrine to log the queries in your application and keep track of it that way.</p>

        
    
        </div>
    </article>
    </main>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?4a831b"
                            integrity="sha384-ygNM6vWkqMgvV0Lrk5BeKUupSk4CidmuzVPL3OkdAxEVjZQDo9cgbfC+FXAfoAse"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            <script
            src="https://www.doctrine-project.org/frontend/js/prismjs.js?e97886"
                            integrity="sha384-gKhxdEN1Hcl/o+IxbVbpfZRfdDPQe5dwOuCcWYbhCAhhkOl/Vi2VmnWe9/UCD6rW"
                        crossorigin="anonymous">
    </script>
    </body>
</html>
