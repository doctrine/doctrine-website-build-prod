<!DOCTYPE html>
<html>
    <head>
        <title>Using Behaviors to Share Relationship Properties - Doctrine: PHP Open Source Project</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
            <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2009/02/04/using-behaviors-to-share-relationship-properties.html"
        },
        "headline": "Using Behaviors to Share Relationship Properties",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2009-02-04T00:00:00-05:00",
        "dateModified": "2009-02-04T00:00:00-05:00",
        "author": {
            "@type": "Person",
            "name": "jwage"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "Define The Schema
        
    

                
    In this article we will demonstrate some more "
    }
    </script>
    <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/prismjs.css?d2443b"
                            integrity="sha384-IcJ7eow//K0xRBscZjnk8kawYxbm2eUAZ9D6Xf/n0yuAi1NCvwOkep1S8XqPNB3E"
                        crossorigin="anonymous"
    />

        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?5cc46a"
                        integrity="sha384-vonb47KM6nk2/R9Sju3ZEm6yxaL1E02sUWkUGIgcfejb0VD6cFCFZzEvb1r14grl"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/2009/02/04/using-behaviors-to-share-relationship-properties.html" />
        <meta property="og:title" content="Using Behaviors to Share Relationship Properties - Doctrine: PHP Open Source Project" />
        <meta property="og:description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine-website/edit/master/source/blog/2009-02-04-using-behaviors-to-share-relationship-properties.md" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
            <article>
        <div class="row">
            <div class="col-lg-8 col-12">
                <header>
                    <h2>Using Behaviors to Share Relationship Properties</h2>
                </header>

                <p class="lead">
                    Posted on <date>February 4, 2009</date>
                                            by
                                                    jwage
                                                            </p>
            </div>

            <div class="col-lg-4 col-12">
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>
            </div>
        </div>

        <hr />

        <div>
                
            
                <h1 class="section-header ">
    <a href="#define-the-schema">
        Define The Schema
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>In this article we will demonstrate some more ways to add functionality to Doctrine by using the behavior system. We will call this behavior <code>SharedProperties</code> and it allows you to share properties between your models and one-to-one relationships. Here is an example schema that will make use of the behavior we will write.</p>

                    <pre class="code-block-table" id="e39f7d9e537154872283dab847f842d7fdbb0ab8"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="e39f7d9e537154872283dab847f842d7fdbb0ab8"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[yml]</code><code class="line language-php">Entity:</code><code class="line language-php">  actAs:</code><code class="line language-php">    Sluggable:</code><code class="line language-php">      fields: [name]</code><code class="line language-php">    Timestampable:</code><code class="line language-php">  columns:</code><code class="line language-php">    name: string(<span class="hljs-number">255</span>)</code><code class="line language-php">    is_active:</code><code class="line language-php">      type: boolean</code><code class="line language-php">      <span class="hljs-keyword">default</span>: <span class="hljs-keyword">false</span></code><code class="line language-php"></code><code class="line language-php">BlogPost:</code><code class="line language-php">  actAs:</code><code class="line language-php">    SharedProperties:</code><code class="line language-php">      relations: [Entity]</code><code class="line language-php">  columns:</code><code class="line language-php">    title: <span class="hljs-string">"string(255)"</span></code><code class="line language-php">    body: clob</code><code class="line language-php"></code><code class="line language-php">User:</code><code class="line language-php">  actAs:</code><code class="line language-php">    SharedProperties:</code><code class="line language-php">      relations: [Entity]</code><code class="line language-php">  columns:</code><code class="line language-php">    username: string(<span class="hljs-number">255</span>)</code><code class="line language-php">    password: string(<span class="hljs-number">255</span>)</code><code class="line language-php"></code><code class="line language-php">Administrator:</code><code class="line language-php">  actAs:</code><code class="line language-php">    SharedProperties:</code><code class="line language-php">      relations: [User]</code><code class="line language-php">  columns:</code><code class="line language-php">    responsibilities: string(<span class="hljs-number">255</span>)</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>The schema should be somewhat self-explanatory. Each model that acts as <code>SharedProperties</code> you must specify an array of model names or existing relationship aliases. Our behavior will automatically add foreign keys for the list of models and instantiate a one-to-one relationship between the models automatically.</p>

                <h1 class="section-header ">
    <a href="#write-the-template">
        Write the Template
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Lets write the first part of our template that simply adds a column for each of the listed <code>relations</code>:</p>

                    <pre class="code-block-table" id="8dc5ad453d06b52ac58e682dfa0ca6cf3c923f48"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="8dc5ad453d06b52ac58e682dfa0ca6cf3c923f48"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedProperties</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Template</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">protected</span> $_options = <span class="hljs-keyword">array</span>();</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($options)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;_options = $options;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setTableDefinition</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>] <span class="hljs-keyword">as</span> $relation) {</code><code class="line language-php">            $columnName = Doctrine_Inflector::tableize($relation) . <span class="hljs-string">'_id'</span>;</code><code class="line language-php">            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;_table-&gt;hasColumn($columnName)) {</code><code class="line language-php">                <span class="hljs-keyword">$this</span>-&gt;hasColumn($columnName, <span class="hljs-string">'integer'</span>);</code><code class="line language-php">            }</code><code class="line language-php">        }</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="line language-php">**NOTE** You will notice we add columns <span class="hljs-keyword">for</span> each of the</code><code class="line language-php">``relations`` specified <span class="hljs-keyword">if</span> the column does not already exist. We</code><code class="line language-php">will <span class="hljs-keyword">use</span> <span class="hljs-title">these</span> <span class="hljs-title">columns</span> <span class="hljs-title">to</span> <span class="hljs-title">automatically</span> <span class="hljs-title">create</span> <span class="hljs-title">the</span></code><code class="line language-php">relationships/foreign keys between the models <span class="hljs-keyword">if</span> they don<span class="hljs-string">'t already</span></code><code class="line language-php">exist in the next step.</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h1 class="section-header ">
    <a href="#enhance-the-template">
        Enhance the Template
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Now lets enhance our template and add a <code>setUp()</code> method to instantiate our relationships between the list of <code>relations</code> and the columns we added in the previous step:</p>

                    <pre class="code-block-table" id="cc025b0caf6b2559e24c574ae1df5ddc49bc076e"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="cc025b0caf6b2559e24c574ae1df5ddc49bc076e"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedProperties</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Template</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">// ...</span></code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>] <span class="hljs-keyword">as</span> $model) {</code><code class="line language-php">            $table = <span class="hljs-keyword">$this</span>-&gt;_table;</code><code class="line language-php">            $local = Doctrine_Inflector::tableize($model) . <span class="hljs-string">'_id'</span>;</code><code class="line language-php">            $foreign = Doctrine::getTable($model)-&gt;getIdentifier();</code><code class="line language-php">            <span class="hljs-keyword">$this</span>-&gt;_makeRelation($table, $model, $local, $foreign, <span class="hljs-keyword">true</span>);</code><code class="line language-php">        }</code><code class="line language-php"></code><code class="line language-php">        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>] <span class="hljs-keyword">as</span> $model) {</code><code class="line language-php">            $table = Doctrine::getTable($model);</code><code class="line language-php">            $local = $table-&gt;getIdentifier();</code><code class="line language-php">            $foreign = Doctrine_Inflector::tableize($model) . <span class="hljs-string">'_id'</span>;</code><code class="line language-php">            <span class="hljs-keyword">$this</span>-&gt;_makeRelation($table, <span class="hljs-keyword">$this</span>-&gt;_table-&gt;getOption(<span class="hljs-string">'name'</span>), $table-&gt;getIdentifier(), $foreign);</code><code class="line language-php">        }</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_makeRelation</span><span class="hljs-params">(Doctrine_Table $table, $model, $local, $foreign, $cascade = false)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">if</span> (!$table-&gt;hasRelation($model)) {</code><code class="line language-php">            $options = <span class="hljs-keyword">array</span>(<span class="hljs-string">'local'</span>   =&gt; $local, <span class="hljs-string">'foreign'</span> =&gt; $foreign);</code><code class="line language-php">            <span class="hljs-keyword">if</span> ($cascade) {</code><code class="line language-php">                $options[<span class="hljs-string">'onDelete'</span>] = <span class="hljs-string">'CASCADE'</span>;</code><code class="line language-php">            }</code><code class="line language-php">            $table-&gt;bind(<span class="hljs-keyword">array</span>($model, $options), Doctrine_Relation::ONE);</code><code class="line language-php">        }</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h1 class="section-header ">
    <a href="#generated-sql">
        Generated SQL
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>This code we&#039;ve added now makes a one-to-one relationship between the models that act as <code>SharedProperties</code> and the list of models specified. So for example, <code>Entity</code> has one <code>BlogPost</code> and <code>BlogPost</code> has one <code>Entity</code>. The above models at this point would generate the following SQL:</p>

                    <pre class="code-block-table" id="0dc728b5b7dd8584ec02f528b1dcd8182363236d"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="0dc728b5b7dd8584ec02f528b1dcd8182363236d"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[sql]</code><code class="line language-php">CREATE TABLE administrator (id BIGINT AUTO_INCREMENT, responsibilities VARCHAR(<span class="hljs-number">255</span>), user_id BIGINT, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;</code><code class="line language-php"></code><code class="line language-php">CREATE TABLE blog_post (id BIGINT AUTO_INCREMENT, title VARCHAR(<span class="hljs-number">255</span>), body LONGTEXT, entity_id BIGINT, INDEX entity_id_idx (entity_id), PRIMARY KEY(id)) ENGINE = INNODB;</code><code class="line language-php"></code><code class="line language-php">CREATE TABLE entity (id BIGINT AUTO_INCREMENT, name VARCHAR(<span class="hljs-number">255</span>), is_active TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span>, slug VARCHAR(<span class="hljs-number">255</span>), created_at DATETIME, updated_at DATETIME, UNIQUE INDEX sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = INNODB;</code><code class="line language-php"></code><code class="line language-php">CREATE TABLE user (id BIGINT AUTO_INCREMENT, username VARCHAR(<span class="hljs-number">255</span>), password VARCHAR(<span class="hljs-number">255</span>), entity_id BIGINT, INDEX entity_id_idx (entity_id), PRIMARY KEY(id)) ENGINE = INNODB;</code><code class="line language-php"></code><code class="line language-php">ALTER TABLE administrator ADD FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;</code><code class="line language-php"></code><code class="line language-php">ALTER TABLE blog_post ADD FOREIGN KEY (entity_id) REFERENCES entity(id) ON DELETE CASCADE;</code><code class="line language-php"></code><code class="line language-php">ALTER TABLE user ADD FOREIGN KEY (entity_id) REFERENCES entity(id) ON DELETE CASCADE;</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h1 class="section-header ">
    <a href="#sharing-properties-methods">
        Sharing Properties/Methods
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Now to get to the fun, the main purpose of doing all this is to share the properties of these relationships. We can accomplish this by using the <code>Doctrine_Record_Filter</code> feature and some magic PHP <code>__call()</code> functionality. First lets modify our template to attach a new record filter.</p>

                <blockquote>
    <p><strong>TIP</strong> Records filters in Doctrine allow you to handle all unknown properties access on a Doctrine object. This allows us to forward the calls on to the relationships so you can access properties from them.</p>
</blockquote>
                    <pre class="code-block-table" id="1ba4e3bdcd49852eef3f4932c99b1212b5b214e3"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="1ba4e3bdcd49852eef3f4932c99b1212b5b214e3"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedProperties</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Template</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">// ...</span></code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setTableDefinition</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-comment">// ...</span></code><code class="line language-php"></code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;_table-&gt;unshiftFilter(<span class="hljs-keyword">new</span> SharedPropertiesFilter(<span class="hljs-keyword">$this</span>-&gt;_options));</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">// ...</span></code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now that we have attached our filter we need to write that class:</p>

                    <pre class="code-block-table" id="84f722386809d954a223b362266b4e0c0b2e9195"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="84f722386809d954a223b362266b4e0c0b2e9195"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedPropertiesFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Record_Filter</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">protected</span> $_options = <span class="hljs-keyword">array</span>();</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($options)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;_options = $options;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>] <span class="hljs-keyword">as</span> $model) {</code><code class="line language-php">            <span class="hljs-keyword">$this</span>-&gt;_table-&gt;getRelation($model);</code><code class="line language-php">        }</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterSet</span><span class="hljs-params">(Doctrine_Record $record, $name, $value)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>] <span class="hljs-keyword">as</span> $model) {</code><code class="line language-php">            <span class="hljs-keyword">try</span> {</code><code class="line language-php">                $record-&gt;$model-&gt;$name = $value;</code><code class="line language-php">                <span class="hljs-keyword">return</span> $record;</code><code class="line language-php">            } <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">Exception</span> $e) {}</code><code class="line language-php">        }</code><code class="line language-php">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Doctrine_Record_UnknownPropertyException(sprintf(<span class="hljs-string">'Unknown record property / related component "%s" on "%s"'</span>, $name, get_class($record)));</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterGet</span><span class="hljs-params">(Doctrine_Record $record, $name)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>] <span class="hljs-keyword">as</span> $model) {</code><code class="line language-php">            <span class="hljs-keyword">try</span> {</code><code class="line language-php">                <span class="hljs-keyword">return</span> $record-&gt;$model-&gt;$name;</code><code class="line language-php">            } <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">Exception</span> $e) {}</code><code class="line language-php">        }</code><code class="line language-php">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Doctrine_Record_UnknownPropertyException(sprintf(<span class="hljs-string">'Unknown record property / related component "%s" on "%s"'</span>, $name, get_class($record)));</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now you can see this filter checks to see if the property exists on any of the <code>relations</code> specified otherwise throws the normal <code>Doctrine_Record_UnknownPropertyException</code>.</p>

                
    <p>The last thing we need to do is add a magic <code>__call()</code> function to our template to handle the forwarding of any unknown methods to the <code>relations</code>:</p>

                    <pre class="code-block-table" id="be55d9a17461f3dd418939244639909e6eb84afb"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="be55d9a17461f3dd418939244639909e6eb84afb"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedProperties</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Template</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">// ...</span></code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span><span class="hljs-params">($method, $arguments)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        $invoker = <span class="hljs-keyword">$this</span>-&gt;getInvoker();</code><code class="line language-php">        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>] <span class="hljs-keyword">as</span> $model) {</code><code class="line language-php">            <span class="hljs-keyword">try</span> {</code><code class="line language-php">                <span class="hljs-keyword">return</span> call_user_func_array(<span class="hljs-keyword">array</span>($invoker-&gt;$model, $method), $arguments);</code><code class="line language-php">            } <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">Exception</span> $e) {</code><code class="line language-php">                <span class="hljs-keyword">continue</span>;</code><code class="line language-php">            }</code><code class="line language-php">        }</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>This is required if we have functions defined on the models and want to be able to access these methods. So for example if we were to add a <code>setPassword()</code> method to the generated <code>User</code> class like the following:</p>

                    <pre class="code-block-table" id="ec46270965194057db236e020bdbe2cb78e4947f"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="ec46270965194057db236e020bdbe2cb78e4947f"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseUser</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setPassword</span><span class="hljs-params">($password)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;_set(<span class="hljs-string">'password'</span>, md5($password));</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Without the above <code>__call()</code> function we would not be able to do the following:</p>

                    <pre class="code-block-table" id="8d5fbf7d37aa94b40e3ac30dff74857f6583b24b"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="8d5fbf7d37aa94b40e3ac30dff74857f6583b24b"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$administrator = <span class="hljs-keyword">new</span> Administrator();</code><code class="line language-php">$administrator-&gt;setPassword(<span class="hljs-string">'new_password'</span>);</code><code class="line language-php"></code><code class="line language-php">**TIP** **Auto Accessor <span class="hljs-keyword">and</span> Mutator Overriding**</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">If</span> you want Doctrine to automatically override accessors with</code><code class="line language-php">matching ``set*()`` <span class="hljs-keyword">and</span> ``get*()`` functions then you need to</code><code class="line language-php">enable the ``auto_accessor_override`` attribute in your</code><code class="line language-php">configuration where you create your connections <span class="hljs-keyword">and</span> set Doctrine</code><code class="line language-php">attributes:</code><code class="line language-php"></code><code class="empty"></code></pre>
                    <pre class="code-block-table" id="ecb56cdf5ed10432ebd24ed7c73fc266abdeeccf"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="ecb56cdf5ed10432ebd24ed7c73fc266abdeeccf"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">    $manager = Doctrine_Manager::getInstance();</code><code class="line language-php">    $manager-&gt;setAttribute(<span class="hljs-string">'auto_accessor_override'</span>, <span class="hljs-keyword">true</span>);</code><code class="line language-php"></code><code class="line language-php">Now with that attribute the following is possible. Instead of</code><code class="line language-php">having to call the method ``setPassword()``, Doctrine sees you are</code><code class="line language-php">setting the ``password`` <span class="hljs-keyword">and</span> a method named ``setPassword()``</code><code class="line language-php">exists so it uses it to <span class="hljs-keyword">do</span> the mutating.</code><code class="line language-php"></code><code class="empty"></code></pre>
                    <pre class="code-block-table" id="0e7c2b755d7c4aada7cf1c0baac5bab6e7a600c6"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="0e7c2b755d7c4aada7cf1c0baac5bab6e7a600c6"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">    $administrator-&gt;password = <span class="hljs-string">'new_password'</span>;</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h1 class="section-header ">
    <a href="#example-usage">
        Example Usage
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>That is it! Our behavior is implemented and we are ready to write some code that use our new models.</p>

                <h2 class="section-header ">
    <a href="#creating-new-records">
        Creating New Records
        <i class="fas fa-link"></i>
    </a>
</h2>
                    <pre class="code-block-table" id="9f4b66f76f1f51eb9327aacd2bdcdff0bd820a92"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="9f4b66f76f1f51eb9327aacd2bdcdff0bd820a92"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$admin = <span class="hljs-keyword">new</span> Administrator();</code><code class="line language-php">$admin-&gt;name = <span class="hljs-string">'Jonathan H. Wage'</span>;</code><code class="line language-php">$admin-&gt;username = <span class="hljs-string">'jwage'</span>;</code><code class="line language-php">$admin-&gt;password = <span class="hljs-string">'changeme'</span>;</code><code class="line language-php">$admin-&gt;is_active = <span class="hljs-number">1</span>;</code><code class="line language-php">$admin-&gt;responsibilities = <span class="hljs-string">'Train all the PHP developers!'</span>;</code><code class="line language-php">$admin-&gt;save();</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now that code results in the following structure being persisted to the database:</p>

                    <pre class="code-block-table" id="f0443fe04ff6086bb3a217a622eafc33c70e4cf1"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f0443fe04ff6086bb3a217a622eafc33c70e4cf1"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">print_r($admin-&gt;toArray(<span class="hljs-keyword">true</span>));</code><code class="line language-php"><span class="hljs-comment">/*</span></code><code class="line language-php"><span class="hljs-keyword">Array</span></code><code class="line language-php">(</code><code class="line language-php">    [id] =&gt; <span class="hljs-number">2</span></code><code class="line language-php">    [responsibilities] =&gt; Train all the PHP developers!</code><code class="line language-php">    [user_id] =&gt; <span class="hljs-number">2</span></code><code class="line language-php">    [User] =&gt; <span class="hljs-keyword">Array</span></code><code class="line language-php">        (</code><code class="line language-php">            [id] =&gt; <span class="hljs-number">2</span></code><code class="line language-php">            [username] =&gt; jwage</code><code class="line language-php">            [password] =&gt; <span class="hljs-number">4</span>cb9c8a8048fd02294477fcb1a41191a</code><code class="line language-php">            [entity_id] =&gt; <span class="hljs-number">3</span></code><code class="line language-php">            [Entity] =&gt; <span class="hljs-keyword">Array</span></code><code class="line language-php">                (</code><code class="line language-php">                    [id] =&gt; <span class="hljs-number">3</span></code><code class="line language-php">                    [name] =&gt; Jonathan H. Wage</code><code class="line language-php">                    [is_active] =&gt; <span class="hljs-number">1</span></code><code class="line language-php">                    [slug] =&gt; jonathan-h-wage</code><code class="line language-php">                    [created_at] =&gt; <span class="hljs-number">2009</span><span class="hljs-number">-02</span><span class="hljs-number">-04</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span>:<span class="hljs-number">12</span></code><code class="line language-php">                    [updated_at] =&gt; <span class="hljs-number">2009</span><span class="hljs-number">-02</span><span class="hljs-number">-04</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span>:<span class="hljs-number">12</span></code><code class="line language-php">                )</code><code class="line language-php"></code><code class="line language-php">        )</code><code class="line language-php"></code><code class="line language-php">)</code><code class="line language-php">*/</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h2 class="section-header ">
    <a href="#data-fixtures">
        Data Fixtures
        <i class="fas fa-link"></i>
    </a>
</h2>
                
    <p>Similarly, the following data fixtures would be possible:</p>

                    <pre class="code-block-table" id="74c7aa44b0165f764cc34b6f39b3a75a3ea3c6a7"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="74c7aa44b0165f764cc34b6f39b3a75a3ea3c6a7"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[yml]</code><code class="line language-php">BlogPost:</code><code class="line language-php">  BlogPost_1:</code><code class="line language-php">    name: Test Blog Post</code><code class="line language-php">    title: <span class="hljs-string">"This is a test blog post"</span></code><code class="line language-php">    body: This is a test blog post</code><code class="line language-php"></code><code class="line language-php">Administrator:</code><code class="line language-php">  Administrator_1:</code><code class="line language-php">    name: Test Manager</code><code class="line language-php">    username: jwage</code><code class="line language-php">    password: changeme</code><code class="line language-php">    responsibilities: Overseeing development department</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h2 class="section-header ">
    <a href="#querying-for-and-accessing-data">
        Querying For and Accessing Data
        <i class="fas fa-link"></i>
    </a>
</h2>
                
    <p>You can query for these relationships as well:</p>

                    <pre class="code-block-table" id="6a873d4a05ffe047e9c6d784801965e20c0a3dae"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="6a873d4a05ffe047e9c6d784801965e20c0a3dae"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$q = Doctrine_Query::create()</code><code class="line language-php">    -&gt;from(<span class="hljs-string">'Administrator a'</span>)</code><code class="line language-php">    -&gt;leftJoin(<span class="hljs-string">'a.User u'</span>)</code><code class="line language-php">    -&gt;leftJoin(<span class="hljs-string">'u.Entity e'</span>)</code><code class="line language-php">    -&gt;where(<span class="hljs-string">'u.username = ?'</span>, <span class="hljs-string">'jwage'</span>);</code><code class="line language-php"></code><code class="line language-php">$user = $q-&gt;fetchOne();</code><code class="line language-php"><span class="hljs-keyword">echo</span> $user[<span class="hljs-string">'created_at'</span>];</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>The above code would output the value of the <code>created_at</code> column that actually exists in the <code>Entity</code> model that is available through the <code>Administrator-&gt;User-&gt;Entity</code> relations.</p>

        
    
        </div>
    </article>
    </main>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?1546fc"
                            integrity="sha384-ix9eb2EZyp9uayYpxmCQoylbz8msHl5wOg/aqZnD/3cxszNUGePN656MRg5GEgbm"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            <script
            src="https://www.doctrine-project.org/frontend/js/prismjs.js?8aa1bb"
                            integrity="sha384-3EhgfeqnppOxFBVU40g8gS+IVvmh5+wGpe4mG2otPyExrkK9t4aq8uCUy2IDLKkR"
                        crossorigin="anonymous">
    </script>
    </body>
</html>
