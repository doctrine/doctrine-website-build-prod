<!DOCTYPE html>
<html>
    <head>
        <title>Cookbook Recipe: Relation DQL Behavior - Doctrine: PHP Open Source Project</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
            <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2009/01/28/cookbook-recipe-relation-dql-behavior.html"
        },
        "headline": "Cookbook Recipe: Relation DQL Behavior",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2009-01-28T00:00:00-05:00",
        "dateModified": "2009-01-28T00:00:00-05:00",
        "author": {
            "@type": "Person",
            "name": "jwage"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "Today I will teach you how to write a simple Doctrine behavior. You will learn some of the basics of"
    }
    </script>
    <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/prismjs.css?d2443b"
                            integrity="sha384-IcJ7eow//K0xRBscZjnk8kawYxbm2eUAZ9D6Xf/n0yuAi1NCvwOkep1S8XqPNB3E"
                        crossorigin="anonymous"
    />

        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?74d1a1"
                        integrity="sha384-dAaEn2ZyD87ZE8ZaTOc39tmNlPuZWU7Tvl3K1W/IXH5rtko68QAI5cdG6HLv97IH"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/2009/01/28/cookbook-recipe-relation-dql-behavior.html" />
        <meta property="og:title" content="Cookbook Recipe: Relation DQL Behavior - Doctrine: PHP Open Source Project" />
        <meta property="og:description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine-website/edit/master/source/blog/2009-01-28-cookbook-recipe-relation-dql-behavior.md" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
            <article>
        <div class="row">
            <div class="col-lg-8 col-12">
                <header>
                    <h2>Cookbook Recipe: Relation DQL Behavior</h2>
                </header>

                <p class="lead">
                    Posted on <date>January 28, 2009</date>
                                            by
                                                    jwage
                                                            </p>
            </div>

            <div class="col-lg-4 col-12">
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>
            </div>
        </div>

        <hr />

        <div>
                
            
                
    <p>Today I will teach you how to write a simple Doctrine behavior. You will learn some of the basics of creating a behavior and you will gain some pretty cool functionality for your relationships.</p>

                
    <p>We will write a behavior called <code>RelationDql</code> which allows you to add default query parts that are automatically added to your queries when you reference the specified relationships. So first we will get started by looking at an example schema we can apply this to.</p>

                
    <p>Here is an example schema where we have a <code>Site</code>, <code>BlogPost</code> and <code>Tag</code> model:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="5eba27ae679b1bc4369de2f491bbd241d7ac0bdd"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="5eba27ae679b1bc4369de2f491bbd241d7ac0bdd"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-1" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-1">1</a></td><td class="code-line" rowspan="37">[yml]
Site:
  columns:
    name: string(<span class="hljs-number">255</span>)

BlogPost:
  actAs: [Timestampable]
  columns:
    title: <span class="hljs-string">"string(255)"</span>
    body: clob
    site_id: integer
  relations:
    Site:
      foreignAlias: BlogPosts
    Tags:
      <span class="hljs-class"><span class="hljs-keyword">class</span>: <span class="hljs-title">Tag</span>
      <span class="hljs-title">refClass</span>: <span class="hljs-title">BlogPostTag</span>
      <span class="hljs-title">foreignAlias</span>: <span class="hljs-title">BlogPosts</span>

<span class="hljs-title">Tag</span>:
  <span class="hljs-title">columns</span>:
    <span class="hljs-title">name</span>: <span class="hljs-title">string</span>(255)

<span class="hljs-title">BlogPostTag</span>:
  <span class="hljs-title">columns</span>:
    <span class="hljs-title">blog_post_id</span>:
      <span class="hljs-title">type</span>: <span class="hljs-title">integer</span>
      <span class="hljs-title">primary</span>: <span class="hljs-title">true</span>
    <span class="hljs-title">tag_id</span>:
      <span class="hljs-title">type</span>: <span class="hljs-title">integer</span>
      <span class="hljs-title">primary</span>: <span class="hljs-title">true</span>
  <span class="hljs-title">relations</span>:
    <span class="hljs-title">BlogPost</span>:
      <span class="hljs-title">foreignAlias</span>: <span class="hljs-title">BlogPostTags</span>
    <span class="hljs-title">Tag</span>:
      <span class="hljs-title">foreignAlias</span>: <span class="hljs-title">BlogPostTags</span>
</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-2" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-3" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-4" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-5" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-6" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-7" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-8" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-9" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-10" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-11" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-12" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-13" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-14" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-15" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-16" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-16">16</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-17" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-17">17</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-18" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-18">18</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-19" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-19">19</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-20" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-20">20</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-21" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-21">21</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-22" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-22">22</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-23" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-23">23</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-24" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-24">24</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-25" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-25">25</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-26" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-26">26</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-27" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-27">27</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-28" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-28">28</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-29" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-29">29</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-30" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-30">30</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-31" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-31">31</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-32" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-32">32</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-33" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-33">33</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-34" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-34">34</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-35" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-35">35</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-36" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-36">36</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-37" class="line-number-anchor" /><a href="#line-number-5eba27ae679b1bc4369de2f491bbd241d7ac0bdd-37">37</a></td></tr></table></div></code></pre>
                
    <p>This is a fairly simple schema as you can see, but what if we want to have a relationship on the <code>Site</code> model to retrieve the latest five <code>BlogPost</code> records or order the <code>Tags</code> relationship alphabetically by default?</p>

                
    <p>Lets modify our schema to take into account a new behavior that we will write in the next step. First modify the <code>Site</code> model and a relationship named <code>LatestBlogPosts</code>:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="15430f4e49d4147a6e7b6ee0272058799d0be45b"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="15430f4e49d4147a6e7b6ee0272058799d0be45b"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-1" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-1">1</a></td><td class="code-line" rowspan="21">[yml]
Site:
  actAs:
    RelationDql:
      relations:
        LatestBlogPosts:
          orderBy: %s.created_at DESC
          limit: <span class="hljs-number">5</span>
  columns:
    name: string(<span class="hljs-number">255</span>)
  relations:
    LatestBlogPosts:
      autoComplete: <span class="hljs-keyword">false</span>
      <span class="hljs-class"><span class="hljs-keyword">class</span>: <span class="hljs-title">BlogPost</span>
      <span class="hljs-title">local</span>: <span class="hljs-title">id</span>
      <span class="hljs-title">foreign</span>: <span class="hljs-title">site_id</span>

**<span class="hljs-title">TIP</span>** <span class="hljs-title">The</span> ``<span class="hljs-title">autoComplete</span>`` <span class="hljs-title">option</span> <span class="hljs-title">is</span> <span class="hljs-title">set</span> <span class="hljs-title">to</span> ``<span class="hljs-title">false</span>`` <span class="hljs-title">so</span> <span class="hljs-title">that</span> <span class="hljs-title">the</span>
<span class="hljs-title">relationship</span> <span class="hljs-title">is</span> <span class="hljs-title">not</span> <span class="hljs-title">reflected</span> <span class="hljs-title">and</span> <span class="hljs-title">added</span> <span class="hljs-title">to</span> <span class="hljs-title">the</span> <span class="hljs-title">opposite</span> <span class="hljs-title">end</span>,
``<span class="hljs-title">BlogPost</span>`` <span class="hljs-title">automatically</span>.
</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-2" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-3" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-4" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-5" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-6" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-7" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-8" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-9" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-10" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-11" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-12" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-13" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-14" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-15" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-16" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-16">16</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-17" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-17">17</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-18" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-18">18</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-19" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-19">19</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-20" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-20">20</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-21" class="line-number-anchor" /><a href="#line-number-15430f4e49d4147a6e7b6ee0272058799d0be45b-21">21</a></td></tr></table></div></code></pre>
                
    <p>Now lets modify the <code>BlogPost</code> model to change the <code>Tags</code> relationship so that it is ordered alphabetically by name by default:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="aa0c076cca45de856ec0b17b54d55884f3224d4b"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="aa0c076cca45de856ec0b17b54d55884f3224d4b"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-1" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-1">1</a></td><td class="code-line" rowspan="25">[yml]
BlogPost:
  actAs:
    Timestampable:
    RelationDql:
      relations:
        Tags:
          orderBy: %s.name ASC
  columns:
    title: <span class="hljs-string">"string(255)"</span>
    body: clob
    site_id: integer
  relations:
    Site:
      foreignAlias: BlogPosts
    Tags:
      <span class="hljs-class"><span class="hljs-keyword">class</span>: <span class="hljs-title">Tag</span>
      <span class="hljs-title">refClass</span>: <span class="hljs-title">BlogPostTag</span>
      <span class="hljs-title">foreignAlias</span>: <span class="hljs-title">BlogPosts</span>

**<span class="hljs-title">TIP</span>** <span class="hljs-title">The</span> ``<span class="hljs-title">relations</span>`` <span class="hljs-title">array</span> <span class="hljs-title">is</span> <span class="hljs-title">an</span> <span class="hljs-title">array</span> <span class="hljs-title">of</span> <span class="hljs-title">changes</span> <span class="hljs-title">to</span> <span class="hljs-title">make</span> <span class="hljs-title">to</span>
<span class="hljs-title">the</span> <span class="hljs-title">DQL</span> <span class="hljs-title">query</span>. <span class="hljs-title">The</span> <span class="hljs-title">key</span> <span class="hljs-title">can</span> <span class="hljs-title">be</span> <span class="hljs-title">any</span> <span class="hljs-title">valid</span> <span class="hljs-title">function</span> <span class="hljs-title">on</span> <span class="hljs-title">the</span>
``<span class="hljs-title">Doctrine_Query</span>`` <span class="hljs-title">API</span> <span class="hljs-title">and</span> <span class="hljs-title">the</span> <span class="hljs-title">value</span> <span class="hljs-title">is</span> <span class="hljs-title">of</span> <span class="hljs-title">course</span> <span class="hljs-title">the</span> <span class="hljs-title">parameter</span> <span class="hljs-title">to</span>
<span class="hljs-title">pass</span> <span class="hljs-title">to</span> <span class="hljs-title">the</span> <span class="hljs-title">function</span>.
</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-2" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-3" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-4" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-5" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-6" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-7" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-8" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-9" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-10" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-11" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-12" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-13" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-14" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-15" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-16" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-16">16</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-17" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-17">17</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-18" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-18">18</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-19" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-19">19</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-20" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-20">20</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-21" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-21">21</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-22" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-22">22</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-23" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-23">23</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-24" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-24">24</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-25" class="line-number-anchor" /><a href="#line-number-aa0c076cca45de856ec0b17b54d55884f3224d4b-25">25</a></td></tr></table></div></code></pre>
                
    <p>Now that we have our schemas modified to take into account the new <code>RelationDql</code> behavior we need to actually write the code:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="c115ec3d4a09a025af4958d43d747aff5e45d0ca"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="c115ec3d4a09a025af4958d43d747aff5e45d0ca"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-1" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-1">1</a></td><td class="code-line" rowspan="16"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RelationDql</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Template</span>
</span>{
  <span class="hljs-keyword">protected</span> $_options = <span class="hljs-keyword">array</span>();

  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($options)</span>
  </span>{
    <span class="hljs-keyword">$this</span>-&gt;_options = $options;
  }

  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setTableDefinition</span><span class="hljs-params">()</span>
  </span>{
    <span class="hljs-keyword">$this</span>-&gt;_table-&gt;addRecordListener(<span class="hljs-keyword">new</span> RelationDqlListener(<span class="hljs-keyword">$this</span>-&gt;_options));
  }
}
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-2" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-3" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-4" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-5" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-6" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-7" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-8" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-9" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-10" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-11" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-12" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-13" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-14" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-15" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-16" class="line-number-anchor" /><a href="#line-number-c115ec3d4a09a025af4958d43d747aff5e45d0ca-16">16</a></td></tr></table></div></code></pre>
                
    <p>The template is very simple. It only attaches a record listener to the invoking table. Their is where most of the magic happens. So now lets define the <code>RelationDqlListener</code> class:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="3f07ad66e05abd451217e6b0c62f98ac2f68125e"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="3f07ad66e05abd451217e6b0c62f98ac2f68125e"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-1" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-1">1</a></td><td class="code-line" rowspan="59"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RelationDqlListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Record_Listener</span>
</span>{
  <span class="hljs-keyword">protected</span> $_options = <span class="hljs-keyword">array</span>(<span class="hljs-string">'relations'</span> =&gt; <span class="hljs-keyword">array</span>());

  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($options)</span>
  </span>{
    <span class="hljs-keyword">$this</span>-&gt;_options = $options;
  }

  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">preDqlSelect</span><span class="hljs-params">(Doctrine_Event $event)</span>
  </span>{
    $query = $event-&gt;getQuery();

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>]))
    {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Doctrine_Exception(
        <span class="hljs-string">'You must specify at least one relationship to add DQL to'</span>
      );
    }

    $relations = <span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>];

    $components = <span class="hljs-keyword">$this</span>-&gt;_getDqlCallbackComponents($query);
    <span class="hljs-keyword">foreach</span> ($components <span class="hljs-keyword">as</span> $alias =&gt; $component)
    {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($component[<span class="hljs-string">'relation'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>($relations[$component[<span class="hljs-string">'relation'</span>]-&gt;getAlias()]))
      {
        $dqls = $relations[$component[<span class="hljs-string">'relation'</span>]-&gt;getAlias()];
        <span class="hljs-keyword">foreach</span> ($dqls <span class="hljs-keyword">as</span> $func =&gt; $dql)
        {
          $dql = str_replace(<span class="hljs-string">'%s'</span>, $alias, $dql);
          $query-&gt;$func($dql);
        }
        <span class="hljs-keyword">unset</span>($relations[$component[<span class="hljs-string">'relation'</span>]-&gt;getAlias()]);
      }
    }
  }

  <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getDqlCallbackComponents</span><span class="hljs-params">($query)</span>
  </span>{
      $params = $query-&gt;getParams();
      $componentsBefore = <span class="hljs-keyword">array</span>();
      <span class="hljs-keyword">if</span> ($query-&gt;isSubquery()) {
          $componentsBefore = $query-&gt;getQueryComponents();
      }

      $copy = $query-&gt;copy();
      $copy-&gt;getSqlQuery($params);
      $componentsAfter = $copy-&gt;getQueryComponents();

      <span class="hljs-keyword">if</span> ($componentsBefore !== $componentsAfter) {
          <span class="hljs-keyword">return</span> array_diff($componentsAfter, $componentsBefore);
      } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> $componentsAfter;
      }
  }
}
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-2" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-3" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-4" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-5" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-6" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-7" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-8" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-9" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-10" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-11" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-12" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-13" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-14" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-15" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-16" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-16">16</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-17" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-17">17</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-18" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-18">18</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-19" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-19">19</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-20" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-20">20</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-21" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-21">21</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-22" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-22">22</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-23" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-23">23</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-24" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-24">24</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-25" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-25">25</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-26" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-26">26</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-27" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-27">27</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-28" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-28">28</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-29" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-29">29</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-30" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-30">30</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-31" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-31">31</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-32" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-32">32</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-33" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-33">33</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-34" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-34">34</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-35" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-35">35</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-36" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-36">36</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-37" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-37">37</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-38" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-38">38</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-39" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-39">39</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-40" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-40">40</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-41" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-41">41</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-42" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-42">42</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-43" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-43">43</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-44" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-44">44</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-45" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-45">45</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-46" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-46">46</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-47" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-47">47</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-48" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-48">48</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-49" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-49">49</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-50" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-50">50</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-51" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-51">51</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-52" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-52">52</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-53" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-53">53</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-54" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-54">54</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-55" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-55">55</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-56" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-56">56</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-57" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-57">57</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-58" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-58">58</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-59" class="line-number-anchor" /><a href="#line-number-3f07ad66e05abd451217e6b0c62f98ac2f68125e-59">59</a></td></tr></table></div></code></pre>
                
    <p>So now we have the behavior defined so lets look at some example DQL queries and the SQL that is outputted:</p>

                <blockquote>
    <p><strong>TIP</strong> Remember, in order for the dql callbacks to be executed we must enable an attribute first.</p>
</blockquote>
                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="df86ae3851b80c3fdad9d63c8305b18695c3989d"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="df86ae3851b80c3fdad9d63c8305b18695c3989d"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-df86ae3851b80c3fdad9d63c8305b18695c3989d-1" class="line-number-anchor" /><a href="#line-number-df86ae3851b80c3fdad9d63c8305b18695c3989d-1">1</a></td><td class="code-line" rowspan="3"><span class="hljs-meta">&lt;?php</span>
    $manager-&gt;setAttribute(<span class="hljs-string">'use_dql_callbacks'</span>, <span class="hljs-keyword">true</span>);
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-df86ae3851b80c3fdad9d63c8305b18695c3989d-2" class="line-number-anchor" /><a href="#line-number-df86ae3851b80c3fdad9d63c8305b18695c3989d-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-df86ae3851b80c3fdad9d63c8305b18695c3989d-3" class="line-number-anchor" /><a href="#line-number-df86ae3851b80c3fdad9d63c8305b18695c3989d-3">3</a></td></tr></table></div></code></pre>
                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="cb71f1d6c670996b3aca88095c55649bd4308abd"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="cb71f1d6c670996b3aca88095c55649bd4308abd"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-1" class="line-number-anchor" /><a href="#line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-1">1</a></td><td class="code-line" rowspan="8"><span class="hljs-meta">&lt;?php</span>
$q = Doctrine_Query::create()
  -&gt;select(<span class="hljs-string">'s.name, p.title, p.created_at'</span>)
  -&gt;from(<span class="hljs-string">'Site s'</span>)
  -&gt;leftJoin(<span class="hljs-string">'s.LatestBlogPosts p'</span>);

<span class="hljs-keyword">echo</span> $q-&gt;getSql();
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-2" class="line-number-anchor" /><a href="#line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-3" class="line-number-anchor" /><a href="#line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-4" class="line-number-anchor" /><a href="#line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-5" class="line-number-anchor" /><a href="#line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-6" class="line-number-anchor" /><a href="#line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-7" class="line-number-anchor" /><a href="#line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-8" class="line-number-anchor" /><a href="#line-number-cb71f1d6c670996b3aca88095c55649bd4308abd-8">8</a></td></tr></table></div></code></pre>
                
    <p>The above would output the following SQL:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="03a73d13e1058ba35f76e6dd34d18a127e1fbe62"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="03a73d13e1058ba35f76e6dd34d18a127e1fbe62"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-1" class="line-number-anchor" /><a href="#line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-1">1</a></td><td class="code-line" rowspan="6">[sql]
SELECT s.id <span class="hljs-keyword">AS</span> s__id, s.name <span class="hljs-keyword">AS</span> s__name, b.id <span class="hljs-keyword">AS</span> b__id, b.title <span class="hljs-keyword">AS</span> b__title, b.created_at <span class="hljs-keyword">AS</span> b__created_at FROM site s LEFT JOIN blog_post b ON s.id = b.site_id ORDER BY b.created_at DESC LIMIT <span class="hljs-number">5</span>

**NOTE** Notice how the ``ORDER BY`` <span class="hljs-keyword">and</span> ``LIMIT`` were added to
the query.
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-2" class="line-number-anchor" /><a href="#line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-3" class="line-number-anchor" /><a href="#line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-4" class="line-number-anchor" /><a href="#line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-5" class="line-number-anchor" /><a href="#line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-6" class="line-number-anchor" /><a href="#line-number-03a73d13e1058ba35f76e6dd34d18a127e1fbe62-6">6</a></td></tr></table></div></code></pre>
                
    <p>Now lets look at an example that involves the <code>BlogPost</code> tags:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="548907a5bc543bae6f023cad4f3477d407e49a95"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="548907a5bc543bae6f023cad4f3477d407e49a95"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-548907a5bc543bae6f023cad4f3477d407e49a95-1" class="line-number-anchor" /><a href="#line-number-548907a5bc543bae6f023cad4f3477d407e49a95-1">1</a></td><td class="code-line" rowspan="7"><span class="hljs-meta">&lt;?php</span>
$q = Doctrine_Query::create()
  -&gt;from(<span class="hljs-string">'BlogPost p'</span>)
  -&gt;leftJoin(<span class="hljs-string">'p.Tags t'</span>);

<span class="hljs-keyword">echo</span> $q-&gt;getSql();
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-548907a5bc543bae6f023cad4f3477d407e49a95-2" class="line-number-anchor" /><a href="#line-number-548907a5bc543bae6f023cad4f3477d407e49a95-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-548907a5bc543bae6f023cad4f3477d407e49a95-3" class="line-number-anchor" /><a href="#line-number-548907a5bc543bae6f023cad4f3477d407e49a95-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-548907a5bc543bae6f023cad4f3477d407e49a95-4" class="line-number-anchor" /><a href="#line-number-548907a5bc543bae6f023cad4f3477d407e49a95-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-548907a5bc543bae6f023cad4f3477d407e49a95-5" class="line-number-anchor" /><a href="#line-number-548907a5bc543bae6f023cad4f3477d407e49a95-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-548907a5bc543bae6f023cad4f3477d407e49a95-6" class="line-number-anchor" /><a href="#line-number-548907a5bc543bae6f023cad4f3477d407e49a95-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-548907a5bc543bae6f023cad4f3477d407e49a95-7" class="line-number-anchor" /><a href="#line-number-548907a5bc543bae6f023cad4f3477d407e49a95-7">7</a></td></tr></table></div></code></pre>
                
    <p>The above would output the following SQL query:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="342b4e270c96af12b66b099f87735f47c426bf8b"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="342b4e270c96af12b66b099f87735f47c426bf8b"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-342b4e270c96af12b66b099f87735f47c426bf8b-1" class="line-number-anchor" /><a href="#line-number-342b4e270c96af12b66b099f87735f47c426bf8b-1">1</a></td><td class="code-line" rowspan="3">[sql]
SELECT b.id <span class="hljs-keyword">AS</span> b__id, b.title <span class="hljs-keyword">AS</span> b__title, b.body <span class="hljs-keyword">AS</span> b__body, b.site_id <span class="hljs-keyword">AS</span> b__site_id, b.created_at <span class="hljs-keyword">AS</span> b__created_at, b.updated_at <span class="hljs-keyword">AS</span> b__updated_at, t.id <span class="hljs-keyword">AS</span> t__id, t.name <span class="hljs-keyword">AS</span> t__name FROM blog_post b LEFT JOIN blog_post_tag b2 ON b.id = b2.blog_post_id LEFT JOIN tag t ON t.id = b2.tag_id ORDER BY t.name ASC
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-342b4e270c96af12b66b099f87735f47c426bf8b-2" class="line-number-anchor" /><a href="#line-number-342b4e270c96af12b66b099f87735f47c426bf8b-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-342b4e270c96af12b66b099f87735f47c426bf8b-3" class="line-number-anchor" /><a href="#line-number-342b4e270c96af12b66b099f87735f47c426bf8b-3">3</a></td></tr></table></div></code></pre>
                
    <p>As you can see the <code>ORDER BY</code> clause to order the related tags by <code>name</code> was added for us.</p>

                
    <p>Pretty cool huh? You can use this in your projects to make your relationships a little nicer.</p>

        
    
        </div>
    </article>
    </main>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?1546fc"
                            integrity="sha384-ix9eb2EZyp9uayYpxmCQoylbz8msHl5wOg/aqZnD/3cxszNUGePN656MRg5GEgbm"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            <script
            src="https://www.doctrine-project.org/frontend/js/prismjs.js?8aa1bb"
                            integrity="sha384-3EhgfeqnppOxFBVU40g8gS+IVvmh5+wGpe4mG2otPyExrkK9t4aq8uCUy2IDLKkR"
                        crossorigin="anonymous">
    </script>
    </body>
</html>
