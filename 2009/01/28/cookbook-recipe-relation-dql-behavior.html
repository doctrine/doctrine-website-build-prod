<!DOCTYPE html>
<html>
    <head>
        <title>Cookbook Recipe: Relation DQL Behavior - Doctrine: PHP Open Source Project</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
            <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2009/01/28/cookbook-recipe-relation-dql-behavior.html"
        },
        "headline": "Cookbook Recipe: Relation DQL Behavior",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2009-01-28T00:00:00-05:00",
        "dateModified": "2009-01-28T00:00:00-05:00",
        "author": {
            "@type": "Person",
            "name": "jwage"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "Today I will teach you how to write a simple Doctrine behavior. You will learn some of the basics of"
    }
    </script>
    <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/prismjs.css?d2443b"
                            integrity="sha384-IcJ7eow//K0xRBscZjnk8kawYxbm2eUAZ9D6Xf/n0yuAi1NCvwOkep1S8XqPNB3E"
                        crossorigin="anonymous"
    />

        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?e935b6"
                        integrity="sha384-0+XwQ7PUNkbj10v4XDjjp7VJzfahtyhEtNyFDNmWQaR7ohGXNow7qYgClWx6rQoS"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/2009/01/28/cookbook-recipe-relation-dql-behavior.html" />
        <meta property="og:title" content="Cookbook Recipe: Relation DQL Behavior - Doctrine: PHP Open Source Project" />
        <meta property="og:description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine-website/edit/master/source/blog/2009-01-28-cookbook-recipe-relation-dql-behavior.md" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
            <article>
        <div class="row">
            <div class="col-lg-8 col-12">
                <header>
                    <h2>Cookbook Recipe: Relation DQL Behavior</h2>
                </header>

                <p class="lead">
                    Posted on <date>January 28, 2009</date>
                                            by
                                                    jwage
                                                            </p>
            </div>

            <div class="col-lg-4 col-12">
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>
            </div>
        </div>

        <hr />

        <div>
                
            
                
    <p>Today I will teach you how to write a simple Doctrine behavior. You will learn some of the basics of creating a behavior and you will gain some pretty cool functionality for your relationships.</p>

                
    <p>We will write a behavior called <code>RelationDql</code> which allows you to add default query parts that are automatically added to your queries when you reference the specified relationships. So first we will get started by looking at an example schema we can apply this to.</p>

                
    <p>Here is an example schema where we have a <code>Site</code>, <code>BlogPost</code> and <code>Tag</code> model:</p>

                    <pre class="code-block-table" id="f4bd23816baef1f1c266f1225e4278a3b5324856"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f4bd23816baef1f1c266f1225e4278a3b5324856"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[yml]</code><code class="line language-php">Site:</code><code class="line language-php">  columns:</code><code class="line language-php">    name: string(<span class="hljs-number">255</span>)</code><code class="line language-php"></code><code class="line language-php">BlogPost:</code><code class="line language-php">  actAs: [Timestampable]</code><code class="line language-php">  columns:</code><code class="line language-php">    title: <span class="hljs-string">"string(255)"</span></code><code class="line language-php">    body: clob</code><code class="line language-php">    site_id: integer</code><code class="line language-php">  relations:</code><code class="line language-php">    Site:</code><code class="line language-php">      foreignAlias: BlogPosts</code><code class="line language-php">    Tags:</code><code class="line language-php">      <span class="hljs-class"><span class="hljs-keyword">class</span>: <span class="hljs-title">Tag</span></span></code><code class="line language-php">      refClass: BlogPostTag</code><code class="line language-php">      foreignAlias: BlogPosts</code><code class="line language-php"></code><code class="line language-php">Tag:</code><code class="line language-php">  columns:</code><code class="line language-php">    name: string(<span class="hljs-number">255</span>)</code><code class="line language-php"></code><code class="line language-php">BlogPostTag:</code><code class="line language-php">  columns:</code><code class="line language-php">    blog_post_id:</code><code class="line language-php">      type: integer</code><code class="line language-php">      primary: <span class="hljs-keyword">true</span></code><code class="line language-php">    tag_id:</code><code class="line language-php">      type: integer</code><code class="line language-php">      primary: <span class="hljs-keyword">true</span></code><code class="line language-php">  relations:</code><code class="line language-php">    BlogPost:</code><code class="line language-php">      foreignAlias: BlogPostTags</code><code class="line language-php">    Tag:</code><code class="line language-php">      foreignAlias: BlogPostTags</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>This is a fairly simple schema as you can see, but what if we want to have a relationship on the <code>Site</code> model to retrieve the latest five <code>BlogPost</code> records or order the <code>Tags</code> relationship alphabetically by default?</p>

                
    <p>Lets modify our schema to take into account a new behavior that we will write in the next step. First modify the <code>Site</code> model and a relationship named <code>LatestBlogPosts</code>:</p>

                    <pre class="code-block-table" id="a8787a3d6778bf62df1b566643203987649645c4"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="a8787a3d6778bf62df1b566643203987649645c4"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[yml]</code><code class="line language-php">Site:</code><code class="line language-php">  actAs:</code><code class="line language-php">    RelationDql:</code><code class="line language-php">      relations:</code><code class="line language-php">        LatestBlogPosts:</code><code class="line language-php">          orderBy: %s.created_at DESC</code><code class="line language-php">          limit: <span class="hljs-number">5</span></code><code class="line language-php">  columns:</code><code class="line language-php">    name: string(<span class="hljs-number">255</span>)</code><code class="line language-php">  relations:</code><code class="line language-php">    LatestBlogPosts:</code><code class="line language-php">      autoComplete: <span class="hljs-keyword">false</span></code><code class="line language-php">      <span class="hljs-class"><span class="hljs-keyword">class</span>: <span class="hljs-title">BlogPost</span></span></code><code class="line language-php">      local: id</code><code class="line language-php">      foreign: site_id</code><code class="line language-php"></code><code class="line language-php">**TIP** The ``autoComplete`` option is set to ``<span class="hljs-keyword">false</span>`` so that the</code><code class="line language-php">relationship is not reflected <span class="hljs-keyword">and</span> added to the opposite end,</code><code class="line language-php">``BlogPost`` automatically.</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now lets modify the <code>BlogPost</code> model to change the <code>Tags</code> relationship so that it is ordered alphabetically by name by default:</p>

                    <pre class="code-block-table" id="a132899a7e350c003e5dd0d761532fc3d40f8e81"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="a132899a7e350c003e5dd0d761532fc3d40f8e81"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[yml]</code><code class="line language-php">BlogPost:</code><code class="line language-php">  actAs:</code><code class="line language-php">    Timestampable:</code><code class="line language-php">    RelationDql:</code><code class="line language-php">      relations:</code><code class="line language-php">        Tags:</code><code class="line language-php">          orderBy: %s.name ASC</code><code class="line language-php">  columns:</code><code class="line language-php">    title: <span class="hljs-string">"string(255)"</span></code><code class="line language-php">    body: clob</code><code class="line language-php">    site_id: integer</code><code class="line language-php">  relations:</code><code class="line language-php">    Site:</code><code class="line language-php">      foreignAlias: BlogPosts</code><code class="line language-php">    Tags:</code><code class="line language-php">      <span class="hljs-class"><span class="hljs-keyword">class</span>: <span class="hljs-title">Tag</span></span></code><code class="line language-php">      refClass: BlogPostTag</code><code class="line language-php">      foreignAlias: BlogPosts</code><code class="line language-php"></code><code class="line language-php">**TIP** The ``relations`` <span class="hljs-keyword">array</span> is an <span class="hljs-keyword">array</span> of changes to make to</code><code class="line language-php">the DQL query. The key can be any valid <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on</span> <span class="hljs-title">the</span></span></code><code class="line language-php">``Doctrine_Query`` API <span class="hljs-keyword">and</span> the value is of course the parameter to</code><code class="line language-php">pass to the <span class="hljs-function"><span class="hljs-keyword">function</span>.</span></code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now that we have our schemas modified to take into account the new <code>RelationDql</code> behavior we need to actually write the code:</p>

                    <pre class="code-block-table" id="6b89aafdbed3171727e59d6afa929e74c07f32c8"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="6b89aafdbed3171727e59d6afa929e74c07f32c8"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RelationDql</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Template</span></span></code><code class="line language-php">{</code><code class="line language-php">  <span class="hljs-keyword">protected</span> $_options = <span class="hljs-keyword">array</span>();</code><code class="line language-php"></code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($options)</span></span></code><code class="line language-php">  {</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;_options = $options;</code><code class="line language-php">  }</code><code class="line language-php"></code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setTableDefinition</span><span class="hljs-params">()</span></span></code><code class="line language-php">  {</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;_table-&gt;addRecordListener(<span class="hljs-keyword">new</span> RelationDqlListener(<span class="hljs-keyword">$this</span>-&gt;_options));</code><code class="line language-php">  }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>The template is very simple. It only attaches a record listener to the invoking table. Their is where most of the magic happens. So now lets define the <code>RelationDqlListener</code> class:</p>

                    <pre class="code-block-table" id="f77e94da4be9cd04e94dd5e49c8921da4a7116b1"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f77e94da4be9cd04e94dd5e49c8921da4a7116b1"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RelationDqlListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Record_Listener</span></span></code><code class="line language-php">{</code><code class="line language-php">  <span class="hljs-keyword">protected</span> $_options = <span class="hljs-keyword">array</span>(<span class="hljs-string">'relations'</span> =&gt; <span class="hljs-keyword">array</span>());</code><code class="line language-php"></code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($options)</span></span></code><code class="line language-php">  {</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;_options = $options;</code><code class="line language-php">  }</code><code class="line language-php"></code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">preDqlSelect</span><span class="hljs-params">(Doctrine_Event $event)</span></span></code><code class="line language-php">  {</code><code class="line language-php">    $query = $event-&gt;getQuery();</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>]))</code><code class="line language-php">    {</code><code class="line language-php">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Doctrine_Exception(</code><code class="line language-php">        <span class="hljs-string">'You must specify at least one relationship to add DQL to'</span></code><code class="line language-php">      );</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    $relations = <span class="hljs-keyword">$this</span>-&gt;_options[<span class="hljs-string">'relations'</span>];</code><code class="line language-php"></code><code class="line language-php">    $components = <span class="hljs-keyword">$this</span>-&gt;_getDqlCallbackComponents($query);</code><code class="line language-php">    <span class="hljs-keyword">foreach</span> ($components <span class="hljs-keyword">as</span> $alias =&gt; $component)</code><code class="line language-php">    {</code><code class="line language-php">      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($component[<span class="hljs-string">'relation'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>($relations[$component[<span class="hljs-string">'relation'</span>]-&gt;getAlias()]))</code><code class="line language-php">      {</code><code class="line language-php">        $dqls = $relations[$component[<span class="hljs-string">'relation'</span>]-&gt;getAlias()];</code><code class="line language-php">        <span class="hljs-keyword">foreach</span> ($dqls <span class="hljs-keyword">as</span> $func =&gt; $dql)</code><code class="line language-php">        {</code><code class="line language-php">          $dql = str_replace(<span class="hljs-string">'%s'</span>, $alias, $dql);</code><code class="line language-php">          $query-&gt;$func($dql);</code><code class="line language-php">        }</code><code class="line language-php">        <span class="hljs-keyword">unset</span>($relations[$component[<span class="hljs-string">'relation'</span>]-&gt;getAlias()]);</code><code class="line language-php">      }</code><code class="line language-php">    }</code><code class="line language-php">  }</code><code class="line language-php"></code><code class="line language-php">  <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getDqlCallbackComponents</span><span class="hljs-params">($query)</span></span></code><code class="line language-php">  {</code><code class="line language-php">      $params = $query-&gt;getParams();</code><code class="line language-php">      $componentsBefore = <span class="hljs-keyword">array</span>();</code><code class="line language-php">      <span class="hljs-keyword">if</span> ($query-&gt;isSubquery()) {</code><code class="line language-php">          $componentsBefore = $query-&gt;getQueryComponents();</code><code class="line language-php">      }</code><code class="line language-php"></code><code class="line language-php">      $copy = $query-&gt;copy();</code><code class="line language-php">      $copy-&gt;getSqlQuery($params);</code><code class="line language-php">      $componentsAfter = $copy-&gt;getQueryComponents();</code><code class="line language-php"></code><code class="line language-php">      <span class="hljs-keyword">if</span> ($componentsBefore !== $componentsAfter) {</code><code class="line language-php">          <span class="hljs-keyword">return</span> array_diff($componentsAfter, $componentsBefore);</code><code class="line language-php">      } <span class="hljs-keyword">else</span> {</code><code class="line language-php">          <span class="hljs-keyword">return</span> $componentsAfter;</code><code class="line language-php">      }</code><code class="line language-php">  }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>So now we have the behavior defined so lets look at some example DQL queries and the SQL that is outputted:</p>

                <blockquote>
    <p><strong>TIP</strong> Remember, in order for the dql callbacks to be executed we must enable an attribute first.</p>
</blockquote>
                    <pre class="code-block-table" id="6d5ef30422c054362a05088ee9fc395cff66ddd3"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="6d5ef30422c054362a05088ee9fc395cff66ddd3"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">    $manager-&gt;setAttribute(<span class="hljs-string">'use_dql_callbacks'</span>, <span class="hljs-keyword">true</span>);</code><code class="line language-php"></code><code class="empty"></code></pre>
                    <pre class="code-block-table" id="f340911a1230b422316590e1aeba1b403b00c278"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f340911a1230b422316590e1aeba1b403b00c278"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$q = Doctrine_Query::create()</code><code class="line language-php">  -&gt;select(<span class="hljs-string">'s.name, p.title, p.created_at'</span>)</code><code class="line language-php">  -&gt;from(<span class="hljs-string">'Site s'</span>)</code><code class="line language-php">  -&gt;leftJoin(<span class="hljs-string">'s.LatestBlogPosts p'</span>);</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">echo</span> $q-&gt;getSql();</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>The above would output the following SQL:</p>

                    <pre class="code-block-table" id="20d571b5b66c671dde5fea409924ce3a7b3026e2"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="20d571b5b66c671dde5fea409924ce3a7b3026e2"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[sql]</code><code class="line language-php">SELECT s.id <span class="hljs-keyword">AS</span> s__id, s.name <span class="hljs-keyword">AS</span> s__name, b.id <span class="hljs-keyword">AS</span> b__id, b.title <span class="hljs-keyword">AS</span> b__title, b.created_at <span class="hljs-keyword">AS</span> b__created_at FROM site s LEFT JOIN blog_post b ON s.id = b.site_id ORDER BY b.created_at DESC LIMIT <span class="hljs-number">5</span></code><code class="line language-php"></code><code class="line language-php">**NOTE** Notice how the ``ORDER BY`` <span class="hljs-keyword">and</span> ``LIMIT`` were added to</code><code class="line language-php">the query.</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now lets look at an example that involves the <code>BlogPost</code> tags:</p>

                    <pre class="code-block-table" id="56997898b2cc36886fa28652cfd3da063dca383e"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="56997898b2cc36886fa28652cfd3da063dca383e"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$q = Doctrine_Query::create()</code><code class="line language-php">  -&gt;from(<span class="hljs-string">'BlogPost p'</span>)</code><code class="line language-php">  -&gt;leftJoin(<span class="hljs-string">'p.Tags t'</span>);</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">echo</span> $q-&gt;getSql();</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>The above would output the following SQL query:</p>

                    <pre class="code-block-table" id="b0661e45abc25b0fc4184d8c9c347632a7bd1aac"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="b0661e45abc25b0fc4184d8c9c347632a7bd1aac"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[sql]</code><code class="line language-php">SELECT b.id <span class="hljs-keyword">AS</span> b__id, b.title <span class="hljs-keyword">AS</span> b__title, b.body <span class="hljs-keyword">AS</span> b__body, b.site_id <span class="hljs-keyword">AS</span> b__site_id, b.created_at <span class="hljs-keyword">AS</span> b__created_at, b.updated_at <span class="hljs-keyword">AS</span> b__updated_at, t.id <span class="hljs-keyword">AS</span> t__id, t.name <span class="hljs-keyword">AS</span> t__name FROM blog_post b LEFT JOIN blog_post_tag b2 ON b.id = b2.blog_post_id LEFT JOIN tag t ON t.id = b2.tag_id ORDER BY t.name ASC</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>As you can see the <code>ORDER BY</code> clause to order the related tags by <code>name</code> was added for us.</p>

                
    <p>Pretty cool huh? You can use this in your projects to make your relationships a little nicer.</p>

        
    
        </div>
    </article>
    </main>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?4a831b"
                            integrity="sha384-ygNM6vWkqMgvV0Lrk5BeKUupSk4CidmuzVPL3OkdAxEVjZQDo9cgbfC+FXAfoAse"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            <script
            src="https://www.doctrine-project.org/frontend/js/prismjs.js?e97886"
                            integrity="sha384-gKhxdEN1Hcl/o+IxbVbpfZRfdDPQe5dwOuCcWYbhCAhhkOl/Vi2VmnWe9/UCD6rW"
                        crossorigin="anonymous">
    </script>
    </body>
</html>
