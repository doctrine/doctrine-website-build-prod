<!DOCTYPE html>
<html>
    <head>
        <title>ORM 3.4.0 released with Native Lazy Objects and Property hooks support - Doctrine: PHP Open Source Project</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
            <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2025/06/28/orm-3.4.0-released.html"
        },
        "headline": "ORM 3.4.0 released with Native Lazy Objects and Property hooks support",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2025-06-28T00:00:00-04:00",
        "dateModified": "2025-06-28T00:00:00-04:00",
        "author": {
            "@type": "Person",
            "name": "Benjamin Eberlei"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "Last week we have released Doctrine 3.4.0 which primarily adds support for PHP 8.4 functionality:

 "
    }
    </script>
    <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/prismjs.css?d2443b"
                            integrity="sha384-IcJ7eow//K0xRBscZjnk8kawYxbm2eUAZ9D6Xf/n0yuAi1NCvwOkep1S8XqPNB3E"
                        crossorigin="anonymous"
    />

        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?5cc46a"
                        integrity="sha384-vonb47KM6nk2/R9Sju3ZEm6yxaL1E02sUWkUGIgcfejb0VD6cFCFZzEvb1r14grl"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/2025/06/28/orm-3.4.0-released.html" />
        <meta property="og:title" content="ORM 3.4.0 released with Native Lazy Objects and Property hooks support - Doctrine: PHP Open Source Project" />
        <meta property="og:description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine-website/edit/master/source/blog/2025-06-28-orm-3.4-released.md" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
            <article>
        <div class="row">
            <div class="col-lg-8 col-12">
                <header>
                    <h2>ORM 3.4.0 released with Native Lazy Objects and Property hooks support</h2>
                </header>

                <p class="lead">
                    Posted on <date>June 28, 2025</date>
                                            by
                                                    <a href="mailto:kontakt@beberlei.de">Benjamin Eberlei</a>
                                                            </p>
            </div>

            <div class="col-lg-4 col-12">
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>
            </div>
        </div>

        <hr />

        <div>
                
            
                
    <p>Last week we have <a href="https://github.com/doctrine/orm/releases/tag/3.4.0">released Doctrine 3.4.0</a> which primarily adds support for PHP 8.4 functionality:</p>

                

<ul>
    <li class="dash"><a href="https://www.php.net/manual/en/language.oop5.property-hooks.php">Property Hooks</a></li>
    <li class="dash"><a href="https://www.php.net/manual/en/language.oop5.lazy-objects.php">Native Lazy Objects</a></li>
</ul>

                
    <p>From my perspective, this marks a new era for Doctrine ORM, one that can be compared with the invention of Reflection based mapping in Doctrine 2.0 way back in 2010.</p>

                
    <p>For one, this now allows to use public properties for entities by default without having to fear consequences down the line. Expressed with our Doctrine tutorial example it looks like this:</p>

                    <pre class="code-block-table" id="1740ed79c9c3b70477122e45794d2c3f75fddd4a"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="1740ed79c9c3b70477122e45794d2c3f75fddd4a"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[ORM\Entity]</span></code><code class="line language-php"><span class="hljs-comment">#[ORM\Table(name: 'bugs')]</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bug</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">#[ORM\Id]</span></code><code class="line language-php">    <span class="hljs-comment">#[ORM\Column]</span></code><code class="line language-php">    <span class="hljs-comment">#[ORM\GeneratedValue]</span></code><code class="line language-php">    <span class="hljs-keyword">public</span> ?int $id = <span class="hljs-keyword">null</span>;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">#[ORM\Column]</span></code><code class="line language-php">    <span class="hljs-keyword">public</span> string $description;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">#[ORM\Column]</span></code><code class="line language-php">    <span class="hljs-keyword">public</span> DateTime $created;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">#[ORM\Column]</span></code><code class="line language-php">    <span class="hljs-keyword">public</span> string $status;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">#[ORM\ManyToOne(targetEntity: User::class, inversedBy: 'assignedBugs')]</span></code><code class="line language-php">    <span class="hljs-keyword">public</span> ?User $engineer = <span class="hljs-keyword">null</span> {</code><code class="line language-php">        get =&gt; <span class="hljs-keyword">$this</span>-&gt;engineer;</code><code class="line language-php">        set (?User $value) {</code><code class="line language-php">            $value?-&gt;assignedTo(<span class="hljs-keyword">$this</span>);</code><code class="line language-php">            <span class="hljs-keyword">$this</span>-&gt;engineer = $value;</code><code class="line language-php">        }</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">#[ORM\ManyToOne(targetEntity: User::class, inversedBy: 'reportedBugs')]</span></code><code class="line language-php">    <span class="hljs-keyword">public</span> ?User $reporter = <span class="hljs-keyword">null</span> {</code><code class="line language-php">        get =&gt; <span class="hljs-keyword">$this</span>-&gt;reporter;</code><code class="line language-php">        set (?User $value) {</code><code class="line language-php">            $value?-&gt;addReportedBug(<span class="hljs-keyword">$this</span>);</code><code class="line language-php">            <span class="hljs-keyword">$this</span>-&gt;reporter = $value;</code><code class="line language-php">        }</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;created = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-string">'now'</span>);</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>This reduces the boilerplate code for entities massively by getting rid of getters and setters.</p>

                
    <p>Furthermore, with native lazy objects we do not have to resort to hacks anymore for public properties to work and this avoids the performance hit that was previously there.</p>

                
    <p>Native lazy objects make lazy objects a breeze to implement on our end, it avoids code generation entirely and the overhead of using them is as minimal as it gets at runtime.</p>

                
    <p>During the major version 3 cycle, you need to opt into native lazy objects via configuration:</p>

                    <pre class="code-block-table" id="561df8dfd7ba6f10b9cdb1cfe9ad26fbd85064b0"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="561df8dfd7ba6f10b9cdb1cfe9ad26fbd85064b0"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ORM</span>\<span class="hljs-title">ORMSetup</span>;</code><code class="line language-php"></code><code class="line language-php">$config = ORMSetup::createAttributeMetadataConfiguration(</code><code class="line language-php">    paths: [<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/src'</span>],</code><code class="line language-php">    isDevMode: <span class="hljs-keyword">true</span>,</code><code class="line language-php">);</code><code class="line language-php">$config-&gt;enableNativeLazyObjects(<span class="hljs-keyword">true</span>);</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h2 class="section-header ">
    <a href="#upgrade-path-from-2-x-for-lazy-proxies">
        Upgrade Path from 2.x for Lazy Proxies
        <i class="fas fa-link"></i>
    </a>
</h2>
                
    <p>Many of you are still on Doctrine ORM 2.x (~75% based on packagist installation numbers), so the question is how to upgrade.</p>

                
    <p>With native lazy objects we have added a change that allows you to skip the migration to use lazy ghosts from Symfony VarExporter component.</p>

                
    <p>Previously we thought migrating from our homegrown proxy library to Symfony would be the next step, but now we think you should directly move towards native lazy objects.</p>

                
    <p>If you prepare to migrate to 3.4+ and run PHP 8.4 then we recommend that you skip using <code>symfony/var-exporter</code> for lazy object generation and ignore the deprecation:</p>

                    <pre class="code-block-table" id="f97874530b0461e4a639f0a491ed33d758cbae90"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f97874530b0461e4a639f0a491ed33d758cbae90"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$config-&gt;setLazyGhostObjectEnabled(<span class="hljs-keyword">false</span>);</code><code class="line language-php">Deprecation::ignoreDeprecations(<span class="hljs-string">'https://github.com/doctrine/orm/pull/10837/'</span>);</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Then when you have prepared for all other deprecations and changes, you upgrade to 3.4.x and enable native lazy objects in one step.</p>

                
    <p>This simplifies the migration by not having to migrate to different lazy object strategies multiple times.</p>

                <h2 class="section-header ">
    <a href="#general-upgrade-path-from-2-x">
        General Upgrade Path from 2.x
        <i class="fas fa-link"></i>
    </a>
</h2>
                
    <p>With the re-adding of PARTIAL queries, the move towards native lazy objects the only two deprecations that we haven&#039;t fully addressed yet for a migration towards 3.x is</p>

                

<ul>
    <li class="dash">the use of an argument for <code>EntityManager::flush($entity)</code> (<a href="https://github.com/doctrine/orm/issues/8459">#8459</a>).</li>
    <li class="dash"><code>Query::toIterable</code> is not a full replacement for <code>Query::iterate</code> (<a href="https://github.com/doctrine/orm/issues/9219">#9219</a>)</li>
</ul>

                <h2 class="section-header ">
    <a href="#towards-4-0">
        Towards 4.0
        <i class="fas fa-link"></i>
    </a>
</h2>
                
    <p>This release is a first step towards ORM 4.0, which will require PHP 8.4 and is going to be built on native lazy objects functionality completely. Work on 4.0 has started now and we are hopeful to release it soon.</p>

                
    <p>We have started planning our next hackathon in autumn, most likely a good chunk of work can be planned and completed then and a release could be right after or early next year.</p>

        
    
        </div>
    </article>
    </main>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?1546fc"
                            integrity="sha384-ix9eb2EZyp9uayYpxmCQoylbz8msHl5wOg/aqZnD/3cxszNUGePN656MRg5GEgbm"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            <script
            src="https://www.doctrine-project.org/frontend/js/prismjs.js?8aa1bb"
                            integrity="sha384-3EhgfeqnppOxFBVU40g8gS+IVvmh5+wGpe4mG2otPyExrkK9t4aq8uCUy2IDLKkR"
                        crossorigin="anonymous">
    </script>
    </body>
</html>
