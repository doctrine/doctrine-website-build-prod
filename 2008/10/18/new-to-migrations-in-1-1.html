<!DOCTYPE html>
<html>
    <head>
        <title>New to Migrations in 1.1 - Doctrine: PHP Open Source Project</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
            <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2008/10/18/new-to-migrations-in-1-1.html"
        },
        "headline": "New to Migrations in 1.1",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2008-10-18T00:00:00-04:00",
        "dateModified": "2008-10-18T00:00:00-04:00",
        "author": {
            "@type": "Person",
            "name": "jwage"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "In Doctrine 1.1 migrations are much easier to work with. In addition to the increased stability we h"
    }
    </script>
    <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/prismjs.css?d2443b"
                            integrity="sha384-IcJ7eow//K0xRBscZjnk8kawYxbm2eUAZ9D6Xf/n0yuAi1NCvwOkep1S8XqPNB3E"
                        crossorigin="anonymous"
    />

        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?e935b6"
                        integrity="sha384-0+XwQ7PUNkbj10v4XDjjp7VJzfahtyhEtNyFDNmWQaR7ohGXNow7qYgClWx6rQoS"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/2008/10/18/new-to-migrations-in-1-1.html" />
        <meta property="og:title" content="New to Migrations in 1.1 - Doctrine: PHP Open Source Project" />
        <meta property="og:description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine-website/edit/master/source/blog/2008-10-18-new-to-migrations-in-1-1.md" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
            <article>
        <div class="row">
            <div class="col-lg-8 col-12">
                <header>
                    <h2>New to Migrations in 1.1</h2>
                </header>

                <p class="lead">
                    Posted on <date>October 18, 2008</date>
                                            by
                                                    jwage
                                                            </p>
            </div>

            <div class="col-lg-4 col-12">
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>
            </div>
        </div>

        <hr />

        <div>
                
            
                
    <p>In Doctrine 1.1 migrations are much easier to work with. In addition to the increased stability we have enhanced the migrations in a few ways to simplify the use of them dramatically.</p>

                
    <p>We have introduced the following features.</p>

                

<ul>
    <li class="dash">Diff Tool - Generate migration classes by simply changing your schema and generating the migrations.</li>
    <li class="dash">Down Automation - Doctrine now has the ability to automate the down of of a migration call.</li>
</ul>

                <h1 class="section-header ">
    <a href="#generating-migrations">
        Generating Migrations
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Imagine you have the following starting schema.</p>

                    <pre class="code-block-table" id="e17ed6fdf7a4c250a067a5af2708746add8d1793"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="e17ed6fdf7a4c250a067a5af2708746add8d1793"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[yml]</code><code class="line language-php">---</code><code class="line language-php">User:</code><code class="line language-php">  columns:</code><code class="line language-php">    username: string(<span class="hljs-number">255</span>)</code><code class="line language-php">    password: string(<span class="hljs-number">255</span>)</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Build your initial models from the schema.</p>

                    <pre class="code-block-table" id="0a36e97497e481e306230c3136eb0471be4eecc9"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="0a36e97497e481e306230c3136eb0471be4eecc9"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">$ ./doctrine generate-models-yaml</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now we want to enhance our schema to add some new columns as well as a new model with the following schema.</p>

                    <pre class="code-block-table" id="22f2eefbb26ae77f5ff0d2a55890fab5a6cd9e5b"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="22f2eefbb26ae77f5ff0d2a55890fab5a6cd9e5b"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[yml]</code><code class="line language-php">---</code><code class="line language-php">User:</code><code class="line language-php">  columns:</code><code class="line language-php">    username: string(<span class="hljs-number">255</span>)</code><code class="line language-php">    password: string(<span class="hljs-number">255</span>)</code><code class="line language-php">    email_address: string(<span class="hljs-number">255</span>)</code><code class="line language-php"></code><code class="line language-php">Phonenumber:</code><code class="line language-php">  columns:</code><code class="line language-php">    user_id: integer</code><code class="line language-php">    phonenumber: string(<span class="hljs-number">25</span>)</code><code class="line language-php">  relations:</code><code class="line language-php">    User:</code><code class="line language-php">      onDelete: CASCADE</code><code class="line language-php">      foreignAlias: Phonenumbers</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now by simply changing our schema we can generate the migrations required to upgrade our database.</p>

                    <pre class="code-block-table" id="04420cb3a3e9425a3b93c8f38268373d3cc53ec7"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="04420cb3a3e9425a3b93c8f38268373d3cc53ec7"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">$ ./doctrine generate-migrations-diff</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now in your migrations directory you will see 3 migration classes created for you.</p>

                <h2 class="section-header ">
    <a href="#1224273485-add-user-php">
        <code>1224273485_add_user.php</code>
        <i class="fas fa-link"></i>
    </a>
</h2>
                    <pre class="code-block-table" id="310953bb8ca6fe775c8f5c5dab6f386ca4435c40"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="310953bb8ca6fe775c8f5c5dab6f386ca4435c40"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">/**</span></code><code class="line language-php"> * This <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">has</span> <span class="hljs-title">been</span> <span class="hljs-title">auto</span>-<span class="hljs-title">generated</span> <span class="hljs-title">by</span> <span class="hljs-title">the</span> <span class="hljs-title">Doctrine</span> <span class="hljs-title">ORM</span> <span class="hljs-title">Framework</span></span></code><code class="line language-php"> */</code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AddUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Migration_Base</span></span></code><code class="line language-php">{</code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">up</span><span class="hljs-params">()</span></span></code><code class="line language-php">  {</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;createTable(<span class="hljs-string">'up'</span>, <span class="hljs-string">'user'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">'id'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'type'</span> =&gt; <span class="hljs-string">'integer'</span>, <span class="hljs-string">'length'</span> =&gt; <span class="hljs-number">8</span>, <span class="hljs-string">'autoincrement'</span> =&gt; <span class="hljs-keyword">true</span>, <span class="hljs-string">'primary'</span> =&gt; <span class="hljs-keyword">true</span>), <span class="hljs-string">'username'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'type'</span> =&gt; <span class="hljs-string">'string'</span>, <span class="hljs-string">'length'</span> =&gt; <span class="hljs-number">255</span>), <span class="hljs-string">'password'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'type'</span> =&gt; <span class="hljs-string">'string'</span>, <span class="hljs-string">'length'</span> =&gt; <span class="hljs-number">255</span>)), <span class="hljs-keyword">array</span>(<span class="hljs-string">'indexes'</span> =&gt; <span class="hljs-keyword">array</span>(), <span class="hljs-string">'primary'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-number">0</span> =&gt; <span class="hljs-string">'id'</span>)));</code><code class="line language-php">  }</code><code class="line language-php"></code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">down</span><span class="hljs-params">()</span></span></code><code class="line language-php">  {</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;dropTable(<span class="hljs-string">'up'</span>, <span class="hljs-string">'user'</span>);</code><code class="line language-php">  }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h2 class="section-header ">
    <a href="#1224273485-version1-php">
        <code>1224273485_version1.php</code>
        <i class="fas fa-link"></i>
    </a>
</h2>
                    <pre class="code-block-table" id="9be3791f5736d0900dbf8125772ae674ba1c6bad"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="9be3791f5736d0900dbf8125772ae674ba1c6bad"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">/**</span></code><code class="line language-php"> * This <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">has</span> <span class="hljs-title">been</span> <span class="hljs-title">auto</span>-<span class="hljs-title">generated</span> <span class="hljs-title">by</span> <span class="hljs-title">the</span> <span class="hljs-title">Doctrine</span> <span class="hljs-title">ORM</span> <span class="hljs-title">Framework</span></span></code><code class="line language-php"> */</code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Version1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Migration_Base</span></span></code><code class="line language-php">{</code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">up</span><span class="hljs-params">()</span></span></code><code class="line language-php">  {</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;createTable(<span class="hljs-string">'up'</span>, <span class="hljs-string">'phonenumber'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">'id'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'type'</span> =&gt; <span class="hljs-string">'integer'</span>, <span class="hljs-string">'length'</span> =&gt; <span class="hljs-number">8</span>, <span class="hljs-string">'autoincrement'</span> =&gt; <span class="hljs-keyword">true</span>, <span class="hljs-string">'primary'</span> =&gt; <span class="hljs-keyword">true</span>), <span class="hljs-string">'user_id'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'type'</span> =&gt; <span class="hljs-string">'integer'</span>, <span class="hljs-string">'length'</span> =&gt; <span class="hljs-number">8</span>), <span class="hljs-string">'phonenumber'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">'type'</span> =&gt; <span class="hljs-string">'string'</span>, <span class="hljs-string">'length'</span> =&gt; <span class="hljs-number">25</span>)), <span class="hljs-keyword">array</span>(<span class="hljs-string">'indexes'</span> =&gt; <span class="hljs-keyword">array</span>(), <span class="hljs-string">'primary'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-number">0</span> =&gt; <span class="hljs-string">'id'</span>)));</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;addColumn(<span class="hljs-string">'up'</span>, <span class="hljs-string">'user'</span>, <span class="hljs-string">'email_address'</span>, <span class="hljs-string">'255'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-keyword">array</span> ());</code><code class="line language-php">  }</code><code class="line language-php"></code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">down</span><span class="hljs-params">()</span></span></code><code class="line language-php">  {</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;dropTable(<span class="hljs-string">'up'</span>, <span class="hljs-string">'phonenumber'</span>);</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;removeColumn(<span class="hljs-string">'up'</span>, <span class="hljs-string">'user'</span>, <span class="hljs-string">'email_address'</span>);</code><code class="line language-php">  }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h2 class="section-header ">
    <a href="#1224273486-version2-php">
        <code>1224273486_version2.php</code>
        <i class="fas fa-link"></i>
    </a>
</h2>
                    <pre class="code-block-table" id="94520b6d454d622e782e58090b7ee4eb7a0188f8"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="94520b6d454d622e782e58090b7ee4eb7a0188f8"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">/**</span></code><code class="line language-php"> * This <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">has</span> <span class="hljs-title">been</span> <span class="hljs-title">auto</span>-<span class="hljs-title">generated</span> <span class="hljs-title">by</span> <span class="hljs-title">the</span> <span class="hljs-title">Doctrine</span> <span class="hljs-title">ORM</span> <span class="hljs-title">Framework</span></span></code><code class="line language-php"> */</code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Version2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Migration_Base</span></span></code><code class="line language-php">{</code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">up</span><span class="hljs-params">()</span></span></code><code class="line language-php">  {</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;addIndex(<span class="hljs-string">'up'</span>, <span class="hljs-string">'phonenumber'</span>, <span class="hljs-string">'phonenumber_user_id_user_id'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">'fields'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-number">0</span> =&gt; <span class="hljs-string">'user_id'</span>)));</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;createForeignKey(<span class="hljs-string">'up'</span>, <span class="hljs-string">'phonenumber'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'phonenumber_user_id_user_id_idx'</span>, <span class="hljs-string">'local'</span> =&gt; <span class="hljs-string">'user_id'</span>, <span class="hljs-string">'foreign'</span> =&gt; <span class="hljs-string">'id'</span>, <span class="hljs-string">'foreignTable'</span> =&gt; <span class="hljs-string">'user'</span>, <span class="hljs-string">'onUpdate'</span> =&gt; <span class="hljs-keyword">NULL</span>, <span class="hljs-string">'onDelete'</span> =&gt; <span class="hljs-string">'CASCADE'</span>));</code><code class="line language-php">  }</code><code class="line language-php"></code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">down</span><span class="hljs-params">()</span></span></code><code class="line language-php">  {</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;removeIndex(<span class="hljs-string">'up'</span>, <span class="hljs-string">'phonenumber'</span>, <span class="hljs-string">'phonenumber_user_id_user_id'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">'fields'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-number">0</span> =&gt; <span class="hljs-string">'user_id'</span>)));</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;dropForeignKey(<span class="hljs-string">'up'</span>, <span class="hljs-string">'phonenumber'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'phonenumber_user_id_user_id_idx'</span>, <span class="hljs-string">'local'</span> =&gt; <span class="hljs-string">'user_id'</span>, <span class="hljs-string">'foreign'</span> =&gt; <span class="hljs-string">'id'</span>, <span class="hljs-string">'foreignTable'</span> =&gt; <span class="hljs-string">'user'</span>, <span class="hljs-string">'onUpdate'</span> =&gt; <span class="hljs-keyword">NULL</span>, <span class="hljs-string">'onDelete'</span> =&gt; <span class="hljs-string">'CASCADE'</span>));</code><code class="line language-php">  }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h1 class="section-header ">
    <a href="#down-automation">
        Down Automation
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>In addition to Doctrine being able to generate migrations based on your schema changes, you can now easily automate the down of most methods. The last migration class could be simplified a lot by doing the following.</p>

                    <pre class="code-block-table" id="e47509da0e398e5a3b4579554221048e1e8720d8"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="e47509da0e398e5a3b4579554221048e1e8720d8"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">/**</span></code><code class="line language-php"> * This <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">has</span> <span class="hljs-title">been</span> <span class="hljs-title">auto</span>-<span class="hljs-title">generated</span> <span class="hljs-title">by</span> <span class="hljs-title">the</span> <span class="hljs-title">Doctrine</span> <span class="hljs-title">ORM</span> <span class="hljs-title">Framework</span></span></code><code class="line language-php"> */</code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Version2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doctrine_Migration_Base</span></span></code><code class="line language-php">{</code><code class="line language-php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">migrate</span><span class="hljs-params">($direction)</span></span></code><code class="line language-php">  {</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;addIndex($direction, <span class="hljs-string">'phonenumber'</span>, <span class="hljs-string">'phonenumber_user_id_user_id'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">'fields'</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-number">0</span> =&gt; <span class="hljs-string">'user_id'</span>)));</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;createForeignKey($direction, <span class="hljs-string">'phonenumber'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'phonenumber_user_id_user_id_idx'</span>, <span class="hljs-string">'local'</span> =&gt; <span class="hljs-string">'user_id'</span>, <span class="hljs-string">'foreign'</span> =&gt; <span class="hljs-string">'id'</span>, <span class="hljs-string">'foreignTable'</span> =&gt; <span class="hljs-string">'user'</span>, <span class="hljs-string">'onUpdate'</span> =&gt; <span class="hljs-keyword">NULL</span>, <span class="hljs-string">'onDelete'</span> =&gt; <span class="hljs-string">'CASCADE'</span>));</code><code class="line language-php">  }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Notice that in this example we only have one method named migrate() which receives a direction. Most API methods are easy to automate the opposite down so when migrate is called with $direction = &#039;down&#039; then the index and foreign key will be dropped instead of added.</p>

        
    
        </div>
    </article>
    </main>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?4a831b"
                            integrity="sha384-ygNM6vWkqMgvV0Lrk5BeKUupSk4CidmuzVPL3OkdAxEVjZQDo9cgbfC+FXAfoAse"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            <script
            src="https://www.doctrine-project.org/frontend/js/prismjs.js?e97886"
                            integrity="sha384-gKhxdEN1Hcl/o+IxbVbpfZRfdDPQe5dwOuCcWYbhCAhhkOl/Vi2VmnWe9/UCD6rW"
                        crossorigin="anonymous">
    </script>
    </body>
</html>
