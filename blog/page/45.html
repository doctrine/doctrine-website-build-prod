<!DOCTYPE html>
<html>
    <head>
        <title>Blog - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://www.doctrine-project.org/css/style.css?a9fab4" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://www.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/blog/page/45.html" />
        <meta property="og:title" content="Blog - Doctrine - PHP Database Tools" />
        <meta property="og:description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://www.doctrine-project.org/"><img src="https://www.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://www.doctrine-project.org/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/reflection.html">Reflection</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://www.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://www.doctrine-project.org/contribute/" id="navbarContributeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="https://www.doctrine-project.org/contribute/">Contributor Workflow</a>
                                <a class="dropdown-item" href="https://www.doctrine-project.org/contribute/maintainer/">Maintainer Workflow</a>
                                <a class="dropdown-item" href="https://www.doctrine-project.org/contribute/website/">Contribute to Website</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://www.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div class="google-translate-dropdown dropdown show d-inline-block mr-2">
                        <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="translateDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Translate
                        </a>

                        <div class="dropdown-menu" aria-labelledby="translateDropdown">
                            <div class="dropdown-item" id="google_translate_element">Loading...</div>
                        </div>
                    </div>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <main role="main" class="container-wrapper container">
                        <article>
        <header>
            <h2><a href="https://www.doctrine-project.org/2010/07/22/mongodb-for-ecommerce.html">MongoDB ODM: MongoDB for eCommerce</a></h2>
        </header>

        <p class="lead">
            Posted on 2010-07-22
                            by
                                    avalanche123
                                    </p>

        <hr />

        <div>
            <div style="float: left; width: 300px;">
    <div style="padding: 15px; border: 1px solid #ccc; margin: 0 15px; background: #eee; color: #888">
    <p style="margin: 0;">

Hi, my name is Bulat S. (my last name won't make it any easier, but in
case you were wondering it's Shakirzyanov), I joined OpenSky in August
2009 (It's been almost a year since then, but it feels like ages). My
official title in the company is Hacker, which also says a lot about me
(that I don't like corporate titles for one).

</p>
    <p style="margin: 10px 0 0;">

The last 6 weeks were truly amazing for me. Not only was I able to learn
a new technology, I also managed to contribute back to the community.
But let's go over everything step by step.

</p>
    </div>
</div>

<p>Building an eCommerce system is not easy, and building a platform is
even harder. When it comes to data in eCommerce, there is nothing
definite, no real structure you could stick to, and no final
requirements. Something as obvious as the "item you add to cart" could
be overly complicated when it comes to data.</p>

<p>There is a good example of how to model the database for handling
variable product attributes; <a href="http://www.magentocommerce.com">Magento</a>
is one of the most advanced open source eCommerce solutions available
today. It uses <a href="http://en.wikipedia.org/wiki/Entity-attribute-value_model">EAV (Entity Attribute
Value)</a> ,
which solves the problem of variable attributes by sacrificing database
level integrity and application performance. The amount of queries you
need to perform to select one entity will grow with every attribute data
type you introduce; however, it still is a viable solution.</p>

<p>A document store on the other hand lets you save two absolutely
different documents in the same collection. Because of its schema-less
structure it is also possible to add or remove a document's properties
after saving - it's a database that adapts to your data structure on the
fly.</p>

<p>At <a href="http://www.theopenskyproject.com/">OpenSky</a> , we decided to use
<a href="http://www.mongodb.org/">MongoDB</a> for storage of products and use
relational databases for order-related data since
<a href="http://www.mongodb.org/">MongoDB</a> doesn't support transactions.</p>

<p>So what is the benefit of using <a href="http://www.mongodb.org/">MongoDB</a> over
MySQL, or any other RDBMS, for storing variable attribute data.
Performance. This is the pseudo-query we would have to write to select
one product, with id 1, and all of its attributes in a typical <a href="http://en.wikipedia.org/wiki/Entity-attribute-value_model">EAV
model</a>:</p>

<div class="right">

</div>

<pre><code>[txt]
SELECT * FROM `product` WHERE id = 1;
SELECT * FROM `product_attributes` = WHERE product_id = 1;
SELECT * FROM `product_values_int` WHERE product_id = 1;
SELECT * FROM `product_values_varchar` WHERE product_id = 1;
SELECT * FROM `product_values_datetime` WHERE product_id = 1;
SELECT * FROM `product_values_text` WHERE product_id = 1;
SELECT * FROM `product_values_float` WHERE product_id = 1;
</code></pre>

<p>After the above queries are run, there would be a huge step of data
hydration into the product object, which
<a href="http://www.magentocommerce.com">Magento</a> handles quite well, albeit
slowly. Contrast this with what we would do in
<a href="http://www.mongodb.org/">MongoDB</a>:</p>

<pre><code>[javascript]
db.products.find({'_id': '1'});
</code></pre>

<p>Not only is the selection simpler, but it also returns a JSON object,
which can easily be hydrated into a native PHP object. And here is how a
configurable product could be represented in
<a href="http://www.mongodb.org/">MongoDB</a>:</p>

<pre><code>[javascript]
{
    "_id": ObjectId("4bffd798fdc2120019040000")
    "name": "Configurable T-Shirt"
    "options": [
        {
            "name": "small",
            "price": 12.99
        },
        {
            "name": "medium",
            "price": 15.99
        },
        {
            "name": "large",
            "price": 17.99
        }
    ]
}

**NOTE** There is no need for joins, as product options are a
collection of embedded objects. Object references (akin foreign key
relationships in RDBMSs) are also possible, but they are generally
only necessary if you need to access the object independently. For
instance, if I needed a page to list all product options across all
products, I would probably put options into their own collection
and reference them from the product document.
</code></pre>

<p>Of course, there are <a href="http://www.mongodb.org/display/DOCS/PHP+Language+Center#PHPLanguageCenter-LibraryandFrameworkTools">plenty of ORM
libraries</a>
for <a href="http://www.mongodb.org/">MongoDB</a> , which were either
hard-to-extract parts of frameworks, not quite ORMs or used the
<a href="http://martinfowler.com/eaaCatalog/activeRecord.html">ActiveRecord
pattern</a> (which
after using
<a href="http://martinfowler.com/eaaCatalog/dataMapper.html">DataMapper</a> for
quite some time, I wouldn't want to go back to). The very same day I
started writing an object document mapper (ODM) to use at
<a href="http://www.theopenskyproject.com/">OpenSky</a> , <a href="http://www.twitter.com/jwage">Jon
Wage</a> (developer for the Doctrine project)
released a proof-of-concept <a href="http://www.doctrine-project.org/projects/mongodb_odm">MongoDB
ODM</a> , which you
can <a href="http://github.com/doctrine/mongodb-odm">find on github</a>. After
contacting Jon and giving his library a couple of tries and
<a href="http://www.phpunit.de/">tests</a> , I decided to use it for
<a href="http://www.theopenskyproject.com/">OpenSky</a>'s products domain layer.</p>

<p>I started to submit patches and <a href="http://www.phpunit.de/">unit tests</a> to
the project and soon joined the core team for <a href="http://www.doctrine-project.org/projects/mongodb_odm">MongoDB
ODM</a>. Today, we
are past first alpha release of the project, and this is my first post
on the Doctrine blog (yay!).</p>

<p>Getting back to our example, this is how the product and embedded option
classes for the aforementioned data structure could look:</p>

<pre><code class="sourceCode php">&lt;?php
// Product.php
/**
 * @Document(collection="products")
 */
class Product
{

    /**
     * @Id
     */
    private $id;

    /**
     * @String
     */
    private $name;

    /**
     * @EmbedMany(targetDocument="Product\Option")
     */
    private $options = array();

    public function getId()
    {
        return $this-&gt;id;
    }

    public function setName($name)
    {
        $this-&gt;name = $name;
    }

    public function getName()
    {
        return $this-&gt;name;
    }

    public function addOption(Product\Option $option)
    {
        $this-&gt;options[] = $option
    }

    //...
}
</code></pre>

<p>And the Product class:</p>

<pre><code class="sourceCode php">&lt;?php
// Product/Option.php
namespace Product;
/**
 * @EmbeddedDocument
 */
class Option
{

    /**
     * @String
     */
    private $name;

    /**
     * @Float
     */
    private $price;

    public function setName($name)
    {
        $this-&gt;name = $name;
    }

    public function getName()
    {
        return $this-&gt;name;
    }

    public function setPrice($price)
    {
        $this-&gt;price = $price;
    }

    public function getPrice()
    {
        return $this-&gt;price;
    }

    //...
}
</code></pre>

<p>Using the DocumentManager instance, we could easily persist the product
with:</p>

<pre><code class="sourceCode php">&lt;?php
$product = new Product();
$product-&gt;setName('Configurable T-Shirt');

$small = new Product\Option();
$small-&gt;setName('small');
$small-&gt;setPrice(12.99);
$product-&gt;addOption($small);

$medium = new Product\Option();
$medium-&gt;setName('medium');
$medium-&gt;setPrice(15.99);
$product-&gt;addOption($medium);

$large = new Product\Option();
$large-&gt;setName('large');
$large-&gt;setPrice(15.99);
$product-&gt;addOption($large);

$documentManager-&gt;persist($product);
$documentManager-&gt;flush();

**NOTE** MongoDB ODM intelligently uses
`atomic operators &lt;http://www.mongodb.org/display/DOCS/Atomic+Operations&gt;`_
to update data, which makes it really fast. It also supports
inheritance (collection-per-class and single-collection
inheritances), which is similar to table inheritance design
patterns for ORMs. Check out the official Mongo ODM
`project documentation &lt;http://www.doctrine-project.org/projects/mongodb_odm/1.0/docs/en&gt;`_
for more information and examples. Complete instructions on how to
setup your DocumentManager instance
`can be found here &lt;http://www.doctrine-project.org/projects/mongodb_odm/1.0/docs/reference/introduction/en&gt;`_.
</code></pre>

<p>The above code would store the product object as a document in
<a href="http://www.mongodb.org/">MongoDB</a>.</p>

<p>There is much more to talk about in terms or technologies, techniques
and practices we adopt and use at
<a href="http://www.theopenskyproject.com/">OpenSky</a> , so this post is
definitely not the last one.</p>

        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://www.doctrine-project.org/2010/07/21/mongodb-odm-query-builder-api.html">MongoDB ODM: Query Builder API</a></h2>
        </header>

        <p class="lead">
            Posted on 2010-07-21
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <p>The Doctrine MongoDB Object Document Mapper includes a fluent object
oriented API for building queries to execute against MongoDB. Recently
some changes were made to the API to simplify it and make it more
readable. This blog post aims to demonstrate and introduce the new API
to you!</p>

<h1 id="query-types">Query Types</h1>

<p>The API still supports all the types of queries you would expect:</p>

<ul>
<li><a href="#find">find</a></li>
<li><a href="#insert">insert</a></li>
<li><a href="#update">update</a></li>
<li><a href="#delete">delete</a></li>
</ul>

<p>Continue reading to see examples for each of the above types of queries!</p>

<p>&#35;&#35; Find</p>

<p>You can easily find documents by just creating a new <code>Query</code> object with
the <code>createQuery()</code> method. A new <code>Query</code> object defaults to a <code>find</code>
query so you just need to pass the name of the document to query for:</p>

<pre><code class="sourceCode php">&lt;?php
$q = $dm-&gt;createQuery('User');
</code></pre>

<p>You can change the document being queried for by using the <code>find()</code>
method:</p>

<pre><code class="sourceCode php">&lt;?php
$q-&gt;find('Project');
</code></pre>

<h2 id="conditions">Conditions</h2>

<p>You can limit the returned documents by specifying some conditions:</p>

<pre><code class="sourceCode php">&lt;?php
$q-&gt;field('title')-&gt;equals('The Doctrine Project');
</code></pre>

<p>Maybe you want to only return projects created after today:</p>

<pre><code class="sourceCode php">&lt;?php
$q-&gt;field('createdAt')-&gt;greaterThan(new MongoDate(time()));
</code></pre>

<p>You can even a condition on an embedded document:</p>

<pre><code class="sourceCode php">&lt;?php
$q-&gt;field('profile.firstName')-&gt;equals('Jonathan');
</code></pre>

<p>Also, you can add a condition for a referenced document to filter by id:</p>

<pre><code class="sourceCode php">&lt;?php
$q-&gt;field('account.$id')-&gt;equals($accountId);
</code></pre>

<p>The <code>field()</code> method specifies the current field to add the conditions
to. You can optionally use the magical <code>__call()</code> feature of the <code>Query</code>
object to specify the current field as well:</p>

<pre><code class="sourceCode php">&lt;?php
$q-&gt;createdAt()-&gt;greaterThan(new MongoDate(time()));
</code></pre>

<p>All the methods you'd expect can be used in combination with the
<code>field()</code> method for adding conditions to your query:</p>

<ul>
<li>equal(\$value)</li>
<li>where(\$javascript)</li>
<li>not(\$value)</li>
<li>in(\$values)</li>
<li>notIn(\$values)</li>
<li>notEqual(\$value)</li>
<li>greaterThan(\$value)</li>
<li>greaterThanOrEq(\$value)</li>
<li>lessThan(\$value)</li>
<li>lessThanOrEq(\$value)</li>
<li>range(\$start, \$end)</li>
<li>size(\$size)</li>
<li>exists(\$bool)</li>
<li>type(\$type)</li>
<li>all(\$values)</li>
<li>mod(\$mod)</li>
</ul>

<p>&#35;&#35; Insert</p>

<p>You can easily insert new documents using the <code>Query</code> API as well. Just
use the <code>insert()</code> method in combination with <code>field()</code> and <code>set()</code>:</p>

<pre><code class="sourceCode php">&lt;?php
$q = $dm-&gt;createQuery('User')
    -&gt;insert()
    -&gt;field('username')-&gt;set('jwage')
    -&gt;field('password')-&gt;set('password');
</code></pre>

<p>If you want to set the new document to insert you can use the
<code>setNewObj()</code> method:</p>

<pre><code class="sourceCode php">&lt;?php
$q = $dm-&gt;createQuery('User')
    -&gt;insert()
    -&gt;setNewObj(array(
        'username' =&gt; 'jwage',
        'password' =&gt; 'password'
    ));
</code></pre>

<p>&#35;&#35; Update</p>

<p>If you want to update a document you can use the <code>update()</code> method in
combination with <code>field()</code>, <code>set()</code> and conditions. Here is an example
where we create a query to update a user with the username <code>jwage</code> and
give him a new password:</p>

<pre><code class="sourceCode php">&lt;?php
$q = $dm-&gt;createQuery('User')
    -&gt;update()
    -&gt;field('password')-&gt;set('newpassword')
    -&gt;field('username')-&gt;equals('jwage');
</code></pre>

<p>&#35;&#35; Delete</p>

<p>You can delete documents as well by using the <code>delete()</code> method in
combination with conditions. Here is an example where we create a query
to delete the user document with a username of <code>jwage</code>:</p>

<pre><code class="sourceCode php">&lt;?php
$q = $dm-&gt;createQuery('User')
    -&gt;delete()
    -&gt;field('username')-&gt;equals('jwage');
</code></pre>

<p>As you can see the fluent API makes it a bit easier to express queries
that are easy to read in the same way you would read english from left
to right. We hope to enhance and improve this API even more before we
release the stable 1.0 version.</p>

<p>You can read more about the Query Builder API in the
<a href="http://www.doctrine-project.org/projects/mongodb_odm/1.0/docs/reference/query-builder-api/en#query-builder-api">documentation</a>.</p>

        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://www.doctrine-project.org/2010/07/20/mixing-types-of-documents.html">MongoDB ODM: Mixing Types of Documents</a></h2>
        </header>

        <p class="lead">
            Posted on 2010-07-20
                            by
                                    jwage
                                    </p>

        <hr />

        <div>
            <p>One major advantage to using something like MongoDB is the fact that it
is schema-less. We can store multiple types of documents in a single
collection and we are not limited to a single type of document in
embedded and referenced documents. This article shows how you can easily
mix types of documents in collections, embedded and referenced
documents.</p>

<h1 id="mixing-types-in-collections">Mixing Types in Collections</h1>

<p>If you don't want to use <code>SINGLE_COLLECTION</code> inheritance you can easily
store different documents in the same collection by using a
discriminator field. First define an <code>Article</code> document that maps to
<code>my_documents</code>:</p>

<pre><code class="sourceCode php">&lt;?php
/**
 * @Document(collection="my_documents")
 * @DiscriminatorField(fieldName="type")
 * @DiscriminatorMap({"article"="Article", "album"="Album"})
 */
class Article
{
    // ...
}
</code></pre>

<p>Next create another document named <code>Album</code> and also map it to
<code>my_documents</code>:</p>

<pre><code class="sourceCode php">&lt;?php
/**
 * @Document(collection="my_documents")
 * @DiscriminatorField(fieldName="type")
 * @DiscriminatorMap({"article"="Article", "album"="Album"})
 */
class Album
{
    // ...
}
</code></pre>

<p>Now if you create some instances and persist them they will all be
stored in the <code>my_documents</code> collection and will have a discriminator
field named <code>type</code> automatically set with the value specified in the
mapping:</p>

<pre><code class="sourceCode php">&lt;?php
$article = new Article();
$article-&gt;setTitle('Sample Article');
// ...

$album = new Album();
$album-&gt;setName('My Album');

$dm-&gt;persist($article);
$dm-&gt;persist($album);
</code></pre>

<p>Finally, if you retrieve the documents they'll all be retrieved from
<code>my_documents</code> but you will get back the proper PHP classes that created
them:</p>

<pre><code class="sourceCode php">&lt;?php
$articles = $dm-&gt;find('Article');
$albums = $dm-&gt;find('Album');
</code></pre>

<p>You can retrieve more then just one document type by specifying an
array:</p>

<pre><code class="sourceCode php">&lt;?php
$documents = $dm
    -&gt;createQuery(array('Article', 'Album'))
    -&gt;execute();
</code></pre>

<p>The returned documents will contain instances of articles and albums!</p>

<h1 id="mixing-types-in-embedded-documents">Mixing Types in Embedded Documents</h1>

<p>You can store multiple types of documents in embedded documents by
simply omitting the <code>targetDocument</code> option. First create a <code>User</code>
document and embed multiple task documents:</p>

<pre><code class="sourceCode php">&lt;?php
/** @Document(collection="users") */
class User
{
    // ...

    /** @Embedded */
    private $tasks = array();

    // ...
}

**NOTE** Notice how on the ``$tasks`` annotation we don't specify
whether it is ``one`` or ``many``. This is because we know it is
``many`` due to the default value being an array.
</code></pre>

<p>Now create the different types of tasks we can add to the user:</p>

<pre><code class="sourceCode php">&lt;?php
/** @EmbeddedDocument */
class DownloadTask
{
    // ...
}

/** @EmbeddedDocument */
class UploadTask
{
    // ...
}
</code></pre>

<p>Now you can embed any type of class in the <code>$tasks</code> property:</p>

<pre><code class="sourceCode php">&lt;?php
$user = $dm-&gt;findOne('User', array(...));

$task = new DownloadTask();
// ...

$user-&gt;addTask($task);

$task = new UploadTask();
// ...

$user-&gt;addTask($task);

$dm-&gt;flush();
</code></pre>

<h1 id="mixing-types-in-referenced-documents">Mixing Types in Referenced Documents</h1>

<p>Mixing types in referenced documents works just the same as embedded by
omitting the <code>targetDocument</code> option. In this example a user can add
references to all his favorite albums, songs and books. First define a
<code>User</code> document with a many references property for storing the users
favorites:</p>

<pre><code class="sourceCode php">&lt;?php
/** @Document(collection="users") */
class User
{
    // ...

    /** @Reference */
    private $favorites = array();

    // ...
}
</code></pre>

<p>Now here is what the referenced documents would look like:</p>

<pre><code class="sourceCode php">&lt;?php
/** @Document(collection="albums") */
class Album
{
    // ...
}

/** @Document(collection="songs") */
class Song
{
    // ...
}

/** @Document(collection="books") */
class Book
{
    // ...
}
</code></pre>

<p>Now it is easy to add the references to his favorites:</p>

<pre><code class="sourceCode php">&lt;?php
$user-&gt;addFavorite($album);
$user-&gt;addFavorite($song);
$user-&gt;addFavorite($book);

$dm-&gt;flush();
</code></pre>

<p>When you retrieve the user and access the <code>$favorites</code> the documents
will be grouped by type and loaded with one or more <code>$in</code> queries:</p>

<pre><code class="sourceCode php">&lt;?php
$user = $dm-&gt;findOne('User', array(...));
$favorites = $user-&gt;getFavorites();

// Lazily loads references
// Contains Album, Song and Book instances
foreach ($favorites as $favorite) {
    // ...
}
</code></pre>

<p>That is it! It is easy to take advantage of the schema-less features of
MongoDB with the Doctrine Object Document Mapper (ODM)!</p>

        </div>

            </article>

    <nav class="mt-4">
        <ul class="pagination">
            <li class="page-item"><a class="page-link" href="https://www.doctrine-project.org/blog/page/44.html">Newer Posts</a></li><br />
            <li class="page-item"><a class="page-link" href="https://www.doctrine-project.org/blog/page/46.html">Older Posts</a></li>        </ul>
    </nav>
            </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://cdn.ravenjs.com/3.24.2/raven.min.js" crossorigin="anonymous"></script>

        <script type="text/javascript">
            Raven.config('https://09ce137590054cfd8f0b7e9324d6ec14@sentry.io/1197701').install()
        </script>

        <script src="https://www.doctrine-project.org/js/main.js?850a2b"></script>
        <script src="https://www.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }

            function googleTranslateElementInit() {
                $('#google_translate_element').html('');

                new google.translate.TranslateElement(
                    {pageLanguage: 'en'}, 'google_translate_element'
                );

                $('#google_translate_element select').on('change', function() {
                    var language = $('#google_translate_element select option:selected').text();

                    googleAnalyticsEvent('Translate', 'click', language);
                });
            }
        </script>

        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
