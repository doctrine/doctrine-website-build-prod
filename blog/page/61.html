<!DOCTYPE html>
<html>
    <head>
        <title>Blog - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://new.doctrine-project.org/css/style.css?9" rel="stylesheet" type="text/css" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://new.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://new.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://new.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://new.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://new.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://new.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://new.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://new.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://new.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://new.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://new.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://new.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://new.doctrine-project.org/images/mstile-310x310.png" />

        <link rel="stylesheet" href="https://new.doctrine-project.org/components/highlightjs/styles/railscasts.css?9" />
        <link rel="alternate" type="application/atom+xml" href="https://new.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
        
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>
    </head>
    <body>

        <header>
            <nav class="navbar navbar-expand-md navbar-dark border-bottom">
                <a class="navbar-brand text-hide" href="https://new.doctrine-project.org/"><img src="https://new.doctrine-project.org/images/doctrine-logo.svg" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/">Home</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://new.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/lexer/">Lexer</a>
                                                            </div>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://new.doctrine-project.org/search/">Search</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://github.com/doctrine/" target="_blank">Development</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="container">
                            
                                
                                
                
                <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Blog</li>
    </ol>
</nav>

    <article>
        <header>
            <h2><a href="https://new.doctrine-project.org/2009/08/15/doctrine2-native-queries">Doctrine 2 Native Queries</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-08-15
                            by
                                    romanb
                                    </p>

        <hr />

        <div>
            <p>If you are familar with Doctrine\_RawSql from Doctrine 1.x you
probably know that it is somewhat broken by design since it
requires a special syntax in the select clause that makes a lot of
SQL constructs in the select clause impossible.</p>
<p>Doctrine 2 introduces a facility called &quot;native queries&quot;,
represented by the <code>Doctrine\ORM\NativeQuery</code> class that replaces
Doctrine\_RawSql. The clue about NativeQuery is that it allows the
usage of real native SQL yet the result can be transformed into all
the different formats that are supported by DQL.</p>
<p>This is achieved through having a generic description of how an SQL
result maps to a Doctrine result in form of a
<code>Doctrine\ORM\Query\ResultSetMapping</code>.</p>
<p>Enough of the introductory talk, lets look at a (primitive) example
from our test suite:</p>
<pre><code class="php">&lt;?php
$rsm = new ResultSetMapping;
$rsm-&gt;addEntityResult('Doctrine\Tests\Models\CMS\CmsUser', 'u');
$rsm-&gt;addFieldResult('u', 'id', 'id'); // ($alias, $columnName, $fieldName)
$rsm-&gt;addFieldResult('u', 'name', 'name'); // // ($alias, $columnName, $fieldName)

$query = $this-&gt;_em-&gt;createNativeQuery('SELECT id, name FROM cms_users WHERE username = ?', $rsm);
$query-&gt;setParameter(1, 'romanb');

$users = $query-&gt;getResult();

$this-&gt;assertEquals(1, count($users));
$this-&gt;assertTrue($users[0] instanceof CmsUser);
$this-&gt;assertEquals('Roman', $users[0]-&gt;getName());
</code></pre>
<p>The SQL that is passed to createNativeQuery is not touched by
Doctrine in any way. The NativeQuery and ResultSetMapping
combination are extremely powerful. It might not surprise you that
Doctrine 2 creates a ResultSetMapping internally when it transforms
DQL to SQL.</p>
<p>Granted, this was a very trivial example that can easily be
expressed in a short DQL 1-liner but it was just for demonstration
purposes (and I am bad at making up complex ad-hoc SQL examples
that make sense).</p>
<p>So when is this useful? While DQL has been heavily improved in
Doctrine 2 and has many new powerful features which we will cover
in future blog posts, it is sometimes necessary to use native SQL.
NativeQuery gives you the ability to do that while still retrieving
the results in the convenient Doctrine formats you are familar
with. NativeQuery is also an obvious choice when starting to
migrate a pure SQL project to Doctrine without going into all the
DQL details from the start.</p>
<p>More on NativeQuery and ResultSetMapping can be found in the new
documentation under:</p>
<p><a href="http://www.doctrine-project.org/documentation/manual/2_0/en/native-sql">Documentation - Native Sql</a></p>

        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://new.doctrine-project.org/2009/08/07/doctrine2-batch-processing">Doctrine 2 Batch Processing</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-08-07
                            by
                                    romanb
                                    </p>

        <hr />

        <div>
            <p><strong>TIP</strong> Disclaimer: In general, an ORM is surely not the best tool
    for the job for mass data movements, however, it can be a
    convenient alternative if the performance is sufficient. Every
    RDBMS has its own highly efficient commands for such operations.
    For maximum efficiency you should consult the manual of your
    RDBMS.</p>
<blockquote><p><strong>NOTE</strong> The hardware used for the following tests: MBP, Intel Core
2 Duo 2.53 Ghz, 4GB DDR3 RAM, 7200rpm HDD.</p>
</blockquote>
<p>A lot of people have encountered the infamous &quot;memory exhausted&quot;
errors when using Doctrine for bulk operations or in long-running
scripts. This is a problem that is the result of 2 things:</p>
<ul><li class="dash"> The often unnecessarily intertwined architecture of Doctrine
   1.x.</li>
<li class="dash"> The simple garbage collector of PHP &lt; 5.3.
    <strong>NOTE</strong> If you did not know it yet, basically every circular
    reference between objects (and that is every bidirectional
    relationship!) is a potential memory leak in PHP &lt; 5.3.</li>
</ul>

<p>Now, the PHP team did their homework and introduced a new garbage
collector in PHP 5.3 (that is enabled by default, thank god!) that
is capable of properly detecting cyclic references that are not
referenced any longer from the outside.</p>
<p>In Doctrine 2 we did our part of the homework to address this issue
and redesigned the Doctrine core from scratch. The result is a much
better user experience, as I will demonstrate with some examples.</p>
<a id="title.1"></a><h1>Mass inserts</h1>
<p>The first thing we will look at is mass inserts. In Doctrine 2
there is a special pattern that can be used for mass inserts that
looks as follows:</p>
<pre><code class="php">&lt;?php
// $em instanceof EntityManager
$batchSize = 20;
for ($i=1; $i&lt;=10000; ++$i) {
     $obj = new MyEntity;
     $obj-&gt;setFoo('...');
     // ... set more data
     $em-&gt;persist($obj);
     if (($i % $batchSize) == 0) {
         $em-&gt;flush();
         $em-&gt;clear();
    }
}
</code></pre>
<p>I used this pattern to create a little demonstration that looks
like this in a PHPUnit test:</p>
<pre><code class="php">&lt;?php
// $this-&gt;_em created in setUp()
echo &quot;Memory usage before: &quot; . (memory_get_usage() / 1024) . &quot; KB&quot; . PHP_EOL;
$s = microtime(true);
$batchSize = 20;
for ($i=1; $i&lt;=10000; ++$i) {
     $user = new CmsUser;
     $user-&gt;status = 'user';
     $user-&gt;username = 'user' . $i;
     $user-&gt;name = 'Mr.Smith-' . $i;
     $this-&gt;_em-&gt;persist($user);
     if (($i % $batchSize) == 0) {
         $this-&gt;_em-&gt;flush();
         $this-&gt;_em-&gt;clear();
    }
}

//gc_collect_cycles(); // explained later!
echo &quot;Memory usage after: &quot; . (memory_get_usage() / 1024) . &quot; KB&quot; . PHP_EOL;

$e = microtime(true);
echo ' Inserted 10000 objects in ' . ($e - $s) . ' seconds' . PHP_EOL;
</code></pre>
<p>As you can see, we insert a total of 10000 objects. On running this
code through PHPUnit, using an SQLite in-memory database, I got the
following output:</p>

<pre><code class="">Memory usage before: 5034.03515625 KB
Memory usage after: 6726.3515625 KB
Inserted 10000 objects in 3.165983915329 seconds
</code></pre>
<p>We can see the following:</p>
<ul><li class="dash"> The insertion of 10000 objects through Doctrine into an SQLite
   in-memory database took roughly 3 seconds, not too bad.</li>
<li class="dash"> Memory usage increased by roughly 1.7MB, not too bad either.</li>
</ul>

<p>If you are now still not satisfied and wonder where the 1.7MB are
going, here is the answer: A small part of that is occupied by
objects that were created on-demand internally by Doctrine, these
will stay pretty constant, however. But the majority of this 1.7MB
has simply not yet been reclaimed (but is eliglible for garbage
collection for the new garbage collector!). To prove that, I can
just uncomment the gc\_collect\_cycles() function call. Here's the
result:</p>

<pre><code class="">Memory usage before: 5034.3828125 KB
Memory usage after: 5502.21484375 KB
Inserted 10000 objects in 3.1807188987732 seconds
</code></pre>
<p>Much better! And to prove that the &nbsp;500KB occupied by Doctrine are
constant, I simply made it 20000 objects. Here is the result:</p>

<pre><code class="">Memory usage before: 5034.3828125 KB
Memory usage after: 5502.21484375 KB
Inserted 20000 objects in 6.6149919033051 seconds
</code></pre>
<p>We can see the following things:</p>
<ul><li class="dash"> Memory usage is constant, the second batch of 10000 objects did
   not result in additional memory usage.</li>
<li class="dash"> The mass insertion strategy scales almost linearly. 10k objects
   took &nbsp;3.2 seconds and 20k objects took &nbsp;6.6 seconds.</li>
</ul>

<p>Note: You do not really need to call gc\_collect\_cycles(). This
should just demonstrate that the memory can be reclaimed. PHP would
reclaim that memory anyway when it needs to.</p>
<p>Even better, when testing the peak memory usage
(memory\_get\_peak\_usage()) it turned out that the memory usage
never grew beyond &nbsp;10MB in between. If you choose a larger batch
size the peak memory usage will be higher and vice versa.</p>
<a id="title.2"></a><h1>Mass object processing</h1>
<p>Now we take a look at mass-processing objects, which means loading
10000 objects from the database and doing something with each of
them. The clue here is the new support for iterative (step-by-step)
hydration in Doctrine 2. The pattern for these kinds of tasks looks
as follows:</p>
<pre><code class="php">&lt;?php
$q = $this-&gt;_em-&gt;createQuery(&quot;&lt;DQL to select the objects I want&gt;&quot;);
$iterableResult = $q-&gt;iterate();
while (($row = $iterableResult-&gt;next()) !== false) {
        // do stuff with the data in the row, $row[0] is always the object
        $this-&gt;_em-&gt;detach($row[0]); // detach from Doctrine, so that it can be GC'd immediately
 }
</code></pre>
<p>So instead of using <code>$q-&gt;execute()</code> or <code>$q-&gt;getResult()</code> or
similar, we use <code>$q-&gt;iterate()</code> which returns an instance of
<code>IterableResult</code> that allows us to iterate over the result step
by step. The important part for not running out of memory is the
line where the created object is detached from Doctrine, which
results in Doctrine removing any internal references to that
object, Doctrine no longer &quot;knows&quot; about that object.</p>
<p>I used this pattern to iterate through the just inserted 10000
objects as follows:</p>
<pre><code class="php">&lt;?php
$q = $this-&gt;_em-&gt;createQuery(&quot;select u from Doctrine\Tests\Models\CMS\CmsUser u&quot;);
$iterableResult = $q-&gt;iterate();

echo &quot;Memory usage before: &quot; . (memory_get_usage() / 1024) . &quot; KB&quot; . PHP_EOL;

while (($row = $iterableResult-&gt;next()) !== false) {
    // ... I could do some stuff here
    $this-&gt;_em-&gt;detach($row[0]);
}

echo &quot;Memory usage after: &quot; . (memory_get_usage() / 1024) . &quot; KB&quot; . PHP_EOL;
</code></pre>
<p>The following is the result:</p>

<pre><code class="">Memory usage before: 6578.58984375 KB
Memory usage after: 6581.71875 KB
</code></pre>
<p>The result is pretty acceptable. Here is the same again, this time
for 20000 objects, again to prove that the small memory increase is
constant:</p>

<pre><code class="">Memory usage before: 6578.23828125 KB 
Memory usage after: 6581.359375 KB
</code></pre>
<p>Good stuff!</p>
<blockquote><p><strong>NOTE</strong> If you're thinking that I waited ages until the 10k or 20k
objects were hydrated, that was not the case. 10k or 20k objects
(without associations) are hydrated in seconds.</p>
</blockquote>
<p>More information on bulk operations with Doctrine 2 can be found in
the (very new) online manual that is still a work in progress:</p>
<p>http://www.doctrine-project.org/documentation/manual/2\_0/en/batch-processing</p>
<a id="title.3"></a><h1>UPDATE</h1>
<p>Some people seem to be wondering why Doctrine does not use
multi-inserts (insert into (...) values (...), (...), (...), ...</p>
<p>First of all, this syntax is only supported on mysql and newer
postgresql versions. Secondly, there is no easy way to get hold of
all the generated identifiers in such a multi-insert when using
AUTO\_INCREMENT or SERIAL and an ORM needs the identifiers for
identity management of the objects. Lastly, insert performance is
rarely the bottleneck of an ORM. Normal inserts are more than fast
enough for most situations and if you really want to do fast bulk
inserts, then a multi-insert is not the best way anyway, i.e.
Postgres COPY or Mysql LOAD DATA INFILE are several orders of
magnitude faster.</p>
<p>These are the reasons why it is not worth the effort to implement
an abstraction that performs multi-inserts on mysql and postgresql
in an ORM.</p>
<p>I hope that clears up some questionmarks.</p>

        </div>

            </article>
    <article>
        <header>
            <h2><a href="https://new.doctrine-project.org/2009/08/04/help-write-tests-for-new-dql-parser">Help write tests for new DQL Parser</a></h2>
        </header>

        <p class="lead">
            Posted on 2009-08-04
                            by
                                    guilhermeblanco
                                    </p>

        <hr />

        <div>
            <p>As you all know, we're focusing most of our development time on
Doctrine 2.0 these days. To help speed things up, we would like to
ask for help writing tests from our users</p>
<p>Recently I finished new
<a href="http://trac.doctrine-project.org/browser/trunk/lib/Doctrine/ORM/Query/Parser.php">DQL parser for 2.0</a>.
Most of you may not be familiar with compiler's theory, but for
those that are, it's a top-down recursive descent parser for a
context-free grammar, usually known as LL(k).</p>
<p>We mapped the entire supported DQL into a document, which is an
<a href="http://en.wikipedia.org/wiki/Extended_Backusâ€“Naur_Form">EBNF (Extended Backus-Naur Form)</a> ,
which is a meta-syntax notation to express context-free grammars.
This one is quite simple to be readable by humans. Yes, we are
humans if you raise the question! =)</p>
<p>The header of our EBNF describes some terms and conventions, but
here is a small subset of our grammar:</p>

<pre><code class="">FromClause                        ::= &quot;FROM&quot; IdentificationVariableDeclaration {&quot;,&quot; IdentificationVariableDeclaration}*
IdentificationVariableDeclaration ::= RangeVariableDeclaration [IndexBy] {JoinVariableDeclaration}* 
RangeVariableDeclaration          ::= AbstractSchemaName [&quot;AS&quot;] AliasIdentificationVariable
AbstractSchemaName                ::= identifier
AliasIdentificationVariable       ::= identifier
</code></pre>
<p>It's not mentioned in this subset some pieces just for clarity.
Identifier is a terminal (no grammar rule to follow after that) and
is a string (ie. &quot;<code>name</code>&quot;, &quot;<code>email</code>&quot;).</p>
<a id="title.1"></a><h1>What does this subset do?</h1>
<p>It processes this pieces of DQL:</p>

<pre><code class="">FROM User u
FROM User AS u, u.Group g
</code></pre>
<a id="title.2"></a><h1>How does it do that?</h1>
<p>Each piece of DQL is converted to a series of tokens. Some tokens
are defined in our
<a href="http://en.wikipedia.org/wiki/Symbol_table">Symbol Table</a> , which
is then validated and correctly typed into the right token type.
For example... when it finds the &quot;<code>FROM</code>&quot;, it'll return for us
internally a token in an array format of:</p>

<pre><code class="">array(
    'value' =&gt; 'FROM', 
    'type' =&gt; Lexer::T_FROM, 
    'position' =&gt; 0
)
</code></pre>
<p>Value is the actual string representation in DQL, type is the token
type that was brought by symbol table and position is the position
of this token in the DQL string.</p>
<p>Then token is validated in the DQL parser; if it is expected the
<code>T_FROM</code>, just match and go to next token, if not raise a syntax
error. Imagine someone types this: &quot;<code>FROM User u, u.Group u</code>&quot;. It
is not valid DQL, because alias &quot;<code>u</code>&quot; is being used twice. That
is the task of another check, which inspects the requested DQL
defined symbol table and reports for semantical errors. We removed
the lexical errors since we use them as identifiers, so there is no
lexical error checks in DQL. Not that it may open a hole in our
structure, syntax and semantical checks do all that we need.</p>
<a id="title.3"></a><h1>How can I help?</h1>
<p>We currently have a single test that checks for DQL recognition. We
need to expand it to cover as much situations as possible. If you
follow the EBNF grammar rules, you'll see that for example, IN
condition supports either a series of Literals (which can be
strings, booleans, etc), an InputParameter or a subselect. We need
some people with free time to cover all possible situations; I mean
that we needs something like these queries:</p>

<pre><code class="">SELECT u FROM CmsUser u WHERE u.id IN (1, 2)

SELECT u FROM CmsUser u WHERE u.id IN (?0)

SELECT u FROM CmsUser u WHERE u.name IN ('guilhermeblanco', 'jwage', 'romanb')

SELECT u FROM CmsUser u WHERE u.id IN (SELECT u2.id FROM CmsUser u2)
</code></pre>
<p>By doing (sometimes) stupid queries and complex queries, we cover
all possibilities and then we can finally consider that we have a
good coverage in our DQL support.</p>
<p>If you load the
<a href="http://trac.doctrine-project.org/browser/trunk/tests/Doctrine/Tests/ORM/Query/LanguageRecognitionTest.php">LanguageRecognitionTest</a> ,
you'll find that we have already builtin 2 methods to help you
asserting DQL support: <code>assertValidDql</code> and <code>assertInvalidDql</code>.
Just follow the EBNF, pick defined models under
<a href="http://trac.doctrine-project.org/browser/trunk/tests/Doctrine/Tests/Models/CMS">Models/CMS folder</a>
and start writing tests.</p>
<a id="title.4"></a><h1>Running tests</h1>
<p>It is not hard to execute new test suite. Once you have
<a href="http://phpunit.de">PHPUnit</a> and <a href="http://xdebug.org">XDebug</a>
installed, go to tests folder of trunk, create the directory
<code>_coverage</code> (CHMOD 0777) and execute:</p>

<pre><code class="">phpunit --coverage-html=./_coverage Doctrine_Tests_AllTests
</code></pre>
<p>Then you'll have coverage too, which means it'll be even better to
see where it's missing tests in suite.</p>
<p>Once you write your tests, create a ticket in our trac and then
upload the patched file there. We'll review your tests and commit
them.</p>
<p>To generate a patch file, just type:
<code>svn diff &gt; /path/to/path/file.diff</code> I hope you enjoy new
structure and contribute with lots of tests!</p>

        </div>

            </article>

    <nav class="mt-4">
        <ul class="pagination">
            <li class="page-item"><a class="page-link" href="https://new.doctrine-project.org/blog/page/60.html">Newer Posts</a></li><br />
            <li class="page-item"><a class="page-link" href="https://new.doctrine-project.org/blog/page/62.html">Older Posts</a></li>        </ul>
    </nav>
                    </main>

        <footer class="footer">
            <div class="container">
                <i class="fa fa-copyright"></i> 2018 Doctrine
            </div>
        </footer>

        <script type="text/javascript">
            // When the user scrolls down 20px from the top of the document, show the button
            window.onscroll = function() {scrollFunction()};

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementById('back-to-top').style.display = "block";
                } else {
                    document.getElementById('back-to-top').style.display = "none";
                }
            }

            // When the user clicks on the button, scroll to the top of the document
            function topFunction() {
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            }
        </script>

        <button onclick="topFunction()" id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://new.doctrine-project.org/components/highlightjs/highlight.pack.js?9"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
