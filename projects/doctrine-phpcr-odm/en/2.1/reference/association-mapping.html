<!DOCTYPE html>
<html>
    <head>
        <title>        Association Mapping - Doctrine PHPCR ODM
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine PHPCR ODM Documentation: Association Mapping ">

        <meta name="keywords" content="                    php,content,odm,data,mapper,mapping,object,documentation,association,mapping
    ">

                    <meta name="robots" content="index, follow">
        
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/reference/association-mapping.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?0e8060"
                        integrity="sha384-uWM8Ap71kVRCtCM3QzQOLqztvscP4nQrnWhodnVaUQW30oDwgZiD05Y6/M0G9kHC"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/2.1/reference/association-mapping.html" />
        <meta property="og:title" content="        Association Mapping - Doctrine PHPCR ODM
    " />
        <meta property="og:description" content="Doctrine PHPCR ODM Documentation: Association Mapping " />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine PHPCR ODM",
            "description": "Association Mapping",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/phpcr-odm/edit/2.1.x/docs/en/reference/association-mapping.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        

            <div class="toc">
    <ul class="menu-level">
    <li class="toc-item">
    <a href="architecture.html#architecture">Architecture</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="architecture.html#doctrine-phpcr-odm-packages">Doctrine PHPCR-ODM Packages</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="architecture.html#content-tree-not-tables">Content tree, not tables</a>


</li>
            <li class="toc-item">
    <a href="architecture.html#additional-core-features">Additional core features</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item opened">
    <a href="#association-mapping">Association Mapping</a>

        <ul class="section-level-1 opened-ul ">
            <li class="toc-item">
    <a href="#hierarchy-mappings">Hierarchy mappings</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#child-restriction">Child restriction</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#references">References</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#referenceable-documents">Referenceable documents</a>


</li>
            <li class="toc-item">
    <a href="#reference-other-documents">Reference other documents</a>


</li>
            <li class="toc-item">
    <a href="#referrers-to-inverse-the-reference-relation">Referrers to inverse the reference relation</a>


</li>
            <li class="toc-item">
    <a href="#mixedreferrers">MixedReferrers</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#transitive-persistence-cascade-operations">Transitive persistence / Cascade Operations</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#persistence-by-reachability-cascade-persist">Persistence by Reachability: Cascade Persist</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#collections">Collections</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#initializing-collections">Initializing Collections</a>


</li>
            <li class="toc-item">
    <a href="#new-collections-after-flushing">New Collections after Flushing</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="attributes-mapping.html#attributes-mapping">Attributes Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="attributes-mapping.html#note-on-usage">Note on usage</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#document">Document</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="attributes-mapping.html#document">#[Document]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#mappedsuperclass">#[MappedSuperclass]</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#mapping-fields">Mapping Fields</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="attributes-mapping.html#field">#[Field]</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#hierarchy">Hierarchy</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="attributes-mapping.html#child">#[Child]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#children">#[Children]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#depth">#[Depth]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#parentdocument">#[ParentDocument]</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#identification">Identification</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="attributes-mapping.html#id">#[Id]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#nodename">#[Nodename]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#uuid">#[Uuid]</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#lifcycle-callbacks">Lifcycle callbacks</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="attributes-mapping.html#postload">#[PostLoad]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#postpersist">#[PostPersist]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#postremove">#[PostRemove]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#postupdate">#[PostUpdate]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#prepersist">#[PrePersist]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#preremove">#[PreRemove]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#preupdate">#[PreUpdate]</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#phpcr">PHPCR</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="attributes-mapping.html#node">#[Node]</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#references">References</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="attributes-mapping.html#referencemany">#[ReferenceMany]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#referenceone">#[ReferenceOne]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#referrers">#[Referrers]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#mixedreferrers">#[MixedReferrers]</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#translation">Translation</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="attributes-mapping.html#locale">#[Locale]</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#versioning">Versioning</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="attributes-mapping.html#versioncreated">#[VersionCreated]</a>


</li>
            <li class="toc-item">
    <a href="attributes-mapping.html#versionname">#[VersionName]</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="basic-mapping.html#basic-mapping">Basic Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="basic-mapping.html#mapping-drivers">Mapping Drivers</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#introduction-to-php-attributes">Introduction to PHP Attributes</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#persistent-classes">Persistent classes</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="basic-mapping.html#specify-a-node-type">Specify a node type</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#specify-a-repository-class">Specify a repository class</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="basic-mapping.html#doctrine-mapping-types">Doctrine Mapping Types</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#property-mapping">Property Mapping</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="basic-mapping.html#mapping-to-a-differently-named-phpcr-property">Mapping to a differently named PHPCR property</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#mapping-multivalue-properties">Mapping multivalue properties</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#summary">Summary</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="basic-mapping.html#identifiers">Identifiers</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="basic-mapping.html#identifier-generation-strategies">Identifier Generation Strategies</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="basic-mapping.html#parent-and-name-strategy-recommended">Parent and name strategy (recommended)</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#assigned-id">Assigned Id</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#repository-strategy">Repository strategy</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="basic-mapping.html#symfony-bundle">Symfony bundle</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="events.html#events">Events</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="events.html#lifecycle-events">Lifecycle Events</a>


</li>
            <li class="toc-item">
    <a href="events.html#event-order-when-moving">Event order when moving</a>


</li>
            <li class="toc-item">
    <a href="events.html#event-order-when-handling-with-translations">Event order when handling with translations</a>


</li>
            <li class="toc-item">
    <a href="events.html#listening-to-events">Listening to events</a>


</li>
            <li class="toc-item">
    <a href="events.html#lifecycle-callbacks">Lifecycle Callbacks</a>


</li>
            <li class="toc-item">
    <a href="events.html#listening-to-lifecycle-events">Listening to Lifecycle Events</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="fetch-depth.html#tuning-the-node-preloading">Tuning the node preloading</a>


</li>
    <li class="toc-item">
    <a href="inheritance-mapping.html#inheritance-mapping">Inheritance Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="inheritance-mapping.html#document-class-inheritance">Document class inheritance</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="installation-configuration.html#installation">Installation</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="installation-configuration.html#composer">Composer</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#phpcr-provider">PHPCR provider</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#install-jackalope-jackrabbit-phpcr-provider">Install Jackalope-Jackrabbit PHPCR provider</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#install-jackalope-doctrine-dbal-phpcr-provider">Install Jackalope Doctrine DBAL PHPCR provider</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#install-midgard2-phpcr-provider">Install Midgard2 PHPCR provider</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="installation-configuration.html#class-loading-with-composer">Class loading with composer</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#obtaining-an-objectmanager">Obtaining an ObjectManager</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#prepare-the-mapping-driver">Prepare the mapping driver</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#attributes-mapping-driver">Attributes Mapping Driver</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#xml-mapping-driver">XML Mapping Driver</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#yml-mapping-driver">YML Mapping Driver</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="installation-configuration.html#quick-configuration-example">Quick Configuration Example</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="installation-configuration.html#configuration-options">Configuration Options</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#proxy-directory-required">Proxy Directory (*REQUIRED*)</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#proxy-namespace-required">Proxy Namespace (*REQUIRED*)</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#metadata-driver-required">Metadata Driver (*REQUIRED*)</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#metadata-cache-recommended">Metadata Cache (*RECOMMENDED*)</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#auto-generating-proxy-classes-optional">Auto-generating Proxy Classes (*OPTIONAL*)</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="installation-configuration.html#development-vs-production-configuration">Development vs Production Configuration</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#connection-options">Connection Options</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#proxy-objects">Proxy Objects</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#reference-proxies">Reference Proxies</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#generating-proxy-classes">Generating Proxy classes</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#multiple-metadata-sources">Multiple Metadata Sources</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#default-repository-optional">Default Repository (*OPTIONAL*)</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="installation-configuration.html#setting-up-the-console">Setting up the Console</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#register-system-node-types">Register system node types</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="introduction.html#getting-started">Getting Started</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="introduction.html#what-are-documents">What are Documents?</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#an-example-model-document-management">An Example Model: Document Management</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#setup-project">Setup Project</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#building-the-model">Building the model</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#initialize-the-repository">Initialize the repository</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#storing-documents">Storing documents</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#reading-documents">Reading documents</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#tree-traversal">Tree traversal</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#add-references">Add references</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#removing-documents">Removing documents</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#other-helpful-methods-on-the-documentmanager">Other helpful methods on the DocumentManager</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#conclusion">Conclusion</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="multilang.html#multilanguage-support">Multilanguage support</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="multilang.html#philosophy">Philosophy</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#mapping">Mapping</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#interacting-with-translations">Interacting with translations</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#choosing-the-right-translation-strategy">Choosing the right translation strategy</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="multilang.html#implementing-your-own-translation-strategy">Implementing your own translation strategy</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="multilang.html#configure-the-locale-chooser-strategy">Configure the locale chooser strategy</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#full-example">Full Example</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#querying-translated-properties">Querying Translated Properties</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#limitations">Limitations</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="multilang.html#translations-and-references-hierarchy">Translations and references / hierarchy</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="phpcr-access.html#accessing-the-underlying-phpcr-session">Accessing the underlying PHPCR session</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="phpcr-access.html#getting-the-phpcr-session">Getting the PHPCR Session</a>


</li>
            <li class="toc-item">
    <a href="phpcr-access.html#the-node-field-mapping">The Node field mapping</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="query.html#the-query-object">The Query Object</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="query.html#getting-single-results">Getting single results</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query.html#getsingleresult">getSingleResult</a>


</li>
            <li class="toc-item">
    <a href="query.html#getoneornullresult">getOneOrNullResult</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query.html#getting-multiple-results">Getting multiple results</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query.html#getresult">getResult</a>


</li>
            <li class="toc-item">
    <a href="query.html#getphpcrnoderesult">getPhpcrNodeResult</a>


</li>
            <li class="toc-item">
    <a href="query.html#execute">execute</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query.html#hydration-modes">Hydration modes</a>


</li>
            <li class="toc-item">
    <a href="query.html#limiting-results">Limiting results</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="query-builder.html#the-querybuilder">The QueryBuilder</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="query-builder.html#concepts">Concepts</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder.html#leaf-and-factory-nodes">Leaf and Factory Nodes</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#fluent-interface">Fluent Interface</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#types-and-cardinality">Types and Cardinality</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#aliases-and-fields">Aliases and fields</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder.html#retrieving-a-query-builder-instance">Retrieving a query builder instance</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder.html#via-the-document-manager">Via the document manager</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#via-a-document-repository">Via a document repository</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder.html#working-with-the-querybuilder">Working with the QueryBuilder</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder.html#specifying-the-document-source-from">Specifying the document source - from</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder.html#from-single-source">From Single Source</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#from-joined-source">From Joined Source</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#joining-with-an-association">Joining with an Association</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder.html#selecting-specific-properties-select">Selecting specific properties - select</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#limiting-the-number-of-results">Limiting the number of results</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#specifying-selection-criteria">Specifying selection criteria</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#ordering-results">Ordering results</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#querying-translated-documents">Querying translated documents</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder.html#additional-notes">Additional notes</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder.html#querying-multivalue-fields">Querying multivalue fields</a>


</li>
            <li class="toc-item">
    <a href="query-builder.html#using-the-query-builder-in-tests">Using the Query Builder in Tests</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="query-builder-reference.html#query-builder-reference">Query Builder Reference</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="query-builder-reference.html#reference">Reference</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#node-constraintandx">Node: ConstraintAndx</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-constraintcomparison">Node: ConstraintComparison</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-constraintfactory">Node: ConstraintFactory</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#andx">-&gt;andX</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#orx">-&gt;orX</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#fieldisset">-&gt;fieldIsset</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#fulltextsearch">-&gt;fullTextSearch</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#same">-&gt;same</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#descendant">-&gt;descendant</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#child">-&gt;child</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#eq">-&gt;eq</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#neq">-&gt;neq</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#lt">-&gt;lt</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#lte">-&gt;lte</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#gt">-&gt;gt</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#gte">-&gt;gte</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#like">-&gt;like</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-constraintnot">Node: ConstraintNot</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-constraintorx">Node: ConstraintOrx</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-from">Node: From</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-operanddynamicfactory">Node: OperandDynamicFactory</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#fulltextsearchscore">-&gt;fullTextSearchScore</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#length">-&gt;length</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#lowercase">-&gt;lowerCase</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#uppercase">-&gt;upperCase</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#localname">-&gt;localName</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#name">-&gt;name</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#field">-&gt;field</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-operanddynamiclowercase">Node: OperandDynamicLowerCase</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-operanddynamicuppercase">Node: OperandDynamicUpperCase</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-operandfactory">Node: OperandFactory</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#parameter">-&gt;parameter</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#literal">-&gt;literal</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-operandstaticfactory">Node: OperandStaticFactory</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-orderby">Node: OrderBy</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#asc">-&gt;asc</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#desc">-&gt;desc</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-orderbyadd">Node: OrderByAdd</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-ordering">Node: Ordering</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-querybuilder">Node: QueryBuilder</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#where">-&gt;where</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#andwhere">-&gt;andWhere</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#orwhere">-&gt;orWhere</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#from">-&gt;from</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#fromdocument">-&gt;fromDocument</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#addjoinleftouter">-&gt;addJoinLeftOuter</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#addjoinrightouter">-&gt;addJoinRightOuter</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#addjoininner">-&gt;addJoinInner</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#select">-&gt;select</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#addselect">-&gt;addSelect</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#orderby">-&gt;orderBy</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#addorderby">-&gt;addOrderBy</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-select">Node: Select</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-selectadd">Node: SelectAdd</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-sourcejoin">Node: SourceJoin</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-sourcejoinconditionfactory">Node: SourceJoinConditionFactory</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#descendant">-&gt;descendant</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#equi">-&gt;equi</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#child">-&gt;child</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#same">-&gt;same</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-sourcejoinleft">Node: SourceJoinLeft</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-sourcejoinright">Node: SourceJoinRight</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-where">Node: Where</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-whereand">Node: WhereAnd</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-whereor">Node: WhereOr</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="tools.html#tools">Tools</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="tools.html#doctrine-console">Doctrine Console</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="tools.html#command-overview">Command Overview</a>


</li>
            <li class="toc-item">
    <a href="tools.html#getting-documentation-of-a-command">Getting documentation of a command</a>


</li>
            <li class="toc-item">
    <a href="tools.html#phpcr-implementation-specific-commands">PHPCR implementation specific commands</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="tools.html#jackrabbit-specific-commands">Jackrabbit specific commands</a>


</li>
            <li class="toc-item">
    <a href="tools.html#doctrine-dbal-specific-commands">Doctrine DBAL specific commands</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="tools.html#register-system-node-types">Register system node types</a>


</li>
            <li class="toc-item">
    <a href="tools.html#adding-your-own-commands">Adding your own commands</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="transactions.html#transactions-1">Transactions</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="transactions.html#transactional">transactional()</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="versioning.html#versioning-support">Versioning support</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="versioning.html#philosophy">Philosophy</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="versioning.html#phpcr-odm">PHPCR-ODM</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="versioning.html#mappings">Mappings</a>


</li>
            <li class="toc-item">
    <a href="versioning.html#interacting-with-versions">Interacting with versions</a>


</li>
            <li class="toc-item">
    <a href="versioning.html#full-example">Full Example</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="working-with-objects.html#working-with-objects">Working with Objects</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="working-with-objects.html#documents-and-the-identity-map">Documents and the Identity Map</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#document-graph-traversal">Document Graph Traversal</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#persisting-documents">Persisting documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#removing-documents">Removing documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#detaching-documents">Detaching documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#merging-documents">Merging documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#synchronization-with-the-repository">Synchronization with the Repository</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="working-with-objects.html#effects-of-repository-and-unitofwork-being-out-of-sync">Effects of Repository and UnitOfWork being Out-Of-Sync</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#synchronizing-new-and-managed-documents">Synchronizing New and Managed Documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#synchronizing-removed-documents">Synchronizing Removed Documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#the-size-of-a-unit-of-work">The size of a Unit of Work</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#the-cost-of-flushing">The cost of flushing</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#direct-access-to-a-unit-of-work">Direct Access to a Unit of Work</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#document-state">Document State</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="working-with-objects.html#querying">Querying</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="working-with-objects.html#by-primary-key">By Primary Key</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#by-simple-conditions">By Simple Conditions</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#by-lazy-loading">By Lazy Loading</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#by-query-builder">By Query Builder</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#by-native-queries">By Native Queries</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#custom-repositories">Custom Repositories</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="xml-mapping.html#xml-mapping">XML Mapping</a>


</li>
    </ul>
</div>
    

                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://www.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "PHPCR ODM",
            "item": "https://www.doctrine-project.org/projects/phpcr-odm.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/2.1/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "Association Mapping",
            "item": "https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/2.1/reference/association-mapping.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/2.1/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">Association Mapping</li>
                        </ol>
</nav>
                                    </div>

                    
    <div class="alert caution bg-light-yellow text-dark border">
    <table width="100%">
        <tr>
            <td width="10" class="align-top">
                <i class="fas fa-exclamation-circle text-warning mr-2"></i>
            </td>
            <td><p>You are browsing a version that is no longer maintained.</p></td>
        </tr>
    </table>
</div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine-phpcr-odm/en/2.1/reference/association-mapping.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        2.1.0
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-phpcr-odm/en/latest/reference/association-mapping.html">
                                                        2.0.1

                                                                                                                    (current)
                                                        
                                                                                                            </a>
                                                                                                                                                                                                                                
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                
                                                    <a class="dropdown-item active" href="/projects/doctrine-phpcr-odm/en/2.1/reference/association-mapping.html">2.1</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-phpcr-odm/en/1.8/reference/association-mapping.html">1.8</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-phpcr-odm/en/1.7/reference/association-mapping.html">1.7</a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                </div>
                            
                            

            <div class="section" id="association-mapping">
            <h1 class="section-header ">
    <a href="#association-mapping">
        Association Mapping
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p>This chapter introduces association mappings. PHPCR has a tree based model of the content.
In addition to references to arbitrary other documents, every document has a parent and may
have children.</p>

            
    <p>We will start with the hierarchy associations and then go into the references, which work
slightly differently from what you are used from an RDBMS as well.</p>

            <div class="section" id="hierarchy-mappings">
            <a id="hierarchy-mappings"></a>
            <h2 class="section-header ">
    <a href="#hierarchy-mappings">
        Hierarchy mappings
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>We have already seen the <code>ParentDocument</code> in the previous chapter in the section about
identifier generation. The field with this mapping contains the parent document of this document
(<code>PHPCR\NodeInterface::getParent()</code>). If the repository can determine the document class of the
parent, it will use it, otherwise <code>Doctrine\ODM\PHPCR\Document\Generic</code> is used.</p>

            
    <p>To map children, you have two options:</p>

            

<ul>
    <li class="dash">You can map a single child with a specific name.</li>
    <li class="dash">Or you can map a <a href="#collections">collection</a> of children, with the possibility to filter on the document name.</li>
</ul>

            
    <p>A single Child will always load only one document. If no explicit name is specified, the field
name is used to retrieve the child document. The name is the last part of that document&#039;s id,
resp. its Nodename mapping.</p>

                        <div class="alert warning-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td>
            <td>
                                                
    <p>When persisting such a document, the name of the child document set on that
field must be empty or match the configured name. If it is not the expected
name, you will get an exception.</p>

    <p>PHPCR-ODM 1.0 silently changed the name of the child to the name of the
mapping, which could lead to unexpected behaviour.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>To map a collection of children, use <code>Children</code>. This will always be a collection, regardless of
the number of found children. You can limit the children to a subset of all children by specifying
a <code>filter</code> that acts on the node name. See <a href="http://phpcr.github.com/doc/html/phpcr/nodeinterface.html#getNodes()">PHPCR\NodeInterface::getNodes()</a>
for details on allowed filters.</p>

            
    <p>To tweak performance, you can also specify a <code>fetchDepth</code> if you know that you will always access children
of the mapped children. This can improve performance when you need to load a more complicated structure.
(See also <a href="fetch-depth.html">Tuning the node preloading</a>).</p>

            
    <p>Some sample mappings:</p>

            <div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="php"
                    aria-controls="configuration-block-tabpanel-3d9d05d7691dc8bd5a18fa995294093e" aria-selected="true"
                    data-active="true" >
                <span>Php</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                    aria-controls="configuration-block-tabpanel-59ec76fcbb7f67090d23801139a7173a" aria-selected="false"
                     tabindex="-1">
                <span>Xml</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                    aria-controls="configuration-block-tabpanel-9bac1802c0eec494f634537bbc07ba23" aria-selected="false"
                     tabindex="-1">
                <span>Yaml</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-3d9d05d7691dc8bd5a18fa995294093e" aria-label="Php" class="configuration-codeblock" data-language="php" style="">
                <pre class="code-block-table" id="64c3c2a4c63f9c6194ec5f4b323d16d334818263"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="64c3c2a4c63f9c6194ec5f4b323d16d334818263"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">Mapping</span>\<span class="hljs-title">Attributes</span> <span class="hljs-title">as</span> <span class="hljs-title">PHPCR</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">ChildrenCollection</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\ParentDocument]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> object $parent;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\Child]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> object $mychild;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\Children(filter: 'a*', fetchDepth: 3)]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> ChildrenCollection $children;</code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-59ec76fcbb7f67090d23801139a7173a" aria-label="Xml" class="configuration-codeblock" data-language="xml" style="display: none">
                <pre class="code-block-table" id="3543b2aebd60c5099689179a7a39776bbfbda4cf"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="3543b2aebd60c5099689179a7a39776bbfbda4cf"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="line language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">document</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"MyPersistentClass"</span>&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">parentdocument</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"parent"</span> /&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">child</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"mychild"</span> /&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">children</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"children"</span> <span class="hljs-attr">filter</span>=<span class="hljs-string">"a*"</span> <span class="hljs-attr">fetchDepth</span>=<span class="hljs-string">"3"</span> /&gt;</span></code><code class="line language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">document</span>&gt;</span></code><code class="line language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-9bac1802c0eec494f634537bbc07ba23" aria-label="Yaml" class="configuration-codeblock" data-language="yaml" style="display: none">
                <pre class="code-block-table" id="84e783c5af80f2d1561492d16e93480cf2daac55"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="84e783c5af80f2d1561492d16e93480cf2daac55"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-yaml"><span class="hljs-attr">MyPersistentClass:</span></code><code class="line language-yaml">  <span class="hljs-attr">parentdocument:</span> <span class="hljs-string">parent</span></code><code class="line language-yaml">  <span class="hljs-attr">child:</span></code><code class="line language-yaml">    <span class="hljs-attr">mychild:</span> <span class="hljs-string">~</span></code><code class="line language-yaml">  <span class="hljs-attr">children:</span></code><code class="line language-yaml">    <span class="hljs-attr">some:</span></code><code class="line language-yaml">     <span class="hljs-attr">filter:</span> <span class="hljs-string">"a*"</span></code><code class="line language-yaml">     <span class="hljs-attr">fetchDepth:</span> <span class="hljs-number">3</span></code><code class="empty"></code></pre>
        </div>
    </div>
            <div class="section" id="child-restriction">
            <h3 class="section-header ">
    <a href="#child-restriction">
        Child restriction
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>You may either specify which classes may be children of a document or that a
document is not allowed to have children (i.e. that it is a leaf node).</p>

            <div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="php"
                    aria-controls="configuration-block-tabpanel-c2f918d0b6f14810051683855662a3ca" aria-selected="true"
                    data-active="true" >
                <span>Php</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                    aria-controls="configuration-block-tabpanel-407ce439d6a9371946661cafb8be1f58" aria-selected="false"
                     tabindex="-1">
                <span>Xml</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                    aria-controls="configuration-block-tabpanel-2642f4f223e7c3db29aa308a2510c29c" aria-selected="false"
                     tabindex="-1">
                <span>Yaml</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-c2f918d0b6f14810051683855662a3ca" aria-label="Php" class="configuration-codeblock" data-language="php" style="">
                <pre class="code-block-table" id="1cc78c6ea28390f7293ff370751b42e74c9afcf9"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="1cc78c6ea28390f7293ff370751b42e74c9afcf9"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Fqn</span>\<span class="hljs-title">Article</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Fqn</span>\<span class="hljs-title">Page</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[Document(childClasses: [Article::class, Page::class])]</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContentFolder</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">// ...</span></code><code class="line language-php">}</code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-407ce439d6a9371946661cafb8be1f58" aria-label="Xml" class="configuration-codeblock" data-language="xml" style="display: none">
                <pre class="code-block-table" id="c4d127e997fd60f9d8c297b62a76a8fcdf5e79b8"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="c4d127e997fd60f9d8c297b62a76a8fcdf5e79b8"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">document</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ContentFolder"</span>&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">child-class</span>&gt;</span>Fqn\Article<span class="hljs-tag">&lt;/<span class="hljs-name">child-class</span>&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">child-class</span>&gt;</span>Fqn\Page<span class="hljs-tag">&lt;/<span class="hljs-name">child-class</span>&gt;</span></code><code class="line language-xml">        <span class="hljs-comment">&lt;!-- ... --&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">document</span>&gt;</span></code><code class="line language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-2642f4f223e7c3db29aa308a2510c29c" aria-label="Yaml" class="configuration-codeblock" data-language="yaml" style="display: none">
                <pre class="code-block-table" id="486e4995cea4ae472defdc25c64b72e10c4f2971"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="486e4995cea4ae472defdc25c64b72e10c4f2971"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-yaml"><span class="hljs-attr">ContentFolder:</span></code><code class="line language-yaml">    <span class="hljs-comment"># ...</span></code><code class="line language-yaml">    <span class="hljs-attr">child_classes:</span> <span class="hljs-string">[</span> <span class="hljs-string">"Fqn\Article"</span><span class="hljs-string">,</span> <span class="hljs-string">"Fqn\Page"</span> <span class="hljs-string">]</span></code><code class="empty"></code></pre>
        </div>
    </div>
            
    <p>To specify that a document can have no children:</p>

            <div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="php"
                    aria-controls="configuration-block-tabpanel-a22e9c907823dc2a21d5bb4294a5d154" aria-selected="true"
                    data-active="true" >
                <span>Php</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                    aria-controls="configuration-block-tabpanel-ce76914aaea795d2266abe5715207240" aria-selected="false"
                     tabindex="-1">
                <span>Xml</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                    aria-controls="configuration-block-tabpanel-d70c76bee280525e8975b9d6a46980b9" aria-selected="false"
                     tabindex="-1">
                <span>Yaml</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-a22e9c907823dc2a21d5bb4294a5d154" aria-label="Php" class="configuration-codeblock" data-language="php" style="">
                <pre class="code-block-table" id="2a3fa009f2a5804d6b69888ad9e8b5f574175aa0"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="2a3fa009f2a5804d6b69888ad9e8b5f574175aa0"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">#[Document(isLeaf: true)]</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LeafDocument</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">// ...</span></code><code class="line language-php">}</code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-ce76914aaea795d2266abe5715207240" aria-label="Xml" class="configuration-codeblock" data-language="xml" style="display: none">
                <pre class="code-block-table" id="236800cfc8779bd2cc1443a6f57dd9d06ab19526"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="236800cfc8779bd2cc1443a6f57dd9d06ab19526"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">document</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"LeafDocument"</span> <span class="hljs-attr">is-leaf</span>=<span class="hljs-string">"true"</span>&gt;</span></code><code class="line language-xml">        <span class="hljs-comment">&lt;!-- ... --&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">document</span>&gt;</span></code><code class="line language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-d70c76bee280525e8975b9d6a46980b9" aria-label="Yaml" class="configuration-codeblock" data-language="yaml" style="display: none">
                <pre class="code-block-table" id="c7ae951c05c71a2fcbef296262fbb94614928ccd"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="c7ae951c05c71a2fcbef296262fbb94614928ccd"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-yaml"><span class="hljs-attr">MyPersistentClass:</span></code><code class="line language-yaml">    <span class="hljs-comment"># ...</span></code><code class="line language-yaml">    <span class="hljs-attr">is_leaf:</span> <span class="hljs-literal">true</span></code><code class="empty"></code></pre>
        </div>
    </div>
    </div>
    </div>
            <div class="section" id="references">
            <h2 class="section-header ">
    <a href="#references">
        References
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>In PHPCR any referenceable node can be referenced by any other node, regardless of their types.</p>

            
    <p>References are always directional, but thanks to the Referrers, you can model the back reference as well.</p>

            
    <p>References use universally unique identifiers automatically generated on documents if they
are set to be referenceable. That way, a reference will stay intact even if documents are moved.
A field can reference one or many documents, and it can enforce referencial integrity or create
a weak reference that does not ensure integrity, depending on your use case.</p>

            <div class="section" id="referenceable-documents">
            <a id="association-mapping_referenceable"></a>
            <h3 class="section-header ">
    <a href="#referenceable-documents">
        Referenceable documents
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>To be allowed to reference a document, it needs to be referenceable. To achieve this, this fact needs
to be specified in the Document mapping. Having a referenceable document also allows you to
map its uuid to a field.</p>

            
    <p>The Uuid is read only, autogenerated on the first flush of the document. It follows the universally unique
id standard and is guaranteed to be unique for the whole PHPCR repository (all workspaces).</p>

            <div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="php"
                    aria-controls="configuration-block-tabpanel-195b58edfc8931f9fae0f0bf7ec1fe73" aria-selected="true"
                    data-active="true" >
                <span>Php</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                    aria-controls="configuration-block-tabpanel-7c600a446d89022d040e7a01facbc965" aria-selected="false"
                     tabindex="-1">
                <span>Xml</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                    aria-controls="configuration-block-tabpanel-031d5fd49fcc14fb4150cfba72d8d099" aria-selected="false"
                     tabindex="-1">
                <span>Yaml</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-195b58edfc8931f9fae0f0bf7ec1fe73" aria-label="Php" class="configuration-codeblock" data-language="php" style="">
                <pre class="code-block-table" id="eb782569242e027b3e6ca80780f1041115ff87ee"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="eb782569242e027b3e6ca80780f1041115ff87ee"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">Mapping</span>\<span class="hljs-title">Attributes</span> <span class="hljs-title">as</span> <span class="hljs-title">PHPCR</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\Document(referenceable: true)]</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPersistentClass</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">#[PHPCR\Uuid]</span></code><code class="line language-php">    <span class="hljs-keyword">private</span> string $uuid;</code><code class="line language-php"></code><code class="line language-php">}</code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-7c600a446d89022d040e7a01facbc965" aria-label="Xml" class="configuration-codeblock" data-language="xml" style="display: none">
                <pre class="code-block-table" id="88a890694b8ad41c2afebdd30472fa95c8eafd57"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="88a890694b8ad41c2afebdd30472fa95c8eafd57"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">document</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"MyPersistentClass"</span> <span class="hljs-attr">referenceable</span>=<span class="hljs-string">"true"</span>&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">uuid</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"uuid"</span> /&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">document</span>&gt;</span></code><code class="line language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-031d5fd49fcc14fb4150cfba72d8d099" aria-label="Yaml" class="configuration-codeblock" data-language="yaml" style="display: none">
                <pre class="code-block-table" id="72a78319b2ed0ab07001622a6062c135b178586a"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="72a78319b2ed0ab07001622a6062c135b178586a"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-yaml"><span class="hljs-attr">MyPersistentClass:</span></code><code class="line language-yaml">  <span class="hljs-attr">referenceable:</span> <span class="hljs-literal">true</span></code><code class="line language-yaml">  <span class="hljs-attr">fields:</span></code><code class="line language-yaml">    <span class="hljs-attr">uuid:</span></code><code class="line language-yaml">      <span class="hljs-attr">uuid:</span> <span class="hljs-literal">true</span></code><code class="empty"></code></pre>
        </div>
    </div>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>PHPCR-ODM has no migrations (yet). If you change a document class to become referenceable,
you need to load and save every document of that type to make the stored documents note the change.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="reference-other-documents">
            <a id="associationmapping_referenceotherdocuments"></a>
            <h3 class="section-header ">
    <a href="#reference-other-documents">
        Reference other documents
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>As noted above, the target document needs to be referenceable. Apart from that, there is
no limitation on the type of the target document, giving you great flexibility.</p>

            
    <p>There are two mappings, ReferenceOne and ReferenceMany to reference one or several
target documents. ReferenceMany is using <code>doctrine/common</code>&#039;s collections.</p>

            
    <p>You can specify for each reference if it should ensure referencial integrity or just
be a weak reference. By default, a weak reference is created, allowing you to delete
the referenced target document. Alternatively you can also tell PHPCR-ODM to reference by path,
which is interesting to create references to non-referenceable documents and when using relative paths.
A path reference will never ensure referential integrity.
(TODO: solve the open issue of how we can make paths relative and document here)</p>

            <div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="php"
                    aria-controls="configuration-block-tabpanel-f25c5225e90e1640b4767f7884c0ffc4" aria-selected="true"
                    data-active="true" >
                <span>Php</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                    aria-controls="configuration-block-tabpanel-a7bbe7a03c651b0915ab55ec564603ca" aria-selected="false"
                     tabindex="-1">
                <span>Xml</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                    aria-controls="configuration-block-tabpanel-9db16cec401da3430dfe27f31501beb9" aria-selected="false"
                     tabindex="-1">
                <span>Yaml</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-f25c5225e90e1640b4767f7884c0ffc4" aria-label="Php" class="configuration-codeblock" data-language="php" style="">
                <pre class="code-block-table" id="d73de323f4d1d4e3ed0920bbb55d14d9e9cefeae"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="d73de323f4d1d4e3ed0920bbb55d14d9e9cefeae"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">Mapping</span>\<span class="hljs-title">Attributes</span> <span class="hljs-title">as</span> <span class="hljs-title">PHPCR</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">ReferenceManyCollection</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\ReferenceOne(strategy: 'weak')]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> object $weakTarget;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\ReferenceOne(strategy: 'hard')]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> object $hardTarget;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\ReferenceOne(strategy: 'path')]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> object $pathTarget;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\ReferenceMany(strategy: 'weak')]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> ReferenceManyCollection $weakGroup;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\ReferenceMany(strategy: 'hard')]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> ReferenceManyCollection $hardGroup;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\ReferenceMany(strategy: 'path')]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> ReferenceManyCollection $pathGroup;</code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-a7bbe7a03c651b0915ab55ec564603ca" aria-label="Xml" class="configuration-codeblock" data-language="xml" style="display: none">
                <pre class="code-block-table" id="a118cc2b5d64a9ced547a6dbc4d49994b3f5b83d"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="a118cc2b5d64a9ced547a6dbc4d49994b3f5b83d"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">document</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"MyPersistentClass"</span>&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">reference-one</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"weakTarget"</span> <span class="hljs-attr">strategy</span>=<span class="hljs-string">"weak"</span> /&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">reference-one</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"hardTarget"</span> <span class="hljs-attr">strategy</span>=<span class="hljs-string">"hard"</span> /&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">reference-one</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"pathTarget"</span> <span class="hljs-attr">strategy</span>=<span class="hljs-string">"path"</span> /&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">reference-many</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"weakGroup"</span> <span class="hljs-attr">strategy</span>=<span class="hljs-string">"weak"</span> /&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">reference-many</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"hardGroup"</span> <span class="hljs-attr">strategy</span>=<span class="hljs-string">"hard"</span> /&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">reference-many</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"pathGroup"</span> <span class="hljs-attr">strategy</span>=<span class="hljs-string">"path"</span> /&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">document</span>&gt;</span></code><code class="line language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-9db16cec401da3430dfe27f31501beb9" aria-label="Yaml" class="configuration-codeblock" data-language="yaml" style="display: none">
                <pre class="code-block-table" id="85dcfa468ef23b6dd0c7abe99330e687631781da"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="85dcfa468ef23b6dd0c7abe99330e687631781da"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-yaml"><span class="hljs-attr">MyPersistentClass:</span></code><code class="line language-yaml">    <span class="hljs-attr">referenceOne:</span></code><code class="line language-yaml">        <span class="hljs-attr">weakTarget:</span></code><code class="line language-yaml">          <span class="hljs-attr">strategy:</span> <span class="hljs-string">weak</span></code><code class="line language-yaml">        <span class="hljs-attr">hardTarget:</span></code><code class="line language-yaml">          <span class="hljs-attr">strategy:</span> <span class="hljs-string">hard</span></code><code class="line language-yaml">        <span class="hljs-attr">pathTarget:</span></code><code class="line language-yaml">          <span class="hljs-attr">strategy:</span> <span class="hljs-string">path</span></code><code class="line language-yaml">    <span class="hljs-attr">referenceMany:</span></code><code class="line language-yaml">        <span class="hljs-attr">weakGroup:</span></code><code class="line language-yaml">          <span class="hljs-attr">strategy:</span> <span class="hljs-string">weak</span></code><code class="line language-yaml">        <span class="hljs-attr">hardGroup:</span></code><code class="line language-yaml">          <span class="hljs-attr">strategy:</span> <span class="hljs-string">hard</span></code><code class="line language-yaml">        <span class="hljs-attr">pathGroup:</span></code><code class="line language-yaml">          <span class="hljs-attr">strategy:</span> <span class="hljs-string">path</span></code><code class="empty"></code></pre>
        </div>
    </div>
            
    <p><code>ReferenceMany</code> documents will always be handled as collections to allow for lazy loading,
regardless of the strategy chosen.</p>

            
    <p>All types of reference support the optional argument <code>targetDocument</code>.
This can be used to tell what the expected document type for the reference target is.
If you only reference documents of one specific type, you can use this as sanity check,
additionally path references will be faster this way.</p>

            
    <p>If you do not set the targetDocument, you can reference documents of any type.
In ReferenceMany collections, you can even have documents of mixed types.</p>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>If your repository supports programmatically setting the uuid property at node creation,
you can just persist your main document and the referenced documents will be persisted
automatically.</p>

    <p>Otherwise you first need to flush the document manager for the reference targets before
you can reference them in your document.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
                        <div class="alert warning-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td>
            <td>
                                                
    <p>When using hard references in combination with versioning, old versions of
your documents may still have target documents that become null if the
target has been deleted since the version has been created. This is due to
PHPCR not ensuring referential integrity for old versions as otherwise you
could never delete a document once it has been referenced and the reference
versioned, even if the reference is deleted later. When working with
versions, you thus always need to check if a referenced document actually
exists.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="referrers-to-inverse-the-reference-relation">
            <h3 class="section-header ">
    <a href="#referrers-to-inverse-the-reference-relation">
        Referrers to inverse the reference relation
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>PHPCR-ODM is able to tell which documents reference a specific document, if the <code>hard</code> or
<code>weak</code> strategy is used. The <code>Referrers</code> mapping is a collection of documents that have
a reference to this document.</p>

            
    <p>In ORM terms, the Reference is the owning side of the association, while the
Referrer is the inverse side. Contrary to the ORM, the PHPCR references really
are directional, they are always stored in the property of the document with
the ReferenceOne or ReferenceMany field. Referrer is a purely virtual information
that is not explicitly stored in the PHPCR database but determined at runtime.</p>

            
    <p>You need to specify the <code>referringDocument</code> to specify the (base) class of the
document that has the reference, and <code>referencedBy</code> to tell which field of the
referencing document contains the reference. After flushing, the reference property
will contain the referenced document.</p>

            <div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="php"
                    aria-controls="configuration-block-tabpanel-3384da0d53547cd5679f32708e268314" aria-selected="true"
                    data-active="true" >
                <span>Php</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                    aria-controls="configuration-block-tabpanel-d1973617135d58a7f89d00e1f3bfe182" aria-selected="false"
                     tabindex="-1">
                <span>Xml</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                    aria-controls="configuration-block-tabpanel-a82a4e51903580b82208be46eb0c798d" aria-selected="false"
                     tabindex="-1">
                <span>Yaml</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-3384da0d53547cd5679f32708e268314" aria-label="Php" class="configuration-codeblock" data-language="php" style="">
                <pre class="code-block-table" id="ec2c09b13cd5987fb28bef70ca403e1cda52892a"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="ec2c09b13cd5987fb28bef70ca403e1cda52892a"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">Mapping</span>\<span class="hljs-title">Attributes</span> <span class="hljs-title">as</span> <span class="hljs-title">PHPCR</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">ReferrersCollection</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\Referrers(referringDocument: ClassName::class, referencedBy: 'otherFieldName')]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> ReferrersCollection $specificReferrers;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\Referrers(referringDocument: OtherClassName::class, referencedBy: 'someFieldName', cascade: 'persist, remove')]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> ReferrersCollection $cascadedReferrers;</code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-d1973617135d58a7f89d00e1f3bfe182" aria-label="Xml" class="configuration-codeblock" data-language="xml" style="display: none">
                <pre class="code-block-table" id="a7b11aa9db9b6e5d14bc802e53feefd082473ae0"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="a7b11aa9db9b6e5d14bc802e53feefd082473ae0"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">document</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"MyPersistentClass"</span>&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">referrers</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"specificReferrers"</span> <span class="hljs-attr">referring-document</span>=<span class="hljs-string">"FQN\Class\Name"</span> <span class="hljs-attr">referenced-by</span>=<span class="hljs-string">"otherFieldName"</span> /&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">referrers</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"cascadedReferrers"</span> <span class="hljs-attr">referring-document</span>=<span class="hljs-string">"Other\Class\Name"</span> <span class="hljs-attr">referenced-by</span>=<span class="hljs-string">"someFieldName"</span> <span class="hljs-attr">cascade</span>=<span class="hljs-string">"persist, remove"</span> /&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">document</span>&gt;</span></code><code class="line language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-a82a4e51903580b82208be46eb0c798d" aria-label="Yaml" class="configuration-codeblock" data-language="yaml" style="display: none">
                <pre class="code-block-table" id="5f3a7be9aefd29f8ac1cfb35ca0bbd4e6025d8bd"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="5f3a7be9aefd29f8ac1cfb35ca0bbd4e6025d8bd"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-yaml"><span class="hljs-attr">MyPersistentClass:</span></code><code class="line language-yaml">    <span class="hljs-attr">referrers:</span></code><code class="line language-yaml">        <span class="hljs-attr">specificReferrers:</span></code><code class="line language-yaml">            <span class="hljs-attr">referringDocument:</span> <span class="hljs-string">FQN\Class\Name</span></code><code class="line language-yaml">            <span class="hljs-attr">referencedBy:</span> <span class="hljs-string">otherFieldName</span></code><code class="line language-yaml">        <span class="hljs-attr">cascadedReferrers:</span></code><code class="line language-yaml">            <span class="hljs-attr">referringDocument:</span> <span class="hljs-string">Other\Class\Name</span></code><code class="line language-yaml">            <span class="hljs-attr">referencedBy:</span> <span class="hljs-string">someFieldName</span></code><code class="line language-yaml">            <span class="hljs-attr">cascade:</span> <span class="hljs-string">persist,</span> <span class="hljs-string">remove</span></code><code class="empty"></code></pre>
        </div>
    </div>
            
    <p>Referrers can cascade like the other association mappings to persist or delete their
referrers if desired.</p>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>The main use case to persist cascade or deletion of the referrer mapping
is to build a form where it is possible to add documents that should reference
this content. However, it is not allowed to modify both the reference collection
and the referrer collection of interlinked content, as this would be ambiguous.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>There is also the <code>DocumentManager::getReferrers()</code> method that allows you
to get more fine grained control on what referencing documents are returned,
if <code>Referrers</code> is too limited and <code>MixedReferrers</code> too broad.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="mixedreferrers">
            <h3 class="section-header ">
    <a href="#mixedreferrers">
        MixedReferrers
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>The mixed referrers is a much simpler but read only mapping to get a collection
of <em>all</em> documents that have a reference to this document. The only possible option
of mixed referrers is <code>referenceType</code> to limit the referrers to only hard resp. weak
references. If left out, you get both types of references.</p>

            
    <p>Mixed referrers can even be mapped on a document that is not referenceable, as you
might do it on a base document of which some extending documents are referenceable.
An example for this is the <code>Generic</code> document provided by phpcr-odm itself.</p>

            <div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="php"
                    aria-controls="configuration-block-tabpanel-5f2bb37992d0ee16b3d200b59ddfcf5d" aria-selected="true"
                    data-active="true" >
                <span>Php</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                    aria-controls="configuration-block-tabpanel-0673b5e0c9cd1df56576eb3395d5d73b" aria-selected="false"
                     tabindex="-1">
                <span>Xml</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                    aria-controls="configuration-block-tabpanel-118c437277b3b8ba1487e287588c2650" aria-selected="false"
                     tabindex="-1">
                <span>Yaml</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-5f2bb37992d0ee16b3d200b59ddfcf5d" aria-label="Php" class="configuration-codeblock" data-language="php" style="">
                <pre class="code-block-table" id="27080d24144f72cb4a4ccd08480a23ae9195a7bf"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="27080d24144f72cb4a4ccd08480a23ae9195a7bf"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">Mapping</span>\<span class="hljs-title">Attributes</span> <span class="hljs-title">as</span> <span class="hljs-title">PHPCR</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">ReferrersCollection</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\MixedReferrers]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> ReferrersCollection $allReferrers;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\MixedReferrers(referenceType: 'hard')]</span></code><code class="line language-php"><span class="hljs-keyword">private</span> ReferrersCollection $hardReferrers;</code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-0673b5e0c9cd1df56576eb3395d5d73b" aria-label="Xml" class="configuration-codeblock" data-language="xml" style="display: none">
                <pre class="code-block-table" id="56567e5672a1c7d392a3f336736205bbfdef430f"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="56567e5672a1c7d392a3f336736205bbfdef430f"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">document</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"MyPersistentClass"</span>&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">mixed-referrers</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"allReferrers"</span> /&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">mixed-referrers</span> <span class="hljs-attr">fieldName</span>=<span class="hljs-string">"hardReferrers"</span> <span class="hljs-attr">reference-type</span>=<span class="hljs-string">"hard"</span> /&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">document</span>&gt;</span></code><code class="line language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-118c437277b3b8ba1487e287588c2650" aria-label="Yaml" class="configuration-codeblock" data-language="yaml" style="display: none">
                <pre class="code-block-table" id="4d0c8ef5d2195c075efe67be9c32e4143a1fcc93"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="4d0c8ef5d2195c075efe67be9c32e4143a1fcc93"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-yaml"><span class="hljs-attr">MyPersistentClass:</span></code><code class="line language-yaml">    <span class="hljs-attr">mixedReferrers:</span></code><code class="line language-yaml">        <span class="hljs-attr">allReferrers:</span> <span class="hljs-string">~</span></code><code class="line language-yaml">        <span class="hljs-attr">hardReferrers:</span></code><code class="line language-yaml">            <span class="hljs-attr">referenceType:</span> <span class="hljs-string">hard</span></code><code class="empty"></code></pre>
        </div>
    </div>
    </div>
    </div>
            <div class="section" id="transitive-persistence-cascade-operations">
            <a id="assocmap_transpers"></a>
            <a id="assocmap_cascading"></a>
            <h2 class="section-header ">
    <a href="#transitive-persistence-cascade-operations">
        Transitive persistence / Cascade Operations
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Persisting, removing, detaching and merging individual documents can
become pretty cumbersome, especially when a highly interweaved object graph
is involved. PHPCR-ODM provides cascading with the same concepts as
Doctrine2 ORM does.</p>

            
    <p>Each association to another document or a collection of documents can be
configured to automatically cascade certain operations. For the <code>Children</code> mapping,
cascading persist and remove are implicit and cannot be disabled. A PHPCR node
always must have a parent, removing the parent removes its children.
The child removal happens on PHPCR level and does not trigger additional
lifecycle events.</p>

            
    <p>For References and Referrers, no operations are cascaded by default, they
can be configured specifically.</p>

            
    <p>The following cascade options exist:</p>

            

<ul>
    <li class="dash"><strong>persist</strong>: Cascades persist operations to the associated documents.</li>
    <li class="dash"><strong>remove</strong>: Cascades remove operations to the associated documents.</li>
    <li class="dash"><strong>merge</strong>: Cascades merge operations to the associated documents.</li>
    <li class="dash"><strong>detach</strong>: Cascades detach operations to the associated documents.</li>
    <li class="dash"><strong>refresh</strong>: Also refresh the associated documents when refreshing this document.</li>
    <li class="dash"><strong>translation</strong>: Cascade the current translation locale to associated documents.</li>
    <li class="dash"><strong>all</strong>: Cascades persist, remove, merge, detach, refresh and translation
operations to associated documents.</li>
</ul>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>Cascade operations are performed in memory. That means collections and related documents
are fetched into memory, even if they are still marked as lazy when
the cascade operation is about to be performed. This approach allows
document lifecycle events to be performed for each of these operations.</p>

    <p>However, pulling a large object graph into memory on cascade can cause considerable performance
overhead, especially when cascading collections are large. Makes sure
to weigh the benefits and downsides of each cascade operation that you define.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>Even though automatic cascading is convenient it should be used
with care. Do not blindly apply <code>cascade=all</code> to all associations as
it will unnecessarily degrade the performance of your application.
For each cascade operation that gets activated Doctrine also
applies that operation to the association, be it single or
collection valued.</p>

            <div class="section" id="persistence-by-reachability-cascade-persist">
            <h3 class="section-header ">
    <a href="#persistence-by-reachability-cascade-persist">
        Persistence by Reachability: Cascade Persist
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>There are additional semantics that apply to the Cascade Persist
operation. During each flush() operation Doctrine detects if there
are new documents in any collection and three possible cases can
happen:</p>

            
    
<ol start="1" type="1">
    <li value="1">New documents in a collection marked as cascade persist will be
directly persisted by Doctrine.</li>
    <li value="2">New documents in a collection not marked as cascade persist will
produce an Exception and rollback the flush() operation.</li>
    <li value="3">Collections without new documents are skipped.</li>
</ol>

            
    <p>This concept is called &quot;Persistence by Reachability&quot;. New documents
that are found on already managed documents are automatically
persisted as long as the association is defined as cascade
persist.</p>

    </div>
    </div>
            <div class="section" id="collections">
            <a id="collections"></a>
            <h2 class="section-header ">
    <a href="#collections">
        Collections
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>All many-valued associations of PHPCR-ODM use implementations of the <code>Collection</code>
interface. They are more powerful than plain arrays. Read sections 8.2 to 8.5 in
the ORM documentation <a href="http://docs.doctrine-project.org/en/latest/reference/working-with-associations.html">Working with associations</a>
if you are not familiar with associations.</p>

            
    <p>Your domain models need to use those classes, but they are defined in a
specific doctrine collections repository and thus not specific to any
persistence implementation.
For a discussion of this topic, see the <a href="http://docs.doctrine-project.org/en/latest/reference/association-mapping.html#collections">Collections section</a>
in the ORM documentation.</p>

            <div class="section" id="initializing-collections">
            <h3 class="section-header ">
    <a href="#initializing-collections">
        Initializing Collections
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>You have to be careful when using document fields that contain a
collection of related documents. Say we have a User document that
contains a collection of groups:</p>

                <div class="console">
        <pre><code class="console">use Doctrine\ODM\PHPCR\Mapping\Attributes as PHPCR;
use Doctrine\ODM\PHPCR\ReferenceManyCollection;

#[PHPCR\Document]
class User
{
    #[PHPCR\ReferenceMany]
    private ReferenceManyCollection $groups;

    public function getGroups(): ReferenceManyCollection
    {
        return $this-&gt;groups;
    }
}
</code></pre>
    </div>

            
    <p>With this code alone the <code>$groups</code> field only contains an
instance of <code>Doctrine\Common\Collections\Collection</code> if the user
is retrieved from Doctrine, however not after you instantiated a
fresh instance of the User. When your user document is still new
<code>$groups</code> will obviously be null.</p>

            
    <p>This is why we recommend to initialize all collection fields to an
empty <code>ArrayCollection</code> in your documents constructor:</p>

                <div class="console">
        <pre><code class="console">use Doctrine\Common\Collections\Collection;
use Doctrine\Common\Collections\ArrayCollection;
use Doctrine\ODM\PHPCR\Mapping\Attributes as PHPCR;

#[PHPCR\Document]
class User
{
    #[PHPCR\ReferenceMany]
    private Collection $groups;

    public function __construct()
    {
        $this-&gt;groups = new ArrayCollection();
    }

    public function getGroups(): Collection
    {
        return $this-&gt;groups;
    }
}
</code></pre>
    </div>

            
    <p>Now the following code will be working even if the Document hasn&#039;t
been associated with a DocumentManager yet:</p>

                <div class="console">
        <pre><code class="console">$group = $documentManager-&gt;find(null, $groupId);
$user = new User();
$user-&gt;getGroups()-&gt;add($group);
</code></pre>
    </div>

    </div>
            <div class="section" id="new-collections-after-flushing">
            <h3 class="section-header ">
    <a href="#new-collections-after-flushing">
        New Collections after Flushing
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>On flushing, Doctrine replaces all collection fields (children, reference many,
referrers, mixed referrers) that contain plain arrays or ArrayCollection with
the appropriate persistent collection class for the field type.</p>

            
    <p>When flushing a new document, their collections are <em>not</em> synchronized with the
database, though cascading happens as explained above. The collections thus
only show the documents that where explicitly added. If other documents are
added directly (e.g. a child with assigned id), you will only see them after
calling <code>$dm-&gt;refresh()</code>, or in subsequent requests.</p>

            
    <p>On an existing document, setting a field to an array or new collection
overwrites all existing documents that previously where in that field, leading
to the deletion of the previous documents.</p>

    </div>
    </div>
    </div>
        

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?1546fc"
                            integrity="sha384-ix9eb2EZyp9uayYpxmCQoylbz8msHl5wOg/aqZnD/3cxszNUGePN656MRg5GEgbm"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'phpcr-odm';
            var versionSlug = '2.1';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search PHPCR ODM 2.1'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            </body>
</html>
