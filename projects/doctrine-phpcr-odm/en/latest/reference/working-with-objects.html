<!DOCTYPE html>
<html>
    <head>
        <title>        Working with Objects - Doctrine PHPCR ODM
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine PHPCR ODM Documentation: Working with Objects ">

        <meta name="keywords" content="                    php,content,odm,data,mapper,mapping,object,documentation,working,with,objects
    ">

                    <meta name="robots" content="index, follow">
        
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/1.x/reference/working-with-objects.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?804931"
                        integrity="sha384-OU8/Wh6kOwekbc8p0dZR/mByM4cSXGaK7tancdEkaNPG444b3MrTnpJMsUhuspCh"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/reference/working-with-objects.html" />
        <meta property="og:title" content="        Working with Objects - Doctrine PHPCR ODM
    " />
        <meta property="og:description" content="Doctrine PHPCR ODM Documentation: Working with Objects " />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine PHPCR ODM",
            "description": "Working with Objects",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                    <a class="dropdown-item" href="/projects/skeleton-mapper.html">Skeleton Mapper</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/phpcr-odm/edit/2.x/docs/en/reference/working-with-objects.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        <div class="toc"><ul><li id="cookbook-custom-documentclass-mapper-html" class="toc-item"><a href="../cookbook/custom_documentclass_mapper.html">Using a Custom Document Class Mapper with PHPCR-ODM</a><ul><li id="cookbook-custom-documentclass-mapper-html-symfony-integration" class="toc-item"><a href="../cookbook/custom_documentclass_mapper.html#symfony-integration">Symfony integration</a></li></ul></li><li id="cookbook-last-modified-html" class="toc-item"><a href="../cookbook/last-modified.html">Last modification timestamp</a><ul><li id="cookbook-last-modified-html-using-the-build-in-support" class="toc-item"><a href="../cookbook/last-modified.html#using-the-build-in-support">Using the build-in support</a></li><li id="cookbook-last-modified-html-a-lastmodified-listener-for-custom-behaviour" class="toc-item"><a href="../cookbook/last-modified.html#a-lastmodified-listener-for-custom-behaviour">A lastModified listener for custom behaviour</a></li></ul></li><li id="cookbook-refactoring-multilang-html" class="toc-item"><a href="../cookbook/refactoring-multilang.html">Refactoring Multilanguage Documents</a><ul><li id="cookbook-refactoring-multilang-html-procedure" class="toc-item"><a href="../cookbook/refactoring-multilang.html#procedure">Procedure</a></li><li id="cookbook-refactoring-multilang-html-converting-untranslated-fields-to-be-translated" class="toc-item"><a href="../cookbook/refactoring-multilang.html#converting-untranslated-fields-to-be-translated">Converting Untranslated Fields to be Translated</a></li><li id="cookbook-refactoring-multilang-html-removing-translation-from-a-field" class="toc-item"><a href="../cookbook/refactoring-multilang.html#removing-translation-from-a-field">Removing Translation from a Field</a></li><li id="cookbook-refactoring-multilang-html-changing-the-translation-strategy" class="toc-item"><a href="../cookbook/refactoring-multilang.html#changing-the-translation-strategy">Changing the Translation Strategy</a></li></ul></li><li id="index-html" class="toc-item"><a href="../index.html">Doctrine PHP Content Repository ODM documentation</a><ul><li id="index-html-getting-help" class="toc-item"><a href="../index.html#getting-help">Getting Help</a></li><li id="index-html-getting-started" class="toc-item"><a href="../index.html#getting-started">Getting Started</a></li><li id="index-html-mapping-objects-onto-a-document-repository" class="toc-item"><a href="../index.html#mapping-objects-onto-a-document-repository">Mapping Objects onto a Document Repository</a></li><li id="index-html-working-with-objects" class="toc-item"><a href="../index.html#working-with-objects">Working with Objects</a></li><li id="index-html-advanced-topics" class="toc-item"><a href="../index.html#advanced-topics">Advanced Topics</a></li><li id="index-html-cookbook" class="toc-item"><a href="../index.html#cookbook">Cookbook</a></li></ul></li><li id="architecture-html" class="toc-item"><a href="architecture.html">Architecture</a><ul><li id="architecture-html-doctrine-phpcr-odm-packages" class="toc-item"><a href="architecture.html#doctrine-phpcr-odm-packages">Doctrine PHPCR-ODM Packages</a><ul><li id="architecture-html-content-tree-not-tables" class="toc-item"><a href="architecture.html#content-tree-not-tables">Content tree, not tables</a></li><li id="architecture-html-additional-core-features" class="toc-item"><a href="architecture.html#additional-core-features">Additional core features</a></li></ul></li></ul></li><li id="association-mapping-html" class="toc-item"><a href="association-mapping.html">Association Mapping</a><ul><li id="association-mapping-html-hierarchy-mappings" class="toc-item"><a href="association-mapping.html#hierarchy-mappings">Hierarchy mappings</a><ul><li id="association-mapping-html-child-restriction" class="toc-item"><a href="association-mapping.html#child-restriction">Child restriction</a></li></ul></li><li id="association-mapping-html-references" class="toc-item"><a href="association-mapping.html#references">References</a><ul><li id="association-mapping-html-referenceable-documents" class="toc-item"><a href="association-mapping.html#referenceable-documents">Referenceable documents</a></li><li id="association-mapping-html-reference-other-documents" class="toc-item"><a href="association-mapping.html#reference-other-documents">Reference other documents</a></li><li id="association-mapping-html-referrers-to-inverse-the-reference-relation" class="toc-item"><a href="association-mapping.html#referrers-to-inverse-the-reference-relation">Referrers to inverse the reference relation</a></li><li id="association-mapping-html-mixedreferrers" class="toc-item"><a href="association-mapping.html#mixedreferrers">MixedReferrers</a></li></ul></li><li id="association-mapping-html-transitive-persistence-cascade-operations" class="toc-item"><a href="association-mapping.html#transitive-persistence-cascade-operations">Transitive persistence / Cascade Operations</a><ul><li id="association-mapping-html-persistence-by-reachability-cascade-persist" class="toc-item"><a href="association-mapping.html#persistence-by-reachability-cascade-persist">Persistence by Reachability: Cascade Persist</a></li></ul></li><li id="association-mapping-html-collections" class="toc-item"><a href="association-mapping.html#collections">Collections</a><ul><li id="association-mapping-html-initializing-collections" class="toc-item"><a href="association-mapping.html#initializing-collections">Initializing Collections</a></li><li id="association-mapping-html-new-collections-after-flushing" class="toc-item"><a href="association-mapping.html#new-collections-after-flushing">New Collections after Flushing</a></li></ul></li></ul></li><li id="attributes-mapping-html" class="toc-item"><a href="attributes-mapping.html">Attributes Mapping</a><ul><li id="attributes-mapping-html-note-on-usage" class="toc-item"><a href="attributes-mapping.html#note-on-usage">Note on usage</a></li><li id="attributes-mapping-html-document" class="toc-item"><a href="attributes-mapping.html#document">Document</a><ul><li id="attributes-mapping-html-document" class="toc-item"><a href="attributes-mapping.html#document">#[Document]</a></li><li id="attributes-mapping-html-mappedsuperclass" class="toc-item"><a href="attributes-mapping.html#mappedsuperclass">#[MappedSuperclass]</a></li></ul></li><li id="attributes-mapping-html-mapping-fields" class="toc-item"><a href="attributes-mapping.html#mapping-fields">Mapping Fields</a><ul><li id="attributes-mapping-html-field" class="toc-item"><a href="attributes-mapping.html#field">#[Field]</a></li></ul></li><li id="attributes-mapping-html-hierarchy" class="toc-item"><a href="attributes-mapping.html#hierarchy">Hierarchy</a><ul><li id="attributes-mapping-html-child" class="toc-item"><a href="attributes-mapping.html#child">#[Child]</a></li><li id="attributes-mapping-html-children" class="toc-item"><a href="attributes-mapping.html#children">#[Children]</a></li><li id="attributes-mapping-html-depth" class="toc-item"><a href="attributes-mapping.html#depth">#[Depth]</a></li><li id="attributes-mapping-html-parentdocument" class="toc-item"><a href="attributes-mapping.html#parentdocument">#[ParentDocument]</a></li></ul></li><li id="attributes-mapping-html-identification" class="toc-item"><a href="attributes-mapping.html#identification">Identification</a><ul><li id="attributes-mapping-html-id" class="toc-item"><a href="attributes-mapping.html#id">#[Id]</a></li><li id="attributes-mapping-html-nodename" class="toc-item"><a href="attributes-mapping.html#nodename">#[Nodename]</a></li><li id="attributes-mapping-html-uuid" class="toc-item"><a href="attributes-mapping.html#uuid">#[Uuid]</a></li></ul></li><li id="attributes-mapping-html-lifcycle-callbacks" class="toc-item"><a href="attributes-mapping.html#lifcycle-callbacks">Lifcycle callbacks</a><ul><li id="attributes-mapping-html-postload" class="toc-item"><a href="attributes-mapping.html#postload">#[PostLoad]</a></li><li id="attributes-mapping-html-postpersist" class="toc-item"><a href="attributes-mapping.html#postpersist">#[PostPersist]</a></li><li id="attributes-mapping-html-postremove" class="toc-item"><a href="attributes-mapping.html#postremove">#[PostRemove]</a></li><li id="attributes-mapping-html-postupdate" class="toc-item"><a href="attributes-mapping.html#postupdate">#[PostUpdate]</a></li><li id="attributes-mapping-html-prepersist" class="toc-item"><a href="attributes-mapping.html#prepersist">#[PrePersist]</a></li><li id="attributes-mapping-html-preremove" class="toc-item"><a href="attributes-mapping.html#preremove">#[PreRemove]</a></li><li id="attributes-mapping-html-preupdate" class="toc-item"><a href="attributes-mapping.html#preupdate">#[PreUpdate]</a></li></ul></li><li id="attributes-mapping-html-phpcr" class="toc-item"><a href="attributes-mapping.html#phpcr">PHPCR</a><ul><li id="attributes-mapping-html-node" class="toc-item"><a href="attributes-mapping.html#node">#[Node]</a></li></ul></li><li id="attributes-mapping-html-references" class="toc-item"><a href="attributes-mapping.html#references">References</a><ul><li id="attributes-mapping-html-referencemany" class="toc-item"><a href="attributes-mapping.html#referencemany">#[ReferenceMany]</a></li><li id="attributes-mapping-html-referenceone" class="toc-item"><a href="attributes-mapping.html#referenceone">#[ReferenceOne]</a></li><li id="attributes-mapping-html-referrers" class="toc-item"><a href="attributes-mapping.html#referrers">#[Referrers]</a></li><li id="attributes-mapping-html-mixedreferrers" class="toc-item"><a href="attributes-mapping.html#mixedreferrers">#[MixedReferrers]</a></li></ul></li><li id="attributes-mapping-html-translation" class="toc-item"><a href="attributes-mapping.html#translation">Translation</a><ul><li id="attributes-mapping-html-locale" class="toc-item"><a href="attributes-mapping.html#locale">#[Locale]</a></li></ul></li><li id="attributes-mapping-html-versioning" class="toc-item"><a href="attributes-mapping.html#versioning">Versioning</a><ul><li id="attributes-mapping-html-versioncreated" class="toc-item"><a href="attributes-mapping.html#versioncreated">#[VersionCreated]</a></li><li id="attributes-mapping-html-versionname" class="toc-item"><a href="attributes-mapping.html#versionname">#[VersionName]</a></li></ul></li></ul></li><li id="basic-mapping-html" class="toc-item"><a href="basic-mapping.html">Basic Mapping</a><ul><li id="basic-mapping-html-mapping-drivers" class="toc-item"><a href="basic-mapping.html#mapping-drivers">Mapping Drivers</a></li><li id="basic-mapping-html-introduction-to-php-attributes" class="toc-item"><a href="basic-mapping.html#introduction-to-php-attributes">Introduction to PHP Attributes</a></li><li id="basic-mapping-html-persistent-classes" class="toc-item"><a href="basic-mapping.html#persistent-classes">Persistent classes</a><ul><li id="basic-mapping-html-specify-a-node-type" class="toc-item"><a href="basic-mapping.html#specify-a-node-type">Specify a node type</a></li><li id="basic-mapping-html-specify-a-repository-class" class="toc-item"><a href="basic-mapping.html#specify-a-repository-class">Specify a repository class</a></li></ul></li><li id="basic-mapping-html-doctrine-mapping-types" class="toc-item"><a href="basic-mapping.html#doctrine-mapping-types">Doctrine Mapping Types</a></li><li id="basic-mapping-html-property-mapping" class="toc-item"><a href="basic-mapping.html#property-mapping">Property Mapping</a><ul><li id="basic-mapping-html-mapping-to-a-differently-named-phpcr-property" class="toc-item"><a href="basic-mapping.html#mapping-to-a-differently-named-phpcr-property">Mapping to a differently named PHPCR property</a></li><li id="basic-mapping-html-mapping-multivalue-properties" class="toc-item"><a href="basic-mapping.html#mapping-multivalue-properties">Mapping multivalue properties</a></li><li id="basic-mapping-html-summary" class="toc-item"><a href="basic-mapping.html#summary">Summary</a></li></ul></li><li id="basic-mapping-html-identifiers" class="toc-item"><a href="basic-mapping.html#identifiers">Identifiers</a><ul><li id="basic-mapping-html-identifier-generation-strategies" class="toc-item"><a href="basic-mapping.html#identifier-generation-strategies">Identifier Generation Strategies</a></li></ul></li><li id="basic-mapping-html-symfony-bundle" class="toc-item"><a href="basic-mapping.html#symfony-bundle">Symfony bundle</a></li></ul></li><li id="events-html" class="toc-item"><a href="events.html">Events</a><ul><li id="events-html-lifecycle-events" class="toc-item"><a href="events.html#lifecycle-events">Lifecycle Events</a></li><li id="events-html-event-order-when-moving" class="toc-item"><a href="events.html#event-order-when-moving">Event order when moving</a></li><li id="events-html-event-order-when-handling-with-translations" class="toc-item"><a href="events.html#event-order-when-handling-with-translations">Event order when handling with translations</a></li><li id="events-html-listening-to-events" class="toc-item"><a href="events.html#listening-to-events">Listening to events</a></li><li id="events-html-lifecycle-callbacks" class="toc-item"><a href="events.html#lifecycle-callbacks">Lifecycle Callbacks</a></li><li id="events-html-listening-to-lifecycle-events" class="toc-item"><a href="events.html#listening-to-lifecycle-events">Listening to Lifecycle Events</a></li></ul></li><li id="fetch-depth-html" class="toc-item"><a href="fetch-depth.html">Tuning the node preloading</a></li><li id="inheritance-mapping-html" class="toc-item"><a href="inheritance-mapping.html">Inheritance Mapping</a><ul><li id="inheritance-mapping-html-document-class-inheritance" class="toc-item"><a href="inheritance-mapping.html#document-class-inheritance">Document class inheritance</a></li></ul></li><li id="installation-configuration-html" class="toc-item"><a href="installation-configuration.html">Installation</a><ul><li id="installation-configuration-html-composer" class="toc-item"><a href="installation-configuration.html#composer">Composer</a></li><li id="installation-configuration-html-phpcr-provider" class="toc-item"><a href="installation-configuration.html#phpcr-provider">PHPCR provider</a><ul><li id="installation-configuration-html-install-jackalope-jackrabbit-phpcr-provider" class="toc-item"><a href="installation-configuration.html#install-jackalope-jackrabbit-phpcr-provider">Install Jackalope-Jackrabbit PHPCR provider</a></li><li id="installation-configuration-html-install-jackalope-doctrine-dbal-phpcr-provider" class="toc-item"><a href="installation-configuration.html#install-jackalope-doctrine-dbal-phpcr-provider">Install Jackalope Doctrine DBAL PHPCR provider</a></li><li id="installation-configuration-html-install-midgard2-phpcr-provider" class="toc-item"><a href="installation-configuration.html#install-midgard2-phpcr-provider">Install Midgard2 PHPCR provider</a></li></ul></li></ul></li><li id="installation-configuration-html-configuration" class="toc-item"><a href="installation-configuration.html#configuration">Configuration</a><ul><li id="installation-configuration-html-class-loading-with-composer" class="toc-item"><a href="installation-configuration.html#class-loading-with-composer">Class loading with composer</a></li><li id="installation-configuration-html-obtaining-an-objectmanager" class="toc-item"><a href="installation-configuration.html#obtaining-an-objectmanager">Obtaining an ObjectManager</a><ul><li id="installation-configuration-html-prepare-the-mapping-driver" class="toc-item"><a href="installation-configuration.html#prepare-the-mapping-driver">Prepare the mapping driver</a></li><li id="installation-configuration-html-quick-configuration-example" class="toc-item"><a href="installation-configuration.html#quick-configuration-example">Quick Configuration Example</a></li></ul></li><li id="installation-configuration-html-configuration-options" class="toc-item"><a href="installation-configuration.html#configuration-options">Configuration Options</a><ul><li id="installation-configuration-html-proxy-directory-required" class="toc-item"><a href="installation-configuration.html#proxy-directory-required">Proxy Directory (***REQUIRED***)</a></li><li id="installation-configuration-html-proxy-namespace-required" class="toc-item"><a href="installation-configuration.html#proxy-namespace-required">Proxy Namespace (***REQUIRED***)</a></li><li id="installation-configuration-html-metadata-driver-required" class="toc-item"><a href="installation-configuration.html#metadata-driver-required">Metadata Driver (***REQUIRED***)</a></li><li id="installation-configuration-html-metadata-cache-recommended" class="toc-item"><a href="installation-configuration.html#metadata-cache-recommended">Metadata Cache (***RECOMMENDED***)</a></li><li id="installation-configuration-html-auto-generating-proxy-classes-optional" class="toc-item"><a href="installation-configuration.html#auto-generating-proxy-classes-optional">Auto-generating Proxy Classes (***OPTIONAL***)</a></li></ul></li><li id="installation-configuration-html-development-vs-production-configuration" class="toc-item"><a href="installation-configuration.html#development-vs-production-configuration">Development vs Production Configuration</a></li><li id="installation-configuration-html-connection-options" class="toc-item"><a href="installation-configuration.html#connection-options">Connection Options</a></li><li id="installation-configuration-html-proxy-objects" class="toc-item"><a href="installation-configuration.html#proxy-objects">Proxy Objects</a><ul><li id="installation-configuration-html-reference-proxies" class="toc-item"><a href="installation-configuration.html#reference-proxies">Reference Proxies</a></li><li id="installation-configuration-html-generating-proxy-classes" class="toc-item"><a href="installation-configuration.html#generating-proxy-classes">Generating Proxy classes</a></li><li id="installation-configuration-html-multiple-metadata-sources" class="toc-item"><a href="installation-configuration.html#multiple-metadata-sources">Multiple Metadata Sources</a></li><li id="installation-configuration-html-default-repository-optional" class="toc-item"><a href="installation-configuration.html#default-repository-optional">Default Repository (***OPTIONAL***)</a></li></ul></li><li id="installation-configuration-html-setting-up-the-console" class="toc-item"><a href="installation-configuration.html#setting-up-the-console">Setting up the Console</a><ul><li id="installation-configuration-html-register-system-node-types" class="toc-item"><a href="installation-configuration.html#register-system-node-types">Register system node types</a></li></ul></li></ul></li><li id="introduction-html" class="toc-item"><a href="introduction.html">Getting Started</a><ul><li id="introduction-html-what-are-documents" class="toc-item"><a href="introduction.html#what-are-documents">What are Documents?</a></li><li id="introduction-html-an-example-model-document-management" class="toc-item"><a href="introduction.html#an-example-model-document-management">An Example Model: Document Management</a></li><li id="introduction-html-setup-project" class="toc-item"><a href="introduction.html#setup-project">Setup Project</a></li><li id="introduction-html-building-the-model" class="toc-item"><a href="introduction.html#building-the-model">Building the model</a></li><li id="introduction-html-initialize-the-repository" class="toc-item"><a href="introduction.html#initialize-the-repository">Initialize the repository</a></li><li id="introduction-html-storing-documents" class="toc-item"><a href="introduction.html#storing-documents">Storing documents</a></li><li id="introduction-html-reading-documents" class="toc-item"><a href="introduction.html#reading-documents">Reading documents</a></li><li id="introduction-html-tree-traversal" class="toc-item"><a href="introduction.html#tree-traversal">Tree traversal</a></li><li id="introduction-html-add-references" class="toc-item"><a href="introduction.html#add-references">Add references</a></li><li id="introduction-html-removing-documents" class="toc-item"><a href="introduction.html#removing-documents">Removing documents</a></li><li id="introduction-html-other-helpful-methods-on-the-documentmanager" class="toc-item"><a href="introduction.html#other-helpful-methods-on-the-documentmanager">Other helpful methods on the DocumentManager</a></li><li id="introduction-html-conclusion" class="toc-item"><a href="introduction.html#conclusion">Conclusion</a></li></ul></li><li id="multilang-html" class="toc-item"><a href="multilang.html">Multilanguage support</a><ul><li id="multilang-html-philosophy" class="toc-item"><a href="multilang.html#philosophy">Philosophy</a></li><li id="multilang-html-mapping" class="toc-item"><a href="multilang.html#mapping">Mapping</a></li><li id="multilang-html-interacting-with-translations" class="toc-item"><a href="multilang.html#interacting-with-translations">Interacting with translations</a></li><li id="multilang-html-choosing-the-right-translation-strategy" class="toc-item"><a href="multilang.html#choosing-the-right-translation-strategy">Choosing the right translation strategy</a><ul><li id="multilang-html-implementing-your-own-translation-strategy" class="toc-item"><a href="multilang.html#implementing-your-own-translation-strategy">Implementing your own translation strategy</a></li></ul></li><li id="multilang-html-configure-the-locale-chooser-strategy" class="toc-item"><a href="multilang.html#configure-the-locale-chooser-strategy">Configure the locale chooser strategy</a></li><li id="multilang-html-full-example" class="toc-item"><a href="multilang.html#full-example">Full Example</a></li><li id="multilang-html-querying-translated-properties" class="toc-item"><a href="multilang.html#querying-translated-properties">Querying Translated Properties</a></li><li id="multilang-html-limitations" class="toc-item"><a href="multilang.html#limitations">Limitations</a><ul><li id="multilang-html-translations-and-references-hierarchy" class="toc-item"><a href="multilang.html#translations-and-references-hierarchy">Translations and references / hierarchy</a></li></ul></li></ul></li><li id="phpcr-access-html" class="toc-item"><a href="phpcr-access.html">Accessing the underlying PHPCR session</a><ul><li id="phpcr-access-html-getting-the-phpcr-session" class="toc-item"><a href="phpcr-access.html#getting-the-phpcr-session">Getting the PHPCR Session</a></li><li id="phpcr-access-html-the-node-field-mapping" class="toc-item"><a href="phpcr-access.html#the-node-field-mapping">The Node field mapping</a></li></ul></li><li id="query-html" class="toc-item"><a href="query.html">The Query Object</a><ul><li id="query-html-getting-single-results" class="toc-item"><a href="query.html#getting-single-results">Getting single results</a><ul><li id="query-html-getsingleresult" class="toc-item"><a href="query.html#getsingleresult">getSingleResult</a></li><li id="query-html-getoneornullresult" class="toc-item"><a href="query.html#getoneornullresult">getOneOrNullResult</a></li></ul></li><li id="query-html-getting-multiple-results" class="toc-item"><a href="query.html#getting-multiple-results">Getting multiple results</a><ul><li id="query-html-getresult" class="toc-item"><a href="query.html#getresult">getResult</a></li><li id="query-html-getphpcrnoderesult" class="toc-item"><a href="query.html#getphpcrnoderesult">getPhpcrNodeResult</a></li><li id="query-html-execute" class="toc-item"><a href="query.html#execute">execute</a></li></ul></li><li id="query-html-hydration-modes" class="toc-item"><a href="query.html#hydration-modes">Hydration modes</a></li><li id="query-html-limiting-results" class="toc-item"><a href="query.html#limiting-results">Limiting results</a></li></ul></li><li id="query-builder-html" class="toc-item"><a href="query-builder.html">The QueryBuilder</a><ul><li id="query-builder-html-concepts" class="toc-item"><a href="query-builder.html#concepts">Concepts</a><ul><li id="query-builder-html-leaf-and-factory-nodes" class="toc-item"><a href="query-builder.html#leaf-and-factory-nodes">Leaf and Factory Nodes</a></li><li id="query-builder-html-fluent-interface" class="toc-item"><a href="query-builder.html#fluent-interface">Fluent Interface</a></li><li id="query-builder-html-types-and-cardinality" class="toc-item"><a href="query-builder.html#types-and-cardinality">Types and Cardinality</a></li><li id="query-builder-html-aliases-and-fields" class="toc-item"><a href="query-builder.html#aliases-and-fields">Aliases and fields</a></li></ul></li><li id="query-builder-html-retrieving-a-query-builder-instance" class="toc-item"><a href="query-builder.html#retrieving-a-query-builder-instance">Retrieving a query builder instance</a><ul><li id="query-builder-html-via-the-document-manager" class="toc-item"><a href="query-builder.html#via-the-document-manager">Via the document manager</a></li><li id="query-builder-html-via-a-document-repository" class="toc-item"><a href="query-builder.html#via-a-document-repository">Via a document repository</a></li></ul></li><li id="query-builder-html-working-with-the-querybuilder" class="toc-item"><a href="query-builder.html#working-with-the-querybuilder">Working with the QueryBuilder</a><ul><li id="query-builder-html-specifying-the-document-source-from" class="toc-item"><a href="query-builder.html#specifying-the-document-source-from">Specifying the document source - from</a></li><li id="query-builder-html-selecting-specific-properties-select" class="toc-item"><a href="query-builder.html#selecting-specific-properties-select">Selecting specific properties - select</a></li><li id="query-builder-html-limiting-the-number-of-results" class="toc-item"><a href="query-builder.html#limiting-the-number-of-results">Limiting the number of results</a></li><li id="query-builder-html-specifying-selection-criteria" class="toc-item"><a href="query-builder.html#specifying-selection-criteria">Specifying selection criteria</a></li><li id="query-builder-html-ordering-results" class="toc-item"><a href="query-builder.html#ordering-results">Ordering results</a></li><li id="query-builder-html-querying-translated-documents" class="toc-item"><a href="query-builder.html#querying-translated-documents">Querying translated documents</a></li></ul></li><li id="query-builder-html-additional-notes" class="toc-item"><a href="query-builder.html#additional-notes">Additional notes</a><ul><li id="query-builder-html-querying-multivalue-fields" class="toc-item"><a href="query-builder.html#querying-multivalue-fields">Querying multivalue fields</a></li><li id="query-builder-html-using-the-query-builder-in-tests" class="toc-item"><a href="query-builder.html#using-the-query-builder-in-tests">Using the Query Builder in Tests</a></li></ul></li></ul></li><li id="query-builder-reference-html" class="toc-item"><a href="query-builder-reference.html">Query Builder Reference</a><ul><li id="query-builder-reference-html-reference" class="toc-item"><a href="query-builder-reference.html#reference">Reference</a><ul><li id="query-builder-reference-html-node-constraintandx" class="toc-item"><a href="query-builder-reference.html#node-constraintandx">Node: ConstraintAndx</a></li><li id="query-builder-reference-html-node-constraintcomparison" class="toc-item"><a href="query-builder-reference.html#node-constraintcomparison">Node: ConstraintComparison</a></li><li id="query-builder-reference-html-node-constraintfactory" class="toc-item"><a href="query-builder-reference.html#node-constraintfactory">Node: ConstraintFactory</a></li><li id="query-builder-reference-html-node-constraintnot" class="toc-item"><a href="query-builder-reference.html#node-constraintnot">Node: ConstraintNot</a></li><li id="query-builder-reference-html-node-constraintorx" class="toc-item"><a href="query-builder-reference.html#node-constraintorx">Node: ConstraintOrx</a></li><li id="query-builder-reference-html-node-from" class="toc-item"><a href="query-builder-reference.html#node-from">Node: From</a></li><li id="query-builder-reference-html-node-operanddynamicfactory" class="toc-item"><a href="query-builder-reference.html#node-operanddynamicfactory">Node: OperandDynamicFactory</a></li><li id="query-builder-reference-html-node-operanddynamiclowercase" class="toc-item"><a href="query-builder-reference.html#node-operanddynamiclowercase">Node: OperandDynamicLowerCase</a></li><li id="query-builder-reference-html-node-operanddynamicuppercase" class="toc-item"><a href="query-builder-reference.html#node-operanddynamicuppercase">Node: OperandDynamicUpperCase</a></li><li id="query-builder-reference-html-node-operandfactory" class="toc-item"><a href="query-builder-reference.html#node-operandfactory">Node: OperandFactory</a></li><li id="query-builder-reference-html-node-operandstaticfactory" class="toc-item"><a href="query-builder-reference.html#node-operandstaticfactory">Node: OperandStaticFactory</a></li><li id="query-builder-reference-html-node-orderby" class="toc-item"><a href="query-builder-reference.html#node-orderby">Node: OrderBy</a></li><li id="query-builder-reference-html-node-orderbyadd" class="toc-item"><a href="query-builder-reference.html#node-orderbyadd">Node: OrderByAdd</a></li><li id="query-builder-reference-html-node-ordering" class="toc-item"><a href="query-builder-reference.html#node-ordering">Node: Ordering</a></li><li id="query-builder-reference-html-node-querybuilder" class="toc-item"><a href="query-builder-reference.html#node-querybuilder">Node: QueryBuilder</a></li><li id="query-builder-reference-html-node-select" class="toc-item"><a href="query-builder-reference.html#node-select">Node: Select</a></li><li id="query-builder-reference-html-node-selectadd" class="toc-item"><a href="query-builder-reference.html#node-selectadd">Node: SelectAdd</a></li><li id="query-builder-reference-html-node-sourcejoin" class="toc-item"><a href="query-builder-reference.html#node-sourcejoin">Node: SourceJoin</a></li><li id="query-builder-reference-html-node-sourcejoinconditionfactory" class="toc-item"><a href="query-builder-reference.html#node-sourcejoinconditionfactory">Node: SourceJoinConditionFactory</a></li><li id="query-builder-reference-html-node-sourcejoinleft" class="toc-item"><a href="query-builder-reference.html#node-sourcejoinleft">Node: SourceJoinLeft</a></li><li id="query-builder-reference-html-node-sourcejoinright" class="toc-item"><a href="query-builder-reference.html#node-sourcejoinright">Node: SourceJoinRight</a></li><li id="query-builder-reference-html-node-where" class="toc-item"><a href="query-builder-reference.html#node-where">Node: Where</a></li><li id="query-builder-reference-html-node-whereand" class="toc-item"><a href="query-builder-reference.html#node-whereand">Node: WhereAnd</a></li><li id="query-builder-reference-html-node-whereor" class="toc-item"><a href="query-builder-reference.html#node-whereor">Node: WhereOr</a></li></ul></li></ul></li><li id="tools-html" class="toc-item"><a href="tools.html">Tools</a><ul><li id="tools-html-doctrine-console" class="toc-item"><a href="tools.html#doctrine-console">Doctrine Console</a><ul><li id="tools-html-command-overview" class="toc-item"><a href="tools.html#command-overview">Command Overview</a></li><li id="tools-html-getting-documentation-of-a-command" class="toc-item"><a href="tools.html#getting-documentation-of-a-command">Getting documentation of a command</a></li><li id="tools-html-phpcr-implementation-specific-commands" class="toc-item"><a href="tools.html#phpcr-implementation-specific-commands">PHPCR implementation specific commands</a></li></ul></li><li id="tools-html-register-system-node-types" class="toc-item"><a href="tools.html#register-system-node-types">Register system node types</a></li><li id="tools-html-adding-your-own-commands" class="toc-item"><a href="tools.html#adding-your-own-commands">Adding your own commands</a></li></ul></li><li id="transactions-html" class="toc-item"><a href="transactions.html">Transactions</a><ul><li id="transactions-html-transactional" class="toc-item"><a href="transactions.html#transactional">transactional()</a></li></ul></li><li id="versioning-html" class="toc-item"><a href="versioning.html">Versioning support</a><ul><li id="versioning-html-philosophy" class="toc-item"><a href="versioning.html#philosophy">Philosophy</a><ul><li id="versioning-html-phpcr-odm" class="toc-item"><a href="versioning.html#phpcr-odm">PHPCR-ODM</a></li></ul></li><li id="versioning-html-mappings" class="toc-item"><a href="versioning.html#mappings">Mappings</a></li><li id="versioning-html-interacting-with-versions" class="toc-item"><a href="versioning.html#interacting-with-versions">Interacting with versions</a></li><li id="versioning-html-full-example" class="toc-item"><a href="versioning.html#full-example">Full Example</a></li></ul></li><li id="working-with-objects-html-working-with-objects" class="toc-item"><a href="working-with-objects.html#working-with-objects">Working with Objects</a><ul><li id="working-with-objects-html-documents-and-the-identity-map" class="toc-item"><a href="working-with-objects.html#documents-and-the-identity-map">Documents and the Identity Map</a></li><li id="working-with-objects-html-document-graph-traversal" class="toc-item"><a href="working-with-objects.html#document-graph-traversal">Document Graph Traversal</a></li><li id="working-with-objects-html-persisting-documents" class="toc-item"><a href="working-with-objects.html#persisting-documents">Persisting documents</a></li><li id="working-with-objects-html-removing-documents" class="toc-item"><a href="working-with-objects.html#removing-documents">Removing documents</a></li><li id="working-with-objects-html-detaching-documents" class="toc-item"><a href="working-with-objects.html#detaching-documents">Detaching documents</a></li><li id="working-with-objects-html-merging-documents" class="toc-item"><a href="working-with-objects.html#merging-documents">Merging documents</a></li><li id="working-with-objects-html-synchronization-with-the-repository" class="toc-item"><a href="working-with-objects.html#synchronization-with-the-repository">Synchronization with the Repository</a><ul><li id="working-with-objects-html-effects-of-repository-and-unitofwork-being-out-of-sync" class="toc-item"><a href="working-with-objects.html#effects-of-repository-and-unitofwork-being-out-of-sync">Effects of Repository and UnitOfWork being Out-Of-Sync</a></li><li id="working-with-objects-html-synchronizing-new-and-managed-documents" class="toc-item"><a href="working-with-objects.html#synchronizing-new-and-managed-documents">Synchronizing New and Managed Documents</a></li><li id="working-with-objects-html-synchronizing-removed-documents" class="toc-item"><a href="working-with-objects.html#synchronizing-removed-documents">Synchronizing Removed Documents</a></li><li id="working-with-objects-html-the-size-of-a-unit-of-work" class="toc-item"><a href="working-with-objects.html#the-size-of-a-unit-of-work">The size of a Unit of Work</a></li><li id="working-with-objects-html-the-cost-of-flushing" class="toc-item"><a href="working-with-objects.html#the-cost-of-flushing">The cost of flushing</a></li><li id="working-with-objects-html-direct-access-to-a-unit-of-work" class="toc-item"><a href="working-with-objects.html#direct-access-to-a-unit-of-work">Direct Access to a Unit of Work</a></li><li id="working-with-objects-html-document-state" class="toc-item"><a href="working-with-objects.html#document-state">Document State</a></li></ul></li><li id="working-with-objects-html-querying" class="toc-item"><a href="working-with-objects.html#querying">Querying</a><ul><li id="working-with-objects-html-by-primary-key" class="toc-item"><a href="working-with-objects.html#by-primary-key">By Primary Key</a></li><li id="working-with-objects-html-by-simple-conditions" class="toc-item"><a href="working-with-objects.html#by-simple-conditions">By Simple Conditions</a></li><li id="working-with-objects-html-by-lazy-loading" class="toc-item"><a href="working-with-objects.html#by-lazy-loading">By Lazy Loading</a></li><li id="working-with-objects-html-by-query-builder" class="toc-item"><a href="working-with-objects.html#by-query-builder">By Query Builder</a></li><li id="working-with-objects-html-by-native-queries" class="toc-item"><a href="working-with-objects.html#by-native-queries">By Native Queries</a></li><li id="working-with-objects-html-custom-repositories" class="toc-item"><a href="working-with-objects.html#custom-repositories">Custom Repositories</a></li></ul></li></ul></li><li id="xml-mapping-html" class="toc-item"><a href="xml-mapping.html">XML Mapping</a></li></ul></div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://www.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "PHPCR ODM",
            "item": "https://www.doctrine-project.org/projects/phpcr-odm.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "Working with Objects",
            "item": "https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/reference/working-with-objects.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">Working with Objects</li>
                        </ol>
</nav>
                                    </div>

                    
    <div class="alert caution bg-light-yellow text-dark border">
    <table width="100%">
        <tr>
            <td width="10" class="align-top">
                <i class="fas fa-exclamation-circle text-warning mr-2"></i>
            </td>
            <td><p>You are browsing a version that has not yet been released.</p></td>
        </tr>
    </table>
</div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine-phpcr-odm/en/latest/reference/working-with-objects.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        2.x
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item active" href="/projects/doctrine-phpcr-odm/en/latest/reference/working-with-objects.html">
                                                        2.x

                                                        
                                                                                                                    (upcoming)
                                                                                                            </a>
                                                                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-phpcr-odm/en/1.x/reference/working-with-objects.html">
                                                        1.x

                                                                                                                    (current)
                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-phpcr-odm/en/2.0/reference/working-with-objects.html">2.0</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-phpcr-odm/en/1.8/reference/working-with-objects.html">1.8</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-phpcr-odm/en/1.7/reference/working-with-objects.html">1.7</a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                </div>
                            
                            
<div class="section"><a class="section-anchor" id="working-with-objects" name="working-with-objects"></a><h1 class="section-header"><a href="#working-with-objects">Working with Objects<i class="fas fa-link"></i></a></h1>
<p>This chapter explains how to work with the <code>DocumentManager</code> and the
<code>UnitOfWork</code>. The Unit of Work encapsulates the information to be written
to PHPCR when you call <code>DocumentManager#flush()</code>.</p>
<p>A Unit of Work can be manually closed by calling <code>DocumentManager#close()</code>.
Any changes to documents within this UnitOfWork that have not yet been
persisted are lost.</p>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>It is very important to understand that only
<code>DocumentManager::flush()</code> ever causes write operations against the
repository to be executed. Any other methods such as
<code>DocumentManager::persist($document)</code> or
<code>DocumentManager::remove($document)</code> only notify the UnitOfWork to
perform these operations during flush.</p>
<p>Not calling <code>DocumentManager::flush()</code> will lead to all changes
during that request being lost.</p>
</td></tr></table></div>
<div class="alert tip-admonition bg-success text-light border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-question-circle mr-2"></i></td><td><p>The <code>DocumentManager</code> is very similar to the Doctrine ORM EntityManager and
this chapter is similar to its <a href="https://www.doctrine-project.org/projects/doctrine-orm/en/2.6/reference/working-with-objects.html">corresponding ORM chapter</a>.
This chapter tries to help you by highlighting the places where PHPCR-ODM
is different from the ORM.</p>
</td></tr></table></div>
<div class="section"><a class="section-anchor" id="documents-and-the-identity-map" name="documents-and-the-identity-map"></a><h2 class="section-header"><a href="#documents-and-the-identity-map">Documents and the Identity Map<i class="fas fa-link"></i></a></h2>
<p>Objects managed by Doctrine PHPCR-ODM are called <em>documents</em>.
Every document has an identifier, which is its PHPCR path. The path is unique
inside the workspace. Take the following example, where you find an article
with the headline Hello World with the ID <code>/cms/article/hello-world</code>:</p>
<pre><code class="">$article = $documentManager-&gt;find(null, &#039;/cms/article/hello-world&#039;);
$article-&gt;setHeadline(&#039;Hello World dude!&#039;);

$article2 = $documentManager-&gt;find(null, &#039;/cms/article/hello-world&#039;);
echo $article2-&gt;getHeadline(); // Hello World dude!
</code></pre>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>The first argument to <code>find()</code> is the document class name. While the ORM
has a table per class and thus always needs the document class name,
PHPCR-ODM has one tree for all documents. The above call will find you
whatever document is at that path. Note that you may optionally specify
the class name to have PHPCR-ODM check if the document is not of the
expected type. On a class mismatch, PHPCR-ODM treats the lookup as a not
found and returns <code>null</code>.</p>
</td></tr></table></div>
<p>In this case, the article is retrieved from the document manager twice,
but modified in between. Doctrine realizes that it is the same ID and will
only ever give you access to one instance of the Article with ID
<code>/cms/article/hello-world</code>, no matter how often do you retrieve it from
the <code>DocumentManager</code> and even no matter what kind of Query method you are
using (find, findBy, query builder, getDocumentsByPhpcrQuery). This is
called Identity Map pattern, which means Doctrine keeps a map of each
document that has been retrieved in the current PHP request and keeps
returning you the same instances.</p>
<p>In the previous example the <code>echo</code> prints Hello World dude! to the
screen. You can even verify that <code>$article</code> and <code>$article2</code> are
indeed pointing to the same instance by running the following
code:</p>
<pre><code class="">if ($article === $article2) {
    echo &quot;Yes we are the same!&quot;;
}
</code></pre>
<p>Sometimes you want to clear the identity map of a <code>DocumentManager</code> to
start over. We use this regularly in our unit tests to enforce
loading documents from the repository again instead of serving them
from the identity map. You can call <code>DocumentManager::clear()</code> to
achieve this result.</p>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>In PHPCR-ODM, the ID is the PHPCR path of the document. This means it is
possible to change the ID of a document by moving it in the tree using the
the <code>DocumentManager::move()</code> operation.
To create a reference to a document that is stable over move operations,
make the document <em>referenceable</em> and map the <code>Uuid</code> field. You can find
a document by its universally unique identifier.</p>
</td></tr></table></div>
</div>
<div class="section"><a class="section-anchor" id="document-graph-traversal" name="document-graph-traversal"></a><h2 class="section-header"><a href="#document-graph-traversal">Document Graph Traversal<i class="fas fa-link"></i></a></h2>
<p>Although Doctrine allows for a complete separation of your domain
model (Document classes) there will never be a situation where
documents are missing when traversing associations. You can walk
all the associations inside your document models as deep as you
want.</p>
<p>Take the following example of a single <code>Article</code> document fetched
from newly opened DocumentManager:</p>
<pre><code class="">use Doctrine\ODM\PHPCR\Mapping\Attributes as PHPCR;
use Doctrine\ODM\PHPCR\ReferrerCollection;

#[PHPCR\Document]
class Article
{
    #[PHPCR\Id]
    private string $id;

    #[PHPCR\Field(type: &#039;string&#039;)]
    private string $headline;

    #[PHPCR\ReferenceOne]
    private Author $author;

    #[PHPCR\Referrers(referrerDocument: Comment::class, referencedBy: &#039;article&#039;)]
    private ReferrersCollection $comments;

    public function __construct {
        $this-&gt;comments = new ArrayCollection();
    }

    public function getAuthor(): Author
    {
        return $this-&gt;author;
    }
    public function getComments(): ReferrersCollection
    {
        return $this-&gt;comments;
    }
}

$article = $em-&gt;find(null, &#039;/cms/article/hello-world&#039;);
</code></pre>
<p>This code retrieves an <code>Article</code> instance with ID
<code>/cms/article/hello-world</code>, executing a single <code>getNode()</code> operation
on the repository, retrieving only the data required for the specified
article. However, you can still access the associated properties author
and comments and the associated documents they contain.</p>
<p>This works by utilizing the lazy loading pattern. Instead of
passing you back a real Author instance and a collection of
comments, Doctrine will create proxy instances for you. Only if you
access these proxies for the first time they will go through the
<code>DocumentManager</code> and load their state from the repository.</p>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>In PHPCR-ODM, relations between documents are expressed in <em>references</em>.
References are directed links. You can map the backlinks using the
<code>Referrers</code> mapping.</p>
</td></tr></table></div>
<p>This lazy-loading process happens behind the scenes, hidden from
your code. Have a look at the following example:</p>
<pre><code class="">$article = $em-&gt;find(null, &#039;/cms/article/hello-world&#039;);

// accessing a method of the user instance triggers the lazy-load
echo &quot;Author: &quot; . $article-&gt;getAuthor()-&gt;getName() . &quot;\n&quot;;

if ($article-&gt;getAuthor() instanceof User) {
    // getAuthor returns a proxy class which is instanceof User
}

// accessing the comments as an iterator triggers the lazy-load
// retrieving ALL the comments of this article from the repository
// using a single getNodes call
foreach ($article-&gt;getComments() AS $comment) {
    echo $comment-&gt;getText() . &quot;\n\n&quot;;
}

// Article::$comments passes instanceof tests for the Collection interface
// But it will NOT pass for the ArrayCollection interface
if ($article-&gt;getComments() instanceof \Doctrine\Common\Collections\Collection) {
    echo &quot;This will always be true!&quot;;
}
</code></pre>
<p>A slice of the generated proxy classes code looks like the
following example. Real proxy class override <em>all</em> public
methods along the lines of the <code>getName()</code> method shown below:</p>
<pre><code class="">class UserProxy extends User implements Proxy
{
    private function _load()
    {
        // lazy loading code
    }

    public function getName()
    {
        $this-&gt;_load();
        return parent::getName();
    }
    // .. other public methods of User
}
</code></pre>
<div class="alert warning-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td><td><p>Traversing the object graph for parts that are lazy-loaded will
easily trigger lots of repository lookups and will perform badly if used
too heavily. If you often use child documents for example, look into
the <code>fetchDepth</code> configuration.</p>
</td></tr></table></div>
</div>
<div class="section"><a class="section-anchor" id="persisting-documents" name="persisting-documents"></a><h2 class="section-header"><a href="#persisting-documents">Persisting documents<i class="fas fa-link"></i></a></h2>
<p>When you create a new document, the <code>DocumentManager</code> knows nothing about it.
You need to call <code>DocumentManager::persist($document)</code> to make the document
MANAGED. You only need to do that on object instantiation. From now on,
whenever you modify the object you loaded from the <code>DocumentManager</code>, it will
automatically be synchronized with the repository when
<code>DocumentManager::flush()</code> is invoked.</p>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>Invoking the <code>persist</code> method for a document does NOT
cause an immediate addNode on the repository.
Doctrine applies a strategy called transactional write-behind,
which means that it will delay most SQL commands until
<code>DocumentManager::flush()</code> is invoked which will then issue all
necessary PHPCR calls to synchronize your documents with the
repository in the most efficient way - a single, short transaction -
taking care of maintaining referential integrity.</p>
</td></tr></table></div>
<p>Example:</p>
<pre><code class="">$user = new User;
$user-&gt;setName(&#039;Mr.Right&#039;);
$dm-&gt;persist($user);
$dm-&gt;flush();
</code></pre>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>Generated document identifiers / primary keys are
guaranteed to be available after the next successful flush
operation that involves the document in question. You may not rely on
a generated identifier to be available directly after invoking
<code>persist</code>. The inverse is also true. After a failed flush,
a document may already show a generated identifier even though
it was not persisted.</p>
</td></tr></table></div>
<p>The semantics of the persist operation, applied on a document X, are
as follows:</p>
<ul>
    <li>If X is a new document, it becomes managed. The document X will be
entered into the repository as a result of the flush operation;</li>
<li>If X is a pre-existing managed document, it is ignored by the
persist operation. However, the persist operation is cascaded to
documents referenced by X if the relationships from X to these
other documents are mapped with <code>cascade: &#039;PERSIST&#039;</code> or <code>cascade: &#039;ALL&#039;</code> (see
&quot;Transitive Persistence&quot;);</li>
<li>If X is a removed document, it becomes managed;</li>
<li>If X is a detached document, an exception will be thrown on
flush.</li>
</ul>
</div>
<div class="section"><a class="section-anchor" id="removing-documents" name="removing-documents"></a><h2 class="section-header"><a href="#removing-documents">Removing documents<i class="fas fa-link"></i></a></h2>
<p>A document can be removed from persistent storage by passing it to
the <code>DocumentManager::remove($document)</code> method. By applying the
<code>remove</code> operation on some document, that document becomes REMOVED,
which means that its persistent state will be deleted once
<code>DocumentManager::flush()</code> is invoked.</p>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>Just like <code>persist</code>, invoking <code>remove</code> with a document
does NOT cause an immediate remove() to be issued on the
repository. The document will be deleted on the next invocation of
<code>DocumentManager::flush()</code> that involves that document. This
means that documents scheduled for removal can still be queried
for and appear in query and collection results. See
the section on <a href="working-with-objects.html#workingobjects_repository_uow_outofsync">Repository and UnitOfWork Out-Of-Sync</a>
for more information.</p>
</td></tr></table></div>
<p>Example:</p>
<pre><code class="">$dm-&gt;remove($user);
$dm-&gt;flush();
</code></pre>
<p>The semantics of the remove operation, applied to a document X are
as follows:</p>
<ul>
    <li>If X is a new document, it is ignored by the remove operation.
However, the remove operation is cascaded to documents referenced by
X, if the relationship from X to these other documents is mapped
with <code>cascade: &#039;REMOVE&#039;</code> or <code>cascade: &#039;ALL&#039;</code> (see &quot;Transitive Persistence&quot;);</li>
<li>If X is a managed document, the remove operation causes it to
become removed. The remove operation is cascaded to documents
referenced by X, if the relationships from X to these other
documents is mapped with <code>cascade: &#039;REMOVE&#039;</code> or <code>cascade: &#039;ALL&#039;</code> (see
&quot;Transitive Persistence&quot;);</li>
<li>If X is a detached document, an <code>InvalidArgumentException</code> will be
thrown;</li>
<li>If X is a removed document, it is ignored by the remove operation;</li>
<li>A removed document X will be removed from the repository as a result
of the flush operation.</li>
</ul>
<p>After a document has been removed, its in-memory state is the same as
before the removal, except that the identifier is set to null.</p>
<p>Removing a document will also <strong>automatically delete any children</strong> of it.
Note that no events will be triggered for the removed children, only for
the document explicitly removed.</p>
<p>By default, references and referring documents are not deleted. You can enable
this by configuring cascading removal on the association mapping. If an association
is marked as <code>cascade: &#039;REMOVE&#039;</code>, PHPCR-ODM will follow this association. If
its a Single association it will pass this document to
<code>DocumentManager::remove()</code>. If the association is a collection, Doctrine
will loop over all its elements and pass them to<code>DocumentManager::remove()</code>.
In both cases the cascade remove semantics are applied recursively.
For large object graphs this removal strategy can be very costly.</p>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>Contrary to the ORM, the PHPCR query language knows no DELETE statement.
If you expect to remove large object graphs, try to model them in a way
that you can simply remove the parent, as children removal is as cheap
as having a relational database cascade removal through foreign keys.</p>
</td></tr></table></div>
</div>
<div class="section"><a class="section-anchor" id="detaching-documents" name="detaching-documents"></a><h2 class="section-header"><a href="#detaching-documents">Detaching documents<i class="fas fa-link"></i></a></h2>
<p>You can make Doctrine stop tracking a document by detaching it from
the <code>UnitOfWork</code>. To do this, you invoke the
<code>DocumentManager::detach($document)</code> method with the document. Changes
made to the detached document, including removal of the document, will
not be synchronized to the repository after the document has been
detached.</p>
<p>Doctrine will discard all references to a detached document.</p>
<p>Example:</p>
<pre><code class="">$dm-&gt;detach($document);
</code></pre>
<p>The semantics of the detach operation, applied to a document X are
as follows:</p>
<ul>
    <li>If X is a managed document, the detach operation causes it to
become detached. The detach operation is cascaded to documents
referenced by X, if the relationships from X to these other
documents is mapped with <code>cascade: &#039;DETACH&#039;</code> or <code>cascade: &#039;ALL&#039;</code> (see
&quot;Transitive Persistence&quot;). Documents which previously referenced X
will continue to reference X;</li>
<li>If X is a new or detached document, it is ignored by the detach
operation;</li>
<li>If X is a removed document, the detach operation is cascaded to
documents referenced by X, if the relationships from X to these
other documents is mapped with <code>cascade: &#039;DETACH&#039;</code> or <code>cascade: &#039;ALL&#039;</code> (see
&quot;Transitive Persistence&quot;). Documents which previously referenced X
will continue to reference X.</li>
</ul>
<p>There are several situations in which a document will become detached
automatically without invoking the <code>detach</code> method:</p>
<ul>
    <li>When <code>DocumentManager::clear()</code> is invoked, all documents that are
currently managed by the <code>DocumentManager</code> instance become detached;</li>
<li>When serializing a document. The document retrieved upon subsequent
unserialization will be detached (This is the case for all documents
that are serialized and stored in some cache).</li>
</ul>
<p>The <code>detach</code> operation is usually not as frequently needed and
used as <code>persist</code> and <code>remove</code>.</p>
</div>
<div class="section"><a class="section-anchor" id="merging-documents" name="merging-documents"></a><h2 class="section-header"><a href="#merging-documents">Merging documents<i class="fas fa-link"></i></a></h2>
<p>Merging documents refers to the merging of (usually detached)
documents into the context of a <code>DocumentManager</code> so that they become
managed again. To merge the state of a document into a
<code>DocumentManager</code> use the <code>DocumentManager::merge($document)</code> method. The
state of the passed document will be merged into a managed copy of
this document and this copy will subsequently be returned.</p>
<p>Example:</p>
<pre><code class="">$detachedDocument = unserialize($serializedDocument); // some detached document
$document = $em-&gt;merge($detachedDocument);
// $document now refers to the fully managed copy returned by the merge operation.
// The DocumentManager now manages the persistence of $document as usual.

</code></pre>
<p>The semantics of the merge operation, applied to a document X, are
as follows:</p>
<ul>
    <li>If X is a detached document, the state of X is copied onto a
pre-existing managed document instance X' of the same identity;</li>
<li>If X is a new document instance, a new managed copy X' will be
created and the state of X is copied onto this managed instance;</li>
<li>If X is a removed document instance, an <code>InvalidArgumentException</code>
will be thrown;</li>
<li>If X is a managed document, it is ignored by the merge operation,
however, the merge operation is cascaded to documents referenced by
relationships from X if these relationships have been mapped with
the cascade element value MERGE or ALL (see &quot;Transitive
Persistence&quot;);</li>
<li>For all documents Y referenced by relationships from X having the
cascade element value <code>MERGE</code> or <code>ALL</code>, Y is merged recursively as Y'.
For all such Y referenced by X, X' is set to reference Y'. (Note
that if X is managed then X is the same object as X'.);</li>
<li>If X is a document merged to X', with a reference to another
document Y, where <code>cascade: &#039;MERGE&#039;</code> or <code>cascade: &#039;ALL&#039;</code> is not specified, then
navigation of the same association from X' yields a reference to a
managed object Y' with the same persistent identity as Y.</li>
</ul>
<p>The <code>merge</code> operation is usually not as frequently needed and
used as <code>persist</code> and <code>remove</code>. The most common scenario for
the <code>merge</code> operation is to reattach documents to a <code>DocumentManager</code>
that come from some cache (and are therefore detached) and you want
to modify and persist such a document.</p>
<div class="alert warning-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td><td><p>If you need to perform multiple merges of documents that share
certain subparts of their object-graphs and cascade merge, then you
have to call <code>DocumentManager::clear()</code> between the successive
calls to <code>DocumentManager::merge()</code>. Otherwise you might end up
with multiple copies of the same object in the repository, however
with different IDs, or a duplicate ID conflict - depending on how
you generate IDs.</p>
</td></tr></table></div>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>If you load some detached documents from a cache and you do
not need to persist or delete them or otherwise make use of them
without the need for persistence services there is no need to use
<code>merge</code>. I.e. you can simply pass detached objects from a cache
directly to the view.</p>
</td></tr></table></div>
</div>
<div class="section"><a class="section-anchor" id="synchronization-with-the-repository" name="synchronization-with-the-repository"></a><h2 class="section-header"><a href="#synchronization-with-the-repository">Synchronization with the Repository<i class="fas fa-link"></i></a></h2>
<p>The state of persistent documents is synchronized with the repository
by calling <code>flush</code> on a <code>DocumentManager</code> by commiting the underlying
<code>UnitOfWork</code>. The synchronization involves writing any updates to
persistent documents and their relationships to the repository.
Thereby bidirectional relationships are persisted based on the
references held by the owning side of the relationship as explained
in the Association Mapping chapter.</p>
<p>When <code>DocumentManager::flush()</code> is called, Doctrine inspects all
managed, new and removed documents and will perform the necessary
operations.</p>
<a id="workingobjects_repository_uow_outofsync"></a>
<div class="section"><a class="section-anchor" id="effects-of-repository-and-unitofwork-being-out-of-sync" name="effects-of-repository-and-unitofwork-being-out-of-sync"></a><h3 class="section-header"><a href="#effects-of-repository-and-unitofwork-being-out-of-sync">Effects of Repository and UnitOfWork being Out-Of-Sync<i class="fas fa-link"></i></a></h3>
<p>As soon as you begin to change the state of documents, call persist or remove the
contents of the UnitOfWork and the repository will get out of sync. They can
only be synchronized by calling <code>DocumentManager::flush()</code>. This section
describes the effects of repository and UnitOfWork being out of sync.</p>
<ul>
    <li>Documents that are scheduled for removal can still be queried from the repository.
They are returned from queries, calls to getReferrers and getChildren and
stay visible in collections;</li>
<li>Documents that are passed to <code>DocumentManager::persist</code> do not turn up in query
results and do not appear in collections;</li>
<li>Documents that have changed will not be overwritten with the state from the repository.
This is because the identity map will detect the construction of an already existing
document and assumes its the most up to date version.</li>
</ul>
<p><code>DocumentManager::flush()</code> is never called implicitly by Doctrine. You
always have to trigger it manually.</p>
</div>
<div class="section"><a class="section-anchor" id="synchronizing-new-and-managed-documents" name="synchronizing-new-and-managed-documents"></a><h3 class="section-header"><a href="#synchronizing-new-and-managed-documents">Synchronizing New and Managed Documents<i class="fas fa-link"></i></a></h3>
<p>The flush operation applies to a managed document with the following
semantics:</p>
<ul>
    <li>The document itself is synchronized to the repository using PHPCR
API calls, only if at least one persistent field has changed;</li>
<li>No PHPCR API calls are executed if the document did not change.</li>
</ul>
<p>The flush operation applies to a new document with the following
semantics:</p>
<ul>
    <li>The document itself is synchronized to the repository using
PHPCR API calls.</li>
</ul>
<p>For all (initialized) relationships of the new or managed document
the following semantics apply to each associated document X:</p>
<ul>
    <li>If X is new and persist operations are configured to cascade on
the relationship, X will be persisted;</li>
<li>If X is new and no persist operations are configured to cascade
on the relationship, an exception will be thrown as this indicates
a programming error;</li>
<li>If X is removed and persist operations are configured to cascade
on the relationship, an exception will be thrown as this indicates
a programming error (X would be re-persisted by the cascade);</li>
<li>If X is detached and persist operations are configured to
cascade on the relationship, an exception will be thrown (This leads
to the same result as passing X to persist()).</li>
</ul>
</div>
<div class="section"><a class="section-anchor" id="synchronizing-removed-documents" name="synchronizing-removed-documents"></a><h3 class="section-header"><a href="#synchronizing-removed-documents">Synchronizing Removed Documents<i class="fas fa-link"></i></a></h3>
<p>The flush operation applies to a removed document by deleting its
persistent state from the repository. No cascade options are relevant
for removed documents on flush, the cascade remove option is already
executed during <code>DocumentManager::remove($document)</code>.</p>
</div>
<div class="section"><a class="section-anchor" id="the-size-of-a-unit-of-work" name="the-size-of-a-unit-of-work"></a><h3 class="section-header"><a href="#the-size-of-a-unit-of-work">The size of a Unit of Work<i class="fas fa-link"></i></a></h3>
<p>The size of a Unit of Work mainly depends on the number of managed
documents at a particular point in time.</p>
</div>
<div class="section"><a class="section-anchor" id="the-cost-of-flushing" name="the-cost-of-flushing"></a><h3 class="section-header"><a href="#the-cost-of-flushing">The cost of flushing<i class="fas fa-link"></i></a></h3>
<p>How costly a flush operation is, mainly depends on two factors:</p>
<ul>
    <li>The size of the document manager's current Unit of Work;</li>
<li>The configured change tracking policies.</li>
</ul>
<p>You can get the size of a Unit of Work as follows:</p>
<pre><code class="">$uowSize = $dm-&gt;getUnitOfWork()-&gt;size();
</code></pre>
<p>The size represents the number of managed documents in the Unit of
Work. This size affects the performance of flush() operations due
to change tracking (see Change Tracking Policies) and, of course,
memory consumption, so you may want to check it from time to time
during development.</p>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>Do not invoke <code>flush</code> after every change to a document
or every single invocation of persist/remove/merge/... This is an
anti-pattern and unnecessarily reduces the performance of your
application. Instead, form units of work that operate on your
documents and call <code>flush</code> when you are done. While serving a
single HTTP request there should be usually no need for invoking
<code>flush</code> more than 0-2 times.</p>
</td></tr></table></div>
</div>
<div class="section"><a class="section-anchor" id="direct-access-to-a-unit-of-work" name="direct-access-to-a-unit-of-work"></a><h3 class="section-header"><a href="#direct-access-to-a-unit-of-work">Direct Access to a Unit of Work<i class="fas fa-link"></i></a></h3>
<p>You can get direct access to the Unit of Work by calling
<code>DocumentManager::getUnitOfWork()</code>. This will return the UnitOfWork
instance the <code>DocumentManager</code> is currently using:</p>
<pre><code class="">$uow = $em-&gt;getUnitOfWork();
</code></pre>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>Directly manipulating a UnitOfWork is not recommended.
When working directly with the UnitOfWork API, respect methods
marked as INTERNAL by not using them and carefully read the API
documentation.</p>
</td></tr></table></div>
</div>
<div class="section"><a class="section-anchor" id="document-state" name="document-state"></a><h3 class="section-header"><a href="#document-state">Document State<i class="fas fa-link"></i></a></h3>
<p>As outlined in the architecture overview, a document can be in one of
four possible states: NEW, MANAGED, REMOVED, DETACHED. If you
explicitly need to find out what the current state of a document is
in the context of a certain <code>DocumentManager</code> you can ask the
underlying <code>UnitOfWork</code>:</p>
<pre><code class="">switch ($dm-&gt;getUnitOfWork()-&gt;getDocumentState($document)) {
    case UnitOfWork::STATE_MANAGED:
        ...
    case UnitOfWork::STATE_REMOVED:
        ...
    case UnitOfWork::STATE_DETACHED:
        ...
    case UnitOfWork::STATE_NEW:
        ...
}
</code></pre>
<p>The states mean the following:</p>
<ul>
    <li><strong>MANAGED</strong>: The document is associated with a <code>DocumentManager</code>
and it is not scheduled for removal.</li>
<li><strong>REMOVED</strong>: The document has been passed to <code>DocumentManager::remove()</code>
but no flush operation executing the removal was triggered yet. A
REMOVED document is still associated with a <code>DocumentManager</code>
until the next flush operation.</li>
<li><strong>DETACHED</strong>: The document has persistent state and identity but is
currently not associated with a <code>DocumentManager</code>.</li>
<li><strong>NEW</strong>: The document has no persistent state and identity
and is not associated with a <code>DocumentManager</code> (for example those
just created via the &quot;new&quot; operator).</li>
</ul>
<a id="workingobjects-query"></a>
</div>
</div>
<div class="section"><a class="section-anchor" id="querying" name="querying"></a><h2 class="section-header"><a href="#querying">Querying<i class="fas fa-link"></i></a></h2>
<p>Doctrine PHPCR-ODM provides the following ways, in increasing level of
power and flexibility, to query for persisted documents. You should
always start with the simplest one that suits your needs.</p>
<div class="section"><a class="section-anchor" id="by-primary-key" name="by-primary-key"></a><h3 class="section-header"><a href="#by-primary-key">By Primary Key<i class="fas fa-link"></i></a></h3>
<p>The most basic way to query for a persisted document is by its
identifier (PHPCR path) using the
<code>DocumentManager::find(null, $id)</code> method. Here is an
example:</p>
<pre><code class="">/** @var $em DocumentManager */
$user = $em-&gt;find(User::class, $id);
</code></pre>
<p>The return value is either the found document instance or null if no
instance of the specified class can be found with the given identifier.</p>
<p>If you need several documents and know their paths, you can have a considerable
performance gain by using <code>DocumentManager::findMany(null, $ids)</code> as then
all those documents are loaded from the repository in one request.</p>
<p>You can also specify the class name instead of null to filter to only find
instances of that class. If you call <code>find</code> on the repository of a document
class, this is equivalent to calling <code>find</code> on the <code>DocumentManager</code> with
that document class.</p>
</div>
<div class="section"><a class="section-anchor" id="by-simple-conditions" name="by-simple-conditions"></a><h3 class="section-header"><a href="#by-simple-conditions">By Simple Conditions<i class="fas fa-link"></i></a></h3>
<p>To query for one or more documents based on several conditions that
form a logical conjunction, use the <code>findBy</code> and <code>findOneBy</code>
methods on a repository as follows:</p>
<pre><code class="">/** @var $dm DocumentManager */

// All users that are 20 years old
$users = $dm-&gt;getRepository(User::Class)-&gt;findBy([&#039;age&#039; =&gt; 20]);

// All users that are 20 years old and have a surname of &#039;Miller&#039;
$users = $dm-&gt;getRepository(User::Class)-&gt;findBy([&#039;age&#039; =&gt; 20, &#039;surname&#039; =&gt; &#039;Miller&#039;]);

// A single user by its nickname
$user = $dm-&gt;getRepository(User::Class)-&gt;findOneBy([&#039;nickname&#039; =&gt; &#039;romanb&#039;]);
</code></pre>
<div class="alert warning-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td><td><p>Note that due to the nature of PHPCR, the primary identifier is no field.
You can thus not use <code>findBy([&#039;id&#039; =&gt; &#039;/my/path&#039;])</code> but should
pass the ID into the <code>find</code> method. There is also findMany if you
need to fetch several documents.</p>
</td></tr></table></div>
<p>You can also query by references through the repository:</p>
<pre><code class="">$number = $dm-&gt;find(PhoneNumber::class, &#039;/path/to/phone/number&#039;);
$user = $dm-&gt;getRepository(User::Class)-&gt;findOneBy([&#039;phone&#039; =&gt; $number-&gt;getUuid()]);
</code></pre>
<p>Be careful that this only works by passing the uuid of the associated
document, not yet by passing the associated document itself.</p>
<p>The <code>DocumentRepository::findBy()</code> method additionally accepts orderings,
limit and offset as second to fourth parameters:</p>
<pre><code class="">$tenUsers = $dm
    -&gt;getRepository(User::Class)
    -&gt;findBy([&#039;age&#039; =&gt; 20], [&#039;name&#039; =&gt; &#039;ASC&#039;], 10, 0);
</code></pre>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>The ORM has a shortcut for querying by one field, using the <code>__call</code>
handler. In PHPCR-ODM this is not yet implemented, so the rest of this
section does not work yet.</p>
</td></tr></table></div>
<p>A DocumentRepository also provides a mechanism for more concise
calls through its use of <code>__call</code>. Thus, the following two
examples are equivalent:</p>
<pre><code class="">// A single user by its nickname
$user = $dm-&gt;getRepository(User::Class)-&gt;findOneBy([&#039;nickname&#039; =&gt; &#039;romanb&#039;]);

// A single user by its nickname (__call magic)
$user = $dm-&gt;getRepository(User::Class)-&gt;findOneByNickname(&#039;romanb&#039;);

</code></pre>
</div>
<div class="section"><a class="section-anchor" id="by-lazy-loading" name="by-lazy-loading"></a><h3 class="section-header"><a href="#by-lazy-loading">By Lazy Loading<i class="fas fa-link"></i></a></h3>
<p>Whenever you have a managed document instance at hand, you can
traverse and use any associations of that document that are
configured LAZY as if they were in-memory already. Doctrine will
automatically load the associated documents on demand through the
concept of lazy-loading.</p>
</div>
<div class="section"><a class="section-anchor" id="by-query-builder" name="by-query-builder"></a><h3 class="section-header"><a href="#by-query-builder">By Query Builder<i class="fas fa-link"></i></a></h3>
<p>PHPCR-ODM provides a query builder that wraps around native PHPCR queries.
See <a href="query-builder.html">The QueryBuilder</a>.</p>
</div>
<div class="section"><a class="section-anchor" id="by-native-queries" name="by-native-queries"></a><h3 class="section-header"><a href="#by-native-queries">By Native Queries<i class="fas fa-link"></i></a></h3>
<p>PHPCR-ODM has no DQL (yet), but you can query using the JCR-SQL2 query
language or the JCR-QOM to build a query object tree.</p>
<p>You can create your SQL2 query by calling <code>DocumentManager::createPhpcrQuery</code>
with the query as string, or get the phpcr-utils query builder by calling
<code>DocumentManager::createPhpcrQueryBuilder</code>. You can either execute that query
to get raw PHPCR nodes, or pass a PHPCR query to
<code>DocumentManager::getDocumentsByPhpcrQuery</code> to get documents.</p>
</div>
<div class="section"><a class="section-anchor" id="custom-repositories" name="custom-repositories"></a><h3 class="section-header"><a href="#custom-repositories">Custom Repositories<i class="fas fa-link"></i></a></h3>
<p>By default the <code>DocumentManager</code> returns a default implementation of
<code>Doctrine\ODM\PHPCR\DocumentRepository</code> when you call
<code>DocumentManager::getRepository($documentClass)</code>. You can overwrite
this behaviour by specifying the class name of your own Document
Repository in the mapping (PHP Attribute, XML or YAML metadata).</p>
<p>In applications that require lots of specialized queries, using a
custom repository is the recommended way of grouping these queries
in a central location:</p>
<pre><code class="">namespace MyDomain\Model;

use Doctrine\ODM\PHPCR\DocumentRepository;
use Doctrine\Common\Collections\Collection;

#[PHPCR\Document(repositoryClass: UserRepository::class)]
class User
{
}

class UserRepository extends DocumentRepository
{
    public function getAllAdminUsers(): Collection
    {
        $qb = $this-&gt;dm-&gt;getQueryBuilder();
        // ... build some fancy query
        return $qb-&gt;getQuery()-&gt;getResult();
    }
}
</code></pre>
<p>You can access your repository now by calling:</p>
<pre><code class="">/** @var $dm DocumentManager */

$admins = $dm-&gt;getRepository(User::class)-&gt;getAllAdminUsers();
</code></pre>

</div>
</div>
</div>

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                    <footer class="footer">
                <div class="container">
                    <ul class="list-inline">
                        <li class="list-inline-item"><a href="/projects.html">Projects</a></li>
                        <li class="list-inline-item"><a href="/partners.html">Partners</a></li>
                        <li class="list-inline-item"><a href="/sponsorship.html">Sponsorship</a></li>
                        <li class="list-inline-item"><a href="/community/index.html">Community</a></li>
                        <li class="list-inline-item"><a href="/blog/index.html">Blog</a></li>
                    </ul>
                </div>
            </footer>
        
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?5364f3"
                            integrity="sha384-yT1xut8dmITuccyh+MOljcF0MzMJFhaP227UZREURvpogyieLsqm9J/duGcSbb6q"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'phpcr-odm';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search PHPCR ODM 2.x'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            </body>
</html>
