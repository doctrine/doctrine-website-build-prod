<!DOCTYPE html>
<html>
    <head>
        <title>        The QueryBuilder - Doctrine PHPCR ODM
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine PHPCR ODM Documentation: The QueryBuilder ">

        <meta name="keywords" content="                    php,content,odm,data,mapper,mapping,object,documentation,the,querybuilder
    ">

                    <meta name="robots" content="index, follow">
        
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/reference/query-builder.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?74d1a1"
                        integrity="sha384-dAaEn2ZyD87ZE8ZaTOc39tmNlPuZWU7Tvl3K1W/IXH5rtko68QAI5cdG6HLv97IH"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/1.7/reference/query-builder.html" />
        <meta property="og:title" content="        The QueryBuilder - Doctrine PHPCR ODM
    " />
        <meta property="og:description" content="Doctrine PHPCR ODM Documentation: The QueryBuilder " />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine PHPCR ODM",
            "description": "The QueryBuilder",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/phpcr-odm/edit//docs/en/reference/query-builder.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        

            <div class="toc">
    <ul class="menu-level">
    <li class="toc-item">
    <a href="annotations-mapping.html#annotation-mapping">Annotation Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="annotations-mapping.html#note-on-usage">Note on usage</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#document">Document</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="annotations-mapping.html#document">@Document</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#mappedsuperclass">@MappedSuperclass</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#mapping-fields">Mapping Fields</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="annotations-mapping.html#field">@Field</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#hierarchy">Hierarchy</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="annotations-mapping.html#child">@Child</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#children">@Children</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#depth">@Depth</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#parentdocument">@ParentDocument</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#identification">Identification</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="annotations-mapping.html#id">@Id</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#nodename">@Nodename</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#uuid">@Uuid</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#lifcycle-callbacks">Lifcycle callbacks</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="annotations-mapping.html#postload">@PostLoad</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#postpersist">@PostPersist</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#postremove">@PostRemove</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#postupdate">@PostUpdate</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#prepersist">@PrePersist</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#preremove">@PreRemove</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#preupdate">@PreUpdate</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#phpcr">PHPCR</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="annotations-mapping.html#node">@Node</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#references">References</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="annotations-mapping.html#referencemany">@ReferenceMany</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#referenceone">@ReferenceOne</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#referrers">@Referrers</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#mixedreferrers">@MixedReferrers</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#translation">Translation</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="annotations-mapping.html#locale">@Locale</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#versioning">Versioning</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="annotations-mapping.html#versioncreated">@VersionCreated</a>


</li>
            <li class="toc-item">
    <a href="annotations-mapping.html#versionname">@VersionName</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="architecture.html#architecture">Architecture</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="architecture.html#doctrine-phpcr-odm-packages">Doctrine PHPCR-ODM Packages</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="architecture.html#content-tree-not-tables">Content tree, not tables</a>


</li>
            <li class="toc-item">
    <a href="architecture.html#additional-core-features">Additional core features</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="association-mapping.html#association-mapping">Association Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="association-mapping.html#hierarchy-mappings">Hierarchy mappings</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="association-mapping.html#child-restriction">Child restriction</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="association-mapping.html#references">References</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="association-mapping.html#referenceable-documents">Referenceable documents</a>


</li>
            <li class="toc-item">
    <a href="association-mapping.html#reference-other-documents">Reference other documents</a>


</li>
            <li class="toc-item">
    <a href="association-mapping.html#referrers-to-inverse-the-reference-relation">Referrers to inverse the reference relation</a>


</li>
            <li class="toc-item">
    <a href="association-mapping.html#mixedreferrers">MixedReferrers</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="association-mapping.html#transitive-persistence-cascade-operations">Transitive persistence / Cascade Operations</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="association-mapping.html#persistence-by-reachability-cascade-persist">Persistence by Reachability: Cascade Persist</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="association-mapping.html#collections">Collections</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="association-mapping.html#initializing-collections">Initializing Collections</a>


</li>
            <li class="toc-item">
    <a href="association-mapping.html#new-collections-after-flushing">New Collections after Flushing</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="basic-mapping.html#basic-mapping">Basic Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="basic-mapping.html#mapping-drivers">Mapping Drivers</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#introduction-to-docblock-annotations">Introduction to Docblock Annotations</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#persistent-classes">Persistent classes</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="basic-mapping.html#specify-a-node-type">Specify a node type</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#specify-a-repository-class">Specify a repository class</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="basic-mapping.html#doctrine-mapping-types">Doctrine Mapping Types</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#property-mapping">Property Mapping</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="basic-mapping.html#mapping-to-a-differently-named-phpcr-property">Mapping to a differently named PHPCR property</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#mapping-multivalue-properties">Mapping multivalue properties</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#summary">Summary</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="basic-mapping.html#identifiers">Identifiers</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="basic-mapping.html#identifier-generation-strategies">Identifier Generation Strategies</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="basic-mapping.html#parent-and-name-strategy-recommended">Parent and name strategy (recommended)</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#assigned-id">Assigned Id</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#repository-strategy">Repository strategy</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="basic-mapping.html#symfony-bundle">Symfony bundle</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="events.html#events">Events</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="events.html#lifecycle-events">Lifecycle Events</a>


</li>
            <li class="toc-item">
    <a href="events.html#event-order-when-moving">Event order when moving</a>


</li>
            <li class="toc-item">
    <a href="events.html#event-order-when-handling-with-translations">Event order when handling with translations</a>


</li>
            <li class="toc-item">
    <a href="events.html#listening-to-events">Listening to events</a>


</li>
            <li class="toc-item">
    <a href="events.html#lifecycle-callbacks">Lifecycle Callbacks</a>


</li>
            <li class="toc-item">
    <a href="events.html#listening-to-lifecycle-events">Listening to Lifecycle Events</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="fetch-depth.html#tuning-the-node-preloading">Tuning the node preloading</a>


</li>
    <li class="toc-item">
    <a href="inheritance-mapping.html#inheritance-mapping">Inheritance Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="inheritance-mapping.html#document-class-inheritance">Document class inheritance</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="installation-configuration.html#installation">Installation</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="installation-configuration.html#composer">Composer</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#phpcr-provider">PHPCR provider</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#install-jackalope-jackrabbit-phcpr-provider">Install Jackalope-Jackrabbit PHCPR provider</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#install-jackalope-doctrine-dbal-phpcr-provider">Install Jackalope Doctrine DBAL PHPCR provider</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#install-midgard2-phpcr-provider">Install Midgard2 PHPCR provider</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="installation-configuration.html#class-loading-with-composer">Class loading with composer</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#obtaining-an-objectmanager">Obtaining an ObjectManager</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#prepare-the-mapping-driver">Prepare the mapping driver</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#annotation-mapping-driver">Annotation Mapping Driver</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#xml-mapping-driver">XML Mapping Driver</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#yml-mapping-driver">YML Mapping Driver</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="installation-configuration.html#quick-configuration-example">Quick Configuration Example</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="installation-configuration.html#configuration-options">Configuration Options</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#proxy-directory-required">Proxy Directory (*REQUIRED*)</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#proxy-namespace-required">Proxy Namespace (*REQUIRED*)</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#metadata-driver-required">Metadata Driver (*REQUIRED*)</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#metadata-cache-recommended">Metadata Cache (*RECOMMENDED*)</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#auto-generating-proxy-classes-optional">Auto-generating Proxy Classes (*OPTIONAL*)</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="installation-configuration.html#development-vs-production-configuration">Development vs Production Configuration</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#connection-options">Connection Options</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#proxy-objects">Proxy Objects</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#reference-proxies">Reference Proxies</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#generating-proxy-classes">Generating Proxy classes</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#autoloading-proxies">Autoloading Proxies</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#multiple-metadata-sources">Multiple Metadata Sources</a>


</li>
            <li class="toc-item">
    <a href="installation-configuration.html#default-repository-optional">Default Repository (*OPTIONAL*)</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="installation-configuration.html#setting-up-the-console">Setting up the Console</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="installation-configuration.html#register-system-node-types">Register system node types</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="introduction.html#getting-started">Getting Started</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="introduction.html#what-are-documents">What are Documents?</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#an-example-model-document-management">An Example Model: Document Management</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#setup-project">Setup Project</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#building-the-model">Building the model</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#initialize-the-repository">Initialize the repository</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#storing-documents">Storing documents</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#reading-documents">Reading documents</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#tree-traversal">Tree traversal</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#add-references">Add references</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#removing-documents">Removing documents</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#other-helpful-methods-on-the-documentmanager">Other helpful methods on the DocumentManager</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#conclusion">Conclusion</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="multilang.html#multilanguage-support">Multilanguage support</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="multilang.html#philosophy">Philosophy</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#mapping">Mapping</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#interacting-with-translations">Interacting with translations</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#choosing-the-right-translation-strategy">Choosing the right translation strategy</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="multilang.html#implementing-your-own-translation-strategy">Implementing your own translation strategy</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="multilang.html#configure-the-locale-chooser-strategy">Configure the locale chooser strategy</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#full-example">Full Example</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#querying-translated-properties">Querying Translated Properties</a>


</li>
            <li class="toc-item">
    <a href="multilang.html#limitations">Limitations</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="multilang.html#translations-and-references-hierarchy">Translations and references / hierarchy</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="phpcr-access.html#accessing-the-underlying-phpcr-session">Accessing the underlying PHPCR session</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="phpcr-access.html#getting-the-phpcr-session">Getting the PHPCR Session</a>


</li>
            <li class="toc-item">
    <a href="phpcr-access.html#the-node-field-mapping">The Node field mapping</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="query-builder-reference.html#query-builder-reference">Query Builder Reference</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="query-builder-reference.html#reference">Reference</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#node-constraintandx">Node: ConstraintAndx</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-constraintcomparison">Node: ConstraintComparison</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-constraintfactory">Node: ConstraintFactory</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#andx">-&gt;andX</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#orx">-&gt;orX</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#fieldisset">-&gt;fieldIsset</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#fulltextsearch">-&gt;fullTextSearch</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#same">-&gt;same</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#descendant">-&gt;descendant</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#child">-&gt;child</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#eq">-&gt;eq</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#neq">-&gt;neq</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#lt">-&gt;lt</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#lte">-&gt;lte</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#gt">-&gt;gt</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#gte">-&gt;gte</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#like">-&gt;like</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-constraintnot">Node: ConstraintNot</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-constraintorx">Node: ConstraintOrx</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-from">Node: From</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-operanddynamicfactory">Node: OperandDynamicFactory</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#fulltextsearchscore">-&gt;fullTextSearchScore</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#length">-&gt;length</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#lowercase">-&gt;lowerCase</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#uppercase">-&gt;upperCase</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#localname">-&gt;localName</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#name">-&gt;name</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#field">-&gt;field</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-operanddynamiclowercase">Node: OperandDynamicLowerCase</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-operanddynamicuppercase">Node: OperandDynamicUpperCase</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-operandfactory">Node: OperandFactory</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#parameter">-&gt;parameter</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#literal">-&gt;literal</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-operandstaticfactory">Node: OperandStaticFactory</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-orderby">Node: OrderBy</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#asc">-&gt;asc</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#desc">-&gt;desc</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-orderbyadd">Node: OrderByAdd</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-ordering">Node: Ordering</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-querybuilder">Node: QueryBuilder</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#where">-&gt;where</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#andwhere">-&gt;andWhere</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#orwhere">-&gt;orWhere</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#from">-&gt;from</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#fromdocument">-&gt;fromDocument</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#addjoinleftouter">-&gt;addJoinLeftOuter</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#addjoinrightouter">-&gt;addJoinRightOuter</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#addjoininner">-&gt;addJoinInner</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#select">-&gt;select</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#addselect">-&gt;addSelect</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#orderby">-&gt;orderBy</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#addorderby">-&gt;addOrderBy</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-select">Node: Select</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-selectadd">Node: SelectAdd</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-sourcejoin">Node: SourceJoin</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-sourcejoinconditionfactory">Node: SourceJoinConditionFactory</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-reference.html#descendant">-&gt;descendant</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#equi">-&gt;equi</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#child">-&gt;child</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#same">-&gt;same</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-sourcejoinleft">Node: SourceJoinLeft</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-sourcejoinright">Node: SourceJoinRight</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-where">Node: Where</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-whereand">Node: WhereAnd</a>


</li>
            <li class="toc-item">
    <a href="query-builder-reference.html#node-whereor">Node: WhereOr</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item opened">
    <a href="#the-querybuilder">The QueryBuilder</a>

        <ul class="section-level-1 opened-ul ">
            <li class="toc-item">
    <a href="#concepts">Concepts</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#leaf-and-factory-nodes">Leaf and Factory Nodes</a>


</li>
            <li class="toc-item">
    <a href="#fluent-interface">Fluent Interface</a>


</li>
            <li class="toc-item">
    <a href="#types-and-cardinality">Types and Cardinality</a>


</li>
            <li class="toc-item">
    <a href="#aliases-and-fields">Aliases and fields</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#retrieving-a-query-builder-instance">Retrieving a query builder instance</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#via-the-document-manager">Via the document manager</a>


</li>
            <li class="toc-item">
    <a href="#via-a-document-repository">Via a document repository</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#working-with-the-querybuilder">Working with the QueryBuilder</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#specifying-the-document-source-from">Specifying the document source - from</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#from-single-source">From Single Source</a>


</li>
            <li class="toc-item">
    <a href="#from-joined-source">From Joined Source</a>


</li>
            <li class="toc-item">
    <a href="#joining-with-an-association">Joining with an Association</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#selecting-specific-properties-select">Selecting specific properties - select</a>


</li>
            <li class="toc-item">
    <a href="#limiting-the-number-of-results">Limiting the number of results</a>


</li>
            <li class="toc-item">
    <a href="#specifying-selection-criteria">Specifying selection criteria</a>


</li>
            <li class="toc-item">
    <a href="#ordering-results">Ordering results</a>


</li>
            <li class="toc-item">
    <a href="#querying-translated-documents">Querying translated documents</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#additional-notes">Additional notes</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#querying-multivalue-fields">Querying multivalue fields</a>


</li>
            <li class="toc-item">
    <a href="#using-the-query-builder-in-tests">Using the Query Builder in Tests</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="query.html#the-query-object">The Query Object</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="query.html#getting-single-results">Getting single results</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query.html#getsingleresult">getSingleResult</a>


</li>
            <li class="toc-item">
    <a href="query.html#getoneornullresult">getOneOrNullResult</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query.html#getting-multiple-results">Getting multiple results</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query.html#getresult">getResult</a>


</li>
            <li class="toc-item">
    <a href="query.html#getphpcrnoderesult">getPhpcrNodeResult</a>


</li>
            <li class="toc-item">
    <a href="query.html#execute">execute</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query.html#hydration-modes">Hydration modes</a>


</li>
            <li class="toc-item">
    <a href="query.html#limiting-results">Limiting results</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="tools.html#tools">Tools</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="tools.html#doctrine-console">Doctrine Console</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="tools.html#command-overview">Command Overview</a>


</li>
            <li class="toc-item">
    <a href="tools.html#getting-documentation-of-a-command">Getting documentation of a command</a>


</li>
            <li class="toc-item">
    <a href="tools.html#phpcr-implementation-specific-commands">PHPCR implementation specific commands</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="tools.html#jackrabbit-specific-commands">Jackrabbit specific commands</a>


</li>
            <li class="toc-item">
    <a href="tools.html#doctrine-dbal-specific-commands">Doctrine DBAL specific commands</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="tools.html#register-system-node-types">Register system node types</a>


</li>
            <li class="toc-item">
    <a href="tools.html#adding-your-own-commands">Adding your own commands</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="transactions.html#transactions-1">Transactions</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="transactions.html#transactional">transactional()</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="versioning.html#versioning-support">Versioning support</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="versioning.html#philosophy">Philosophy</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="versioning.html#phpcr-odm">PHPCR-ODM</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="versioning.html#mappings">Mappings</a>


</li>
            <li class="toc-item">
    <a href="versioning.html#interacting-with-versions">Interacting with versions</a>


</li>
            <li class="toc-item">
    <a href="versioning.html#full-example">Full Example</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="working-with-objects.html#working-with-objects">Working with Objects</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="working-with-objects.html#documents-and-the-identity-map">Documents and the Identity Map</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#document-graph-traversal">Document Graph Traversal</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#persisting-documents">Persisting documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#removing-documents">Removing documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#detaching-documents">Detaching documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#merging-documents">Merging documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#synchronization-with-the-repository">Synchronization with the Repository</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="working-with-objects.html#effects-of-repository-and-unitofwork-being-out-of-sync">Effects of Repository and UnitOfWork being Out-Of-Sync</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#synchronizing-new-and-managed-documents">Synchronizing New and Managed Documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#synchronizing-removed-documents">Synchronizing Removed Documents</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#the-size-of-a-unit-of-work">The size of a Unit of Work</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#the-cost-of-flushing">The cost of flushing</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#direct-access-to-a-unit-of-work">Direct Access to a Unit of Work</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#document-state">Document State</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="working-with-objects.html#querying">Querying</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="working-with-objects.html#by-primary-key">By Primary Key</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#by-simple-conditions">By Simple Conditions</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#by-lazy-loading">By Lazy Loading</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#by-query-builder">By Query Builder</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#by-native-queries">By Native Queries</a>


</li>
            <li class="toc-item">
    <a href="working-with-objects.html#custom-repositories">Custom Repositories</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="xml-mapping.html#xml-mapping">XML Mapping</a>


</li>
    </ul>
</div>
    

                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://www.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "PHPCR ODM",
            "item": "https://www.doctrine-project.org/projects/phpcr-odm.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/1.7/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "The QueryBuilder",
            "item": "https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/1.7/reference/query-builder.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-phpcr-odm/en/1.7/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">The QueryBuilder</li>
                        </ol>
</nav>
                                    </div>

                    
    <div class="alert caution bg-light-yellow text-dark border">
    <table width="100%">
        <tr>
            <td width="10" class="align-top">
                <i class="fas fa-exclamation-circle text-warning mr-2"></i>
            </td>
            <td><p>You are browsing a version that is no longer maintained.</p></td>
        </tr>
    </table>
</div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine-phpcr-odm/en/1.7/reference/query-builder.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        1.7.2
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-phpcr-odm/en/latest/reference/query-builder.html">
                                                        2.x

                                                                                                                    (current)
                                                        
                                                                                                            </a>
                                                                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-phpcr-odm/en/1.x/reference/query-builder.html">
                                                        1.x

                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-phpcr-odm/en/2.0/reference/query-builder.html">2.0</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-phpcr-odm/en/1.8/reference/query-builder.html">1.8</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item active" href="/projects/doctrine-phpcr-odm/en/1.7/reference/query-builder.html">1.7</a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                </div>
                            
                            

            <div class="section" id="the-querybuilder">
            <a id="qbref"></a>
            <h1 class="section-header ">
    <a href="#the-querybuilder">
        The QueryBuilder
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p>The PHPCR-ODM query builder enables you to create queries at the abstraction
level of the ODM using a fluent interface.</p>

            
    <p>An example query:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb = $documentManager->createQueryBuilder();

<span class="noselect">$ </span>qb->from()->document('Blog\User', 'u');
<span class="noselect">$ </span>qb->where()->eq()->field('u.name')->literal('dtl');

<span class="noselect">$ </span>query = $qb->getQuery();
</code></pre></div>
            
    <p>This query will select all documents of class <code>Blog\User</code> which
have a value of <code>dtl</code> for the field <code>name</code>.</p>

            
    <p>The first line retrieves a new instance of the query builder from the document
manager.</p>

            
    <p>The second specifies that we want documents of type <code>Blog\User</code> and that
the string &quot;u&quot; will be used as the alias name.</p>

            
    <p>The third line says that we want only documents where the value of the
field &quot;name&quot; from the alias named &quot;u&quot; is equal (eq) to the
literal string &quot;dtl&quot;.</p>

            
    <p>The forth and final line retrieves the <a href="query.html#queryref">query</a> object.</p>

            
    <p>Alternatively the above query can be written more fluently by the using
<code>end()</code> terminators as follows:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb = $documentManager->createQueryBuilder();
<span class="noselect">$ </span>qb->from()
    ->document('Blog\User')
  ->end()
  ->where()
    ->eq()
      ->field('a.name')
      ->literal('dtl');
</code></pre></div>
            <div class="section" id="concepts">
            <h2 class="section-header ">
    <a href="#concepts">
        Concepts
        <i class="fas fa-link"></i>
    </a>
</h2>
            <div class="section" id="leaf-and-factory-nodes">
            <h3 class="section-header ">
    <a href="#leaf-and-factory-nodes">
        Leaf and Factory Nodes
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>The query builder is a tree structure composed of two different categories of
nodes. <em>Factory nodes</em> and <em>Leaf nodes</em>. Factory nodes create and
add new nodes to the query builder tree and then return the newly created node. Factory methods
accept no arguments and always have <em>children</em>. A factory node has zero
arguments.</p>

            
    <p>Leaf nodes have no children and always return the parent node after adding
themselves to the query builder tree. The parent node is always a factory
node and the leaf node always has arguments:</p>

            <div class="console"><pre><code class="console">// the query builder is a factory node
<span class="noselect">$ </span>qb = $dm->createQueryBuilder();

// from() returns a new factory node
<span class="noselect">$ </span>from = $qb->from();

// document() is a leaf node, it returns the parent factory
<span class="noselect">$ </span>from = $from->document('Post', 'p');

// end() returns the parent, in this case the query builder.
<span class="noselect">$ </span>qb = $from->end();
</code></pre></div>
    </div>
            <div class="section" id="fluent-interface">
            <h3 class="section-header ">
    <a href="#fluent-interface">
        Fluent Interface
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>The API makes use of a fluent API which enables an entire query to be
constructed in a single, unbroken, statement.</p>

            
    <p>Factory node methods append nodes as children to themselves and return either
other factory nodes or, if the factory method returns a leaf, the method will
return its owning class instance:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->where()->eq()->field('p.title', 'p')->literal('My Post');
</code></pre></div>
            
    <p>In the example above:</p>

            

<ul>
    <li>The <code>where</code> method of the <code>QueryBuilder</code> adds and returns a
<code>ConstraintFactory</code> which provides the <code>eq()</code> method.</li>
    <li>The <code>eq()</code> method adds and returns an <code>OperandFactory</code> which contains the
<code>field()</code> and <code>literal()</code> methods.</li>
</ul>

            
    <p>Up to this point the return values have all been factory classes.</p>

            

<ul>
    <li>The <code>field()</code> and <code>literal()</code> methods add leaf nodes and they return the
same class of which they are part - the <code>OperandFactory</code> - the same node
which provides the <code>eq()</code> method.</li>
</ul>

            
    <p>This model presents a problem when we want to proceed to a previous node
without breaking the chain, this is where the <code>end()</code> method comes in.</p>

            
    <p>The <code>end()</code> method is a special method that will always return the parent of the
current node, allowing us to construct the query in full without breaking the
chain. A practical application of this is when we do more complicated things,
such as chaining operands:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->where()->eq()->lowerCase()->field('p.title')->end()->literal('my post');
</code></pre></div>
            
    <p>Here the <code>lowerCase()</code> method would return the <code>LowerCase</code> operand, which will
transform the value of its child member to lowercase. Because <code>field()</code> will
return its parent we need to call <code>end()</code> to go back once more to the
<code>ConstraintFactory</code> (as returned by <code>eq()</code>).</p>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>It is only necessary to add an <code>end()</code> terminator when you wish to
append additional leaf nodes to the <em>same statement</em>. In this document we
will not add <code>end()</code> terminators where they are not required.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="types-and-cardinality">
            <h3 class="section-header ">
    <a href="#types-and-cardinality">
        Types and Cardinality
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Each node has an associated node type:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->getNodeType(); // returns "builder"
<span class="noselect">$ </span>qb->where()->getNodeType(); // returns "where"
<span class="noselect">$ </span>qb->andWhere()->getNodeType(); // returns "where"
<span class="noselect">$ </span>qb->where()->eq()->getNodeType(); // returns "constraint"
<span class="noselect">$ </span>qb->where()->eq()->field()->getNodeType(); // returns "operand"
</code></pre></div>
            
    <p>Node types (not to be confused with PHPCR node types) are used to validate the
query builder trees structure. Each factory node declares how many children of
each type it is allowed, this is the node child cardinality map. The
<a href="query-builder-reference.html">Query Builder Reference</a> document lists the cardinalities of all the
factory nodes.</p>

            
    <p>Exceeding or not achieving the minimum or maximum child cardinality for a
given node type will cause an exception to be thrown when retrieving the
query, for example:</p>

            <div class="console"><pre><code class="console">// throws exception, query builder node needs at least one "from".
<span class="noselect">$ </span>qb->getQuery();

// throws exception, eq() needs one dynamic and one static operand
<span class="noselect">$ </span>qb->where()->eq()->field('p.title');
<span class="noselect">$ </span>qb->getQuery();

// throws exception, eq() needs one dynamic and one static operand
<span class="noselect">$ </span>qb->where()->eq()->field('p.title')->field('p.name');
<span class="noselect">$ </span>qb->getQuery();

// ok
<span class="noselect">$ </span>qb->where()->eq()->field('p.title')->literal('My Post');
<span class="noselect">$ </span>qb->getQuery();
</code></pre></div>
            
    <p>The cardinality for each node is documented in the
<a href="query-builder-reference.html">Query Builder Reference</a>, for an example see
<a href="query-builder-reference.html#qbref_node_querybuilder">Node: QueryBuilder</a>.</p>

    </div>
            <div class="section" id="aliases-and-fields">
            <h3 class="section-header ">
    <a href="#aliases-and-fields">
        Aliases and fields
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>The term &quot;alias&quot; refers to the string that is assigned to a document source,
either a <code>SourceFrom</code> or a <code>SourceJoin</code>:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->from('Blog\Post', 'post');
</code></pre></div>
            
    <p>In the example above, &quot;post&quot; is the alias. The alias is subsequently used
whenever the source is referenced. The following example show some instances
where we reference the alias:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->where()->eq()->field('post.title')->literal('foobar');
// or
<span class="noselect">$ </span>qb->where()->fieldIsset('post.username');
// or
<span class="noselect">$ </span>qb->where()->child('/blog', 'post');
</code></pre></div>
            
    <p>The term &quot;field&quot; refers to the property of an aliased document. In the first
of the above examples we reference the property <code>$post</code> on the dcoument
<code>Blog\Post</code>. Note that the alias and property name are delimited by a dot
&quot;.&quot;.</p>

    </div>
    </div>
            <div class="section" id="retrieving-a-query-builder-instance">
            <h2 class="section-header ">
    <a href="#retrieving-a-query-builder-instance">
        Retrieving a query builder instance
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>You can create instances of the query builder in one of two ways, either via
the <code>DocumentManager</code> or via a <code>DocumentRepository</code>.</p>

            <div class="section" id="via-the-document-manager">
            <h3 class="section-header ">
    <a href="#via-the-document-manager">
        Via the document manager
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>You can instantiate the <code>QueryBuilder</code> with the <code>DocumentManager</code> using the
<code>createQueryBuilder</code> method:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb = $documentManager->createQueryBuilder();
</code></pre></div>
    </div>
            <div class="section" id="via-a-document-repository">
            <h3 class="section-header ">
    <a href="#via-a-document-repository">
        Via a document repository
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>You can also instantiate a <code>QueryBuilder</code> from a <code>DocumentRepsitory</code>
instance, doing so will automatically select only those records which are
associated with the <code>DocumentRepository</code>:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>postsRepository = $dm->getRepository('Blog\Post');
<span class="noselect">$ </span>qb = $postsRepository->createQueryBuilder('p');
<span class="noselect">$ </span>posts = $qb->getQuery()->execute();
</code></pre></div>
            
    <p>The above code block will select all documents in the document tree of class
<code>Blog\Post</code>. This feature is especially useful within a document repository
class.</p>

            
    <p>Example showing the use of the query builder in a <code>DocumentRepository</code>:</p>

            <div class="console"><pre><code class="console">namespace Blog;

use Doctrine\ODM\PHPCR\DocumentRepository;

class PostRepository extends DocumentRepository
{
    public function getPostsByAuthor($authorName)
    {
        $qb = $this->createQueryBuilder('p');
        $qb->where()->eq()->field('p.author')->literal('dtl');

        return $qb->getQuery()->execute();
    }
}
</code></pre></div>
            
    <p>Note that we specify the string &quot;a&quot; as an argument to
<code>createQueryBuilder</code> - this is the alias name (analagous to &quot;alias&quot; in
Doctrine ORM terms), more on these later.</p>

    </div>
    </div>
            <div class="section" id="working-with-the-querybuilder">
            <h2 class="section-header ">
    <a href="#working-with-the-querybuilder">
        Working with the QueryBuilder
        <i class="fas fa-link"></i>
    </a>
</h2>
            <div class="section" id="specifying-the-document-source-from">
            <a id="qbref_from"></a>
            <h3 class="section-header ">
    <a href="#specifying-the-document-source-from">
        Specifying the document source - from
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>The ODM query builder requires you to specify a source from which records
should be selected. This source can either be a specified document or a
&quot;join&quot;. Joins join two sources using a given &quot;join condition&quot;.</p>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>A raw PHPCR query will allow you to select from ALL records and to hydrate
a result set of mixed document classes, the PHPCR-ODM query builder
requires however that you specify a single document source - this is because the
PHPCR query builder is not bound to the field mappings of the ODM.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            <div class="section" id="from-single-source">
            <h4 class="section-header ">
    <a href="#from-single-source">
        From Single Source
        <i class="fas fa-link"></i>
    </a>
</h4>
            <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="b2c1070f4ba49693ad913940af4dd3d637c41fa6"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="b2c1070f4ba49693ad913940af4dd3d637c41fa6"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-b2c1070f4ba49693ad913940af4dd3d637c41fa6-1" class="line-number-anchor" /><a href="#line-number-b2c1070f4ba49693ad913940af4dd3d637c41fa6-1">1</a></td><td class="code-line" rowspan="2"><span class="hljs-comment">// select documents of class Foo\Bar.</span>
$qb-&gt;from()-&gt;document(<span class="hljs-string">'Blog\Post'</span>, <span class="hljs-string">'p'</span>);</td></tr>
<tr><td class="line-number noselect"><a name="line-number-b2c1070f4ba49693ad913940af4dd3d637c41fa6-2" class="line-number-anchor" /><a href="#line-number-b2c1070f4ba49693ad913940af4dd3d637c41fa6-2">2</a></td></tr></table></div></code></pre>
            
    <p>The above example will setup the query builder to select documents only of class
<code>Blog\Post</code> using the <em>alias name</em> &quot;p&quot;. The alias name is the alias used
in subsequent references to this document source or properties within this
document.</p>

    </div>
            <div class="section" id="from-joined-source">
            <h4 class="section-header ">
    <a href="#from-joined-source">
        From Joined Source
        <i class="fas fa-link"></i>
    </a>
</h4>
            
    <p>Joins allow you to take other documents into account when selecting records.</p>

            
    <p>When selecting from multiple sources it is mandatory to specify a <em>primary
alias</em> as an argument to the <code>from</code> factory node.</p>

            
    <p>The following will retrieve a collection of <code>Blog\Post</code> documents for active users:</p>

            <div class="console"><pre><code class="console">// select documents from a join
<span class="noselect">$ </span>qb->from('p')->joinInner()
    ->left()->document('Blog\Post', 'p')->end()
    ->right()->document('Blog\User', 'u')->end()
    ->condition()->equi('p.username', 'u.username');

<span class="noselect">$ </span>qb->where()
    ->eq()->field('u.status')->literal('active');

<span class="noselect">$ </span>posts = $qb->getQuery()->execute();
</code></pre></div>
            
    <p>Using the document source <code>p</code> as the primary document source we select from
a <code>joinInner</code> source, with <code>Blog\Post</code> documents on the left (alias <code>p</code>)
and <code>Blog\User</code> documents on the right (alias <code>u</code>) we join the left and
right sources using an <code>equi</code> (equality) join on the <code>username</code> columns.</p>

            
    <p>We then specify that only blog posts which have associated users with the
status &quot;active&quot; are selected.</p>

    </div>
            <div class="section" id="joining-with-an-association">
            <h4 class="section-header ">
    <a href="#joining-with-an-association">
        Joining with an Association
        <i class="fas fa-link"></i>
    </a>
</h4>
            
    <p>The following is another example which joins on an <em>association</em>.  The
<code>CmsUser</code> class is associated with a single address:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->fromDocument('Doctrine\Tests\Models\CMS\CmsUser', 'u');
    ->addJoinInner()
    ->right()->document('Doctrine\Tests\Models\CMS\CmsAddress', 'a')->end()
    ->condition()->equi('u.address', 'a.uuid');
    ->where()->eq()->field('a.city')->literal('Lyon');
<span class="noselect">$ </span>users = $qb->getQuery()->execute();
</code></pre></div>
            
    <p>This query selects all <code>CmsUser</code> documents which have an associated address
where the <code>city</code> field has a value of <code>Lyon</code>.</p>

            
    <p>For detailed information see <a href="query-builder-reference.html#qbref_method_querybuilder_from">the query builder reference</a>.</p>

    </div>
    </div>
            <div class="section" id="selecting-specific-properties-select">
            <a id="qbref_select"></a>
            <h3 class="section-header ">
    <a href="#selecting-specific-properties-select">
        Selecting specific properties - select
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>You can specify fields to populate with values using the <code>select</code> factory
node, this is currently only useful when <a href="query.html#queryref_hydration">hydrating to PHPCR nodes</a>. The default (object) hydration will <em>always</em> hydrate
all fields regardless of what you specify:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->from('Demo\User', 'u');
<span class="noselect">$ </span>qb->select()
  ->field('u.firstname')
  ->field('u.lastname');

<span class="noselect">$ </span>query = $qb->getQuery();

// field selection only used when hydrating to nodes
<span class="noselect">$ </span>node = $query->getSingleResult(Query::HYDRATE_PHPCR);
<span class="noselect">$ </span>node->getProperty('firstname');
</code></pre></div>
    </div>
            <div class="section" id="limiting-the-number-of-results">
            <a id="qbref_limiting"></a>
            <h3 class="section-header ">
    <a href="#limiting-the-number-of-results">
        Limiting the number of results
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>You can specify a maximum number of results and the index of the first result
(the offset):</p>

            <div class="console"><pre><code class="console">// select a maximum of 10 records.
<span class="noselect">$ </span>qb->from()->document('User')
   ->setMaxResults(10);

// select a maximum of 10 records from the position of the 20th record.
<span class="noselect">$ </span>qb->from()->document('User')
   ->setMaxResults(10)
   ->setFirstResult(20);
</code></pre></div>
    </div>
            <div class="section" id="specifying-selection-criteria">
            <a id="qbref_where"></a>
            <h3 class="section-header ">
    <a href="#specifying-selection-criteria">
        Specifying selection criteria
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>You can specify selection criteria using the <code>where</code> factory node:</p>

            <div class="console"><pre><code class="console">// setup our document source with alias "u"
<span class="noselect">$ </span>qb->from('Blog\User', 'u');

// where name is "daniel"
<span class="noselect">$ </span>qb->where()
  ->eq()->field('u.name')->literal('daniel');

// where username is "dtl" AND name is "daniel"
<span class="noselect">$ </span>qb->where()->eq()->field('u.username')->literal('dtl');
<span class="noselect">$ </span>qb->andWhere()->eq()->field('u.name')->literal('daniel');

// which is equivalent to
<span class="noselect">$ </span>qb->where()->andX()
  ->eq()->field('u.username')->literal('dtl')->end()
  ->eq()->field('u.name')->literal('daniel');

// where username is "dtl" OR name is "daniel"
<span class="noselect">$ </span>qb->where()->eq()->field('u.username')->literal('dtl');
<span class="noselect">$ </span>qb->orWhere()->eq()->field('u.name')->literal('daniel');

// which is equivalent to
<span class="noselect">$ </span>qb->where()->orX()
  ->eq()->field('u.username')->literal('dtl')->end()
  ->eq()->field('u.name')->literal('daniel');

// where the lowercase value of node name is equal to dtl
<span class="noselect">$ </span>qb->where()
    ->eq()
        ->lowercase()->localName('a')->end()
        ->literal('dtl');

// where the lowercase value of node name is NOT equal to dtl
<span class="noselect">$ </span>qb->where()
    ->eq()
        ->lowercase()->localName('a')->end()
        ->literal('dtl');
</code></pre></div>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>If your code builds a query from distributed places, it is perfectly legal
to only use <code>andWhere</code> / <code>orWhere</code> without a first <code>where</code>.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="ordering-results">
            <a id="qbref_ordering"></a>
            <h3 class="section-header ">
    <a href="#ordering-results">
        Ordering results
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>You can specify the property or properties by which to order the queries
results with the <code>orderBy</code> factory node. You can specify additional
orderings with <code>addOrderBy</code>.</p>

            
    <p>Add a single ordering:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->orderBy()
  ->asc()->field('u.username'); // username asc
</code></pre></div>
            
    <p>Descending:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->orderBy()
  ->desc()->field('u.username');
</code></pre></div>
            
    <p>Add three orderings - equivilent to the SQL <code>ORDER BY username ASC, name ASC, website DESC</code>:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->orderBy()
  ->asc()->field('u.username')->end()
  ->asc()->field('u.name')->end()
  ->desc()->field('u.website');
</code></pre></div>
            
    <p>Adding multiple orderings using <code>addOrderBy</code>:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb->orderBy()->asc()->field('u.username');
<span class="noselect">$ </span>qb->addOrderBy()->asc()->field('u.name');
</code></pre></div>
    </div>
            <div class="section" id="querying-translated-documents">
            <a id="qb-translation"></a>
            <h3 class="section-header ">
    <a href="#querying-translated-documents">
        Querying translated documents
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>If your documents contain <a href="multilang.html">translated fields</a>, the
query builder automatically handles them both for <code>where</code> and <code>orderBy</code>
when using the annotation or child translation strategy.</p>

            
    <p>It will use the &quot;current&quot; locale according to the LocaleChooser. If you want
to query in a different locale, you can also specify the locale explicitly:</p>

            <div class="console"><pre><code class="console"><span class="noselect">$ </span>qb = $dm->createQueryBuilder();
<span class="noselect">$ </span>qb
    ->setLocale('fr')
    ->from()
        ->document('Demo\Document', 'd')
    ->end()
    ->where()->fieldIsset('d.title')->end()
    ->orderBy()
        ->asc()->field('d.title')->end()
    ->end();
</code></pre></div>
    </div>
    </div>
            <div class="section" id="additional-notes">
            <h2 class="section-header ">
    <a href="#additional-notes">
        Additional notes
        <i class="fas fa-link"></i>
    </a>
</h2>
            <div class="section" id="querying-multivalue-fields">
            <h3 class="section-header ">
    <a href="#querying-multivalue-fields">
        Querying multivalue fields
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Multivalue fields can be queried using either <code>eq()</code> or <code>like()</code> in the same
way as you would for a single value field:</p>

            <div class="console"><pre><code class="console">// Find all posts which have a tag "general"
<span class="noselect">$ </span>qb->where()->eq()->field('p.tags')->literal('general');

// Find all posts which have a tag containing the string "foo"
<span class="noselect">$ </span>qb->where()->like()->field('p.tags')->literal('%foo%');
</code></pre></div>
    </div>
            <div class="section" id="using-the-query-builder-in-tests">
            <h3 class="section-header ">
    <a href="#using-the-query-builder-in-tests">
        Using the Query Builder in Tests
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Mocking the query builder in a unit test is not easy - it requires that you
mock the node classes and setup the methods to return the correct node classes
at the correct time. In short, we recommend that you use the real query
builder class and a special companion class, the <code>QueryBuilderTester</code>.</p>

            
    <p>The <code>QueryBuilderTester</code> provides a couple of methods:</p>

            

<ul>
    <li><strong>getNode</strong>: Retrieve a node from the query builder by its &quot;node type&quot; path.</li>
    <li><strong>dumpNodePaths</strong>: Dump all the &quot;node type&quot; paths in the query builder
instance.</li>
</ul>

            <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="5061dc82f976688c086d846b5861754ef58c5720"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="5061dc82f976688c086d846b5861754ef58c5720"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-1" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-1">1</a></td><td class="code-line" rowspan="26"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">Query</span>\<span class="hljs-title">Builder</span>\<span class="hljs-title">QueryBuilder</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">Tools</span>\<span class="hljs-title">Test</span>\<span class="hljs-title">QueryBuilderTester</span>;

$test = <span class="hljs-comment">// pretend we have a PHPUnit_Framework_TestCase</span>
$qb = <span class="hljs-keyword">new</span> QueryBuilder;
$qb-&gt;where()-&gt;eq()-&gt;field(<span class="hljs-string">'p.title'</span>)-&gt;literal(<span class="hljs-string">'Foobar'</span>);

$qbTester = <span class="hljs-keyword">new</span> QueryBuilderTester($qb);

<span class="hljs-comment">// -&gt;getNode - retrieve node by its nodetype path.</span>
$literalNode = $qbTester-&gt;getNode(<span class="hljs-string">'where.constraint.operand_statuc'</span>);
$fieldNode = $qbTester-&gt;getNode(<span class="hljs-string">'where.constraint.operand_dynamic'</span>);

$test-&gt;assertEquals(<span class="hljs-string">'Foobar'</span>, $literalNode-&gt;getValue());
$test-&gt;assertEquals(<span class="hljs-string">'p'</span>, $fieldNode-&gt;getSelectorName());
$test-&gt;assertEquals(<span class="hljs-string">'title'</span>, $fieldNode-&gt;getPropertyName());

$qb-&gt;where()-&gt;andX()
    -&gt;eq()-&gt;field(<span class="hljs-string">'p.title'</span>)-&gt;literal(<span class="hljs-string">'Foobar'</span>)-&gt;end()
    -&gt;fieldIsset(<span class="hljs-string">'p.username'</span>);

<span class="hljs-comment">// first constraint is the "andX", the second constraint node of "andX" is "fieldIsset"</span>
$fieldIsset = $qbTester-&gt;getNode(<span class="hljs-string">'where.constraint.constraint[1]'</span>);

<span class="hljs-comment">// -&gt;dumpNodePaths - dump all the node paths of the query builder</span>
$res = $qbTester-&gt;dumpNodePaths();</td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-2" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-3" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-4" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-5" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-6" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-7" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-8" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-9" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-10" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-11" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-12" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-13" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-14" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-15" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-16" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-16">16</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-17" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-17">17</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-18" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-18">18</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-19" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-19">19</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-20" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-20">20</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-21" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-21">21</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-22" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-22">22</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-23" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-23">23</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-24" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-24">24</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-25" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-25">25</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-5061dc82f976688c086d846b5861754ef58c5720-26" class="line-number-anchor" /><a href="#line-number-5061dc82f976688c086d846b5861754ef58c5720-26">26</a></td></tr></table></div></code></pre>
    </div>
    </div>
    </div>
        

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?1546fc"
                            integrity="sha384-ix9eb2EZyp9uayYpxmCQoylbz8msHl5wOg/aqZnD/3cxszNUGePN656MRg5GEgbm"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'phpcr-odm';
            var versionSlug = '1.7';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search PHPCR ODM 1.7'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            </body>
</html>
