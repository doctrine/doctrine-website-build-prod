<!DOCTYPE html>
<html>
    <head>
        <title>        Middlewares - Doctrine Doctrine Bundle (DoctrineBundle)
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine Doctrine Bundle Documentation: Middlewares ">

        <meta name="keywords" content="                    DBAL,ORM,Database,Persistence,documentation,middlewares
    ">

                    <meta name="robots" content="index, follow">
        
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine-bundle/en/3.2/middlewares.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?209f12"
                        integrity="sha384-VMcQOaUBPJYirNpZMqv0kKw80RSt4Uye4T1Li/d7kiKYAfj1WSzYOgP2OTdON/HM"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine-bundle/en/2.18/middlewares.html" />
        <meta property="og:title" content="        Middlewares - Doctrine Doctrine Bundle (DoctrineBundle)
    " />
        <meta property="og:description" content="Doctrine Doctrine Bundle Documentation: Middlewares " />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine Doctrine Bundle",
            "description": "Middlewares",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/DoctrineBundle/edit/2.18.x/docs/en/middlewares.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        

            <div class="toc">
    <ul class="menu-level">
    <li class="toc-item">
    <a href="configuration.html#configuration-reference">Configuration Reference</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="configuration.html#configuration-overview">Configuration Overview</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="configuration.html#oracle-db">Oracle DB</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#caching-drivers">Caching Drivers</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#mapping-configuration">Mapping Configuration</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#filters-configuration">Filters Configuration</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#autowiring-multiple-entity-managers">Autowiring multiple Entity Managers</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="configuration.html#doctrine-dbal-configuration">Doctrine DBAL Configuration</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="configuration.html#autowiring-multiple-connections">Autowiring multiple Connections</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="custom-id-generators.html#custom-id-generators">Custom ID Generators</a>


</li>
    <li class="toc-item">
    <a href="doctrine-console.html#doctrine-console">Doctrine Console</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="doctrine-console.html#command-name-mapping">Command Name Mapping</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="entity-listeners.html#entity-listeners">Entity Listeners</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="entity-listeners.html#lazy-entity-listeners">Lazy Entity Listeners</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="event-listeners.html#event-listeners">Event Listeners</a>


</li>
    <li class="toc-item">
    <a href="installation.html#installation">Installation</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="installation.html#step-1-download-the-bundle">Step 1: Download the Bundle</a>


</li>
            <li class="toc-item">
    <a href="installation.html#step-2-enable-the-bundle">Step 2: Enable the Bundle</a>


</li>
                    </ul>
</li>
    <li class="toc-item opened">
    <a href="#middlewares">Middlewares</a>


</li>
    </ul>
</div>
    

                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://www.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "DoctrineBundle",
            "item": "https://www.doctrine-project.org/projects/doctrine-bundle.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://www.doctrine-project.org/projects/doctrine-bundle/en/2.18/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "Middlewares",
            "item": "https://www.doctrine-project.org/projects/doctrine-bundle/en/2.18/middlewares.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-bundle.html">DoctrineBundle</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-bundle/en/2.18/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">Middlewares</li>
                        </ol>
</nav>
                                    </div>

                

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine-bundle/en/2.18/middlewares.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        2.18.2
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-bundle/en/latest/middlewares.html">
                                                        4.0

                                                        
                                                                                                                    (upcoming)
                                                                                                            </a>
                                                                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-bundle/en/3.3/middlewares.html">
                                                        3.3

                                                        
                                                                                                                    (upcoming)
                                                                                                            </a>
                                                                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-bundle/en/3.2/middlewares.html">
                                                        3.2.1

                                                                                                                    (current)
                                                        
                                                                                                            </a>
                                                                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-bundle/en/2.19/middlewares.html">
                                                        2.19

                                                        
                                                                                                            </a>
                                                                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item active" href="/projects/doctrine-bundle/en/2.18/middlewares.html">
                                                        2.18.2

                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-bundle/en/3.1/middlewares.html">3.1</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-bundle/en/3.0/middlewares.html">3.0</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-bundle/en/2.16/middlewares.html">2.16</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-bundle/en/2.15/middlewares.html">2.15</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-bundle/en/2.14/middlewares.html">2.14</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-bundle/en/2.13/middlewares.html">2.13</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-bundle/en/2.12/middlewares.html">2.12</a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                </div>
                            
                            

            <div class="section" id="middlewares">
            <h1 class="section-header ">
    <a href="#middlewares">
        Middlewares
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p>Doctrine DBAL supports middlewares. According to the <a href="https://www.doctrine-project.org/projects/doctrine-dbal/en/current/reference/architecture.html#middlewares">DBAL documentation</a>:</p>

            <blockquote>
    <p>&quot;A middleware sits in the middle between the wrapper components and the driver&quot;</p>
</blockquote>
            
    <p>They allow to decorate the following DBAL classes:</p>

            

<ul>
    <li class="dash"><code>Doctrine\DBAL\Driver</code></li>
    <li class="dash"><code>Doctrine\DBAL\Driver\Connection</code></li>
    <li class="dash"><code>Doctrine\DBAL\Driver\Statement</code></li>
    <li class="dash"><code>Doctrine\DBAL\Driver\Result</code></li>
</ul>

            
    <p>Symfony, for instance, uses a middleware to harvest the queries executed
by the current page and make them available in the profiler.</p>

            
    <p>You can also create your own middleware. This is an example of a (very)
simple middleware that prevents database connections with the root user.
The first step is to create the middleware:</p>

                <pre class="code-block-table" id="ee51ebea66011dc508d33cc9c400bcb94d8fc7a2"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="ee51ebea66011dc508d33cc9c400bcb94d8fc7a2"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Middleware</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">Driver</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">Driver</span>\<span class="hljs-title">Middleware</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PreventRootConnectionMiddleware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Middleware</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrap</span><span class="hljs-params">(Driver $driver)</span>: <span class="hljs-title">Driver</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PreventRootConnectionDriver($driver);</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="empty"></code></pre>
            
    <p>As you can see in the <code>wrap</code> method, the principle of a middleware is
to decorate Doctrine objects with your own objects bearing the logic you
need. Now, the <code>connect</code> method of the driver must be decorated in
<code>PreventRootConnectionDriver</code> to prevent connections with the root user:</p>

                <pre class="code-block-table" id="afc9d4af55a61451136d3805805b68830d1a348a"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="afc9d4af55a61451136d3805805b68830d1a348a"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Middleware</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">Driver</span>\<span class="hljs-title">Connection</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">Driver</span>\<span class="hljs-title">Middleware</span>\<span class="hljs-title">AbstractDriverMiddleware</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">SensitiveParameter</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PreventRootConnectionDriver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractDriverMiddleware</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span><span class="hljs-params">(array $params)</span>: <span class="hljs-title">Connection</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($params[<span class="hljs-string">'user'</span>]) &amp;&amp; $params[<span class="hljs-string">'user'</span>] === <span class="hljs-string">'root'</span>) {</code><code class="line language-php">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> \LogicException(<span class="hljs-string">'Connecting to the database with the root user is not allowed.'</span>);</code><code class="line language-php">        }</code><code class="line language-php"></code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">parent</span>::connect($params);</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="empty"></code></pre>
            
    <p>That&#039;s all! Connection with the root user is not possible anymore. Note
that <code>connect</code> is not the only method you can decorate in a <code>Connection</code>.
But thanks to the <code>AbstractDriverMiddleware</code> default implementation,
you only need to decorate the methods for which you want to add some logic.
Too see a more advanced example with a decoration of the <code>Statement</code> class,
you can look at the middleware implementation starting in the class
<code>Symfony\Bridge\Doctrine\Middleware\Debug\Middleware</code> of the
Doctrine Bridge. Decorating the <code>Result</code> class follows the same principle.</p>

            
    <p>The middleware we&#039;ve just created applies by default to all the connections.
If your application has several dbal connections, you can limit the middleware
scope to a subset of connections thanks to the <code>AsMiddleware</code> PHP attribute.
Let&#039;s limit our middleware to a connection named <code>legacy</code>:</p>

                <pre class="code-block-table" id="479ad225f3334171fd7950d94dc28e5e7d7b26e9"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="479ad225f3334171fd7950d94dc28e5e7d7b26e9"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Middleware</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">DoctrineBundle</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AsMiddleware</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">Driver</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">Driver</span>\<span class="hljs-title">Middleware</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[AsMiddleware(connections: ['legacy'])]</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PreventRootConnectionMiddleware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Middleware</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrap</span><span class="hljs-params">(Driver $driver)</span>: <span class="hljs-title">Driver</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PreventRootConnectionDriver($driver);</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="empty"></code></pre>
            
    <p>If you register multiple middlewares in your application, they will be executed
in the order they were registered. If some middleware needs to be executed
before another, you can set priority through the <code>AsMiddleware</code> PHP attribute.
This priority can be any integer, positive or negative. The higher the priority,
the earlier the middleware is executed. If no priority is defined, the priority
is considered 0. Let&#039;s make sure our middleware is the first middleware
executed, so that we don&#039;t set up debugging or logging if the connection will
be prevented:</p>

                <pre class="code-block-table" id="2258e8a9735af71fdf093f9dc7108027e988b236"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="2258e8a9735af71fdf093f9dc7108027e988b236"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Middleware</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">Bundle</span>\<span class="hljs-title">DoctrineBundle</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AsMiddleware</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">Driver</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">DBAL</span>\<span class="hljs-title">Driver</span>\<span class="hljs-title">Middleware</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[AsMiddleware(priority: 10)]</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PreventRootConnectionMiddleware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Middleware</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrap</span><span class="hljs-params">(Driver $driver)</span>: <span class="hljs-title">Driver</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PreventRootConnectionDriver($driver);</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="empty"></code></pre>
            
    <p><code>priority</code> and <code>connections</code> can be used together to restrict a middleware
to a specific connection while changing its priority.</p>

            
    <p>All the examples presented above assume <code>autoconfigure</code> is enabled.
If <code>autoconfigure</code> is disabled, the <code>doctrine.middleware</code> tag must be
added to the middleware. This tag supports a <code>connections</code> attribute to
limit the scope of the middleware and a <code>priority</code> attribute to change
the execution order of the registered middlewares.</p>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>Middlewares have been introduced in version 3.2 of <code>doctrine/dbal</code>
and at least the 2.6 version of <code>doctrine/doctrine-bundle</code> is needed
to integrate them in Symfony as shown above.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
        

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?4a831b"
                            integrity="sha384-ygNM6vWkqMgvV0Lrk5BeKUupSk4CidmuzVPL3OkdAxEVjZQDo9cgbfC+FXAfoAse"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'doctrine-bundle';
            var versionSlug = '2.18';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search DoctrineBundle 2.18'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            </body>
</html>
