<!DOCTYPE html>
<html>
    <head>
        <title>        Transactions - Doctrine Database Abstraction Layer (DBAL)
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine Database Abstraction Layer Documentation: Transactions ">

        <meta name="keywords" content="                    abstraction,database,dbal,db2,mariadb,mssql,mysql,pgsql,postgresql,oci8,oracle,pdo,queryobject,sasql,sql,sqlite,sqlserver,sqlsrv,documentation,transactions
    ">

                    <meta name="robots" content="index, follow">
        
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine-dbal/en/3.7/reference/transactions.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?308422"
                        integrity="sha384-relijT69FrdKSxbt8Zw0zE3pLqZ40KhdyFThxoi9+GPIiWS1dvN1iq9AO5Z8bak4"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine-dbal/en/3.8/reference/transactions.html" />
        <meta property="og:title" content="        Transactions - Doctrine Database Abstraction Layer (DBAL)
    " />
        <meta property="og:description" content="Doctrine Database Abstraction Layer Documentation: Transactions " />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine Database Abstraction Layer",
            "description": "Transactions",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                    <a class="dropdown-item" href="/projects/skeleton-mapper.html">Skeleton Mapper</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/team/maintainers.html">Maintainers</a>
                                <a class="dropdown-item" href="/team/contributors.html">Contributors</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/dbal/edit/3.8.x/docs/en/reference/transactions.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        <div class="toc-section"><h2 class="toc-header">Reference</h2>
<div class="toc"><ul><li id="introduction-html" class="toc-item"><a href="introduction.html">Introduction</a></li><li id="architecture-html" class="toc-item"><a href="architecture.html">Architecture</a><ul><li id="architecture-html-drivers" class="toc-item"><a href="architecture.html#drivers">Drivers</a></li><li id="architecture-html-middlewares" class="toc-item"><a href="architecture.html#middlewares">Middlewares</a></li><li id="architecture-html-platforms" class="toc-item"><a href="architecture.html#platforms">Platforms</a></li><li id="architecture-html-logging" class="toc-item"><a href="architecture.html#logging">Logging</a></li><li id="architecture-html-schema" class="toc-item"><a href="architecture.html#schema">Schema</a></li><li id="architecture-html-types" class="toc-item"><a href="architecture.html#types">Types</a></li></ul></li><li id="configuration-html" class="toc-item"><a href="configuration.html">Configuration</a><ul><li id="configuration-html-getting-a-connection" class="toc-item"><a href="configuration.html#getting-a-connection">Getting a Connection</a><ul><li id="configuration-html-connecting-using-a-url" class="toc-item"><a href="configuration.html#connecting-using-a-url">Connecting using a URL</a></li><li id="configuration-html-driver" class="toc-item"><a href="configuration.html#driver">Driver</a></li><li id="configuration-html-wrapper-class" class="toc-item"><a href="configuration.html#wrapper-class">Wrapper Class</a></li><li id="configuration-html-connection-details" class="toc-item"><a href="configuration.html#connection-details">Connection Details</a></li><li id="configuration-html-automatic-platform-version-detection" class="toc-item"><a href="configuration.html#automatic-platform-version-detection">Automatic platform version detection</a></li><li id="configuration-html-custom-driver-options" class="toc-item"><a href="configuration.html#custom-driver-options">Custom Driver Options</a></li></ul></li></ul></li><li id="data-retrieval-and-manipulation-html" class="toc-item"><a href="data-retrieval-and-manipulation.html">Data Retrieval And Manipulation</a><ul><li id="data-retrieval-and-manipulation-html-data-retrieval" class="toc-item"><a href="data-retrieval-and-manipulation.html#data-retrieval">Data Retrieval</a><ul><li id="data-retrieval-and-manipulation-html-dynamic-parameters-and-prepared-statements" class="toc-item"><a href="data-retrieval-and-manipulation.html#dynamic-parameters-and-prepared-statements">Dynamic Parameters and Prepared Statements</a></li><li id="data-retrieval-and-manipulation-html-using-prepared-statements" class="toc-item"><a href="data-retrieval-and-manipulation.html#using-prepared-statements">Using Prepared Statements</a></li></ul></li><li id="data-retrieval-and-manipulation-html-binding-types" class="toc-item"><a href="data-retrieval-and-manipulation.html#binding-types">Binding Types</a><ul><li id="data-retrieval-and-manipulation-html-doctrinedbaltypes-conversion" class="toc-item"><a href="data-retrieval-and-manipulation.html#doctrinedbaltypes-conversion">DoctrineDBALTypes Conversion</a></li><li id="data-retrieval-and-manipulation-html-list-of-parameters-conversion" class="toc-item"><a href="data-retrieval-and-manipulation.html#list-of-parameters-conversion">List of Parameters Conversion</a></li></ul></li><li id="data-retrieval-and-manipulation-html-api" class="toc-item"><a href="data-retrieval-and-manipulation.html#api">API</a><ul><li id="data-retrieval-and-manipulation-html-prepare" class="toc-item"><a href="data-retrieval-and-manipulation.html#prepare">prepare()</a></li><li id="data-retrieval-and-manipulation-html-executestatement" class="toc-item"><a href="data-retrieval-and-manipulation.html#executestatement">executeStatement()</a></li><li id="data-retrieval-and-manipulation-html-executequery" class="toc-item"><a href="data-retrieval-and-manipulation.html#executequery">executeQuery()</a></li><li id="data-retrieval-and-manipulation-html-fetchallassociative" class="toc-item"><a href="data-retrieval-and-manipulation.html#fetchallassociative">fetchAllAssociative()</a></li><li id="data-retrieval-and-manipulation-html-fetchallkeyvalue" class="toc-item"><a href="data-retrieval-and-manipulation.html#fetchallkeyvalue">fetchAllKeyValue()</a></li><li id="data-retrieval-and-manipulation-html-fetchallassociativeindexed" class="toc-item"><a href="data-retrieval-and-manipulation.html#fetchallassociativeindexed">fetchAllAssociativeIndexed()</a></li><li id="data-retrieval-and-manipulation-html-fetchnumeric" class="toc-item"><a href="data-retrieval-and-manipulation.html#fetchnumeric">fetchNumeric()</a></li><li id="data-retrieval-and-manipulation-html-fetchone" class="toc-item"><a href="data-retrieval-and-manipulation.html#fetchone">fetchOne()</a></li><li id="data-retrieval-and-manipulation-html-fetchassociative" class="toc-item"><a href="data-retrieval-and-manipulation.html#fetchassociative">fetchAssociative()</a></li><li id="data-retrieval-and-manipulation-html-iteratekeyvalue" class="toc-item"><a href="data-retrieval-and-manipulation.html#iteratekeyvalue">iterateKeyValue()</a></li><li id="data-retrieval-and-manipulation-html-iterateassociativeindexed" class="toc-item"><a href="data-retrieval-and-manipulation.html#iterateassociativeindexed">iterateAssociativeIndexed()</a></li><li id="data-retrieval-and-manipulation-html-delete" class="toc-item"><a href="data-retrieval-and-manipulation.html#delete">delete()</a></li><li id="data-retrieval-and-manipulation-html-insert" class="toc-item"><a href="data-retrieval-and-manipulation.html#insert">insert()</a></li><li id="data-retrieval-and-manipulation-html-update" class="toc-item"><a href="data-retrieval-and-manipulation.html#update">update()</a></li></ul></li></ul></li><li id="query-builder-html" class="toc-item"><a href="query-builder.html">SQL Query Builder</a><ul><li id="query-builder-html-security-safely-preventing-sql-injection" class="toc-item"><a href="query-builder.html#security-safely-preventing-sql-injection">Security: Safely preventing SQL Injection</a></li><li id="query-builder-html-building-a-query" class="toc-item"><a href="query-builder.html#building-a-query">Building a Query</a><ul><li id="query-builder-html-distinct-clause" class="toc-item"><a href="query-builder.html#distinct-clause">DISTINCT-Clause</a></li><li id="query-builder-html-where-clause" class="toc-item"><a href="query-builder.html#where-clause">WHERE-Clause</a></li><li id="query-builder-html-table-alias" class="toc-item"><a href="query-builder.html#table-alias">Table alias</a></li><li id="query-builder-html-group-by-and-having-clause" class="toc-item"><a href="query-builder.html#group-by-and-having-clause">GROUP BY and HAVING Clause</a></li><li id="query-builder-html-join-clauses" class="toc-item"><a href="query-builder.html#join-clauses">Join Clauses</a></li><li id="query-builder-html-order-by-clause" class="toc-item"><a href="query-builder.html#order-by-clause">Order-By Clause</a></li><li id="query-builder-html-limit-clause" class="toc-item"><a href="query-builder.html#limit-clause">Limit Clause</a></li><li id="query-builder-html-values-clause" class="toc-item"><a href="query-builder.html#values-clause">VALUES Clause</a></li><li id="query-builder-html-set-clause" class="toc-item"><a href="query-builder.html#set-clause">Set Clause</a></li></ul></li><li id="query-builder-html-building-expressions" class="toc-item"><a href="query-builder.html#building-expressions">Building Expressions</a></li><li id="query-builder-html-binding-parameters-to-placeholders" class="toc-item"><a href="query-builder.html#binding-parameters-to-placeholders">Binding Parameters to Placeholders</a></li><li id="query-builder-html-caching" class="toc-item"><a href="query-builder.html#caching">Caching</a></li></ul></li><li id="transactions-html-transactions" class="toc-item"><a href="transactions.html#transactions">Transactions</a><ul><li id="transactions-html-transaction-nesting" class="toc-item"><a href="transactions.html#transaction-nesting">Transaction Nesting</a><ul><li id="transactions-html-dummy-mode" class="toc-item"><a href="transactions.html#dummy-mode">Dummy mode</a></li><li id="transactions-html-emulated-transaction-nesting-with-savepoints" class="toc-item"><a href="transactions.html#emulated-transaction-nesting-with-savepoints">Emulated Transaction Nesting with Savepoints</a></li></ul></li><li id="transactions-html-auto-commit-mode" class="toc-item"><a href="transactions.html#auto-commit-mode">Auto-commit mode</a></li><li id="transactions-html-error-handling" class="toc-item"><a href="transactions.html#error-handling">Error handling</a></li></ul></li><li id="platforms-html" class="toc-item"><a href="platforms.html">Platforms</a><ul><li id="platforms-html-mysql" class="toc-item"><a href="platforms.html#mysql">MySQL</a></li><li id="platforms-html-mariadb" class="toc-item"><a href="platforms.html#mariadb">MariaDB</a></li><li id="platforms-html-oracle" class="toc-item"><a href="platforms.html#oracle">Oracle</a></li><li id="platforms-html-microsoft-sql-server" class="toc-item"><a href="platforms.html#microsoft-sql-server">Microsoft SQL Server</a></li><li id="platforms-html-postgresql" class="toc-item"><a href="platforms.html#postgresql">PostgreSQL</a></li><li id="platforms-html-ibm-db2" class="toc-item"><a href="platforms.html#ibm-db2">IBM DB2</a></li><li id="platforms-html-sqlite" class="toc-item"><a href="platforms.html#sqlite">SQLite</a></li></ul></li><li id="types-html" class="toc-item"><a href="types.html">Types</a><ul><li id="types-html-reference" class="toc-item"><a href="types.html#reference">Reference</a><ul><li id="types-html-numeric-types" class="toc-item"><a href="types.html#numeric-types">Numeric types</a></li><li id="types-html-string-types" class="toc-item"><a href="types.html#string-types">String types</a></li><li id="types-html-bit-types" class="toc-item"><a href="types.html#bit-types">Bit types</a></li><li id="types-html-date-and-time-types" class="toc-item"><a href="types.html#date-and-time-types">Date and time types</a></li><li id="types-html-array-types" class="toc-item"><a href="types.html#array-types">Array types</a></li><li id="types-html-object-types" class="toc-item"><a href="types.html#object-types">Object types</a></li></ul></li><li id="types-html-mapping-matrix" class="toc-item"><a href="types.html#mapping-matrix">Mapping Matrix</a></li><li id="types-html-detection-of-database-types" class="toc-item"><a href="types.html#detection-of-database-types">Detection of Database Types</a></li><li id="types-html-custom-mapping-types" class="toc-item"><a href="types.html#custom-mapping-types">Custom Mapping Types</a></li></ul></li><li id="schema-manager-html" class="toc-item"><a href="schema-manager.html">Schema-Manager</a><ul><li id="schema-manager-html-listdatabases" class="toc-item"><a href="schema-manager.html#listdatabases">listDatabases()</a></li><li id="schema-manager-html-listsequences" class="toc-item"><a href="schema-manager.html#listsequences">listSequences()</a></li><li id="schema-manager-html-listtablecolumns" class="toc-item"><a href="schema-manager.html#listtablecolumns">listTableColumns()</a></li><li id="schema-manager-html-introspecttable" class="toc-item"><a href="schema-manager.html#introspecttable">introspectTable()</a></li><li id="schema-manager-html-listtableforeignkeys" class="toc-item"><a href="schema-manager.html#listtableforeignkeys">listTableForeignKeys()</a></li><li id="schema-manager-html-listtableindexes" class="toc-item"><a href="schema-manager.html#listtableindexes">listTableIndexes()</a></li><li id="schema-manager-html-listtables" class="toc-item"><a href="schema-manager.html#listtables">listTables()</a></li><li id="schema-manager-html-listviews" class="toc-item"><a href="schema-manager.html#listviews">listViews()</a></li><li id="schema-manager-html-introspectschema" class="toc-item"><a href="schema-manager.html#introspectschema">introspectSchema()</a></li><li id="schema-manager-html-overriding-the-schema-manager" class="toc-item"><a href="schema-manager.html#overriding-the-schema-manager">Overriding the schema manager</a></li></ul></li><li id="schema-representation-html" class="toc-item"><a href="schema-representation.html">Schema-Representation</a><ul><li id="schema-representation-html-schema-assets" class="toc-item"><a href="schema-representation.html#schema-assets">Schema Assets</a><ul><li id="schema-representation-html-table" class="toc-item"><a href="schema-representation.html#table">Table</a></li><li id="schema-representation-html-column" class="toc-item"><a href="schema-representation.html#column">Column</a></li></ul></li></ul></li><li id="security-html" class="toc-item"><a href="security.html">Security</a><ul><li id="security-html-sql-injection-safe-and-unsafe-apis-for-user-input" class="toc-item"><a href="security.html#sql-injection-safe-and-unsafe-apis-for-user-input">SQL Injection: Safe and Unsafe APIs for User Input</a></li><li id="security-html-user-input-in-your-queries" class="toc-item"><a href="security.html#user-input-in-your-queries">User input in your queries</a><ul><li id="security-html-wrong-string-concatenation" class="toc-item"><a href="security.html#wrong-string-concatenation">Wrong: String Concatenation</a></li><li id="security-html-right-prepared-statements" class="toc-item"><a href="security.html#right-prepared-statements">Right: Prepared Statements</a></li><li id="security-html-discouraged-quoting-escaping-values" class="toc-item"><a href="security.html#discouraged-quoting-escaping-values">Discouraged: Quoting/Escaping values</a></li></ul></li></ul></li><li id="supporting-other-databases-html" class="toc-item"><a href="supporting-other-databases.html">Supporting Other Databases</a><ul><li id="supporting-other-databases-html-implementation-steps-in-detail" class="toc-item"><a href="supporting-other-databases.html#implementation-steps-in-detail">Implementation Steps in Detail</a></li></ul></li><li id="portability-html" class="toc-item"><a href="portability.html">Portability</a><ul><li id="portability-html-connection-wrapper" class="toc-item"><a href="portability.html#connection-wrapper">Connection Wrapper</a></li><li id="portability-html-database-platform" class="toc-item"><a href="portability.html#database-platform">Database Platform</a></li><li id="portability-html-keyword-lists" class="toc-item"><a href="portability.html#keyword-lists">Keyword Lists</a></li></ul></li><li id="caching-html" class="toc-item"><a href="caching.html">Caching</a><ul><li id="caching-html-configuring-the-result-cache" class="toc-item"><a href="caching.html#configuring-the-result-cache">Configuring the result cache</a></li><li id="caching-html-providing-a-cache-profile" class="toc-item"><a href="caching.html#providing-a-cache-profile">Providing a cache profile</a></li></ul></li><li id="known-vendor-issues-html" class="toc-item"><a href="known-vendor-issues.html">Known Vendor Issues</a><ul><li id="known-vendor-issues-html-postgresql" class="toc-item"><a href="known-vendor-issues.html#postgresql">PostgreSQL</a><ul><li id="known-vendor-issues-html-datetime-datetimetz-and-time-types" class="toc-item"><a href="known-vendor-issues.html#datetime-datetimetz-and-time-types">DateTime, DateTimeTz and Time Types</a></li><li id="known-vendor-issues-html-timezones-and-datetimetz" class="toc-item"><a href="known-vendor-issues.html#timezones-and-datetimetz">Timezones and DateTimeTz</a></li></ul></li><li id="known-vendor-issues-html-mysql" class="toc-item"><a href="known-vendor-issues.html#mysql">MySQL</a><ul><li id="known-vendor-issues-html-datetimetz" class="toc-item"><a href="known-vendor-issues.html#datetimetz">DateTimeTz</a></li></ul></li><li id="known-vendor-issues-html-sqlite" class="toc-item"><a href="known-vendor-issues.html#sqlite">Sqlite</a><ul><li id="known-vendor-issues-html-buffered-queries-and-isolation" class="toc-item"><a href="known-vendor-issues.html#buffered-queries-and-isolation">Buffered Queries and Isolation</a></li><li id="known-vendor-issues-html-datetime" class="toc-item"><a href="known-vendor-issues.html#datetime">DateTime</a></li><li id="known-vendor-issues-html-datetimetz" class="toc-item"><a href="known-vendor-issues.html#datetimetz">DateTimeTz</a></li><li id="known-vendor-issues-html-reverse-engineering-primary-key-order" class="toc-item"><a href="known-vendor-issues.html#reverse-engineering-primary-key-order">Reverse engineering primary key order</a></li></ul></li><li id="known-vendor-issues-html-ibm-db2" class="toc-item"><a href="known-vendor-issues.html#ibm-db2">IBM DB2</a><ul><li id="known-vendor-issues-html-datetimetz" class="toc-item"><a href="known-vendor-issues.html#datetimetz">DateTimeTz</a></li></ul></li><li id="known-vendor-issues-html-oracle" class="toc-item"><a href="known-vendor-issues.html#oracle">Oracle</a><ul><li id="known-vendor-issues-html-datetimetz" class="toc-item"><a href="known-vendor-issues.html#datetimetz">DateTimeTz</a></li><li id="known-vendor-issues-html-oci-lob-instances" class="toc-item"><a href="known-vendor-issues.html#oci-lob-instances">OCI-LOB instances</a></li></ul></li><li id="known-vendor-issues-html-microsoft-sql-server" class="toc-item"><a href="known-vendor-issues.html#microsoft-sql-server">Microsoft SQL Server</a><ul><li id="known-vendor-issues-html-unique-and-null" class="toc-item"><a href="known-vendor-issues.html#unique-and-null">Unique and NULL</a></li><li id="known-vendor-issues-html-datetime-datetimetz-and-time-types" class="toc-item"><a href="known-vendor-issues.html#datetime-datetimetz-and-time-types">DateTime, DateTimeTz and Time Types</a></li></ul></li></ul></li><li id="testing-html" class="toc-item"><a href="testing.html">Testing Guidelines</a><ul><li id="testing-html-requirements" class="toc-item"><a href="testing.html#requirements">Requirements</a></li><li id="testing-html-types-of-tests" class="toc-item"><a href="testing.html#types-of-tests">Types of Tests</a><ul><li id="testing-html-unit-tests" class="toc-item"><a href="testing.html#unit-tests">Unit Tests</a></li><li id="testing-html-integration-tests" class="toc-item"><a href="testing.html#integration-tests">Integration Tests</a></li><li id="testing-html-recommendations-on-writing-tests" class="toc-item"><a href="testing.html#recommendations-on-writing-tests">Recommendations on Writing Tests</a></li></ul></li></ul></li></ul></div>
</div>
<div class="toc-section"><h2 class="toc-header">Explanation</h2>
<div class="toc"><ul><li id="explanation-dc2type-comments-html" class="toc-item"><a href="../explanation/dc2type-comments.html">Doctrine SQL comments</a></li><li id="explanation-implicit-indexes-html" class="toc-item"><a href="../explanation/implicit-indexes.html">Implicit indexes</a></li></ul></div>
</div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://www.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "DBAL",
            "item": "https://www.doctrine-project.org/projects/dbal.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://www.doctrine-project.org/projects/doctrine-dbal/en/3.8/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "Transactions",
            "item": "https://www.doctrine-project.org/projects/doctrine-dbal/en/3.8/reference/transactions.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/dbal.html">DBAL</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-dbal/en/3.8/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">Transactions</li>
                        </ol>
</nav>
                                    </div>

                    
    <div class="alert caution bg-light-yellow text-dark border">
    <table width="100%">
        <tr>
            <td width="10" class="align-top">
                <i class="fas fa-exclamation-circle text-warning mr-2"></i>
            </td>
            <td><p>You are browsing a version that has not yet been released.</p></td>
        </tr>
    </table>
</div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine-dbal/en/3.8/reference/transactions.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        3.8.0
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-dbal/en/latest/reference/transactions.html">
                                                        4.0.0-RC2

                                                        
                                                                                                                    (upcoming)
                                                                                                            </a>
                                                                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item active" href="/projects/doctrine-dbal/en/3.8/reference/transactions.html">
                                                        3.8.0

                                                        
                                                                                                                    (upcoming)
                                                                                                            </a>
                                                                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-dbal/en/3.7/reference/transactions.html">
                                                        3.7.3

                                                                                                                    (current)
                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/3.6/reference/transactions.html">3.6</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/3.5/reference/transactions.html">3.5</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/3.4/reference/transactions.html">3.4</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/3.3/reference/transactions.html">3.3</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/3.2/reference/transactions.html">3.2</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/3.1/reference/transactions.html">3.1</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/3.0/reference/transactions.html">3.0</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.13/reference/transactions.html">2.13</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.12/reference/transactions.html">2.12</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.11/reference/transactions.html">2.11</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.10/reference/transactions.html">2.10</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.9/reference/transactions.html">2.9</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.8/reference/transactions.html">2.8</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.7/reference/transactions.html">2.7</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.6/reference/transactions.html">2.6</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.5/reference/transactions.html">2.5</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-dbal/en/2.4/reference/transactions.html">2.4</a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>
                                </div>
                            
                            
<div class="section"><a class="section-anchor" id="transactions" name="transactions"></a><h1 class="section-header"><a href="#transactions">Transactions<i class="fas fa-link"></i></a></h1>
<p>A <code>Doctrine\DBAL\Connection</code> provides an API for
transaction management, with the methods
<code>beginTransaction()</code>, <code>commit()</code> and <code>rollBack()</code>.</p>
<p>Transaction demarcation with the Doctrine DBAL looks as follows:</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="3a59f5121917baecda504cb8b481ccd7fcdc3de4"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="3a59f5121917baecda504cb8b481ccd7fcdc3de4"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-1" class="line-number-anchor" /><a href="#line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-1">1</a></td><td class="code-line" rowspan="9"><span class="hljs-meta">&lt;?php</span>
$conn-&gt;beginTransaction();
<span class="hljs-keyword">try</span>{
    <span class="hljs-comment">// do stuff</span>
    $conn-&gt;commit();
} <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
    $conn-&gt;rollBack();
    <span class="hljs-keyword">throw</span> $e;
}</td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-2" class="line-number-anchor" /><a href="#line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-3" class="line-number-anchor" /><a href="#line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-4" class="line-number-anchor" /><a href="#line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-5" class="line-number-anchor" /><a href="#line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-6" class="line-number-anchor" /><a href="#line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-7" class="line-number-anchor" /><a href="#line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-8" class="line-number-anchor" /><a href="#line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-9" class="line-number-anchor" /><a href="#line-number-3a59f5121917baecda504cb8b481ccd7fcdc3de4-9">9</a></td></tr></table></div></code></pre>
<p>Alternatively, the control abstraction
<code>Connection#transactional($func)</code> can be used to make the code
more concise and to make sure you never forget to rollback the
transaction in the case of an exception. The following code snippet
is functionally equivalent to the previous one:</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="c5aaaa468337c50a06dff8cae4bb079a6d581ec0"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="c5aaaa468337c50a06dff8cae4bb079a6d581ec0"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-c5aaaa468337c50a06dff8cae4bb079a6d581ec0-1" class="line-number-anchor" /><a href="#line-number-c5aaaa468337c50a06dff8cae4bb079a6d581ec0-1">1</a></td><td class="code-line" rowspan="4"><span class="hljs-meta">&lt;?php</span>
$conn-&gt;transactional(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Connection $conn)</span>: <span class="hljs-title">void</span> </span>{
    <span class="hljs-comment">// do stuff</span>
});</td></tr>
<tr><td class="line-number noselect"><a name="line-number-c5aaaa468337c50a06dff8cae4bb079a6d581ec0-2" class="line-number-anchor" /><a href="#line-number-c5aaaa468337c50a06dff8cae4bb079a6d581ec0-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c5aaaa468337c50a06dff8cae4bb079a6d581ec0-3" class="line-number-anchor" /><a href="#line-number-c5aaaa468337c50a06dff8cae4bb079a6d581ec0-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-c5aaaa468337c50a06dff8cae4bb079a6d581ec0-4" class="line-number-anchor" /><a href="#line-number-c5aaaa468337c50a06dff8cae4bb079a6d581ec0-4">4</a></td></tr></table></div></code></pre>
<p>Note that the closure above doesn't have to be a void, anything it
returns will be returned by <code>transactional()</code>:</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="b5e95751746216e41bf8069d0185cf1478b63d61"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="b5e95751746216e41bf8069d0185cf1478b63d61"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-b5e95751746216e41bf8069d0185cf1478b63d61-1" class="line-number-anchor" /><a href="#line-number-b5e95751746216e41bf8069d0185cf1478b63d61-1">1</a></td><td class="code-line" rowspan="5"><span class="hljs-meta">&lt;?php</span>
$one = $conn-&gt;transactional(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Connection $conn)</span>: <span class="hljs-title">int</span> </span>{
    <span class="hljs-comment">// do stuff</span>
    <span class="hljs-keyword">return</span> $conn-&gt;fetchOne(<span class="hljs-string">'SELECT 1'</span>);
});</td></tr>
<tr><td class="line-number noselect"><a name="line-number-b5e95751746216e41bf8069d0185cf1478b63d61-2" class="line-number-anchor" /><a href="#line-number-b5e95751746216e41bf8069d0185cf1478b63d61-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b5e95751746216e41bf8069d0185cf1478b63d61-3" class="line-number-anchor" /><a href="#line-number-b5e95751746216e41bf8069d0185cf1478b63d61-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b5e95751746216e41bf8069d0185cf1478b63d61-4" class="line-number-anchor" /><a href="#line-number-b5e95751746216e41bf8069d0185cf1478b63d61-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b5e95751746216e41bf8069d0185cf1478b63d61-5" class="line-number-anchor" /><a href="#line-number-b5e95751746216e41bf8069d0185cf1478b63d61-5">5</a></td></tr></table></div></code></pre>
<p>The <code>Doctrine\DBAL\Connection</code> class also has methods to control the
transaction isolation level as supported by the underlying
database. <code>Connection#setTransactionIsolation($level)</code> and
<code>Connection#getTransactionIsolation()</code> can be used for that purpose.
The possible isolation levels are represented by the following
constants:</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="9d37d6d1e510083666fc02ce0971f7e7cf756427"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="9d37d6d1e510083666fc02ce0971f7e7cf756427"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-9d37d6d1e510083666fc02ce0971f7e7cf756427-1" class="line-number-anchor" /><a href="#line-number-9d37d6d1e510083666fc02ce0971f7e7cf756427-1">1</a></td><td class="code-line" rowspan="5"><span class="hljs-meta">&lt;?php</span>
TransactionIsolationLevel::READ_UNCOMMITTED
TransactionIsolationLevel::READ_COMMITTED
TransactionIsolationLevel::REPEATABLE_READ
TransactionIsolationLevel::SERIALIZABLE</td></tr>
<tr><td class="line-number noselect"><a name="line-number-9d37d6d1e510083666fc02ce0971f7e7cf756427-2" class="line-number-anchor" /><a href="#line-number-9d37d6d1e510083666fc02ce0971f7e7cf756427-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9d37d6d1e510083666fc02ce0971f7e7cf756427-3" class="line-number-anchor" /><a href="#line-number-9d37d6d1e510083666fc02ce0971f7e7cf756427-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9d37d6d1e510083666fc02ce0971f7e7cf756427-4" class="line-number-anchor" /><a href="#line-number-9d37d6d1e510083666fc02ce0971f7e7cf756427-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-9d37d6d1e510083666fc02ce0971f7e7cf756427-5" class="line-number-anchor" /><a href="#line-number-9d37d6d1e510083666fc02ce0971f7e7cf756427-5">5</a></td></tr></table></div></code></pre>
<p>The default transaction isolation level of a
<code>Doctrine\DBAL\Connection</code> instance is chosen by the underlying
platform but it is always at least <code>READ_COMMITTED</code>.</p>
<div class="section"><a class="section-anchor" id="transaction-nesting" name="transaction-nesting"></a><h2 class="section-header"><a href="#transaction-nesting">Transaction Nesting<i class="fas fa-link"></i></a></h2>
<p>Calling <code>beginTransaction()</code> while already in a transaction will
result in two very different behaviors depending on whether transaction
nesting with savepoints is enabled or not. In both cases though, there
won't be an actual transaction inside a transaction, even if your RDBMS
supports it. There is always only a single, real database transaction.</p>
<p>By default, transaction nesting at the SQL level with savepoints is
disabled. The value for that setting can be set on a per-connection
basis, with
<code>Doctrine\DBAL\Connection#setNestTransactionsWithSavepoints()</code>.</p>
<p>Nesting transactions without savepoints is deprecated, but is the
default behavior for backward compatibility reasons.</p>
<div class="section"><a class="section-anchor" id="dummy-mode" name="dummy-mode"></a><h3 class="section-header"><a href="#dummy-mode">Dummy mode<i class="fas fa-link"></i></a></h3>
<div class="alert warning-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td><td><p>This behavior is deprecated, avoid it with
<code>Doctrine\DBAL\Connection#setNestTransactionsWithSavepoints(true)</code>.</p>
</td></tr></table></div>
<p>When transaction nesting with savepoints is disabled, what happens is
not so much transaction nesting as propagating transaction control up
the call stack. For that purpose, the <code>Connection</code> class keeps an
internal counter that represents the nesting level and is
increased/decreased as <code>beginTransaction()</code>, <code>commit()</code> and
<code>rollBack()</code> are invoked. <code>beginTransaction()</code> increases the nesting
level whilst <code>commit()</code> and <code>rollBack()</code> decrease the nesting level.
The nesting level starts at 0.
Whenever the nesting level transitions from 0 to 1,
<code>beginTransaction()</code> is invoked on the underlying driver connection
and whenever the nesting level transitions from 1 to 0, <code>commit()</code> or
<code>rollBack()</code> is invoked on the underlying driver, depending on whether
the transition was caused by <code>Connection#commit()</code> or
<code>Connection#rollBack()</code>.</p>
<p>What this means is that transaction control is basically passed to
code higher up in the call stack and the inner transaction block does
not actually result in an SQL transaction. It is not ignored either
though.</p>
<p>To visualize what this means in practice, consider the following
example:</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="6c2b9548dff597f4ee795629db2db9eb7d8d4578"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="6c2b9548dff597f4ee795629db2db9eb7d8d4578"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-1" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-1">1</a></td><td class="code-line" rowspan="26"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">// $conn instanceof Doctrine\DBAL\Connection</span>
$conn-&gt;beginTransaction(); <span class="hljs-comment">// 0 =&gt; 1, "real" transaction started</span>
<span class="hljs-keyword">try</span> {

    ...

    <span class="hljs-comment">// nested transaction block, this might be in some other API/library code that is</span>
    <span class="hljs-comment">// unaware of the outer transaction.</span>
    $conn-&gt;beginTransaction(); <span class="hljs-comment">// 1 =&gt; 2</span>
    <span class="hljs-keyword">try</span> {
        ...

        $conn-&gt;commit(); <span class="hljs-comment">// 2 =&gt; 1</span>
    } <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
        $conn-&gt;rollBack(); <span class="hljs-comment">// 2 =&gt; 1, transaction marked for rollback only</span>
        <span class="hljs-keyword">throw</span> $e;
    }

    ...

    $conn-&gt;commit(); <span class="hljs-comment">// 1 =&gt; 0, "real" transaction committed</span>
} <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
    $conn-&gt;rollBack(); <span class="hljs-comment">// 1 =&gt; 0, "real" transaction rollback</span>
    <span class="hljs-keyword">throw</span> $e;
}</td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-2" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-3" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-4" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-5" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-6" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-7" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-8" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-9" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-10" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-11" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-12" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-13" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-14" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-15" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-16" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-16">16</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-17" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-17">17</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-18" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-18">18</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-19" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-19">19</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-20" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-20">20</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-21" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-21">21</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-22" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-22">22</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-23" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-23">23</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-24" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-24">24</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-25" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-25">25</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-26" class="line-number-anchor" /><a href="#line-number-6c2b9548dff597f4ee795629db2db9eb7d8d4578-26">26</a></td></tr></table></div></code></pre>
<p>However, <strong>a rollback in a nested transaction block will always mark the
current transaction so that the only possible outcome of the transaction
is to be rolled back</strong>.
That means in the above example, the rollback in the inner
transaction block marks the whole transaction for rollback only.
Even if the nested transaction block would not rethrow the
exception, the transaction is marked for rollback only and the
commit of the outer transaction would trigger an exception, leading
to the final rollback. This also means that you cannot
successfully commit some changes in an outer transaction if an
inner transaction block fails and issues a rollback, even if this
would be the desired behavior (i.e. because the nested operation is
optional for the purpose of the outer transaction block). To
achieve that, you need to resort to transaction nesting with savepoint.</p>
<p>All that is guaranteed to the inner transaction is that it still
happens atomically, all or nothing, the transaction just gets a
wider scope and the control is handed to the outer scope.</p>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>The transaction nesting described here is a debated
feature that has its critics. Form your own opinion. We recommend
avoiding nesting transaction blocks when possible, and most of the
time, it is possible. Transaction control should mostly be left to
a service layer and not be handled in data access objects or
similar.</p>
</td></tr></table></div>
<div class="alert warning-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td><td><p>Directly invoking <code>PDO::beginTransaction()</code>,
<code>PDO::commit()</code> or <code>PDO::rollBack()</code> or the corresponding methods
on the particular <code>Doctrine\DBAL\Driver\Connection</code> instance
bypasses the transparent transaction nesting that is provided
by <code>Doctrine\DBAL\Connection</code> and can therefore corrupt the
nesting level, causing errors with broken transaction boundaries
that may be hard to debug.</p>
</td></tr></table></div>
</div>
<div class="section"><a class="section-anchor" id="emulated-transaction-nesting-with-savepoints" name="emulated-transaction-nesting-with-savepoints"></a><h3 class="section-header"><a href="#emulated-transaction-nesting-with-savepoints">Emulated Transaction Nesting with Savepoints<i class="fas fa-link"></i></a></h3>
<p>Let's now examine what happens when transaction nesting with savepoints
is enabled, with the same example as above</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="71d432050f1faf625538e18f8fb8abc52aa403fd"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="71d432050f1faf625538e18f8fb8abc52aa403fd"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-1" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-1">1</a></td><td class="code-line" rowspan="26"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">// $conn instanceof Doctrine\DBAL\Connection</span>
$conn-&gt;beginTransaction(); <span class="hljs-comment">// 0 =&gt; 1, "real" transaction started</span>
<span class="hljs-keyword">try</span> {

    ...

    <span class="hljs-comment">// nested transaction block, this might be in some other API/library code that is</span>
    <span class="hljs-comment">// unaware of the outer transaction.</span>
    $conn-&gt;beginTransaction(); <span class="hljs-comment">// 1 =&gt; 2, savepoint created</span>
    <span class="hljs-keyword">try</span> {
        ...

        $conn-&gt;commit(); <span class="hljs-comment">// 2 =&gt; 1</span>
    } <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
        $conn-&gt;rollBack(); <span class="hljs-comment">// 2 =&gt; 1, rollback to savepoint</span>
        <span class="hljs-keyword">throw</span> $e;
    }

    ...

    $conn-&gt;commit(); <span class="hljs-comment">// 1 =&gt; 0, "real" transaction committed</span>
} <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
    $conn-&gt;rollBack(); <span class="hljs-comment">// 1 =&gt; 0, "real" transaction rollback</span>
    <span class="hljs-keyword">throw</span> $e;
}</td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-2" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-3" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-4" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-5" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-6" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-7" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-8" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-9" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-10" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-11" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-12" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-13" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-14" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-15" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-16" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-16">16</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-17" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-17">17</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-18" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-18">18</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-19" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-19">19</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-20" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-20">20</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-21" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-21">21</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-22" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-22">22</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-23" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-23">23</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-24" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-24">24</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-25" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-25">25</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-26" class="line-number-anchor" /><a href="#line-number-71d432050f1faf625538e18f8fb8abc52aa403fd-26">26</a></td></tr></table></div></code></pre>
<p>This time, everything is handled at the SQL level: the main transaction
is not marked for rollback only, but the inner emulated transaction is
rolled back to the savepoint.</p>
</div>
</div>
<div class="section"><a class="section-anchor" id="auto-commit-mode" name="auto-commit-mode"></a><h2 class="section-header"><a href="#auto-commit-mode">Auto-commit mode<i class="fas fa-link"></i></a></h2>
<p>A <code>Doctrine\DBAL\Connection</code> supports setting the auto-commit mode
to control whether queries should be automatically wrapped into a
transaction or directly be committed to the database.
By default a connection runs in auto-commit mode which means
that it is non-transactional unless you start a transaction explicitly
via <code>beginTransaction()</code>. To have a connection automatically open up
a new transaction on <code>connect()</code> and after <code>commit()</code> or <code>rollBack()</code>,
you can disable auto-commit mode with <code>setAutoCommit(false)</code>.</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-1" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-1">1</a></td><td class="code-line" rowspan="16"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">// define connection parameters $params and initialize driver $driver</span>

$conn = <span class="hljs-keyword">new</span> \Doctrine\DBAL\Connection($params, $driver);

$conn-&gt;setAutoCommit(<span class="hljs-keyword">false</span>); <span class="hljs-comment">// disables auto-commit</span>
$conn-&gt;connect(); <span class="hljs-comment">// connects and immediately starts a new transaction</span>

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// do stuff</span>
    $conn-&gt;commit(); <span class="hljs-comment">// commits transaction and immediately starts a new one</span>
} <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
    $conn-&gt;rollBack(); <span class="hljs-comment">// rolls back transaction and immediately starts a new one</span>
}

<span class="hljs-comment">// still transactional</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-2" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-3" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-4" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-5" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-6" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-7" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-8" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-9" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-10" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-11" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-12" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-13" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-14" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-15" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-16" class="line-number-anchor" /><a href="#line-number-0d18eacc3e60a6ced72b2d9c743a313c9ab4f02e-16">16</a></td></tr></table></div></code></pre>
<div class="alert note-admonition bg-light-yellow text-dark border"><table width="100%"><tr><td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td><td><p>Changing auto-commit mode during an active transaction, implicitly
commits active transactions for that particular connection.</p>
</td></tr></table></div>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="169bdc88ed6025d54b1f63bf794413b444fd9f6f"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="169bdc88ed6025d54b1f63bf794413b444fd9f6f"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-1" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-1">1</a></td><td class="code-line" rowspan="16"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">// define connection parameters $params and initialize driver $driver</span>

$conn = <span class="hljs-keyword">new</span> \Doctrine\DBAL\Connection($params, $driver);

<span class="hljs-comment">// we are in auto-commit mode</span>
$conn-&gt;beginTransaction();

<span class="hljs-comment">// disable auto-commit, commits currently active transaction</span>
$conn-&gt;setAutoCommit(<span class="hljs-keyword">false</span>); <span class="hljs-comment">// also causes a new transaction to be started</span>

<span class="hljs-comment">// no-op as auto-commit is already disabled</span>
$conn-&gt;setAutoCommit(<span class="hljs-keyword">false</span>);

<span class="hljs-comment">// enable auto-commit again, commits currently active transaction</span>
$conn-&gt;setAutoCommit(<span class="hljs-keyword">true</span>); <span class="hljs-comment">// does not start a new transaction automatically</span></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-2" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-3" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-4" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-5" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-6" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-7" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-8" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-9" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-10" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-11" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-12" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-13" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-14" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-15" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-16" class="line-number-anchor" /><a href="#line-number-169bdc88ed6025d54b1f63bf794413b444fd9f6f-16">16</a></td></tr></table></div></code></pre>
<p>Committing or rolling back an active transaction will of course only
open up a new transaction automatically if the particular action causes
the transaction context of a connection to terminate.
That means committing or rolling back nested transactions are not affected
by this behaviour.</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="ec1174919a166732de9ff081f6a112cabfa78edd"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="ec1174919a166732de9ff081f6a112cabfa78edd"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-1" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-1">1</a></td><td class="code-line" rowspan="21"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">// we are not in auto-commit mode, transaction is active</span>

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// do stuff</span>

    $conn-&gt;beginTransaction(); <span class="hljs-comment">// start inner transaction, nesting level 2</span>

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// do stuff</span>
        $conn-&gt;commit(); <span class="hljs-comment">// commits inner transaction, does not start a new one</span>
    } <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
        $conn-&gt;rollBack(); <span class="hljs-comment">// rolls back inner transaction, does not start a new one</span>
    }

    <span class="hljs-comment">// do stuff</span>

    $conn-&gt;commit(); <span class="hljs-comment">// commits outer transaction, and immediately starts a new one</span>
} <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
    $conn-&gt;rollBack(); <span class="hljs-comment">// rolls back outer transaction, and immediately starts a new one</span>
}</td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-2" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-3" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-4" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-5" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-6" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-7" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-8" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-9" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-10" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-11" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-12" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-13" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-14" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-15" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-16" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-16">16</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-17" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-17">17</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-18" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-18">18</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-19" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-19">19</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-20" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-20">20</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ec1174919a166732de9ff081f6a112cabfa78edd-21" class="line-number-anchor" /><a href="#line-number-ec1174919a166732de9ff081f6a112cabfa78edd-21">21</a></td></tr></table></div></code></pre>
<p>To initialize a <code>Doctrine\DBAL\Connection</code> with auto-commit disabled,
you can also use the <code>Doctrine\DBAL\Configuration</code> container to modify the
default auto-commit mode via <code>Doctrine\DBAL\Configuration::setAutoCommit(false)</code>
and pass it to a <code>Doctrine\DBAL\Connection</code> when instantiating.</p>
</div>
<div class="section"><a class="section-anchor" id="error-handling" name="error-handling"></a><h2 class="section-header"><a href="#error-handling">Error handling<i class="fas fa-link"></i></a></h2>
<p>In order to handle errors related to deadlocks or lock wait timeouts,
you can use Doctrine built-in transaction exceptions.
All transaction exceptions where retrying makes sense have a marker interface: <code>Doctrine\DBAL\Exception\RetryableException</code>.
A practical example is as follows:</p>
<pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="4e2ec62e2037b6d626102733a08a4bb6b72ae2b1"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="4e2ec62e2037b6d626102733a08a4bb6b72ae2b1"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-1" class="line-number-anchor" /><a href="#line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-1">1</a></td><td class="code-line" rowspan="7"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// process stuff</span>
} <span class="hljs-keyword">catch</span> (\Doctrine\DBAL\<span class="hljs-keyword">Exception</span>\RetryableException $e) {
    <span class="hljs-comment">// retry the processing</span>
}</td></tr>
<tr><td class="line-number noselect"><a name="line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-2" class="line-number-anchor" /><a href="#line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-3" class="line-number-anchor" /><a href="#line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-4" class="line-number-anchor" /><a href="#line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-5" class="line-number-anchor" /><a href="#line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-6" class="line-number-anchor" /><a href="#line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-7" class="line-number-anchor" /><a href="#line-number-4e2ec62e2037b6d626102733a08a4bb6b72ae2b1-7">7</a></td></tr></table></div></code></pre>
<p>If you need stricter control, you can catch the concrete exceptions directly:</p>
<ul>
    <li class="dash"><code>Doctrine\DBAL\Exception\DeadlockException</code>: this can happen when each member
of a group of actions is waiting for some other member to release a shared lock.</li>
<li class="dash"><code>Doctrine\DBAL\Exception\LockWaitTimeoutException</code>: this exception happens when
a transaction has to wait a considerable amount of time to obtain a lock, even if
a deadlock is not involved.</li>
</ul>

</div>
</div>

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                    <footer class="footer">
                <div class="container">
                    <ul class="list-inline">
                        <li class="list-inline-item"><a href="/projects.html">Projects</a></li>
                        <li class="list-inline-item"><a href="/partners.html">Partners</a></li>
                        <li class="list-inline-item"><a href="/sponsorship.html">Sponsorship</a></li>
                        <li class="list-inline-item"><a href="/community/index.html">Community</a></li>
                        <li class="list-inline-item"><a href="/blog/index.html">Blog</a></li>
                    </ul>
                </div>
            </footer>
        
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?5364f3"
                            integrity="sha384-yT1xut8dmITuccyh+MOljcF0MzMJFhaP227UZREURvpogyieLsqm9J/duGcSbb6q"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'dbal';
            var versionSlug = '3.8';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search DBAL 3.8'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            </body>
</html>
