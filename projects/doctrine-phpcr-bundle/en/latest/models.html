<!DOCTYPE html>
<html>
    <head>
        <title>        Modeling Data with PHPCR-ODM - Doctrine Doctrine PHPCR Bundle
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine Doctrine PHPCR Bundle Documentation: Modeling Data with PHPCR-ODM ">

        <meta name="keywords" content="                    PHPCR,ODM,Database,Persistence,documentation,modeling,data,with,phpcr-odm
    ">

                    <meta name="robots" content="index, follow">
        
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine-phpcr-bundle/en/latest/models.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?209f12"
                        integrity="sha384-VMcQOaUBPJYirNpZMqv0kKw80RSt4Uye4T1Li/d7kiKYAfj1WSzYOgP2OTdON/HM"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine-phpcr-bundle/en/latest/models.html" />
        <meta property="og:title" content="        Modeling Data with PHPCR-ODM - Doctrine Doctrine PHPCR Bundle
    " />
        <meta property="og:description" content="Doctrine Doctrine PHPCR Bundle Documentation: Modeling Data with PHPCR-ODM " />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine Doctrine PHPCR Bundle",
            "description": "Modeling Data with PHPCR-ODM",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/DoctrinePHPCRBundle/edit/3.x/doc/en/models.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        

            <div class="toc">
    <ul class="menu-level">
    <li class="toc-item">
    <a href="configuration.html#configuration-reference">Configuration Reference</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="configuration.html#configuration">Configuration</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="configuration.html#session">session</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="configuration.html#workspace">workspace</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#username-and-password">username and password</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#backend-type">backend type</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#backend-parameters">backend parameters</a>

        <ul class="section-level-3">
            <li class="toc-item">
    <a href="configuration.html#jackalope-factory">jackalope.factory</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#jackalope-check-login-on-server">jackalope.check_login_on_server</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#jackalope-disable-stream-wrapper">jackalope.disable_stream_wrapper</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#jackalope-auto-lastmodified">jackalope.auto_lastmodified</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="configuration.html#backend-curl-options">backend curl_options</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="configuration.html#phpcr-session-with-jackalope-jackrabbit">PHPCR Session with Jackalope Jackrabbit</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="configuration.html#url">url</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#jackalope-default-header">jackalope.default_header</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#jackalope-jackrabbit-expect">jackalope.jackrabbit_expect</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#jackalope-jackrabbit-version">jackalope.jackrabbit_version</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="configuration.html#phpcr-session-with-jackalope-doctrine-dbal">PHPCR Session with Jackalope Doctrine DBAL</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="configuration.html#connection">connection</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#jackalope-disable-transactions">jackalope.disable_transactions</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="configuration.html#logging-and-profiling">Logging and Profiling</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#doctrine-phpcr-odm-configuration">Doctrine PHPCR-ODM Configuration</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="configuration.html#configuration-id">configuration_id</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#auto-mapping">auto_mapping</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#auto-generate-proxy-classes">auto_generate_proxy_classes</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#proxy-dir">proxy_dir</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#proxy-namespace">proxy_namespace</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#namespaces">namespaces</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#mappings">mappings</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#metadata-cache-driver">metadata_cache_driver</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="configuration.html#general-settings">General Settings</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="configuration.html#jackrabbit-jar">jackrabbit_jar</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#dump-max-line-length">dump_max_line_length</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="events.html#doctrine-phpcr-odm-events">Doctrine PHPCR-ODM Events</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="events.html#dependency-injection-tags">Dependency Injection Tags</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="fixtures_initializers.html#maintaining-data-in-the-repository">Maintaining Data in the Repository</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="fixtures_initializers.html#repository-initializers">Repository Initializers</a>


</li>
            <li class="toc-item">
    <a href="fixtures_initializers.html#migration-loading">Migration Loading</a>


</li>
            <li class="toc-item">
    <a href="fixtures_initializers.html#fixture-loading">Fixture Loading</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="forms.html#doctrine-phpcr-odm-form-types">Doctrine PHPCR-ODM Form Types</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="forms.html#form-types">Form Types</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="forms.html#phpcr-document">phpcr_document</a>


</li>
            <li class="toc-item">
    <a href="forms.html#phpcr-odm-reference-collection">phpcr_odm_reference_collection</a>


</li>
            <li class="toc-item">
    <a href="forms.html#phpcr-reference">phpcr_reference</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="forms.html#validator-constraint">Validator Constraint</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="introduction.html#doctrinephpcrbundle">DoctrinePHPCRBundle</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="introduction.html#setup">Setup</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="introduction.html#requirements">Requirements</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="introduction.html#installation">Installation</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#configuration">Configuration</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="introduction.html#phpcr-session-configuration">PHPCR Session Configuration</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#doctrine-phpcr-odm-configuration">Doctrine PHPCR-ODM Configuration</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="introduction.html#registering-system-node-types">Registering System Node Types</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="introduction.html#profiling-and-performance-of-jackalope">Profiling and Performance of Jackalope</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="introduction.html#services">Services</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#doctrine-phpcr-commands">Doctrine PHPCR Commands</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="introduction.html#some-example-command-runs">Some Example Command Runs</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#simple-backup-and-restore">Simple Backup and Restore</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="introduction.html#read-on">Read On</a>


</li>
                    </ul>
</li>
    <li class="toc-item opened">
    <a href="#modeling-data-with-phpcr-odm">Modeling Data with PHPCR-ODM</a>

        <ul class="section-level-1 opened-ul ">
            <li class="toc-item">
    <a href="#a-simple-example-a-task">A Simple Example: A Task</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#creating-a-document-class">Creating a Document Class</a>


</li>
            <li class="toc-item">
    <a href="#add-mapping-information">Add Mapping Information</a>


</li>
            <li class="toc-item">
    <a href="#persisting-documents-to-phpcr">Persisting Documents to PHPCR</a>


</li>
            <li class="toc-item">
    <a href="#fetching-objects-from-phpcr">Fetching Objects from PHPCR</a>


</li>
            <li class="toc-item">
    <a href="#updating-an-object">Updating an Object</a>


</li>
            <li class="toc-item">
    <a href="#deleting-an-object">Deleting an Object</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#summary">Summary</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="multilang.html#doctrine-phpcr-odm-multi-language-support">Doctrine PHPCR-ODM Multi-Language Support</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="multilang.html#translation-configuration">Translation Configuration</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="multilang.html#fallback-strategies">Fallback strategies</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="multilang.html#translated-documents">Translated documents</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="multiple_sessions.html#configuring-multiple-sessions-for-phpcr-odm">Configuring multiple sessions for PHPCR-ODM</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="multiple_sessions.html#multiple-phpcr-sessions">Multiple PHPCR Sessions</a>


</li>
            <li class="toc-item">
    <a href="multiple_sessions.html#multiple-document-managers">Multiple Document Managers</a>


</li>
            <li class="toc-item">
    <a href="multiple_sessions.html#bringing-it-all-together">Bringing it all together</a>


</li>
                    </ul>
</li>
    </ul>
</div>
    

                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://www.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "Doctrine PHPCR Bundle",
            "item": "https://www.doctrine-project.org/projects/phpcr-bundle.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://www.doctrine-project.org/projects/doctrine-phpcr-bundle/en/latest/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "Modeling Data with PHPCR-ODM",
            "item": "https://www.doctrine-project.org/projects/doctrine-phpcr-bundle/en/latest/models.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/phpcr-bundle.html">Doctrine PHPCR Bundle</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-phpcr-bundle/en/latest/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">Modeling Data with PHPCR-ODM</li>
                        </ol>
</nav>
                                    </div>

                

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine-phpcr-bundle/en/latest/models.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        3.x
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item active" href="/projects/doctrine-phpcr-bundle/en/latest/models.html">
                                                        3.x

                                                                                                                    (current)
                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                            </div>
                                </div>
                            
                            

            <div class="section" id="modeling-data-with-phpcr-odm">
            <h1 class="section-header ">
    <a href="#modeling-data-with-phpcr-odm">
        Modeling Data with PHPCR-ODM
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p>The Doctrine PHPCR-ODM is a doctrine object-mapper on top of the
<a href="http://phpcr.github.io/">PHP Content Repository</a> (PHPCR), which is a PHP adaption of the
<a href="https://jcp.org/en/jsr/detail?id=283">JSR-283 specification</a>. The most important feature of PHPCR is the tree
structure to store the data. All data is stored in items of a tree, called
nodes. You can think of this like a file system, that makes it perfect to use
in a CMS.</p>

            
    <p>On top of the tree structure, PHPCR also adds features like searching,
versioning and access control.</p>

            
    <p>Doctrine PHPCR-ODM has the same API as the other Doctrine libraries, like the
<a href="https://symfony.com/doc/current/doctrine.html">Doctrine ORM</a>. The Doctrine PHPCR-ODM adds another great feature to PHPCR:
multi-language support.</p>

            <div class="section" id="a-simple-example-a-task">
            <h2 class="section-header ">
    <a href="#a-simple-example-a-task">
        A Simple Example: A Task
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>The easiest way to get started with the PHPCR-ODM is to see it in action. In
this section, you are going to create a <code>Task</code> object and learn how to
persist it.</p>

            <div class="section" id="creating-a-document-class">
            <h3 class="section-header ">
    <a href="#creating-a-document-class">
        Creating a Document Class
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Without thinking about Doctrine or PHPCR-ODM, you can create a <code>Task</code> object
in PHP:</p>

                <div class="console">
        <pre><code class="console">// src/App/Document/Task.php
namespace use App\Document;

class Task
{
    protected $description;

    protected $done = false;
}
</code></pre>
    </div>

            
    <p>This class - often called a &quot;document&quot; in PHPCR-ODM, meaning <em>a basic class
that holds data</em> - is simple and helps fulfill the business requirement of
needing tasks in your application. This class can&#039;t be persisted to
Doctrine PHPCR-ODM yet - it&#039;s just a simple PHP class.</p>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>A Document is analogous to the term <code>Entity</code> employed by the Doctrine
ORM.  To have the mapping happen automatically, place your documents in the
<code>Document</code> namespace within your application.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="add-mapping-information">
            <h3 class="section-header ">
    <a href="#add-mapping-information">
        Add Mapping Information
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Doctrine allows you to work with PHPCR in a much more interesting way than
just fetching data back and forth as an array. Instead, Doctrine allows you to
persist entire objects to PHPCR and fetch entire <em>objects</em> out of PHPCR.
This works by mapping a PHP class and its properties to the PHPCR tree.</p>

            
    <p>For Doctrine to be able to do this, you just have to create &quot;metadata&quot;, or
configuration that tells Doctrine exactly how the <code>Task</code> document and its
properties should be <em>mapped</em> to PHPCR. This metadata can be specified in a
number of different formats including YAML, XML or directly inside the <code>Task</code>
class via attributes:</p>

            <div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="php"
                    aria-controls="configuration-block-tabpanel-69f6314deb57218a7ac48bc616a8871e" aria-selected="true"
                    data-active="true" >
                <span>Php</span>
            </button>
                    <button role="tab" type="button" data-language="yaml"
                    aria-controls="configuration-block-tabpanel-def471caed0e05c1de90745aaec24b23" aria-selected="false"
                     tabindex="-1">
                <span>Yaml</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                    aria-controls="configuration-block-tabpanel-1e9877de1ac09dadcd6939ecbe593204" aria-selected="false"
                     tabindex="-1">
                <span>Xml</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-69f6314deb57218a7ac48bc616a8871e" aria-label="Php" class="configuration-codeblock" data-language="php" style="">
                <pre class="code-block-table" id="d474ccaa11f291738665f16cae8ec7466874713b"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="d474ccaa11f291738665f16cae8ec7466874713b"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-comment">// src/App/Document/Task.php</span></code><code class="line language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Document</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Doctrine</span>\<span class="hljs-title">ODM</span>\<span class="hljs-title">PHPCR</span>\<span class="hljs-title">Mapping</span>\<span class="hljs-title">Attributes</span> <span class="hljs-title">as</span> <span class="hljs-title">PHPCR</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">#[PHPCR\Document]</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">#[PHPCR\Id]</span></code><code class="line language-php">    <span class="hljs-keyword">private</span> $id;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">#[PHPCR\Field(type: 'string')]</span></code><code class="line language-php">    <span class="hljs-keyword">private</span> $description;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">#[PHPCR\Field(type: 'boolean')]</span></code><code class="line language-php">    <span class="hljs-keyword">private</span> $done = <span class="hljs-keyword">false</span>;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">#[PHPCR\ParentDocument]</span></code><code class="line language-php">    <span class="hljs-keyword">private</span> $parentDocument;</code><code class="line language-php">}</code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-def471caed0e05c1de90745aaec24b23" aria-label="Yaml" class="configuration-codeblock" data-language="yaml" style="display: none">
                <pre class="code-block-table" id="ae625e3c3162ede5e9759535e6b96a30e7af54a8"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="ae625e3c3162ede5e9759535e6b96a30e7af54a8"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-yaml"><span class="hljs-comment"># src/App/Resources/config/doctrine/Task.phpcr.yml</span></code><code class="line language-yaml"><span class="hljs-string">App\Document\Task:</span></code><code class="line language-yaml">    <span class="hljs-attr">id:</span> <span class="hljs-string">id</span></code><code class="line language-yaml"></code><code class="line language-yaml">    <span class="hljs-attr">fields:</span></code><code class="line language-yaml">        <span class="hljs-attr">description:</span> <span class="hljs-string">string</span></code><code class="line language-yaml">        <span class="hljs-attr">done:</span> <span class="hljs-string">boolean</span></code><code class="line language-yaml"></code><code class="line language-yaml">    <span class="hljs-attr">parent_document:</span> <span class="hljs-string">parentDocument</span></code><code class="empty"></code></pre>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-1e9877de1ac09dadcd6939ecbe593204" aria-label="Xml" class="configuration-codeblock" data-language="xml" style="display: none">
                <pre class="code-block-table" id="6849e5785bf76ba552e9a8ca5f671f769a9532ce"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="6849e5785bf76ba552e9a8ca5f671f769a9532ce"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-xml"><span class="hljs-comment">&lt;!-- src/App/Resources/config/doctrine/Task.phpcr.xml --&gt;</span></code><code class="line language-xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></code><code class="line language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">doctrine-mapping</span></span></code><code class="line language-xml">    xmlns="http://doctrine-project.org/schemas/phpcr-odm/phpcr-mapping"</code><code class="line language-xml">    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</code><code class="line language-xml">    xsi:schemaLocation="http://doctrine-project.org/schemas/phpcr-odm/phpcr-mapping</code><code class="line language-xml">    https://github.com/doctrine/phpcr-odm/raw/master/doctrine-phpcr-odm-mapping.xsd"</code><code class="line language-xml">    &gt;</code><code class="line language-xml"></code><code class="line language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">document</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"App\Document\Task"</span>&gt;</span></code><code class="line language-xml"></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> /&gt;</span></code><code class="line language-xml"></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"description"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span> /&gt;</span></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"done"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"boolean"</span> /&gt;</span></code><code class="line language-xml"></code><code class="line language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">parent-document</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"parentDocument"</span> /&gt;</span></code><code class="line language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">document</span>&gt;</span></code><code class="line language-xml"></code><code class="line language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">doctrine-mapping</span>&gt;</span></code><code class="empty"></code></pre>
        </div>
    </div>
            
    <p>After this, you have to create getters and setters for the properties.</p>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>This Document uses the parent document and a node name to determine its
position in the tree. Because there isn&#039;t any name set, it is generated
automatically. If you want to use a specific node name, such as a
slugified version of the title, you need to add a property mapped as
<code>Nodename</code>.</p>

    <p>A Document must have an id property. This represents the full path (parent
path + name) of the Document. This will be set by Doctrine by default and
it is not recommend to use the id to determine the location of a Document.</p>

    <p>For more information about identifier generation strategies, refer to the
<a href="http://docs.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/reference/basic-mapping.html#basicmapping-identifier-generation-strategies">doctrine documentation</a></p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>You may want to implement <code>Doctrine\ODM\PHPCR\HierarchyInterface</code> to
expose the hierarchy in a standardized way.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>You can also check out Doctrine&#039;s <a href="http://docs.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/reference/basic-mapping.html">Basic Mapping Documentation</a> for all
details about mapping information. If you use attributes, you&#039;ll need to
prepend all attributes with <code>PHPCR\</code>, which is the name of the imported
namespace (e.g. <code>#[PHPCR\Document(..)]</code>), this is not shown in Doctrine&#039;s
documentation. You&#039;ll also need to include the
<code>use Doctrine\ODM\PHPCR\Mapping\Attributes as PHPCR;</code> statement to
import the PHPCR attributes prefix.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="persisting-documents-to-phpcr">
            <h3 class="section-header ">
    <a href="#persisting-documents-to-phpcr">
        Persisting Documents to PHPCR
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Now that you have a mapped <code>Task</code> document, complete with getter and setter
methods, you are ready to persist data to PHPCR. For a simple example, lets do
this from inside a controller:</p>

                <div class="console">
        <pre><code class="console">// src/App/Controller/DefaultController.php

// ...
use App\Document\Task;
use Doctrine\ODM\PHPCR\DocumentManagerInterface;
use Symfony\Component\HttpFoundation\Response;

// ...
public function createAction(DocumentManagerInterface $documentManager)
{
    $rootTask = $documentManager-&gt;find(null, &#039;/tasks&#039;);

    $task = new Task();
    $task-&gt;setDescription(&#039;Finish CMF project&#039;);
    $task-&gt;setParentDocument($rootTask);

    $documentManager-&gt;persist($task);

    $documentManager-&gt;flush();

    return new Response(&#039;Created task &quot;&#039;.$task-&gt;getDescription().&#039;&quot;&#039;);
}
</code></pre>
    </div>

            
    <p>Take a look at the previous example in more detail:</p>

            

<ul>
    <li><strong>line 8</strong> We use symfony controller injection with autowiring to get the
<em>document manager</em>. This service is responsible for storing and fetching
objects to and from PHPCR.</li>
    <li><strong>line 10</strong> This line loads the root document for the tasks, as each PHPCR
document needs to have a parent. To create this root document, you can
configure a <a href="fixtures_initializers.html#phpcr-odm-repository-initializers">Repository Initializer</a>,
which will be executed when running <code>doctrine:phpcr:repository:init</code>.</li>
    <li><strong>lines 12-14</strong> In this section, you instantiate and work with the <code>$task</code>
object like any other, normal PHP object.</li>
    <li><strong>line 16</strong> The <code>persist()</code> method tells Doctrine to &quot;manage&quot; the <code>$task</code>
object. This does not actually cause a query to be made to PHPCR (yet).</li>
    <li><strong>line 20</strong> When the <code>flush()</code> method is called, Doctrine looks through all
of the objects that it is managing to see if they need to be stored to PHPCR.
In this example, the <code>$task</code> object has not been saved yet, so the document
manager makes a query to PHPCR to add it.</li>
</ul>

            
    <p>When creating or updating objects, the workflow is always the same. In the
next section, you&#039;ll see how Doctrine is smart enough to update documents if
they already exist in PHPCR.</p>

    </div>
            <div class="section" id="fetching-objects-from-phpcr">
            <h3 class="section-header ">
    <a href="#fetching-objects-from-phpcr">
        Fetching Objects from PHPCR
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Fetching an object back out of PHPCR is even easier. For example, suppose
you&#039;ve configured a route to display a specific task by name:</p>

                <div class="console">
        <pre><code class="console">use App\Document\Task;
use Doctrine\ODM\PHPCR\DocumentManagerInterface;

public function showAction(DocumentManagerInterface $documentManager, $name)
{
    $repository = $documentManager-&gt;getRepository(Task::class);
    $task = $repository-&gt;find(&#039;/tasks/&#039;.$name);

    if (!$task) {
        throw $this-&gt;createNotFoundException(&#039;No task found with name &#039;.$name);
    }

    return new Response(&#039;[&#039;.($task-&gt;isDone() ? &#039;x&#039; : &#039; &#039;).&#039;] &#039;.$task-&gt;getDescription());
}
</code></pre>
    </div>

            
    <p>To retrieve objects from the document repository using both the <code>find</code> and
<code>findMany</code> methods and all helper methods of a class-specific repository. In
PHPCR, it&#039;s often unknown for developers which node has the data for a specific
document, in that case you should use the document manager to find the nodes
(for instance, when you want to get the root document). In example above, we
know they are <code>Task</code> documents and so we can use the repository.</p>

            
    <p>The repository contains all sorts of helpful methods:</p>

                <div class="console">
        <pre><code class="console">// query by the id (full path)
$task = $repository-&gt;find($id);

// query for one task matching be name and done
$task = $repository-&gt;findOneBy([&#039;name&#039; =&gt; &#039;foo&#039;, &#039;done&#039; =&gt; false]);

// query for all tasks matching the name, ordered by done
$tasks = $repository-&gt;findBy(
    [&#039;name&#039; =&gt; &#039;foo&#039;],
    [&#039;done&#039; =&gt; &#039;ASC&#039;]
);
</code></pre>
    </div>

            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>If you use the repository class, you can also create a custom repository
for a specific document. This helps with &quot;Separation of Concern&quot; when using more
complex queries. This is similar to how it&#039;s done in Doctrine ORM, for
more information read &quot;<a href="https://symfony.com/doc/current/doctrine/repository.html">Custom Repository Classes</a>&quot; in the core
documentation.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>You can also query objects by using the Query Builder provided by
Doctrine PHPCR-ODM. For more information, read
<a href="http://docs.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/reference/query-builder.html">the QueryBuilder documentation</a>.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="updating-an-object">
            <h3 class="section-header ">
    <a href="#updating-an-object">
        Updating an Object
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Once you&#039;ve fetched an object from Doctrine, updating it is easy. Suppose you
have a route that maps a task ID to an update action in a controller:</p>

                <div class="console">
        <pre><code class="console">use App\Document\Task;
use Doctrine\ODM\PHPCR\DocumentManagerInterface;

public function updateAction(DocumentManagerInterface $documentManager, $name)
{
    $repository = $documentManager-&gt;getRepository(Task::class);
    $task = $repository-&gt;find(&#039;/tasks/&#039;.$name);

    if (!$task) {
        throw $this-&gt;createNotFoundException(&#039;No task found for name &#039;.$name);
    }

    if (!$task-&gt;isDone()) {
        $task-&gt;setDone(true);
    }

    $documentManager-&gt;flush();

    return new Response(&#039;[x] &#039;.$task-&gt;getDescription());
}
</code></pre>
    </div>

            
    <p>Updating an object involves just three steps:</p>

            
    
<ol type="1">
    <li>fetching the object from Doctrine;</li>
    <li>modifying the object;</li>
    <li>calling <code>flush()</code> on the document manager</li>
</ol>

            
    <p>Notice that calling <code>$documentManger-&gt;persist($task)</code> isn&#039;t necessary.
Recall that this method simply tells Doctrine to manage or &quot;watch&quot; the
<code>$task</code> object. In this case, since you fetched the <code>$task</code> object from
Doctrine, it&#039;s already managed.</p>

    </div>
            <div class="section" id="deleting-an-object">
            <h3 class="section-header ">
    <a href="#deleting-an-object">
        Deleting an Object
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Deleting an object is very similar, but requires a call to the <code>remove()</code>
method of the document manager after you fetched the document from PHPCR:</p>

                <div class="console">
        <pre><code class="console">$documentManager-&gt;remove($task);
$documentManager-&gt;flush();
</code></pre>
    </div>

            
    <p>As you might expect, the <code>remove()</code> method notifies Doctrine that you&#039;d like
to remove the given document from PHPCR. The actual delete operation
however, is not actually executed until the <code>flush()</code> method is called.</p>

    </div>
    </div>
            <div class="section" id="summary">
            <h2 class="section-header ">
    <a href="#summary">
        Summary
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>With Doctrine, you can focus on your objects and how they&#039;re useful in your
application and worry about database persistence second. This is because
Doctrine allows you to use any PHP object to hold your data and relies on
mapping metadata information to map an object&#039;s data to a particular database
table.</p>

            
    <p>And even though Doctrine revolves around a simple concept, it&#039;s incredibly
powerful, allowing you to <a href="http://docs.doctrine-project.org/projects/doctrine-phpcr-odm/en/latest/reference/query-builder.html">create complex queries</a> and
<a href="events.html">subscribe to events</a> that allow you to take different actions as
objects go through their persistence lifecycle.</p>

    </div>
    </div>
        

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?794a90"
                            integrity="sha384-XY64ovvRXsl2gRSIhxtAbyt56nNRMvhYk0vtBsEL/20yutvGRATJx135BHpuEdl6"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'phpcr-bundle';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search Doctrine PHPCR Bundle 3.x'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            </body>
</html>
