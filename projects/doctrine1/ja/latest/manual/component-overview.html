<!DOCTYPE html>
<html>
    <head>
        <title>        マネージャー - Doctrine Doctrine1 ORM (Doctrine1)
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine Doctrine1 ORM Documentation: マネージャー ">

        <meta name="keywords" content="                    php,doctrine1,orm,database,documentation,マネージャー
    ">

                    <meta name="robots" content="index, follow">
        
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine1/ja/latest/manual/component-overview.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?6e5d9f"
                        integrity="sha384-1gHMA2pCh3C7C5PdanZqLyU+p0j9aNUSKdqMxyST9hhhoAcooEmUcqk0Rj7owse5"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine1/ja/latest/manual/component-overview.html" />
        <meta property="og:title" content="        マネージャー - Doctrine Doctrine1 ORM (Doctrine1)
    " />
        <meta property="og:description" content="Doctrine Doctrine1 ORM Documentation: マネージャー " />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine Doctrine1 ORM",
            "description": "マネージャー",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine1/edit/master/docs/en/manual/component-overview.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        

            <div class="toc">
    <ul class="menu-level">
    <li class="toc-item">
    <a href="about-author.html#about-the-author">About the Author</a>


</li>
    <li class="toc-item">
    <a href="about-sensio.html#about-sensio-labs">About Sensio Labs</a>


</li>
    <li class="toc-item">
    <a href="acknowledgements.html#about-the-authors">About the Authors</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="acknowledgements.html#contributors">Contributors</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="acknowledgements.html#roman-s-borschel">Roman S. Borschel</a>


</li>
            <li class="toc-item">
    <a href="acknowledgements.html#guilherme-blanco">Guilherme Blanco</a>


</li>
            <li class="toc-item">
    <a href="acknowledgements.html#konsta-vesterinen">Konsta Vesterinen</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="acknowledgements.html#companies">Companies</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="acknowledgements.html#centre-source">centre{source}</a>


</li>
            <li class="toc-item">
    <a href="acknowledgements.html#sensio-labs">Sensio Labs</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="acknowledgements.html#other-contributors">Other Contributors</a>


</li>
            <li class="toc-item">
    <a href="acknowledgements.html#conclusion">Conclusion</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="behaviors.html#behaviours">Behaviours</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="behaviors.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#shinpurunatenpureto">シンプルなテンプレート</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#rireshon-fukinotenpureto">リレーション付きのテンプレート</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#derigetomesoddo">デリゲートメソッド</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#biheibiawo-zuo-chengsuru">ビヘイビアを作成する</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#koabiheibia">コアビヘイビア</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="behaviors.html#shao-jie">紹介</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#versionable">Versionable</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#timestampable">Timestampable</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#sluggable">Sluggable</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#i18n">I18n</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#nestedset">NestedSet</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#searchable">Searchable</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#geographical">Geographical</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="behaviors.html#rure-zinobiheibia">入れ子のビヘイビア</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#fairuwo-sheng-chengsuru">ファイルを生成する</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#sheng-chengkurasuwokuerisuru">生成クラスをクエリする</a>


</li>
            <li class="toc-item">
    <a href="behaviors.html#matome">まとめ</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="caching.html#hajimeni">はじめに</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="caching.html#memcache">Memcache</a>


</li>
            <li class="toc-item">
    <a href="caching.html#apc">APC</a>


</li>
            <li class="toc-item">
    <a href="caching.html#db">Db</a>


</li>
            <li class="toc-item">
    <a href="caching.html#hajimeni">はじめに</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="caching.html#xinshiidqlkueriwo-chu-qi-huasuru">新しいDQLクエリを初期化する</a>


</li>
            <li class="toc-item">
    <a href="caching.html#dqlkueriwo-jie-xisuru">DQLクエリを解析する</a>


</li>
            <li class="toc-item">
    <a href="caching.html#detabesu-gu-younosqlkueriwobirudosuru">データベース固有のSQLクエリをビルドする</a>


</li>
            <li class="toc-item">
    <a href="caching.html#sqlkueriwo-shi-xingsuru">SQLクエリを実行する</a>


</li>
            <li class="toc-item">
    <a href="caching.html#jie-guosettowobirudosuru">結果セットをビルドする</a>


</li>
            <li class="toc-item">
    <a href="caching.html#jie-guosettowo-fansu">結果セットを返す</a>


</li>
            <li class="toc-item">
    <a href="caching.html#xinshiidqlkueriwo-chu-qi-huasuru">新しいDQLクエリを初期化する</a>


</li>
            <li class="toc-item">
    <a href="caching.html#sqlkueriwo-shi-xingsuru-kyasshukara-qu-de">SQLクエリを実行する(キャッシュから取得)</a>


</li>
            <li class="toc-item">
    <a href="caching.html#jie-guosettowobirudosuru">結果セットをビルドする</a>


</li>
            <li class="toc-item">
    <a href="caching.html#jie-guosettowo-fansu">結果セットを返す</a>


</li>
            <li class="toc-item">
    <a href="caching.html#xinshiidqlkueriwo-chu-qi-huasuru">新しいDQLクエリを初期化する</a>


</li>
            <li class="toc-item">
    <a href="caching.html#jie-guosettowo-fansu">結果セットを返す</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="caching.html#kuerikyasshu">クエリキャッシュ</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="caching.html#kuerikyasshuwo-shi-yongsuru">クエリキャッシュを使用する</a>


</li>
            <li class="toc-item">
    <a href="caching.html#wei-diao-zhengsuru">微調整する</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="caching.html#jie-guokyasshu">結果キャッシュ</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="caching.html#jie-guokyasshuwo-shi-yongsuru">結果キャッシュを使用する</a>


</li>
            <li class="toc-item">
    <a href="caching.html#wei-diao-zhengsuru">微調整する</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="coding-standards.html#phpfairunofomatto">PHPファイルのフォーマット</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="coding-standards.html#yi-ban">一般</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#indento">インデント</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#zui-dano-zhangsa">最大の長さ</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#gai-xing">改行</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#kurasu">クラス</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#intafeisu">インターフェイス</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#fairuno-ming-qian">ファイルの名前</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#guan-shutomesoddo">関数とメソッド</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#bian-shu">変数</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#ding-shu">定数</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#rekodonokaramu">レコードのカラム</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#phpkodono-jing-jie">PHPコードの境界</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#wen-zi-lie">文字列</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="coding-standards.html#riteraru-wen-zi-lie">リテラル文字列</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#aposutofiwo-hanmu-wen-zi-lie">アポストフィを含む文字列</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#bian-shuno-zhiki-huane">変数の置き換え</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#wen-zi-lieno-lian-jie">文字列の連結</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#gai-xingno-lian-jie">改行の連結</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="coding-standards.html#pei-lie">配列</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#kurasu">クラス</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#guan-shutomesoddo">関数とメソッド</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#zhi-yu-wen">制御文</a>


</li>
            <li class="toc-item">
    <a href="coding-standards.html#inraindokyumento">インラインドキュメント</a>


</li>
                    </ul>
</li>
    <li class="toc-item opened">
    <a href="#maneja">マネージャー</a>

        <ul class="section-level-1 opened-ul ">
            <li class="toc-item">
    <a href="#jie-xuwo-dumi-quru">接続を読み取る</a>


</li>
            <li class="toc-item">
    <a href="#li-yongdekirudoraiba">利用できるドライバ</a>


</li>
            <li class="toc-item">
    <a href="#jie-xuwo-zuo-chengsuru">接続を作成する</a>


</li>
            <li class="toc-item">
    <a href="#jie-xuwoflushsuru">接続をflushする</a>


</li>
            <li class="toc-item">
    <a href="#teburuobujekutowo-qu-desuru">テーブルオブジェクトを取得する</a>


</li>
            <li class="toc-item">
    <a href="#karamu-qing-baowo-qu-desuru">カラム情報を取得する</a>


</li>
            <li class="toc-item">
    <a href="#rireshonno-qing-baowo-qu-desuru">リレーションの情報を取得する</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#array-relation-toarray-print-r-array">// ... $array = relation-&gt;toArray(); print_r(array);</a>


</li>
            <li class="toc-item">
    <a href="#faindamesoddo">ファインダーメソッド</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#kasutamunoteburukurasu">カスタムのテーブルクラス</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#kasutamunofainda">カスタムのファインダー</a>


</li>
            <li class="toc-item">
    <a href="#puropati">プロパティ</a>


</li>
            <li class="toc-item">
    <a href="#rekodowo-geng-xinsuru">レコードを更新する</a>


</li>
            <li class="toc-item">
    <a href="#rekodowo-zhiki-huaneru">レコードを置き換える</a>


</li>
            <li class="toc-item">
    <a href="#rekodoworifuresshusuru">レコードをリフレッシュする</a>


</li>
            <li class="toc-item">
    <a href="#rireshonworifuresshusuru">リレーションをリフレッシュする</a>


</li>
            <li class="toc-item">
    <a href="#rekodowo-xue-chusuru">レコードを削除する</a>


</li>
            <li class="toc-item">
    <a href="#shino-zhiwo-shiu">式の値を使う</a>


</li>
            <li class="toc-item">
    <a href="#rekodono-zhuang-taiwo-qu-desuru">レコードの状態を取得する</a>


</li>
            <li class="toc-item">
    <a href="#obujekutonokopiwo-qu-desuru">オブジェクトのコピーを取得する</a>


</li>
            <li class="toc-item">
    <a href="#kong-bainorekodowo-bao-cunsuru">空白のレコードを保存する</a>


</li>
            <li class="toc-item">
    <a href="#kasutamuno-zhiwomappingusuru">カスタムの値をマッピングする</a>


</li>
            <li class="toc-item">
    <a href="#shiriaraizu">シリアライズ</a>


</li>
            <li class="toc-item">
    <a href="#karamu-yongnokorubakku-guan-shu">カラム用のコールバック関数</a>


</li>
            <li class="toc-item">
    <a href="#yao-suniakusesusuru">要素にアクセスする</a>


</li>
            <li class="toc-item">
    <a href="#xinshii-yao-suwo-zhui-jiasuru">新しい要素を追加する</a>


</li>
            <li class="toc-item">
    <a href="#korekushonnokauntowo-qu-desuru">コレクションのカウントを取得する</a>


</li>
            <li class="toc-item">
    <a href="#korekushonwo-bao-cunsuru">コレクションを保存する</a>


</li>
            <li class="toc-item">
    <a href="#korekushonwo-xue-chusuru">コレクションを削除する</a>


</li>
            <li class="toc-item">
    <a href="#kinomappingu">キーのマッピング</a>


</li>
            <li class="toc-item">
    <a href="#guan-lianrekodoworodosuru">関連レコードをロードする</a>


</li>
            <li class="toc-item">
    <a href="#saranibarideshon">さらにバリデーション</a>


</li>
            <li class="toc-item">
    <a href="#validmoshikuhanot-valid">ValidもしくはNot Valid</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#an-monobarideshon">暗黙のバリデーション</a>


</li>
            <li class="toc-item">
    <a href="#ming-shi-denabarideshon">明示的なバリデーション</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#conn-doctrine-manager-connection-conn-setlistener-profiler">$conn = Doctrine_Manager::connection(); conn-&gt;setListener(profiler);</a>


</li>
            <li class="toc-item">
    <a href="#ji-ben-dena-shii-fang">基本的な使い方</a>


</li>
            <li class="toc-item">
    <a href="#le-guan-derokku">楽観的ロック</a>


</li>
            <li class="toc-item">
    <a href="#bei-guan-derokku">悲観的ロック</a>


</li>
            <li class="toc-item">
    <a href="#li">例</a>


</li>
            <li class="toc-item">
    <a href="#ji-shu-dena-xiang-xi">技術的な詳細</a>


</li>
            <li class="toc-item">
    <a href="#byuwo-shiu">ビューを使う</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#foreach-users-as-user-print-r-us-toarray">foreach ($users as user) { print_r(us-&gt;toArray()); }</a>


</li>
            <li class="toc-item">
    <a href="#matome">まとめ</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="configuration.html#she-dingnoreberu">設定のレベル</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="configuration.html#potabiritimodono-shu-xing">ポータビリティモードの属性</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#li">例</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#indekkusu-mingnofomatto">インデックス名のフォーマット</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#shikensu-mingnofomatto">シーケンス名のフォーマット</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#teburu-mingnofomatto">テーブル名のフォーマット</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#detabesu-mingnofomatto">データベース名のフォーマット</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#barideshon-shu-xing">バリデーション属性</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#barideshonmodono-ding-shu">バリデーションモードの定数</a>


</li>
            <li class="toc-item">
    <a href="configuration.html#li">例</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="connections.html#hajimeni">はじめに</a>


</li>
    <li class="toc-item">
    <a href="data-fixtures.html#inpotosuru">インポートする</a>


</li>
    <li class="toc-item">
    <a href="data-hydrators.html#koahaidoreshonmesoddo">コアハイドレーションメソッド</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="data-hydrators.html#rekodo">レコード</a>


</li>
            <li class="toc-item">
    <a href="data-hydrators.html#pei-lie">配列</a>


</li>
            <li class="toc-item">
    <a href="data-hydrators.html#sukara">スカラー</a>


</li>
            <li class="toc-item">
    <a href="data-hydrators.html#shingurusukara">シングルスカラー</a>


</li>
            <li class="toc-item">
    <a href="data-hydrators.html#ondemando">オンデマンド</a>


</li>
            <li class="toc-item">
    <a href="data-hydrators.html#rure-zi-ji-henorekodo-jie-ceng">入れ子集合のレコード階層</a>


</li>
            <li class="toc-item">
    <a href="data-hydrators.html#rure-zi-ji-heno-pei-lie-jie-ceng">入れ子集合の配列階層</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="data-validation.html#hajimeni">はじめに</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="data-validation.html#not-null">Not Null</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="data-validation.html#user-columns-username-type-string-255-notnull-true-primary-true">User: columns: username: type: string(255) notnull: true primary: true #</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="data-validation.html#emeru">Eメール</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#not-blank">Not Blank</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#no-space">No Space</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#past">Past</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#future">Future</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#zui-xiao-zhang">最小長</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#country">Country</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#ipadoresu">IPアドレス</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#html-color">HTML Color</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="data-validation.html#user-columns-favorite-color-type-string-7-htmlcolor-true">User: columns: # ... favorite_color: type: string(7) htmlcolor: true #</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="data-validation.html#range">Range</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#unique">Unique</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#zheng-gui-biao-xian">正規表現</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#kurejittokado">クレジットカード</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="data-validation.html#user-columns-cc-number-type-integer-16-creditcard-true">User: columns: # ... cc_number: type: integer(16) creditcard: true #</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="data-validation.html#read-only">Read Only</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="data-validation.html#user-columns-readonly-value-type-integer-16-readonly-true">User: columns: # ... readonly_value: type: integer(16) readonly: true #</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="data-validation.html#unsigned">Unsigned</a>


</li>
            <li class="toc-item">
    <a href="data-validation.html#us-state">US State</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="database-abstraction-layer.html#ekusupoto">エクスポート</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="database-abstraction-layer.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#detabesuwo-zuo-chengsuru">データベースを作成する</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#teburuwo-zuo-chengsuru">テーブルを作成する</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#wai-bukiwo-zuo-chengsuru">外部キーを作成する</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#teburuwo-bian-gengsuru">テーブルを変更する</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#indekkusuwo-zuo-chengsuru">インデックスを作成する</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#detabesuno-yao-suwo-xue-chusuru">データベースの要素を削除する</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#shao-jie">紹介</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#detabesuno-yi-lanwo-biao-shisuru">データベースの一覧を表示する</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="database-abstraction-layer.html#databases-conn-import-listdatabases-print-r-databases">// ... $databases = conn-&gt;import-&gt;listDatabases(); print_r(databases);</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#shikensuno-yi-lanwo-biao-shisuru">シーケンスの一覧を表示する</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#byuno-yi-lanwo-biao-shisuru">ビューの一覧を表示する</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#potaburuna-xuan-yanwo-qu-desuru">ポータブルな宣言を取得する</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#neitibuna-xuan-yanwo-qu-desuru">ネイティブな宣言を取得する</a>


</li>
            <li class="toc-item">
    <a href="database-abstraction-layer.html#mysql">Mysql</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="database-abstraction-layer.html#teburu-xingwo-she-dingsuru">テーブル型を設定する</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="defining-models.html#karamu">カラム</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="defining-models.html#karamunoeiriasu">カラムのエイリアス</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#deforutono-zhi">デフォルトの値</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#detano-xing">データの型</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="defining-models.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#xing-xiu-shi-zi">型修飾子</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#lun-li-xing">論理型</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#zheng-shu-xing">整数型</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#fu-dong-xiao-shu-dian-xing">浮動小数点型</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#xiao-shu-xing">小数型</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#wen-zi-lie-xing">文字列型</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#pei-lie">配列</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#obujekuto">オブジェクト</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#blob">blob</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#clob">clob</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#timestamp">timestamp</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#time">time</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#date">date</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#enum">enum</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#gzip">gzip</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="defining-models.html#li">例</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#wai-bukinoasoshieshon">外部キーのアソシエーション</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="defining-models.html#yi-dui-yi">一対一</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#yi-dui-duoto-duo-dui-yi">一対多と多対一</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#tsuri-gou-zao">ツリー構造</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="defining-models.html#teburunoasoshieshonwojoinsuru">テーブルのアソシエーションをジョインする</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="defining-models.html#duo-dui-duo">多対多</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#wai-bukino-ming-qian">外部キーの名前</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#zheng-heakushon">整合アクション</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="defining-models.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#indekkusuwo-zhui-jiasuru">インデックスを追加する</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#indekkusuopushon">インデックスオプション</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#te-bienaindekkusu">特別なインデックス</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#apurikeshonreberunokasukedo">アプリケーションレベルのカスケード</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="defining-models.html#bao-cunkasukedo">保存カスケード</a>


</li>
            <li class="toc-item">
    <a href="defining-models.html#xue-chukasukedo">削除カスケード</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="defining-models.html#detabesureberunokasukedo">データベースレベルのカスケード</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="dql-doctrine-query-language.html#hajimeni">はじめに</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#distinctkiwado">DISTINCTキーワード</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#ji-yue-zhi">集約値</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#onkiwado">ONキーワード</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#withkiwado">WITHキーワード</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#riteraru">リテラル</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#ru-liparameta">入力パラメータ</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#yan-suan-zito-you-xian-shun-wei">演算子と優先順位</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#in-shi">IN式</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#like-shi">LIKE式</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#exists-shi">EXISTS式</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#alltoanyno-shi">AllとAnyの式</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#sabukueri">サブクエリ</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#wen-zi-lie-guan-shu">文字列関数</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#suan-shu-guan-shu">算術関数</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#sabukueriwo-li-yongsuru-bi-jiao">サブクエリを利用する比較</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#ji-yue-zhidesotosuru">集約値でソートする</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#randamu-shunwo-shiu">ランダム順を使う</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#doraibanopotabiriti">ドライバーのポータビリティ</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#limit-subquery-algorithm">limit-subquery-algorithm</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#ming-qian-fukikueriwo-zuo-chengsuru">名前付きクエリを作成する</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#ming-qian-fukikueriniakusesusuru">名前付きクエリにアクセスする</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#ming-qian-fukikueriwo-shi-xingsuru">名前付きクエリを実行する</a>


</li>
            <li class="toc-item">
    <a href="dql-doctrine-query-language.html#ming-qian-fukikuerinikurosuakusesusuru">名前付きクエリにクロスアクセスする</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="event-listeners.html#hajimeni">はじめに</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="event-listeners.html#xinshiirisunawo-zuo-chengsuru">新しいリスナーを作成する</a>


</li>
            <li class="toc-item">
    <a href="event-listeners.html#risunawo-zhui-jiasuru">リスナーを追加する</a>


</li>
            <li class="toc-item">
    <a href="event-listeners.html#pure-jie-xutoposuto-jie-xu">プレ接続とポスト接続</a>


</li>
            <li class="toc-item">
    <a href="event-listeners.html#toranzakushonrisuna">トランザクションリスナー</a>


</li>
            <li class="toc-item">
    <a href="event-listeners.html#kueri-shi-xingrisuna">クエリ実行リスナー</a>


</li>
            <li class="toc-item">
    <a href="event-listeners.html#inbokawo-qu-desuru">インボーカーを取得する</a>


</li>
            <li class="toc-item">
    <a href="event-listeners.html#ibentokodo">イベントコード</a>


</li>
            <li class="toc-item">
    <a href="event-listeners.html#inbokawo-qu-desuru">インボーカーを取得する</a>


</li>
            <li class="toc-item">
    <a href="event-listeners.html#cinoopereshonwosukippusuru">次のオペレーションをスキップする</a>


</li>
            <li class="toc-item">
    <a href="event-listeners.html#cinorisunawosukippusuru">次のリスナーをスキップする</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="exceptions-and-warnings.html#manejano-li-wai">マネージャーの例外</a>


</li>
    <li class="toc-item">
    <a href="extensions.html#extensions">Extensions</a>


</li>
    <li class="toc-item">
    <a href="getting-started.html#yao-jianwo-que-rensuru">要件を確認する</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="getting-started.html#sandobokkusu">サンドボックス</a>


</li>
            <li class="toc-item">
    <a href="getting-started.html#svn">SVN</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="getting-started.html#insutorusuru">インストールする</a>


</li>
            <li class="toc-item">
    <a href="getting-started.html#geng-xinsuru">更新する</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="getting-started.html#svn-externals">SVN Externals</a>


</li>
            <li class="toc-item">
    <a href="getting-started.html#pearinsutora">PEARインストーラ</a>


</li>
            <li class="toc-item">
    <a href="getting-started.html#pearpakkejiwodaunrodosuru">Pearパッケージをダウンロードする</a>


</li>
            <li class="toc-item">
    <a href="getting-started.html#doctrineraiburariwoinkurudosuru">Doctrineライブラリをインクルードする</a>


</li>
            <li class="toc-item">
    <a href="getting-started.html#doctrineno-ji-dikurasuworequiresuru">Doctrineの基底クラスをrequireする</a>


</li>
            <li class="toc-item">
    <a href="getting-started.html#otorodawo-deng-lusuru">オートローダーを登録する</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="getting-started.html#otorodo-ji-nengno-shuo-ming">オートロード機能の説明</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="getting-started.html#butosutorappufairu">ブートストラップファイル</a>


</li>
            <li class="toc-item">
    <a href="getting-started.html#tesutosukuriputo">テストスクリプト</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="hierarchical-data.html#hajimeni">はじめに</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="hierarchical-data.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#settoappusuru">セットアップする</a>


</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#maruchipurutsuri">マルチプルツリー</a>


</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#working-with-trees">Working with Trees</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="hierarchical-data.html#rootnodowo-zuo-chengsuru">rootノードを作成する</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="hierarchical-data.html#child1-getnode-insertaslastchildof-category-child2-getnode-insertaslastchildof-category">child1-&gt;getNode()-&gt;insertAsLastChildOf(category);child2-&gt;getNode()-&gt;insertAsLastChildOf(category);</a>


</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#nodowo-xue-chusuru">ノードを削除する</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#nodowo-yi-dongsaseru">ノードを移動させる</a>


</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#nodowo-jian-zhasuru">ノードを検査する</a>


</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#xiong-dino-jian-zhato-dumi-yumi">兄弟の検査と読み込み</a>


</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#zi-sunno-jian-zhato-dumi-quri">子孫の検査と読み取り</a>


</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#dan-chun-muworendaringusuru">単純木をレンダリングする</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#gao-duna-shii-fang">高度な使い方</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="hierarchical-data.html#rireshondetsuriwo-qu-desuru">リレーションでツリーを取得する</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="hierarchical-data.html#indentoderendaringusuru">インデントでレンダリングする</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="improving-performance.html#hajimeni">はじめに</a>


</li>
    <li class="toc-item">
    <a href="index.html#manual">Manual</a>


</li>
    <li class="toc-item">
    <a href="inheritance.html#dan-yi-ji-cheng">単一継承</a>


</li>
    <li class="toc-item">
    <a href="introduction.html#kodono-li">コードの例</a>


</li>
    <li class="toc-item">
    <a href="introduction-to-connections.html#dsn-data-source-name">DSN、Data Source Name</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="introduction-to-connections.html#li">例</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="introduction-to-models.html#hajimeni">はじめに</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="introduction-to-models.html#ji-cunnodetabesu">既存のデータベース</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="introduction-to-models.html#zui-chunoinpotowo-xingu">最初のインポートを行う</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="introduction-to-models.html#sukimafairu">スキーマファイル</a>


</li>
            <li class="toc-item">
    <a href="introduction-to-models.html#konsabatibu">コンサーバティブ</a>


</li>
            <li class="toc-item">
    <a href="introduction-to-models.html#aguresshibu">アグレッシブ</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="license.html#attribution-share-alike-3-0-unported-license">Attribution-Share Alike 3.0 Unported License</a>


</li>
    <li class="toc-item">
    <a href="migrations.html#maigureshonwo-shi-xingsuru">マイグレーションを実行する</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="migrations.html#li-yong-ke-nengnaopereshon">利用可能なオペレーション</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="migrations.html#teburuwo-zuo-chengsuru">テーブルを作成する</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#teburuwo-xue-chusuru">テーブルを削除する</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#teburuworinemusuru">テーブルをリネームする</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#zhi-yuewo-zuo-chengsuru">制約を作成する</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#zhi-yuewo-xue-chusuru">制約を削除する</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#wai-bukiwo-xue-chusuru">外部キーを削除する</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#wai-bukiwo-xue-chusuru">外部キーを削除する</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#karamuwo-zhui-jiasuru">カラムを追加する</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#karamuworinemusuru">カラムをリネームする</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#karamuwo-bian-gengsuru">カラムを変更する</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#karamuwo-xue-chusuru">カラムを削除する</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#bu-ke-ninamaigureshon">不可逆なマイグレーション</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#indekkusuwo-zhui-jiasuru">インデックスを追加する</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#indekkusuwo-xue-chusuru">インデックスを削除する</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="migrations.html#purefukkutoposutofukku">プレフックとポストフック</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#up-downno-zi-dong-hua">Up/Downの自動化</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#maigureshonwo-sheng-chengsuru">マイグレーションを生成する</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="migrations.html#detabesukara">データベースから</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#ji-cunnomoderukara">既存のモデルから</a>


</li>
            <li class="toc-item">
    <a href="migrations.html#cha-fentsuru">差分ツール</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="native-sql.html#hajimeni">はじめに</a>


</li>
    <li class="toc-item">
    <a href="real-world-examples.html#yuza-guan-lishisutemu">ユーザー管理システム</a>


</li>
    <li class="toc-item">
    <a href="searching.html#hajimeni">はじめに</a>


</li>
    <li class="toc-item">
    <a href="technology.html#hajimeni">はじめに</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="technology.html#doctrine-core">Doctrine CORE</a>


</li>
            <li class="toc-item">
    <a href="technology.html#doctrine-dbal">Doctrine DBAL</a>


</li>
            <li class="toc-item">
    <a href="technology.html#doctrine-orm">Doctrine ORM</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="transactions.html#hajimeni">はじめに</a>


</li>
    <li class="toc-item">
    <a href="unit-testing.html#tesutowo-shi-shisuru">テストを実施する</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="unit-testing.html#cli">CLI</a>


</li>
            <li class="toc-item">
    <a href="unit-testing.html#burauza">ブラウザ</a>


</li>
            <li class="toc-item">
    <a href="unit-testing.html#chikettotesuto">チケットテスト</a>


</li>
            <li class="toc-item">
    <a href="unit-testing.html#tesuto-yongnomesoddo">テスト用のメソッド</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="unit-testing.html#equalwoasatosuru">Equalをアサートする</a>


</li>
            <li class="toc-item">
    <a href="unit-testing.html#not-equalwoasatosuru">Not Equalをアサートする</a>


</li>
            <li class="toc-item">
    <a href="unit-testing.html#identicalwoasatosuru">Identicalをアサートする</a>


</li>
            <li class="toc-item">
    <a href="unit-testing.html#truewoasatosuru">Trueをアサートする</a>


</li>
            <li class="toc-item">
    <a href="unit-testing.html#falsewoasatosuru">Falseをアサートする</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="unit-testing.html#mokkudoraiba">モックドライバ</a>


</li>
            <li class="toc-item">
    <a href="unit-testing.html#tesutokurasunogaidorain">テストクラスのガイドライン</a>


</li>
            <li class="toc-item">
    <a href="unit-testing.html#tesutomesoddonogaidorain">テストメソッドのガイドライン</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="utilities.html#peji-fen-ge">ページ分割</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="utilities.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="utilities.html#pejawo-xiu">ページャーを扱う</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="utilities.html#suraidingu">スライディング</a>


</li>
            <li class="toc-item">
    <a href="utilities.html#janpingu">ジャンピング</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="utilities.html#pejaniyoru-gao-dunareiauto">ページャーによる高度なレイアウト</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="utilities.html#masuku">マスク</a>


</li>
            <li class="toc-item">
    <a href="utilities.html#tenpureto">テンプレート</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="utilities.html#pejareiautowokasutamaizusuru">ページャーレイアウトをカスタマイズする</a>


</li>
            <li class="toc-item">
    <a href="utilities.html#detabesuno-zuo-chengto-xue-chu">データベースの作成と削除</a>


</li>
            <li class="toc-item">
    <a href="utilities.html#konbiniensumesoddo">コンビニエンスメソッド</a>


</li>
            <li class="toc-item">
    <a href="utilities.html#hajimeni">はじめに</a>


</li>
            <li class="toc-item">
    <a href="utilities.html#tasuku">タスク</a>


</li>
            <li class="toc-item">
    <a href="utilities.html#insutoru-fang-fa">インストール方法</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="yaml-schema-files.html#hajimeni">はじめに</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="yaml-schema-files.html#rireshonwo-jian-chusuru">リレーションを検出する</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#rireshonwokasutamaizusuru">リレーションをカスタマイズする</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#yi-dui-yi">一対一</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#yi-dui-duo">一対多</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#duo-dui-duo">多対多</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#jie-xubaindingu">接続バインディング</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#shu-xing">属性</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#lie-ju-xing">列挙型</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#actasbiheibia">ActAsビヘイビア</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#risuna">リスナー</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#opushon">オプション</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#indekkusu">インデックス</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#ji-cheng">継承</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="yaml-schema-files.html#dan-yi-ji-cheng">単一継承</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#ju-xiang-ji-cheng">具象継承</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#karamu-ji-yue-ji-cheng">カラム集約継承</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#kasutamunoeiriasu">カスタムのエイリアス</a>


</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#pakkeji">パッケージ</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="yaml-schema-files.html#kasutamupasunopakkeji">カスタムパスのパッケージ</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="yaml-schema-files.html#gurobarusukimano-qing-bao">グローバルスキーマの情報</a>


</li>
                    </ul>
</li>
    </ul>
</div>
    

                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://www.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "Doctrine1",
            "item": "https://www.doctrine-project.org/projects/doctrine1.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://www.doctrine-project.org/projects/doctrine1/en/latest/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "マネージャー",
            "item": "https://www.doctrine-project.org/projects/doctrine1/ja/latest/manual/component-overview.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine1.html">Doctrine1</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine1/en/latest/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">マネージャー</li>
                        </ol>
</nav>
                                    </div>

                    
    <div class="alert caution bg-light-yellow text-dark border">
    <table width="100%">
        <tr>
            <td width="10" class="align-top">
                <i class="fas fa-exclamation-circle text-warning mr-2"></i>
            </td>
            <td><p>This project is no longer maintained and has been archived.</p></td>
        </tr>
    </table>
</div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine1/ja/latest/manual/component-overview.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        master
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item active" href="/projects/doctrine1/ja/latest/manual/component-overview.html">
                                                        master

                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                                                                                    </div>
                                </div>
                            
                            

            
    <p>この章はDoctrineを構成するすべてのメインコンポーネントとそれらの連携方法を鳥の目から見ることを目的としています。前の章で既に大半のコンポーネントを検討しましたがこの章ではすべてのコンポーネントとそれらのジョブの理解が進みます。</p>

                <div class="section" id="maneja">
            <h1 class="section-header ">
    <a href="#maneja">
        マネージャー
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p><code>Doctrine_Manager</code>クラスはSingletonで構成階層のrootでありDoctrineのいくつかの面をコントロールするFacadeです。次のコードでSingletonインスタンスを読み取ることができます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $manager = Doctrine_Manager::getInstance();</p>

            <div class="section" id="jie-xuwo-dumi-quru">
            <h2 class="section-header ">
    <a href="#jie-xuwo-dumi-quru">
        接続を読み取る
        <i class="fas fa-link"></i>
    </a>
</h2>
            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $connections = <code>manager-&gt;getConnections(); foreach (</code>connectionsas $connection) { echo $connection-&gt;getName() . &quot;&quot;; }</p>

            
    <p><code>Doctrine_Manager</code>はイテレータを実装するので接続をループするために変数$managerをループできます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... foreach ($manager as $connection) { echo $connection-&gt;getName() .
&quot;&quot;; }</p>

    </div>
    </div>
                <div class="section" id="jie-xu">
            <h1 class="section-header ">
    <a href="#jie-xu">
        接続
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p><code>Doctrine_Connection</code>はデータベース用のラッパーです。接続は典型的なPDOのインスタンスですが、Doctrineの設計のおおかげで、PDOが提供する機能を模倣する独自アダプタを設計することが可能です。</p>

            
    <p><code>Doctrine_Connection</code>クラスは次のことを対処します:</p>

            

<ul>
    <li class="dash">PDOから見つからないデータベースのポータビリティ機能(例えばLIMIT/OFFSETのエミュレーション)を処理する</li>
    <li class="dash"><code>Doctrine_Table</code>オブジェクトの経過を追跡する</li>
    <li class="dash">レコードの経過を追跡する</li>
    <li class="dash">update/insert/deleteする必要のあるレコードの経過を追跡する</li>
    <li class="dash">トランザクションと入れ子構造のトランザクションを処理する</li>
    <li class="dash">INSERT / UPDATE /
DELETEオペレーションの場合の実際のデータベースクエリを処理する</li>
    <li class="dash">DQLを使用データベースクエリを行う。DQLは[doc
dql-doctrine-query-language :name]の章で学ぶことができる。</li>
    <li class="dash">オプションとしてDoctrine_Validatorを使用してトランザクションをバリデートしてあり得るエラーの全情報を示す</li>
</ul>

            <div class="section" id="li-yongdekirudoraiba">
            <h2 class="section-header ">
    <a href="#li-yongdekirudoraiba">
        利用できるドライバ
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>DoctrineはPDOがサポートするデータベース用のすべてのドライバを持ちます。サポートされるデータベースは次の通りです:</p>

            

<ul>
    <li class="dash">FreeTDS / Microsoft SQL Server / Sybase</li>
    <li class="dash">Firebird/Interbase 6</li>
    <li class="dash">Informix</li>
    <li class="dash">Mysql</li>
    <li class="dash">Oracle</li>
    <li class="dash">Odbc</li>
    <li class="dash">PostgreSQL</li>
    <li class="dash">Sqlite</li>
</ul>

    </div>
            <div class="section" id="jie-xuwo-zuo-chengsuru">
            <h2 class="section-header ">
    <a href="#jie-xuwo-zuo-chengsuru">
        接続を作成する
        <i class="fas fa-link"></i>
    </a>
</h2>
            <blockquote>
    <p>// bootstrap.php</p>
</blockquote>
            
    <p>// ... $conn =
Doctrine_Manager::connection(&#039;mysql://username:password@localhost/test&#039;,
&#039;connection 1&#039;);</p>

            <blockquote>
    <p><strong>NOTE</strong>
前の章で既に新しい接続を作成しました。上記のステップをスキップして既に作成した接続を使うことができます。<code>Doctrine_Manager::connection()</code>メソッドを使用して読み取ることができます。</p>
</blockquote>
    </div>
            <div class="section" id="jie-xuwoflushsuru">
            <h2 class="section-header ">
    <a href="#jie-xuwoflushsuru">
        接続をflushする
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>新しい<code>User</code>レコードを作成するときレコードは接続をflushしてその接続に対して保存されていないすべてのオブジェクトを保存します。下記は例です:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $conn = Doctrine_Manager::connection();</p>

            
    <p>$user1 = new User(); $user1-&gt;username = &#039;Jack&#039;;</p>

            
    <p>$user2 = new User(); $user2-&gt;username = &#039;jwage&#039;;</p>

            
    <p>$conn-&gt;flush();</p>

            
    <p><code>Doctrine_Connection::flush()</code>を呼び出せばその接続に対する未保存のレコードインスタンスが保存されます。もちろんオプションとしてそれぞれのレコードごとに<code>save()</code>を呼び出して同じことができます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user1-&gt;save(); $user2-&gt;save();</p>

    </div>
    </div>
                <div class="section" id="teburu">
            <h1 class="section-header ">
    <a href="#teburu">
        テーブル
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p><code>Doctrine\_Table</code>はコンポーネント(レコード)によって指定されるスキーマ情報を保有します。例えば<code>Doctrine_Record</code>を継承する<code>User</code>クラスがある場合、それぞれのスキーマ定義の呼び出しは後で使う情報を保有するユニークなテーブルオブジェクトにデリゲートされます。</p>

            
    <p>それぞれの<code>Doctrine\_Table</code>は<code>Doctrine_Connection</code>によって登録されます。下記に示されるそれぞれのコンポーネント用のテーブルオブジェクトを簡単に取得できます。</p>

            
    <p>例えば、Userクラス用のテーブルオブジェクトを読み取りたい場合を考えます。これは<code>User</code>を<code>Doctrine_Core::getTable()</code>メソッドの第一引数として渡すことで可能です。</p>

            <div class="section" id="teburuobujekutowo-qu-desuru">
            <h2 class="section-header ">
    <a href="#teburuobujekutowo-qu-desuru">
        テーブルオブジェクトを取得する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>指定するレコードのテーブルオブジェクトを取得するには、<code>Doctrine_Record::getTable()</code>を呼び出すだけです。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $accountTable = Doctrine_Core::getTable(&#039;Account&#039;);</p>

    </div>
            <div class="section" id="karamu-qing-baowo-qu-desuru">
            <h2 class="section-header ">
    <a href="#karamu-qing-baowo-qu-desuru">
        カラム情報を取得する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>適切な<code>Doctrine\_Table</code>メソッドを使用することで<code>Doctrine_Record</code>のカラム定義セットを読み取ることができます。すべてのカラムのすべての情報が必要な場合は次のように行います:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $columns = $accountTable-&gt;getColumns();</p>

            
    <p>$columns = <code>accountTable-&gt;getColumns(); foreach (</code>columns as<code>column) { print_r(</code>column); }
上記の例が実行されるときに次の内容が出力されます:</p>

            <blockquote>
    <p>$ php test.php Array ( [type] =&gt; integer [length] =&gt; 20 [autoincrement]</p>
</blockquote>
            
    <p>=&gt; 1 [primary] =&gt; 1 ) Array ( [type] =&gt; string [length] =&gt; 255 ) Array (
[type] =&gt; decimal [length] =&gt; 18 )</p>

            
    <p>ときにこれがやりすぎであることがあります。次の例はカラムの名前を配列として読み取る方法を示しています:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $names = <code>accountTable-&gt;getColumnNames(); print_r(</code>names);
上記の例が実行されるとき次の内容が出力されます:</p>

            <blockquote>
    <p>$ php test.php Array ( [0] =&gt; id [1] =&gt; name [2] =&gt; amount )</p>
</blockquote>
    </div>
            <div class="section" id="rireshonno-qing-baowo-qu-desuru">
            <h2 class="section-header ">
    <a href="#rireshonno-qing-baowo-qu-desuru">
        リレーションの情報を取得する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>次のように<code>Doctrine\_Table::getRelations()</code>を呼び出すことですべての<code>Doctrine_Relation</code>オブジェクトの配列を取得できます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $userTable = Doctrine_Core::getTable(&#039;User&#039;);</p>

            
    <p>$relations = $userTable-&gt;getRelations();</p>

            
    <p>foreach ($relations as $name =&gt; $relation) { echo $name . &quot;:&quot;; echo
&quot;Local - &quot; . $relation-&gt;getLocal() . &quot;&quot;; echo &quot;Foreign - &quot; .
$relation-&gt;getForeign() . &quot;&quot;; }</p>

            
    <p>上記の例が実行されるとき次の内容が出力されます:</p>

            <blockquote>
    <p>$ php test.php Email: Local - id Foreign - user_id</p>
</blockquote>
            
    <p>Phonenumbers: Local - id Foreign - user_id</p>

            
    <p>Groups: Local - user_id Foreign - group_id</p>

            
    <p>Friends: Local - user1 Foreign - user2</p>

            
    <p>Addresses: Local - id Foreign - user_id</p>

            
    <p>Threads: Local - id Foreign - user_id</p>

            
    <p><code>Doctrine\_Table::getRelation()</code>メソッドを使用することで個別のリレーション用の<code>Doctrine_Relation</code>オブジェクトを取得できます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $relation = $userTable-&gt;getRelation(&#039;Phonenumbers&#039;);</p>

            
    <p>echo &#039;Name: &#039; . $relation[&#039;alias&#039;] . &quot;&quot;; echo &#039;Local - &#039; .
$relation[&#039;local&#039;] . &quot;&quot;; echo &#039;Foreign - &#039; .
<code>relation[&#039;foreign&#039;] . &quot;\n&quot;; echo &#039;Relation Class - &#039; . get_class(</code>relation);
上記の例が実行されるとき次の内容が出力されます:</p>

            <blockquote>
    <p>$ php test.php Name: Phonenumbers Local - id Foreign - user_id</p>
</blockquote>
            
    <p>Relation Class - Doctrine_Relation_ForeignKey</p>

            <blockquote>
    <p><strong>NOTE</strong>
上記の例において変数<code>$relation}は}配列としてアクセスできる</code>Doctrine_Relation_ForeignKey<code>のインスタンスを格納していることに注目してください。多くのDoctrineのクラスのように、これが</code>ArrayAccess``を実装するからです。</p>
</blockquote>
            
    <p><code>toArray()</code>メソッドと<code>print_r()</code>を使用することでリレーションのすべての情報を検査してデバッグすることができます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            <div class="section" id="array-relation-toarray-print-r-array">
            <h3 class="section-header ">
    <a href="#array-relation-toarray-print-r-array">
        // ... $array = <code>relation-&gt;toArray(); print_r(</code>array);
        <i class="fas fa-link"></i>
    </a>
</h3>
    </div>
            <div class="section" id="faindamesoddo">
            <h3 class="section-header ">
    <a href="#faindamesoddo">
        ファインダーメソッド
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p><code>Doctrine_Table</code>は基本的なファインダーメソッドを提供します。これらのファインダーメソッドはとても速く書けるので1つのデータベーステーブルからデータを取得する場合に使われます。いくつかのコンポーネント(データベーステーブル)を使用するクエリが必要な場合
<code>Doctrine_Connection::query()</code>を使います。</p>

            
    <p>主キーで個別のユーザーを簡単に見つけるには<code>find()</code>メソッドを使用します:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = <code>userTable-&gt;find(2); print_r(</code>user-&gt;toArray());
上記の例が実行されるとき次の内容が出力されます:</p>

            <blockquote>
    <p>$ php test.php Array ( [id] =&gt; 2 [is_active] =&gt; 1 [is_super_admin]</p>
</blockquote>
            
    <p>=&gt; 0 [first_name] =&gt; [last_name] =&gt; [username] =&gt; jwage [password] =&gt;
[type] =&gt; [created_at] =&gt; 2009-01-21 13:29:12 [updated_at] =&gt;
2009-01-21 13:29:12 )</p>

            
    <p>データベースのすべての<code>User</code>レコードのコレクションを読み取るために<code>findAll()</code>メソッドを使うこともできます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... foreach ($userTable-&gt;findAll() as $user) { echo $user-&gt;username .
&quot;&quot;; }</p>

            
    <p>上記の例が実行されるとき次の内容が出力されます:</p>

            <blockquote>
    <p>$ php test.php Jack jwage</p>
<blockquote>
    <p><strong>CAUTION</strong>
<code>findAll()</code>メソッドは推奨されません。このメソッドがデータベースのすべてのレコードを返しリレーションから情報を読み取る場合高いクエリカウントを引き起こしながらそのデータを遅延ロードするからです。[doc
dql-doctrine-query-language
:name]の章を読めばレコードと関連レコードを効率的に読み取る方法を学べます。</p>
</blockquote></blockquote>
            
    <p><code>findByDql()</code>メソッドを使用して
DQLでレコードのセットを読み取ることもできます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users = $userTable-&gt;findByDql(&#039;username LIKE ?&#039;, &#039;%jw%&#039;);</p>

            
    <p>foreach($users as $user) { echo $user-&gt;username . &quot;&quot;; }</p>

            
    <p>上記の例が実行されるときに次の内容が出力されます:</p>

            <blockquote>
    <p>$ php test.php jwage</p>
</blockquote>
            
    <p>Doctrineは追加のマジックファインダーメソッドも提供します。この内容はDQLの章の[doc
dql-doctrine-query-language:magic-finders
:name]セクションで読むことができます。</p>

            <blockquote>
    <p><strong>NOTE</strong>
<code>Doctrine\_Table</code>によって提供される下記のすべてのファインダーメソッドはクエリを実行するために<code>Doctrine_Query</code>のインスタンスを使用します。オブジェクトは内部で動的に構築され実行されます。</p>

    <p>リレーションを通して複数のオブジェクトにアクセスするときは<code>Doctrine_Query</code>インスタンスを使用することが多いに推奨されます。そうでなければデータが遅延ロードされるので高いクエリカウントを得ることになります。[doc
dql-doctrine-query-language :name]の章で詳細を学ぶことができます。</p>
</blockquote>
            <div class="section" id="kasutamunoteburukurasu">
            <h4 class="section-header ">
    <a href="#kasutamunoteburukurasu">
        カスタムのテーブルクラス
        <i class="fas fa-link"></i>
    </a>
</h4>
            
    <p>カスタムのテーブルクラスを追加するのはとても楽です。行う必要のあるのはクラスを[componentName]Tableとして名付けこれらに<code>Doctrine_Table</code>を継承させます。<code>User</code>モデルに関して次のようなクラスを作ることになります:</p>

            <blockquote>
    <p>// models/UserTable.php</p>
</blockquote>
            
    <p>class UserTable extends Doctrine_Table { }</p>

    </div>
    </div>
    </div>
            <div class="section" id="kasutamunofainda">
            <h2 class="section-header ">
    <a href="#kasutamunofainda">
        カスタムのファインダー
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>カスタムのテーブルオブジェクトにカスタムのファインダーメソッドを追加できます。これらのファインダーメソッドは速い<code>Doctrine_Table</code>ファインダーメソッドもしくは[doc
dql-doctrine-query-language DQL API]
(<code>Doctrine_Query::create()</code>)を使用できます。</p>

            <blockquote>
    <p>// models/UserTable.php</p>
</blockquote>
            
    <p>class UserTable extends Doctrine_Table { public function
findByName(<code>name) { return Doctrine_Query::create() -&gt;from(&#039;User u&#039;) -&gt;where(&#039;u.name LIKE ?&#039;, &quot;%</code>name%&quot;)-&gt;execute(); } }</p>

            
    <p>Doctrineは<code>getTable()</code>を呼び出すときに<code>Doctrine\_Table</code>の子クラスである<code>UserTable</code>が存在するかチェックしそうである場合、デフォルトの<code>Doctrine_Table</code>の代わりにそのクラスのインスタンスを返します。</p>

            <blockquote>
    <p><strong>NOTE</strong>
カスタムの<code>Doctrine\_Table</code>クラスをロードするには、下記のように<code>bootstrap.php</code>ファイルで<code>autoload\_table_classes</code>属性を有効にしなければなりません。</p>
</blockquote>
            
    <p>// boostrap.php</p>

            
    <p>// ...
$manager-&gt;setAttribute(Doctrine_Core::ATTR_AUTOLOAD_TABLE_CLASSES,
true);</p>

            
    <p>これで<code>User</code>テーブルオブジェクトに問い合わせるとき次の内容が得られます:</p>

            <blockquote>
    <p>$userTable = Doctrine_Core::getTable(&#039;User&#039;);</p>
</blockquote>
            
    <p>echo get_class($userTable); // UserTable</p>

            
    <p>$users = $userTable-&gt;findByName(&quot;Jack&quot;);</p>

            <blockquote>
    <p><strong>NOTE</strong>
<code>findByName()</code>メソッドを追加する上記の例はマジックファインダーメソッドによって自動的に利用可能になります。DQLの章の[doc
dql-doctrine-query-language:magic-finders
:name]セクションで読むことができます。</p>
</blockquote>
    </div>
    </div>
                <div class="section" id="rekodo">
            <h1 class="section-header ">
    <a href="#rekodo">
        レコード
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p>Doctrineは<code>Doctrine_Record</code>子クラスを用いてRDBMSのテーブルを表します。これらのクラスはスキーマ情報、お婦四、属性などを定義する場所です。これらの子クラスのインスタンスはデータベースのレコードを表しこれらのオブジェクトでプロパティの取得と設定ができます。</p>

            <div class="section" id="puropati">
            <h2 class="section-header ">
    <a href="#puropati">
        プロパティ
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p><code>Doctrine_Record</code>のそれぞれ割り当てられたカラムプロパティはデータベースのテーブルカラムを表します。[doc
defining-models :name]の章でモデルの定義方法の詳細を学ぶことになります。</p>

            
    <p>カラムへのアクセスは簡単です:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $userTable = Doctrine_Core::getTable(&#039;User&#039;);</p>

            
    <p>$user = $userTable-&gt;find(1);</p>

            
    <p><strong>オーバーロードを通してプロパティにアクセスする</strong></p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... echo $user-&gt;username;</p>

            
    <p><strong>get()でプロパティにアクセスする</strong></p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... echo $user-&gt;get(&#039;username);</p>

            
    <p><strong>ArrayAccessでプロパティにアクセスする</strong></p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... echo $user[&#039;username&#039;];</p>

            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>カラムの値にアクセスする推奨方法はArrayAccessを使うことです。これによって必要に応じてレコードと配列取得を切り替えるのが簡単になるからです。</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>レコードのプロパティのイテレーションは配列のやり方と似ています。<code>foreach</code>コンストラクトを使用します。<code>Doctrine_Record</code>は<code>IteratorAggregate</code>インターフェイスを実装するのでこれは実現可能です。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... foreach ($user as $field =&gt; $value) { echo $field . &#039;: &#039; . $value
. &quot;&quot;; }</p>

            
    <p>配列に関してプロパティの存在のチェックには<code>isset()</code>を、プロパティをnullに設定するには<code>unset()</code>が利用できます。</p>

            
    <p>if文で&#039;name&#039;という名前のプロパティが存在するか簡単にチェックできます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... if (isset($user[&#039;username&#039;])) {</p>

            
    <p>}</p>

            
    <p>nameプロパティの割り当てを解除したい場合PHPの<code>unset()</code>関数を使うことができます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... unset($user[&#039;username&#039;]);</p>

            
    <p>レコードプロパティ用に値を設定するとき<code>Doctrine_Record::getModified()</code>を使用して修正されたフィールドと値の配列を取得できます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user[&#039;username&#039;] = &#039;Jack Daniels&#039;;</p>

            
    <p>print_r($user-&gt;getModified());</p>

            
    <p>上記のコードが実行されるとき次の内容が出力されます:</p>

            <blockquote>
    <p>$ php test.php Array ( [username] =&gt; Jack Daniels )</p>
</blockquote>
            
    <p><code>Doctrine_Record::isModified()</code>メソッドを使用してレコードが修正されることをチェックすることもできます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... echo $user-&gt;isModified() ? &#039;Modified&#039;:&#039;Not Modified&#039;;</p>

            
    <p>ときどき任意のレコードのカラムカウントを読み取りたいことがあります。これを行うには<code>count()</code>関数にレコードを引数として渡します。<code>Doctrine_Record</code>が<code>Countable</code>インターフェイスを実装するのでこれは可能です。他には<code>count()</code>メソッドを呼び出す方法があります。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... echo <code>record-&gt;count(); echo count(</code>record);
<code>Doctrine_Record</code>は任意のレコードの識別子にアクセスするための特別なメソッドを提供します。このメソッドは<code>identifier()</code>と呼ばれキーが識別子のフィールド名であり、値が、関連プロパティの値である配列を返します。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user[&#039;username&#039;] = &#039;Jack Daniels&#039;; $user-&gt;save();</p>

            
    <p>print_r($user-&gt;identifier()); // array(&#039;id&#039; =&gt; 1)</p>

            
    <p>よくあるのは配列の値を任意のレコードに割り当てることです。これらの値を個別に設定するのはやりずらいと思うかもしれません。しかし悩む必要はありません。<code>Doctrine_Record</code>は任意の配列もしくはレコードを別のものにマージする方法を提供します。</p>

            
    <p><code>merge()</code>メソッドはレコードもしくは配列のプロパティをイテレートしてオブジェクトに値を割り当てます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $values = array( &#039;username&#039; =&gt; &#039;someone&#039;, &#039;age&#039; =&gt; 11, );</p>

            
    <p><code>user-&gt;merge(</code>values);
echo $user-&gt;username; // someone echo $user-&gt;age; // 11</p>

            
    <p>次のように1つのレコードの値を別のものにマージすることもできます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user1 = new User(); $user1-&gt;username = &#039;jwage&#039;;</p>

            
    <p>$user2 = new User(); <code>user2-&gt;merge(</code>user1);
echo $user2-&gt;username; // jwage</p>

            <blockquote>
    <p><strong>NOTE</strong>
<code>Doctrine_Record</code>は<code>fromArray()</code>メソッドを持ちます。このメソッドは<code>merge()</code>に理想的なもので<code>toArray()</code>メソッドとの一貫性を保つためだけに存在します。</p>
</blockquote>
    </div>
            <div class="section" id="rekodowo-geng-xinsuru">
            <h2 class="section-header ">
    <a href="#rekodowo-geng-xinsuru">
        レコードを更新する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>オブジェクトの更新は非常に簡単で、<code>Doctrine\_Record::save()</code>メソッドを呼び出すだけです。他の方法は<code>Doctrine_Connection::flush()</code>を呼び出す方法でこの場合すべてのオブジェクトが保存されます。flushはsaveメソッドを呼び出すだけよりも重たいオペレーションであることに注意してください。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $userTable = Doctrine_Core::getTable(&#039;User&#039;);</p>

            
    <p>$user = $userTable-&gt;find(2);</p>

            
    <p>if ($user !== false) { $user-&gt;username = &#039;Jack Daniels&#039;;</p>

                <div class="console">
        <pre><code class="console">$user-&gt;save();</code></pre>
    </div>

            
    <p>}</p>

            
    <p>ときどき直接更新を行いたいことがあります。直接の更新においてオブジェクトはデータベースからロードされません。むしろデータベースの状態が直接更新されます。次の例においてすべてのユーザーを更新するためにDQL
UPDATE文を使います。</p>

            
    <p>すべてのユーザー名を小文字にするクエリを実行します:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $q = Doctrine_Query::create() -&gt;update(&#039;User u&#039;)
-&gt;set(&#039;u.username&#039;, &#039;LOWER(u.name)&#039;);</p>

            
    <p>$q-&gt;execute();</p>

            
    <p>レコードの識別子が既知であればオブジェクトを利用して更新を実行することもできます。<code>Doctrine\_Record::assignIdentifier()</code>メソッドを使うときこれはレコード識別子を設定し状態を変更するので<code>Doctrine_Record::save()</code>の呼び出しはinsertの代わりにupdateを実行します。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = new User(); $user-&gt;assignIdentifer(1); $user-&gt;username =
&#039;jwage&#039;; $user-&gt;save();</p>

    </div>
            <div class="section" id="rekodowo-zhiki-huaneru">
            <h2 class="section-header ">
    <a href="#rekodowo-zhiki-huaneru">
        レコードを置き換える
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>レコードを置き換えるのはシンプルです。まずは新しいオブジェクトをインスタンス化して保存します。次にデータベースに既に存在する同じ主キーもしくはユニークキーの値で新しいオブジェクトをインスタンス化すればデータベースで新しい列をinsertする代わりに列を置き換え/更新が行われます。下記は例です。</p>

            
    <p>最初に、ユーザー名がユニークインデックスである<code>User</code>モデルを想像してみましょう。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = new User(); $user-&gt;username = &#039;jwage&#039;; $user-&gt;password =
&#039;changeme&#039;; $user-&gt;save();</p>

            
    <p>次のクエリを発行します。</p>

            <blockquote>
    <p>INSERT INTO user (username, password) VALUES (?,?) (&#039;jwage&#039;,</p>
</blockquote>
            
    <p>&#039;changeme&#039;)</p>

            
    <p>別の新しいオブジェクトを作り同じユーザー名と異なるパスワードを設定します。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = new User(); $user-&gt;username = &#039;jwage&#039;; $user-&gt;password =
&#039;newpassword&#039;; $user-&gt;replace();</p>

            
    <p>次のクエリが発行されます</p>

            <blockquote>
    <p>REPLACE INTO user (id,username,password) VALUES (?,?,?) (null, &#039;jwage&#039;,</p>
</blockquote>
            
    <p>&#039;newpassword&#039;)</p>

            
    <p>新しいレコードがinsertされる代わりにレコードが置き換え/更新されます。</p>

    </div>
            <div class="section" id="rekodoworifuresshusuru">
            <h2 class="section-header ">
    <a href="#rekodoworifuresshusuru">
        レコードをリフレッシュする
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>ときにデータベースからのデータでレコードをリフレッシュしたいことがあります。<code>Doctrine_Record::refresh()</code>を使います。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = Doctrine_Core::getTable(&#039;User&#039;)-&gt;find(2);
$user-&gt;username = &#039;New name&#039;;</p>

            
    <p><code>Doctrine_Record::refresh()</code>メソッドを使う場合データベースからデータが再度選択されインスタンスのプロパティが更新されます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user-&gt;refresh();</p>

    </div>
            <div class="section" id="rireshonworifuresshusuru">
            <h2 class="section-header ">
    <a href="#rireshonworifuresshusuru">
        リレーションをリフレッシュする
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p><code>Doctrine_Record::refresh()</code>メソッドは既にロードされたレコードのリレーションをリフレッシュすることもできますが、オリジナルのクエリでこれらを指定する必要があります。</p>

            
    <p>最初に関連<code>Groups</code>で<code>User</code>を読み取りましょう:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $q = Doctrine_Query::create() -&gt;from(&#039;User u&#039;)
-&gt;leftJoin(&#039;u.Groups&#039;) -&gt;where(&#039;id = ?&#039;);</p>

            
    <p>$user = $q-&gt;fetchOne(array(1));</p>

            
    <p>関連<code>Users</code>で<code>Group</code>を読み取りましょう:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $q = Doctrine_Query::create() -&gt;from(&#039;Group g&#039;)
-&gt;leftJoin(&#039;g.Users&#039;) -&gt;where(&#039;id = ?&#039;);</p>

            
    <p>$group = $q-&gt;fetchOne(array(1));</p>

            
    <p><code>UserGroup</code>インスタンスで読み取られた<code>User</code>と<code>Group</code>をリンクしましょう:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $userGroup = new UserGroup(); $userGroup-&gt;user_id = $user-&gt;id;
$userGroup-&gt;group_id = $group-&gt;id; $userGroup-&gt;save();</p>

            
    <p><code>Group</code>を<code>User</code>に追加するだけで<code>User</code>を<code>Group</code>にリンクすることもできます。Doctrineは<code>UserGroup</code>インスタンスの作成を自動的に引き受けます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user-&gt;Groups[] = $group; $user-&gt;save()</p>

            
    <p><code>Doctrine_Record::refresh(true)</code>を呼び出す場合新しく作成された参照をロードするレコードとリレーションがリフレッシュされます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user-&gt;refresh(true); $group-&gt;refresh(true);</p>

            
    <p><code>Doctrine_Record::refreshRelated()</code>を使用してモデルの定義されたすべてのリレーションを遅延リフレッシュすることもできます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = Doctrine_Core::getTable(&#039;User&#039;)-&gt;findOneByName(&#039;jon&#039;);
$user-&gt;refreshRelated();</p>

            
    <p>リレーションを個別に指定してリフレッシュしたい場合リレーションの名前を<code>refreshRelated()</code>メソッドに渡せばリレーションは遅延ロードされます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user-&gt;refreshRelated(&#039;Phonenumber&#039;);</p>

    </div>
            <div class="section" id="rekodowo-xue-chusuru">
            <h2 class="section-header ">
    <a href="#rekodowo-xue-chusuru">
        レコードを削除する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Doctrineでのレコード削除は<code>Doctrine\_Record::delete()</code>、<code>Doctrine\_Collection::delete()</code>と<code>Doctrine_Connection::delete()</code>メソッドによって処理されます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $userTable = Doctrine_Core::getTable(&quot;User&quot;);</p>

            
    <p>$user = $userTable-&gt;find(2);</p>

            
    <p>// ユーザーと関連コンポジットオブジェクトすべてを削除する if($user !==
false) { $user-&gt;delete(); }</p>

            
    <p><code>User</code>レコードの<code>Doctrine\_Collection</code>がある場合<code>delete()</code>を呼び出すと<code>Doctrine_Record::delete()</code>が呼び出されてすべてのレコードがループされます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users = $userTable-&gt;findAll();</p>

            
    <p><code>Doctrine_Collection::delete()</code>を呼び出すことですべてのユーザーと関連コンポジットオブジェクトを削除できます。deleteを1つずつ呼び出すことでコレクションのすべての<code>Users</code>がループされます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users-&gt;delete();</p>

    </div>
            <div class="section" id="shino-zhiwo-shiu">
            <h2 class="section-header ">
    <a href="#shino-zhiwo-shiu">
        式の値を使う
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>SQLの式をカラムの値として使う必要のある状況があります。これはポータブルなDQL式をネイティブなSQL式に変換する<code>Doctrine_Expression</code>を使用することで実現できます。</p>

            
    <p><code>timepoint(datetime)</code>と<code>name(string)</code>のカラムを持つeventという名前のクラスがある場合を考えてみましょう。現在のタイムスタンプによるレコードの保存は次のように実現されます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = new User(); $user-&gt;username = &#039;jwage&#039;; $user-&gt;updated_at
= new Doctrine_Expression(&#039;NOW()&#039;); $user-&gt;save();</p>

            
    <p>上記のコードは次のSQLクエリを発行します:</p>

            <blockquote>
    <p>INSERT INTO user (username, updated_at_) VALUES (&#039;jwage&#039;, NOW())</p>
</blockquote>
            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>更新された値を取得するためにオブジェクトで<code>Doctrine_Expression</code>を使うとき<code>refresh()</code>を呼び出さなければなりません。</p>

    <p>// test.php</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>// ... $user-&gt;refresh();</p>

    </div>
            <div class="section" id="rekodono-zhuang-taiwo-qu-desuru">
            <h2 class="section-header ">
    <a href="#rekodono-zhuang-taiwo-qu-desuru">
        レコードの状態を取得する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>それぞれの<code>Doctrine\_Record</code>は状態を持ちます。最初のすべてレコードは一時的もしくは永続的になります。データベースから読み取られたすべてのレコードは永続的に新しく作成されたすべてのレコードは一時的なものと見なされます。<code>Doctrine_Record</code>がデータベースから読み取られるが唯一ロードされたプロパティが主キーである場合、このレコードはプロキシと呼ばれる状態を持ちます。</p>

            
    <p>一時的もしくは永続的なすべての<code>Doctrine\_Record</code>はcleanもしくはdirtyのどちらかです。<code>Doctrine_Record</code>はプロパティが変更されていないときはcleanで少なくともプロパティの1つが変更されたときはdirtyです。</p>

            
    <p>レコードはlockedと呼ばれる状態を持つこともできます。まれに起きる循環参照の場合に無限反復を避けるためにDoctrineは現在レコードで操作オペレーションが行われていることを示すこの状態を内部で使用します。</p>

            
    <p>レコードがなり得るすべての異なる状態と手短な説明を含むテーブルは下記の通りです:</p>

            
    <p>||&nbsp; 名前 ||&nbsp; 説明 || || <code>Doctrine\_Record::STATE_PROXY</code> ||
レコードがproxyの状態にある一方で、永続性とすべてではないプロパティがデータベースからロードされる。
|| || <code>Doctrine\_Record::STATE_TCLEAN</code> ||
レコードが一時的にcleanである一方で、一時性が変更されプロパティは変更されない。||
|| <code>Doctrine\_Record::STATE_TDIRTY</code> ||
レコードが一時的にdirtyである一方で、一時性とプロパティの一部が変更される。||
|| <code>Doctrine\_Record::STATE_DIRTY</code> ||
レコードがdirtyである一方で永続性とプロパティの一部が変更される。||
|| <code>Doctrine\_Record::STATE_CLEAN</code> ||
レコードがcleanである一方で、永続性は変更されプロパティは変更されない。||
|| <code>Doctrine\_Record::STATE_LOCKED</code> ||
レコードがロックされる。||</p>

            
    <p><code>Doctrine_Record::state()</code>メソッドを使用してレコードの状態を簡単に取得できます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = new User();</p>

            
    <p>if ($user-&gt;state() == Doctrine_Record::STATE_TDIRTY) { echo &#039;Record is
transient dirty&#039;; }</p>

            <blockquote>
    <p><strong>NOTE</strong>
上記のオブジェクトは<code>TDIRTY</code>です。これがスキーマで指定されたデフォルトの値をいくつか持つからです。デフォルトの値を持たないオブジェクトを使い新しいインスタンスを作成すると<code>TCLEAN</code>が返されます。</p>
</blockquote>
            
    <p>// test.php</p>

            
    <p>// ... $account = new Account();</p>

            
    <p>if ($account-&gt;state() == Doctrine_Record::STATE_TCLEAN) { echo &#039;Record
is transient clean&#039;; }</p>

    </div>
            <div class="section" id="obujekutonokopiwo-qu-desuru">
            <h2 class="section-header ">
    <a href="#obujekutonokopiwo-qu-desuru">
        オブジェクトのコピーを取得する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>ときにオブジェクトのコピーを手に入れたいことがあります(コピーされたすべてのプロパティを持つオブジェクト)。Doctrineはこのためのシンプルなメソッド:
<code>Doctrine_Record::copy()</code>を提供します。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $copy = $user-&gt;copy();</p>

            
    <p><code>copy()</code>でレコードをコピーすると古いレコードの値を持つ新しいレコード(<code>TDIRTY</code>の状態)が返され、そのレコードのリレーションがコピーされることに注意してください。リレーションもコピーしたくなければ、<code>copy(false)</code>を使う必要があります。</p>

            
    <p><strong>リレーション無しのユーザーのコピーを入手する</strong></p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $copy = $user-&gt;copy(false);</p>

            
    <p>PHPの<code>clone</code>キーワードを使えばこの<code>copy()</code>メソッドが内部で使用されます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $copy = clone $user;</p>

    </div>
            <div class="section" id="kong-bainorekodowo-bao-cunsuru">
            <h2 class="section-header ">
    <a href="#kong-bainorekodowo-bao-cunsuru">
        空白のレコードを保存する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>デフォルトでは未修整のレコードで<code>save()</code>メソッドが呼び出されているときDoctrineは実行しません。レコードが修正されていなくてもレコードを強制的にINSERTしたい状況があります。これはレコードの状態を<code>Doctrine\_Record::STATE_TDIRTY</code>を割り当てることで実現できます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = new User(); $user-&gt;state(&#039;TDIRTY&#039;); $user-&gt;save();</p>

    </div>
            <div class="section" id="kasutamuno-zhiwomappingusuru">
            <h2 class="section-header ">
    <a href="#kasutamuno-zhiwomappingusuru">
        カスタムの値をマッピングする
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>カスタムの値をレコードにマッピングしたい状況があります。例えば値が外部のリソースに依存しておりこれらの値をデータベースにシリアライズして保存せずに実行時に利用可能にすることだけを行いたい場合があります。これは次のように実現できます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user-&gt;mapValue(&#039;isRegistered&#039;, true);</p>

            
    <p>$user-&gt;isRegistered; // true</p>

    </div>
            <div class="section" id="shiriaraizu">
            <h2 class="section-header ">
    <a href="#shiriaraizu">
        シリアライズ
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>ときにレコードオブジェクトをシリアライズしたいことがあります(例えばキャッシュを保存するため):</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... <code>string = serialize(</code>user);
<code>user = unserialize(</code>string);
------------------
存在をチェックする
------------------</p>

            
    <p>レコードがデータベースに存在するか知りたいことがとてもよくあります。任意のレコードがデータベースの列の同等の内容を持つかを確認するために<code>exists()</code>メソッドを使うことができます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $record = new User();</p>

            
    <p>echo $record-&gt;exists() ? &#039;Exists&#039;:&#039;Does Not Exist&#039;; // Does Not Exist</p>

            
    <p>$record-&gt;username = &#039;someone&#039;; $record-&gt;save();</p>

            
    <p>echo $record-&gt;exists() ? &#039;Exists&#039;:&#039;Does Not Exist&#039;; // Exists</p>

    </div>
            <div class="section" id="karamu-yongnokorubakku-guan-shu">
            <h2 class="section-header ">
    <a href="#karamu-yongnokorubakku-guan-shu">
        カラム用のコールバック関数
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p><code>Doctrine_Record</code>はカラムを呼び出すコールバックを添付する方法を提供します。例えば特定のカラムをトリムしたい場合、次のメソッドを使うことができます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $record-&gt;call(&#039;trim&#039;, &#039;username&#039;);</p>

    </div>
    </div>
                <div class="section" id="korekushon">
            <h1 class="section-header ">
    <a href="#korekushon">
        コレクション
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p><code>Doctrine\_Collection</code>はレコードのコレクションです(Doctrine_Recordを参照)。レコードに関してコレクションは<code>Doctrine\_Collection::delete()</code>と<code>Doctrine_Collection::save()</code>をそれぞれ使用して削除と保存ができます。</p>

            
    <p>DQL API(<code>Doctrine_Query</code>を参照)もしくはrawSql
API(<code>Doctrine\_RawSql</code>を参照)のどちらかでデータベースからデータを取得するとき、デフォルトではメソッドは<code>Doctrine_Collection</code>のインスタンスを返します。</p>

            
    <p>次の例では新しいコレクションを初期化する方法を示しています:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users = new Doctrine_Collection(&#039;User&#039;);</p>

            
    <p>コレクションにデータを追加します:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users[0]-&gt;username = &#039;Arnold&#039;; $users[1]-&gt;username = &#039;Somebody&#039;;</p>

            
    <p>コレクションの削除と同じように保存もできます:</p>

            <blockquote>
    <p>$users-&gt;save();</p>
</blockquote>
            <div class="section" id="yao-suniakusesusuru">
            <h2 class="section-header ">
    <a href="#yao-suniakusesusuru">
        要素にアクセスする
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p><code>set()</code>と<code>get()</code>メソッドもしくはArrayAccessインターフェイスで<code>Doctrine_Collection</code>の要素にアクセスできます。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $userTable = Doctrine_Core::getTable(&#039;User&#039;); $users =
$userTable-&gt;findAll();</p>

            
    <p><strong>ArrayAccessインターフェイスで要素にアクセスする</strong></p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users[0]-&gt;username = &quot;Jack Daniels&quot;; $users[1]-&gt;username = &quot;John
Locke&quot;;</p>

            
    <p><strong>get()で要素にアクセスする</strong></p>

            <blockquote>
    <p>echo $users-&gt;get(1)-&gt;username;</p>
</blockquote>
    </div>
            <div class="section" id="xinshii-yao-suwo-zhui-jiasuru">
            <h2 class="section-header ">
    <a href="#xinshii-yao-suwo-zhui-jiasuru">
        新しい要素を追加する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>存在しないコレクションの単独の要素とこれらの要素(レコード)にアクセスするときDoctrineはこれらを自動的に追加します。</p>

            
    <p>次の例ではデータベースからすべてのユーザー(5人)を取得しコレクションにユーザーの組を追加します。</p>

            
    <p>PHP配列に関してインデックスはゼロから始まります。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users = $userTable-&gt;findAll();</p>

            
    <p>echo count($users); // 5</p>

            
    <p>$users[5]-&gt;username = &quot;new user 1&quot;; $users[6]-&gt;username = &quot;new user 2&quot;;</p>

            
    <p>オプションとして配列インデックスから5と6を省略可能でその場合通常のPHP配列と同じように自動的にインクリメントされます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users[]-&gt;username = &#039;new user 3&#039;; // キーは7 $users[]-&gt;username
= &#039;new user 4&#039;; // キーは8</p>

    </div>
            <div class="section" id="korekushonnokauntowo-qu-desuru">
            <h2 class="section-header ">
    <a href="#korekushonnokauntowo-qu-desuru">
        コレクションのカウントを取得する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p><code>Doctrine_Collection::count()</code>メソッドはコレクションの現在の要素の数を返します。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users = $userTable-&gt;findAll();</p>

            
    <p>echo $users-&gt;count();</p>

            
    <p><code>Doctrine_Collection</code>はCountableインターフェイスを実装するの以前の例に対する妥当な代替方法はcount()メソッドにコレクションを引数として渡すことです。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... echo count($users);</p>

    </div>
            <div class="section" id="korekushonwo-bao-cunsuru">
            <h2 class="section-header ">
    <a href="#korekushonwo-bao-cunsuru">
        コレクションを保存する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p><code>Doctrine_Record</code>と同じようにコレクションは<code>save()</code>メソッドを呼び出すことで保存できます。<code>save()</code>が呼び出されるときDoctrineはすべてのレコードに対して<code>save()</code>オペレーションを実行しトランザクション全体のプロシージャをラップします。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users = $userTable-&gt;findAll();</p>

            
    <p>$users[0]-&gt;username = &#039;Jack Daniels&#039;;</p>

            
    <p>$users[1]-&gt;username = &#039;John Locke&#039;;</p>

            
    <p>$users-&gt;save();</p>

    </div>
            <div class="section" id="korekushonwo-xue-chusuru">
            <h2 class="section-header ">
    <a href="#korekushonwo-xue-chusuru">
        コレクションを削除する
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Doctrine
Recordsとまったく同じように<code>delete()</code>メソッドを呼び出すだけでDoctrine
Collectionsは削除できます。すべてのコレクションに関してDoctrineはsingle-shot-deleteを実行する方法を知っています。これはそれぞれのコレクションに対して1つのデータベースクエリのみが実行されることを意味します。</p>

            
    <p>例えば複数のコレクションがある場合を考えます。ユーザーのコレクションを削除するときDoctrineはトランザクション全体に対して1つのクエリのみを実行します。クエリは次のようになります:</p>

            <blockquote>
    <p>DELETE FROM user WHERE id IN (1,2,3, ... ,N)</p>
</blockquote>
    </div>
            <div class="section" id="kinomappingu">
            <h2 class="section-header ">
    <a href="#kinomappingu">
        キーのマッピング
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>ときにコレクションの要素用の通常のインデックス作成をしたくないことがあります。その場合例えば主キーをコレクションとしてマッピングすることが役に立つことがあります。次の例はこれを実現する方法を実演しています。</p>

            
    <p><code>id</code>カラムをマッピングします。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// .... $userTable = Doctrine_Core::getTable(&#039;User&#039;);</p>

            
    <p>$userTable-&gt;setAttribute(Doctrine_Core::ATTR_COLL_KEY, &#039;id&#039;);</p>

            
    <p>これで<code>user</code>コレクションは<code>id</code>カラムの値を要素インデックスとして使用します:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users = $userTable-&gt;findAll();</p>

            
    <p>foreach($users as $id =&gt; $user) { echo $id . $user-&gt;username; }</p>

            
    <p><code>name</code>カラムをマッピングするとよいでしょう:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $userTable = Doctrine_Core::getTable(&#039;User&#039;);</p>

            
    <p>$userTable-&gt;setAttribute(Doctrine_Core::ATTR_COLL_KEY, &#039;username&#039;);</p>

            
    <p>これでユーザーコレクションは<code>name</code>カラムの値を要素インデックスとして使用します:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users = $userTable-&gt;findAll();</p>

            
    <p>foreach($users as $username =&gt; $user) { echo $username . &#039; - &#039; .
$user-&gt;created_at . &quot;&quot;; }</p>

            <blockquote>
    <p><strong>CAUTION</strong>
スキーマで<code>username</code>カラムがuniqueとして指定された場合のみこれは利用可能であることに注意してください。そうでなければ重複するコレクションのキーのためにデータは適切にハイドレイトされない事態に遭遇することになります。</p>
</blockquote>
    </div>
            <div class="section" id="guan-lianrekodoworodosuru">
            <h2 class="section-header ">
    <a href="#guan-lianrekodoworodosuru">
        関連レコードをロードする
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Doctrineはすべてのレコード要素用のすべての関連レコードを効率的い読み取る方法を提供します。これは例えばユーザーのコレクションがある場合<code>loadRelated()</code>メソッドを呼び出すだけですべてのユーザーのすべての電話番号をロードできることを意味します。</p>

            
    <p>しかしながら、大抵の場合関連要素を明示的にロードする必要はなく、むしろ行うべきはDQL
APIとJOINを使用して一度にすべてをロードすることを試みることです。</p>

            
    <p>次の例ではユーザー、電話番号とユーザーが所属するグループを読み取るために3つのクエリを使用します。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $q = Doctrine_Query::create() -&gt;from(&#039;User u&#039;);</p>

            
    <p>$users = $q-&gt;execute();</p>

            
    <p>すべてのユーザーの電話番号をロードしてみましょう:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users-&gt;loadRelated(&#039;Phonenumbers&#039;);</p>

            
    <p>foreach($users as $user) { echo $user-&gt;Phonenumbers[0]-&gt;phonenumber; //
ここでは追加のDBクエリは不要 }</p>

            
    <p><code>loadRelated()</code>はリレーション、アソシエーションに対しても動作します:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users-&gt;loadRelated(&#039;Groups&#039;);</p>

            
    <p>foreach($users as $user) { echo $user-&gt;Groups[0]-&gt;name; }</p>

            
    <p>下記の例はDQL APIを使用してより効率的にこれを行う方法を示します。</p>

            
    <p>1つのクエリですべてをロードする<code>Doctrine_Query</code>を書きます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $q = Doctrine_Query::create() -&gt;from(&#039;User u&#039;)
-&gt;leftJoin(&#039;u.Phonenumbers p&#039;) -&gt;leftJoin(&#039;u.Groups g&#039;);</p>

            
    <p>$users = $q-&gt;execute();</p>

            
    <p><code>Phonenumbers</code>と<code>Groups</code>を使うとき追加のデータベースクエリは必要ありません:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... foreach($users as $user) { echo
$user-&gt;Phonenumbers[0]-&gt;phonenumber; echo $user-&gt;Groups[0]-&gt;name; }</p>

    </div>
    </div>
                <div class="section" id="barideta">
            <h1 class="section-header ">
    <a href="#barideta">
        バリデータ
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p>DoctrineのバリデーションはMVCアーキテクチャのモデル部分でビジネスルールを強制する方法です。このバリデーションを永続的なデータ保存が行われる直前に渡される必要のあるゲートウェイとみなすことができます。これらのビジネスルールの定義はレコードレベル、すなわちactive
recordモデルクラスにおいて行われます(<code>Doctrine\_Record</code>を継承するクラス)。この種のバリデーションを使うために最初に行う必要のあることはこれをグローバルに設定することです。これは<code>Doctrine_Manager</code>を通して行われます。</p>

            <blockquote>
    <p>// bootstrap.php</p>
</blockquote>
            
    <p>// ... $manager-&gt;setAttribute(Doctrine_Core::ATTR_VALIDATE,
Doctrine::VALIDATE_ALL);</p>

            
    <p>バリデーションを有効にすると、一連のバリデーションが自動的に使えるようになります:</p>

            

<ul>
    <li class="dash">データ型のバリデーション:
カラムに割り当てられるすべての値は正しい型であるかチェックされます。すなわち次のよに指定した場合</li>
</ul>

            
    <p>レコードのカラムが&#039;integer&#039;型である場合、Doctrineはそのカラムに割り当てられた値がその型であるかをバリデートします。PHPはゆるい型の言語なのでこの種の型バリデーションはできる限りスマートであるように試みます。例えば2は&quot;7&quot;と同じように有効な整数型である一方で&quot;3f&quot;はそうではありません。型バリデーションはすべてのカラムで行われます(すべてのカラム定義は型を必要とするからです)。</p>

            

<ul>
    <li class="dash">長さのバリデーション:
名前がほのめかす通り、カラムに割り当てられたすべての値が最大長を越えないことを確認するためにバリデートされます。</li>
</ul>

            
    <p>次の定数:
<code>VALIDATE\_ALL</code>、<code>VALIDATE\_TYPES</code>、<code>VALIDATE\_LENGTHS</code>、<code>VALIDATE\_CONSTRAINTS</code>、<code>VALIDATE_NONE</code>をビット演算子で結びつけることができます。</p>

            
    <p>例えば長さバリデーション以外のすべてのバリデーションを有効にするには次のように行います:</p>

            <blockquote>
    <p>// bootstrap.php</p>
</blockquote>
            
    <p>// ... $manager-&gt;setAttribute(Doctrine_Core::ATTR_VALIDATE,
VALIDATE_ALL &amp; &nbsp;VALIDATE_LENGTHS);</p>

            
    <p>[doc data-validation
:name]の章でこのトピックの詳細を読むことができます。</p>

            <div class="section" id="saranibarideshon">
            <h2 class="section-header ">
    <a href="#saranibarideshon">
        さらにバリデーション
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>型と長さバリデーションは手軽ですが大抵の場合これらだけでは十分ではありません。それゆえDoctrineはデータをより詳しくバリデートするために利用できるメカニズムを提供します。</p>

            
    <p>バリデータはさらにバリデーションを指定するための簡単な手段です。Doctrineは<code>email</code>、<code>country</code>、<code>ip</code>、<code>range</code>と<code>regexp</code>バリデータなど頻繁に必要とされるたくさんのバリデータを事前に定義しています。[doc
data-validation
:name]の章で利用可能なバリデータの全リストが見つかります。<code>hasColumn()</code>メソッドの4番目の引数を通してどのバリデータをどのカラムに適用するのかを指定できます。これが十分ではなく事前に定義されたバリデータとして利用できない特別なバリデータが必要な場合、3つの選択肢があります:</p>

            

<ul>
    <li class="dash">独自のバリデータを書けます。</li>
    <li class="dash">Doctrineの開発者に新しいバリデータのニーズを提案できます。</li>
    <li class="dash">バリデータフックが使えます。</li>
</ul>

            
    <p>最初の2つのオプションが推奨されます。バリデーションが一般的に利用可能で多くの状況に適用できるからです。このケースにおいて新しいバリデータを実装するのは良い考えです。しかしながら、バリデーションが特別なものでなければDoctrineが提供するフックを使う方がベターです:</p>

            

<ul>
    <li class="dash"><code>validate()</code> (レコードがバリデートされるたびに実行される)</li>
    <li class="dash"><code>validateOnInsert()</code>
(レコードが新しくバリデートされるときに実行される)</li>
    <li class="dash"><code>validateOnUpdate()</code>
(レコードが新しくなくバリデートされるときに実行される)</li>
</ul>

            
    <p>active recordで特殊なバリデーションが必要な場合active
recordクラス(<code>Doctrine_Record</code>の子孫)でこれらのメソッドの1つをオーバーライドできます。フィールドをバリデートするためにこれらのメソッドの範囲内でPHPのすべての力を使うことができます。フィールドがバリデーションを渡さないときエラーをレコードのエラーに追加できます。次のコードスニペットはカスタムバリデーションと一緒にバリデータを定義する例を示しています:</p>

            <blockquote>
    <p>// models/User.php</p>
</blockquote>
            
    <p>class User extends BaseUser { protected function validate() { if
($this-&gt;username == &#039;God&#039;) { // Blasphemy! Stop that! ;-) // syntax:
add(, ) $errorStack = $this-&gt;getErrorStack(); $errorStack-&gt;add(&#039;name&#039;,
&#039;You cannot use this username!&#039;); } } }</p>

            
    <p>// models/Email.php</p>

            
    <p>class Email extends BaseEmail { // ...</p>

                <div class="console">
        <pre><code class="console">public function setTableDefinition()
{
    parent::setTableDefinition();

    // ...

    // 使われる&#039;email&#039;と&#039;unique&#039;バリデータ
    $this-&gt;hasColumn(&#039;address&#039;,&#039;string&#039;, 150, array(&#039;email&#039;, &#039;unique&#039;));
}</code></pre>
    </div>

            
    <p>}</p>

            
    <p>YAMLフォーマットでの同じ例は次の通りです。[doc yaml-schema-files
:name]の章でYAMLの詳細を読むことができます:</p>

            <blockquote>
    <p># schema.yml</p>
</blockquote>
            
    <p>Email: columns: address: type: string(150) email: true unique: true</p>

    </div>
            <div class="section" id="validmoshikuhanot-valid">
            <h2 class="section-header ">
    <a href="#validmoshikuhanot-valid">
        ValidもしくはNot Valid
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>モデルでビジネスルールを指定する方法を理解したので、アプリケーションの残りの部分でこれらのルールを扱う方法を見てみましょう。</p>

            <div class="section" id="an-monobarideshon">
            <h4 class="section-header ">
    <a href="#an-monobarideshon">
        暗黙のバリデーション
        <i class="fas fa-link"></i>
    </a>
</h4>
            
    <p>(<code>$record-&gt;save()</code>の呼び出しを通して)レコードが永続的データとして保存されているときバリデーションの全手続きが実行されます。そのプロセスの間にエラーが起きると<code>Doctrine\_Validator\_Exception</code>型のエラーが投げられます。例外を補足して<code>Doctrine\_Validator\_Exception::getInvalidRecords()</code>インスタンスメソッドを使用してエラーを解析できます。このメソッドはバリデーションをパスしなかったすべてのレコードへの参照を持つ通常の配列を返します。それぞれのレコードのエラースタックを解析することでそれぞれのレコードのエラーを詳しく調査することができます。レコードのエラースタックは<code>Doctrine\_Record::getErrorStack()</code>インスタンスメソッドで取得できます。それぞれのエラースタックは<code>Doctrine\_Validator_ErrorStack</code>クラスのインスタンスです。エラースタックはエラーを検査するためのインターフェイスを簡単に使う方法を提供します。</p>

    </div>
            <div class="section" id="ming-shi-denabarideshon">
            <h4 class="section-header ">
    <a href="#ming-shi-denabarideshon">
        明示的なバリデーション
        <i class="fas fa-link"></i>
    </a>
</h4>
            
    <p>任意のときに任意のレコードに対してバリデーションを明示的に実行できます。この目的のために<code>Doctrine\_Record</code>は<code>Doctrine\_Record::isValid()</code>インスタンスメソッドを提供します。このメソッドはバリデーションの結果を示す論理型を返します。このメソッドがfalseを返す場合、例外が投げられないこと以外は上記と同じ方法でエラースタックを検査できるので、<code>Doctrine_Record::getErrorStack()</code>を通したバリデーションがパスしなかったレコードのエラースタックを得られます。</p>

            
    <p>次のコードスニペットは<code>Doctrine\_Validator_Exception</code>によって引き起こされる明示的なバリデーションの処理方法の例です。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = new User();</p>

            
    <p>try { $user-&gt;username = str_repeat(&#039;t&#039;, 256); $user-&gt;Email-&gt;address =
&quot;drink@@notvalid..&quot;; $user-&gt;save(); }
catch(Doctrine_Validator_Exception $e) { $userErrors =
$user-&gt;getErrorStack(); $emailErrors = $user-&gt;Email-&gt;getErrorStack();</p>

                <div class="console">
        <pre><code class="console">foreach($userErrors as $fieldName =&gt; $errorCodes) {
    echo $fieldName . &quot; - &quot; . implode(&#039;, &#039;, $errorCodes) . &quot;\n&quot;;
}

foreach($emailErrors as $fieldName =&gt; $errorCodes) {
    echo $fieldName . &quot; - &quot; . implode(&#039;, &#039;, $errorCodes) . &quot;\n&quot;;
}</code></pre>
    </div>

            
    <p>}</p>

            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p><code>$e-&gt;getInvalidRecords()</code>を使うことができます。扱っているレコードを知っているときは上記の内容を直接使う方がシンプルです。</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>アプリケーションで簡単に使えるように読みやすく整形されたエラースタックを読み取ることもできます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... echo $user-&gt;getErrorStackAsString();</p>

            
    <p>次のようにエラー文字列が出力されます:</p>

            <blockquote>
    <p>Validation failed in class User</p>
</blockquote>
            
    <p>1 field had validation error:</p>

                <div class="console">
        <pre><code class="console">* 1 validator failed on username (length)</code></pre>
    </div>

    </div>
    </div>
    </div>
                <div class="section" id="purofaira">
            <h1 class="section-header ">
    <a href="#purofaira">
        プロファイラー
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p><code>Doctrine\_Connection\_Profiler</code>は<code>Doctrine_Connection</code>用のイベントリスナーです。これは柔軟なクエリプロファイリングを提供します。SQL文字列に加えクエリプロファイルはクエリを実行するための経過時間を含みます。これによってモデルクラスにデバッグコードを追加せずにクエリのインスペクションの実行が可能になります。</p>

            
    <p><code>Doctrine\_Connection_Profiler</code>はDoctrine_Connection用のイベントリスナーとして追加されることで有効になります。</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $profiler = new Doctrine_Connection_Profiler();</p>

            <div class="section" id="conn-doctrine-manager-connection-conn-setlistener-profiler">
            <h3 class="section-header ">
    <a href="#conn-doctrine-manager-connection-conn-setlistener-profiler">
        $conn = Doctrine_Manager::connection(); <code>conn-&gt;setListener(</code>profiler);
        <i class="fas fa-link"></i>
    </a>
</h3>
    </div>
            <div class="section" id="ji-ben-dena-shii-fang">
            <h3 class="section-header ">
    <a href="#ji-ben-dena-shii-fang">
        基本的な使い方
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>ページの中にはロードが遅いものがあるでしょう。次のコードは接続から完全なプロファイラーレポートを構築する方法を示しています:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... <code>time = 0; foreach (</code>profiler as $event) { $time +=$event-&gt;getElapsedSecs(); echo $event-&gt;getName() . &quot; &quot; . sprintf(&quot;%f&quot;,
$event-&gt;getElapsedSecs()) . &quot;&quot;; echo $event-&gt;getQuery() . &quot;&quot;; $params =
<code>event-&gt;getParams(); if( ! empty(</code>params)) { print_r($params);} } echo &quot;Total time: &quot; . $time . &quot;&quot;;</p>

            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                
    <p>[<a href="http://www.symfony-project.com">http://www.symfony-project.com</a>
symfony]、[<a href="http://framework.zend.com">http://framework.zend.com</a>
Zend]などのフレームワークはウェブデバッグツールバーを提供します。Doctrineはそれぞれのクエリにかかる時間と同様にすべてのページで実行されるクエリの回数をレポートする機能を提供します。</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
    </div>
                <div class="section" id="manejaworokkusuru">
            <h1 class="section-header ">
    <a href="#manejaworokkusuru">
        マネージャーをロックする
        <i class="fas fa-link"></i>
    </a>
</h1>
            <blockquote>
    <p><strong>NOTE</strong>
&#039;トランザクション(Transaction)&#039;という用語はデータベースのトランザクションではなく一般的な意味を示します。</p>
</blockquote>
            
    <p>ロックは並行処理をコントロールするメカニズムです。最もよく知られるロック戦略は楽観的と悲観的ロックです。次のセクションでこれら2つの戦略の手短な説明を行います。現在Doctrineがサポートしているのは悲観的ロックです。</p>

            <div class="section" id="le-guan-derokku">
            <h2 class="section-header ">
    <a href="#le-guan-derokku">
        楽観的ロック
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>トランザクションが開始するときオブジェクトの状態/バージョンに注目されます。トランザクションが終了するとき注目された状態/バージョンの参与しているオブジェクトが現在の状態/バージョンと比較されます。状態/バージョンが異なる場合オブジェクトは他のトランザクションによって修正され現在のトランザクションは失敗します。このアプローチは&#039;楽観的&#039;(optimistic)と呼ばれます。複数のユーザーが同時に同じオブジェクト上のトランザクションに参加しないことを前提としているからです。</p>

    </div>
            <div class="section" id="bei-guan-derokku">
            <h2 class="section-header ">
    <a href="#bei-guan-derokku">
        悲観的ロック
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>トランザクションに参加する必要のあるオブジェクトはユーザーがトランザクションを開始した瞬間にロックされます。ロックが有効な間、他のユーザーがこれらのオブジェクトで作動するトランザクションを始めることはありません。これによってトランザクションを始めるユーザー以外のユーザーが同じオブジェクトを修正しないことが保証されます。</p>

            
    <p>Doctrineの悲観的オフラインロック機能はHTTPリクエストとレスポンスサイクルと/もしくは完了させるためにたくさんの時間がかかるアクションもしくはプロシージャの並行処理をコントロールするために使うことができます。</p>

    </div>
            <div class="section" id="li">
            <h2 class="section-header ">
    <a href="#li">
        例
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>次のコードスニペットはDoctrineの悲観的オフラインロック機能の使い方を実演しています。</p>

            
    <p>ロックがリクエストされたページでロックマネージャーインスタンスを取得します:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $lockingManager = new Doctrine_Locking_Manager_Pessimistic();</p>

            <div class="alert -admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas   mr-2"></i></td>
            <td>
                                                <dl>
                        <dt>300秒 =</dt>
        
        <dd>5分のタイムアウトをロックしようとする前に、タイムアウトした古いロックを必ず解放してください。これは<code>releaseAgedLocks()</code>メソッドを使用することで可能です。</dd>
            </dl>
    <p>// test.php</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>// ... $user = Doctrine_Core::getTable(&#039;User&#039;)-&gt;find(1);</p>

            
    <p>try { $lockingManager-&gt;releaseAgedLocks(300);</p>

                <div class="console">
        <pre><code class="console">$gotLock = $lockingManager-&gt;getLock($user, &#039;jwage&#039;);

if ($gotLock)
{
    echo &quot;Got lock!&quot;;
}
else
{
    echo &quot;Sorry, someone else is currently working on this record&quot;;
}</code></pre>
    </div>

            
    <p>} catch(Doctrine_Locking_Exception $dle) { echo $dle-&gt;getMessage(); //
handle the error }</p>

            
    <p>トランザクションが終了するページでロックマネジャーのインスタンスを取得します:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $user = Doctrine_Core::getTable(&#039;User&#039;)-&gt;find(1);</p>

            
    <p>$lockingManager = new Doctrine_Locking_Manager_Pessimistic();</p>

            
    <p>try { if (<code>lockingManager-&gt;releaseLock(</code>user, &#039;jwage&#039;)) { echo&quot;Lock released&quot;; } else { echo &quot;Record was not locked. No locks
released.&quot;; } } catch(Doctrine_Locking_Exception $dle) { echo
$dle-&gt;getMessage(); // handle the error }</p>

    </div>
            <div class="section" id="ji-shu-dena-xiang-xi">
            <h2 class="section-header ">
    <a href="#ji-shu-dena-xiang-xi">
        技術的な詳細
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>悲観的オフラインロックマネージャーはロックをデータベースで保存します(それゆえ&#039;オフライン&#039;です)。マネージャーをインスタンス化して<code>ATTR\_CREATE_TABLES</code>がTRUEに設定されているときに必要なロックテーブルは自動的に作成されます。インストール用の集中化と一貫したテーブル作成のプロシージャを提供するために将来この振る舞いが変更される可能性があります。</p>

    </div>
    </div>
                <div class="section" id="byu">
            <h1 class="section-header ">
    <a href="#byu">
        ビュー
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p>データベースビューは複雑なクエリのパフォーマンスを多いに増大できます。これらをキャッシュされたクエリとして見なすことができます。<code>Doctrine_View</code>はデータベースビューとDQLクエリの統合を提供します。</p>

            <div class="section" id="byuwo-shiu">
            <h2 class="section-header ">
    <a href="#byuwo-shiu">
        ビューを使う
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>データベースでビューを使うのは簡単です。<code>Doctrine_View</code>クラスは既存のビューの作成と削除をする機能を提供します。</p>

            
    <p><code>Doctrine\_Query</code>によって実行されるSQLを保存することで<code>Doctrine\_View</code>クラスは<code>Doctrine_Query</code>クラスを統合します。</p>

            
    <p>最初に新しい<code>Doctrine_Query</code>インスタンスを作成しましょう:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $q = Doctrine_Query::create() -&gt;from(&#039;User u&#039;)
-&gt;leftJoin(&#039;u.Phonenumber p&#039;) -&gt;limit(20);</p>

            
    <p>データベースビューを指定するための<code>name</code>と同じように<code>Doctrine\_View</code>インスタンスを作成し<code>Doctrine_Query</code>インスタンスにこれを渡しましょう:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... <code>view = new Doctrine_View(</code>q,&#039;RetrieveUsersAndPhonenumbers&#039;);</p>

            
    <p><code>Doctrine_View::create()</code>メソッドを使用してビューを簡単に作成できます:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... try { $view-&gt;create(); } catch (Exception $e) {}</p>

            
    <p>代わりにデータベースビューを削除したい場合<code>Doctrine_View::drop()</code>メソッドを使います:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... try { $view-&gt;drop(); } catch (Exception $e) {}</p>

            
    <p>ビューの使用はとても簡単です。<code>Doctrine\_Query</code>オブジェクトと同じようにビューの実行と結果の取得には<code>Doctrine_View::execute()</code>を使います:</p>

            <blockquote>
    <p>// test.php</p>
</blockquote>
            
    <p>// ... $users = $view-&gt;execute();</p>

            <div class="section" id="foreach-users-as-user-print-r-us-toarray">
            <h5 class="section-header ">
    <a href="#foreach-users-as-user-print-r-us-toarray">
        foreach ($users as <code>user) { print_r(</code>us-&gt;toArray()); }
        <i class="fas fa-link"></i>
    </a>
</h5>
    </div>
            <div class="section" id="matome">
            <h5 class="section-header ">
    <a href="#matome">
        まとめ
        <i class="fas fa-link"></i>
    </a>
</h5>
            
    <p>Doctrineが提供するコア機能の大部分を見てきました。この本の次の章では日常生活を楽にするオプション機能の一部をカバーします。</p>

            
    <p>[doc native-sql 次の章]ではDoctrine Query
Languageの代わりに配列とオブジェクトの間でデータをハイドレイトするネイティブなSQLの使い方を学びます。</p>

    </div>
    </div>
    </div>
        

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?1546fc"
                            integrity="sha384-ix9eb2EZyp9uayYpxmCQoylbz8msHl5wOg/aqZnD/3cxszNUGePN656MRg5GEgbm"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'doctrine1';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search Doctrine1 master'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            </body>
</html>
