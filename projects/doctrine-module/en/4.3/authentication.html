<!DOCTYPE html>
<html>
    <head>
        <title>        Authentication - Doctrine Doctrine Module for Laminas
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine Doctrine Module for Laminas Documentation: Authentication ">

        <meta name="keywords" content="                    doctrine,module,laminas,documentation,authentication
    ">

                    <meta name="robots" content="index, follow">
        
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine-module/en/6.3/authentication.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?6e5d9f"
                        integrity="sha384-1gHMA2pCh3C7C5PdanZqLyU+p0j9aNUSKdqMxyST9hhhoAcooEmUcqk0Rj7owse5"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine-module/en/4.3/authentication.html" />
        <meta property="og:title" content="        Authentication - Doctrine Doctrine Module for Laminas
    " />
        <meta property="og:description" content="Doctrine Doctrine Module for Laminas Documentation: Authentication " />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine Doctrine Module for Laminas",
            "description": "Authentication",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/DoctrineModule/edit/4.3.x/docs/en/authentication.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        

            <div class="toc">
    <ul class="menu-level">
    <li class="toc-item">
    <a href="index.html#introduction">Introduction</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="index.html#installation">Installation</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="index.html#note-on-php-8-0-or-later">Note on PHP 8.0 or later</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="index.html#next-steps">Next Steps</a>


</li>
                    </ul>
</li>
    <li class="toc-item opened">
    <a href="#authentication">Authentication</a>

        <ul class="section-level-1 opened-ul ">
            <li class="toc-item">
    <a href="#simple-example">Simple example</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#authentication-factory">Authentication factory</a>


</li>
            <li class="toc-item">
    <a href="#creating-the-authenticationservice">Creating the AuthenticationService</a>


</li>
            <li class="toc-item">
    <a href="#using-the-authenticationservice">Using the AuthenticationService</a>


</li>
            <li class="toc-item">
    <a href="#view-helper-and-controller-helper">View helper and controller helper</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="caching.html#caching">Caching</a>


</li>
    <li class="toc-item">
    <a href="cli.html#doctrine-cli">Doctrine CLI</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="cli.html#adding-commands-to-the-cli">Adding commands to the CLI</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="form-element.html#form-elements">Form Elements</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="form-element.html#usage">Usage</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="form-element.html#example-1-simple-example">Example 1 : simple example</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="form-element.html#example-2-modifying-the-label">Example 2 : modifying the label</a>


</li>
            <li class="toc-item">
    <a href="form-element.html#example-3-extended-version">Example 3 : extended version</a>


</li>
            <li class="toc-item">
    <a href="form-element.html#example-4-including-an-empty-option">Example 4 : including an empty option</a>


</li>
            <li class="toc-item">
    <a href="form-element.html#example-5-add-html-attributes-to-the-elements">Example 5 : Add html attributes to the  elements</a>


</li>
            <li class="toc-item">
    <a href="form-element.html#example-6-implementing-support">Example 6: Implementing  support</a>


</li>
            <li class="toc-item">
    <a href="form-element.html#example-7-formatting-on-empty-optgroups">Example 7:  formatting on empty optgroups</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="form-element.html#7-1-rendering-without-a-default-group">7.1: Rendering without a default group</a>


</li>
            <li class="toc-item">
    <a href="form-element.html#7-2-rendering-with-a-default-group">7.2: Rendering with a default group</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="paginator.html#paginator">Paginator</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="paginator.html#collection-adapter">Collection adapter</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="paginator.html#simple-example">Simple example</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="paginator.html#selectable-adapter">Selectable adapter</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="paginator.html#simple-example">Simple example</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="validator.html#validator">Validator</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="validator.html#simple-usage">Simple usage</a>


</li>
            <li class="toc-item">
    <a href="validator.html#use-together-with-laminas-forms">Use together with Laminas forms</a>


</li>
            <li class="toc-item">
    <a href="validator.html#uniqueobject">UniqueObject</a>


</li>
                    </ul>
</li>
    </ul>
</div>
    

                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://www.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "Doctrine Module for Laminas",
            "item": "https://www.doctrine-project.org/projects/doctrine-module.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://www.doctrine-project.org/projects/doctrine-module/en/4.3/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "Authentication",
            "item": "https://www.doctrine-project.org/projects/doctrine-module/en/4.3/authentication.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-module.html">Doctrine Module for Laminas</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-module/en/4.3/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">Authentication</li>
                        </ol>
</nav>
                                    </div>

                    
    <div class="alert caution bg-light-yellow text-dark border">
    <table width="100%">
        <tr>
            <td width="10" class="align-top">
                <i class="fas fa-exclamation-circle text-warning mr-2"></i>
            </td>
            <td><p>You are browsing a version that is no longer maintained.</p></td>
        </tr>
    </table>
</div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine-module/en/4.3/authentication.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        4.3.1
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-module/en/6.4/authentication.html">
                                                        6.4

                                                        
                                                                                                                    (upcoming)
                                                                                                            </a>
                                                                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-module/en/6.3/authentication.html">
                                                        6.3.0

                                                                                                                    (current)
                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-module/en/6.2/authentication.html">6.2</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-module/en/6.1/authentication.html">6.1</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-module/en/6.0/authentication.html">6.0</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-module/en/5.3/authentication.html">5.3</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-module/en/5.2/authentication.html">5.2</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-module/en/5.1/authentication.html">5.1</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-module/en/5.0/authentication.html">5.0</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-module/en/4.4/authentication.html">4.4</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item active" href="/projects/doctrine-module/en/4.3/authentication.html">4.3</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-module/en/4.2/authentication.html">4.2</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-module/en/4.1/authentication.html">4.1</a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                </div>
                            
                            

            <div class="section" id="authentication">
            <h1 class="section-header ">
    <a href="#authentication">
        Authentication
        <i class="fas fa-link"></i>
    </a>
</h1>
            
    <p>Authentication through Doctrine is fully supported by DoctrineModule
through an authentication adapter, and a specific storage implementation
that relies on the database. Most of the time, those classes will be
used in conjunction with
<code>Laminas\Authentication\AuthenticationService</code> class.</p>

            <div class="section" id="simple-example">
            <h2 class="section-header ">
    <a href="#simple-example">
        Simple example
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>In order to authenticate a user (or anything else) against Doctrine, the
following workflow is used:</p>

            
    
<ol start="1" type="1">
    <li value="1">Set configuration that contains options about the entity that is
authenticated (credential property, identity property…). It is not
necessary to create a separate authentication adapter, this will be
automatically created by the DoctrineModule based on the defined
configuration.</li>
    <li value="2">Create a storage adapter. If the authentication succeeds, the
identifier of the entity will be automatically stored in session.</li>
    <li value="3">Create a <code>Laminas\Authentication\AuthenticationService</code> instance
that contains both the authentication adapter and the storage
adapter.</li>
</ol>

            <div class="section" id="authentication-factory">
            <h3 class="section-header ">
    <a href="#authentication-factory">
        Authentication factory
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>To make your life easier, DoctrineModule provides an Authentication
factory through the <code>DoctrineModule\Options\Authentication</code> class.</p>

            
    <p>The first task is to configure the Authentication by adding the
<code>authentication</code> key to the <code>doctrine</code> key in your config file (we
assume here that the entity we want to authentication is simply called
<code>Application\Entity\User</code>):</p>

                <pre class="code-block-table" id="bf49bfe22ce31da637bd45adf3e2f4516d4c9d43"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="bf49bfe22ce31da637bd45adf3e2f4516d4c9d43"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-comment">// in your module.config.php:</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">return</span> [</code><code class="line language-php">    <span class="hljs-string">'doctrine'</span> =&gt; [</code><code class="line language-php">        <span class="hljs-string">'authentication'</span> =&gt; [</code><code class="line language-php">            <span class="hljs-string">'orm_default'</span> =&gt; [</code><code class="line language-php">                <span class="hljs-string">'object_manager'</span> =&gt; <span class="hljs-string">'Doctrine\ORM\EntityManager'</span>,</code><code class="line language-php">                <span class="hljs-string">'identity_class'</span> =&gt; <span class="hljs-string">'Application\Entity\User'</span>,</code><code class="line language-php">                <span class="hljs-string">'identity_property'</span> =&gt; <span class="hljs-string">'email'</span>,</code><code class="line language-php">                <span class="hljs-string">'credential_property'</span> =&gt; <span class="hljs-string">'password'</span>,</code><code class="line language-php">            ],</code><code class="line language-php">        ],</code><code class="line language-php">    ],</code><code class="line language-php">];</code><code class="empty"></code></pre>
            
    <p>Here are some explanations about the keys:</p>

            

<ul>
    <li class="dash">the <code>object_manager</code> key can either be a concrete instance of a
<code>Doctrine\Persistence\ObjectManager</code> or a single string that will
fetched from the Service Manager in order to get a concrete instance.
If you are using DoctrineORMModule, you can simply write
<code>Doctrine\ORM\EntityManager</code> (as the
EntityManager implements the class
<code>Doctrine\Persistence\ObjectManager</code>).</li>
    <li class="dash">the <code>identity_class</code> contains the FQCN of the entity that will be
used during the authentication process.</li>
    <li class="dash">the <code>identity_property</code> contains the name of the property that will
be used as the identity property (most often, this is email,
username…). Please note that we are talking here of the PROPERTY, not
the table column name (although it can be the same in most of the
cases).</li>
    <li class="dash">the <code>credential_property</code> contains the name of the property that
will be used as the credential property (most often, this is
password…).</li>
</ul>

            
    <p>The authentication accept some more options that can be used :</p>

            

<ul>
    <li class="dash">the <code>object_repository</code> can be used instead of the
<code>object_manager</code> key. Most of the time you won’t deal with the one,
as specifying the <code>identity_class</code> name will automatically fetch
the <code>object_repository</code> for you.</li>
    <li class="dash">the <code>credential_callable</code> is a very useful option that allow you to
perform some custom logic when checking if the credential is correct.
For instance, if your password are encrypted using Bcrypt algorithm,
you will need to perform specific logic. This option can be any
callable function (closure, class method…). This function will be
given the complete entity fetched from the database, and the
credential that was given by the user during the authentication
process.</li>
</ul>

            
    <p>Here is an example code that adds the <code>credential_callable</code> function
to our previous example :</p>

                <pre class="code-block-table" id="af761c233b0bfeebc07af1c61b2a685c18a2a229"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="af761c233b0bfeebc07af1c61b2a685c18a2a229"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-comment">// in your module.config.php:</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">return</span> [</code><code class="line language-php">    <span class="hljs-string">'doctrine'</span> =&gt; [</code><code class="line language-php">        <span class="hljs-string">'authentication'</span> =&gt; [</code><code class="line language-php">            <span class="hljs-string">'orm_default'</span> =&gt; [</code><code class="line language-php">                <span class="hljs-string">'object_manager'</span> =&gt; <span class="hljs-string">'Doctrine\ORM\EntityManager'</span>,</code><code class="line language-php">                <span class="hljs-string">'identity_class'</span> =&gt; <span class="hljs-string">'Application\Entity\User'</span>,</code><code class="line language-php">                <span class="hljs-string">'identity_property'</span> =&gt; <span class="hljs-string">'email'</span>,</code><code class="line language-php">                <span class="hljs-string">'credential_property'</span> =&gt; <span class="hljs-string">'password'</span>,</code><code class="line language-php">                <span class="hljs-string">'credential_callable'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(User $user, $passwordGiven)</span> </span>{</code><code class="line language-php">                    <span class="hljs-keyword">return</span> my_awesome_check_test($user-&gt;getPassword(), $passwordGiven);</code><code class="line language-php">                },</code><code class="line language-php">            ],</code><code class="line language-php">        ],</code><code class="line language-php">    ],</code><code class="line language-php">];</code><code class="empty"></code></pre>
            
    <p>Here is another example that uses a controller method as the
<em>credential_callable</em> callback. Note that the controller method must be
declared <em>public static</em>.</p>

                <pre class="code-block-table" id="6ce74d05ef1c522442444ab7e56b8e282a6803d4"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="6ce74d05ef1c522442444ab7e56b8e282a6803d4"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-comment">// in your module.config.php:</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">return</span> [</code><code class="line language-php">    <span class="hljs-string">'doctrine'</span> =&gt; [</code><code class="line language-php">        <span class="hljs-string">'authentication'</span> =&gt; [</code><code class="line language-php">            <span class="hljs-string">'orm_default'</span> =&gt; [</code><code class="line language-php">                <span class="hljs-string">'object_manager'</span> =&gt; <span class="hljs-string">'Doctrine\ORM\EntityManager'</span>,</code><code class="line language-php">                <span class="hljs-string">'identity_class'</span> =&gt; <span class="hljs-string">'Application\Entity\User'</span>,</code><code class="line language-php">                <span class="hljs-string">'identity_property'</span> =&gt; <span class="hljs-string">'email'</span>,</code><code class="line language-php">                <span class="hljs-string">'credential_property'</span> =&gt; <span class="hljs-string">'password'</span>,</code><code class="line language-php">                <span class="hljs-string">'credential_callable'</span> =&gt; <span class="hljs-string">'Application\Controller\UserController::verifyCredential'</span></code><code class="line language-php">            ],</code><code class="line language-php">        ],</code><code class="line language-php">    ],</code><code class="line language-php">];</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">// in UserController.php</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">verifyCredential</span><span class="hljs-params">(User $user, $inputPassword)</span> </span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">return</span> password_verify($inputPassword, $user-&gt;getPassword());</code><code class="line language-php">}</code><code class="empty"></code></pre>
    </div>
            <div class="section" id="creating-the-authenticationservice">
            <h3 class="section-header ">
    <a href="#creating-the-authenticationservice">
        Creating the AuthenticationService
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Now that we have configured the authentication, we still need to tell
Laminas how to construct a correct
<code>Laminas\Authentication\AuthenticationService</code> instance. For this, add
the following code in your Module.php class:</p>

                <pre class="code-block-table" id="6d75d428301e9289bf5918416cfd670feaa5c9b4"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="6d75d428301e9289bf5918416cfd670feaa5c9b4"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Application</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Laminas</span>\<span class="hljs-title">Authentication</span>\<span class="hljs-title">AuthenticationService</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Module</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getServiceConfig</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">return</span> [</code><code class="line language-php">            <span class="hljs-string">'factories'</span> =&gt; [</code><code class="line language-php">                <span class="hljs-string">'Laminas\Authentication\AuthenticationService'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($serviceManager)</span> </span>{</code><code class="line language-php">                    <span class="hljs-comment">// If you are using DoctrineORMModule:</span></code><code class="line language-php">                    <span class="hljs-keyword">return</span> $serviceManager-&gt;get(<span class="hljs-string">'doctrine.authenticationservice.orm_default'</span>);</code><code class="line language-php"></code><code class="line language-php">                    <span class="hljs-comment">// If you are using DoctrineODMModule:</span></code><code class="line language-php">                    <span class="hljs-keyword">return</span> $serviceManager-&gt;get(<span class="hljs-string">'doctrine.authenticationservice.odm_default'</span>);</code><code class="line language-php">                },</code><code class="line language-php">            ],</code><code class="line language-php">        ];</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="empty"></code></pre>
            
    <p>Please note that I am using here a
<code>Laminas\Authentication\AuthenticationService</code> name, but it can be
anything else (<code>my_auth_service</code> …). However, using the name
<code>Laminas\Authentication\AuthenticationService</code> will allow it to be
recognised by the Laminas <a href="https://docs.laminas.dev/laminas-view/helpers/identity/">Identity view
helper</a>.</p>

            
    <p>In Laminas, you can inject the
<code>Laminas\Authentication\AuthenticationService</code> into your controller
factories as in the example below:</p>

                <pre class="code-block-table" id="f5559a0109ed769fbbb154c5db3834afdfbc326e"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f5559a0109ed769fbbb154c5db3834afdfbc326e"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Application</span>\<span class="hljs-title">Factory</span>\<span class="hljs-title">Controller</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Interop</span>\<span class="hljs-title">Container</span>\<span class="hljs-title">ContainerInterface</span>;</code><code class="line language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Laminas</span>\<span class="hljs-title">ServiceManager</span>\<span class="hljs-title">Factory</span>\<span class="hljs-title">FactoryInterface</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationControllerFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FactoryInterface</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span><span class="hljs-params">(ContainerInterface $container, $requestedName, array $options = null)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        $authenticationService = $container-&gt;get(<span class="hljs-string">'doctrine.authenticationservice.orm_default'</span>);</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $requestedName($authenticationService);</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="empty"></code></pre>
    </div>
            <div class="section" id="using-the-authenticationservice">
            <h3 class="section-header ">
    <a href="#using-the-authenticationservice">
        Using the AuthenticationService
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Now that we have defined how to create a
<code>Laminas\Authentication\AuthenticationService</code> object we can use it in
our code. For more information about Laminas authentication mechanisms
please read <a href="https://docs.laminas.dev/laminas-authentication/">the laminas-authentication
documentation</a>.</p>

            
    <p>Here is an example of how we could use it from a controller action (we
stripped any Form things for simplicity):</p>

                <pre class="code-block-table" id="1a4f3269178084ce6097fc2bd75ab75734c7431d"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="1a4f3269178084ce6097fc2bd75ab75734c7431d"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loginAction</span><span class="hljs-params">()</span></span></code><code class="line language-php">{</code><code class="line language-php">    $data = <span class="hljs-keyword">$this</span>-&gt;getRequest()-&gt;getPost();</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">// If you used another name for the authentication service, change it here</span></code><code class="line language-php">    $authService = <span class="hljs-keyword">$this</span>-&gt;getServiceLocator()-&gt;get(<span class="hljs-string">'Laminas\Authentication\AuthenticationService'</span>);</code><code class="line language-php"></code><code class="line language-php">    $adapter = $authService-&gt;getAdapter();</code><code class="line language-php">    $adapter-&gt;setIdentityValue($data[<span class="hljs-string">'login'</span>]);</code><code class="line language-php">    $adapter-&gt;setCredentialValue($data[<span class="hljs-string">'password'</span>]);</code><code class="line language-php">    $authResult = $authService-&gt;authenticate();</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">if</span> ($authResult-&gt;isValid()) {</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;redirect()-&gt;toRoute(<span class="hljs-string">'home'</span>);</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ViewModel([</code><code class="line language-php">        <span class="hljs-string">'error'</span> =&gt; <span class="hljs-string">'Your authentication credentials are not valid'</span>,</code><code class="line language-php">    ]);</code><code class="line language-php">}</code><code class="empty"></code></pre>
            
    <p>Instead of Zend Framework 2, you can do like this in Zend Framework 3
and Laminas:</p>

                <pre class="code-block-table" id="b53dd55ab7e5fc1d7ec90a2930df81b9ac668bfc"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="b53dd55ab7e5fc1d7ec90a2930df81b9ac668bfc"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(AuthenticationService $authenticationService)</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">$this</span>-&gt;authenticationService = $authenticationService;</code><code class="line language-php">}</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loginAction</span><span class="hljs-params">()</span></span></code><code class="line language-php">{</code><code class="line language-php">    $data = <span class="hljs-keyword">$this</span>-&gt;getRequest()-&gt;getPost();</code><code class="line language-php"></code><code class="line language-php">    $adapter = <span class="hljs-keyword">$this</span>-&gt;authenticationService-&gt;getAdapter();</code><code class="line language-php">    $adapter-&gt;setIdentity($data[<span class="hljs-string">'login'</span>]);</code><code class="line language-php">    $adapter-&gt;setCredential($data[<span class="hljs-string">'password'</span>]);</code><code class="line language-php">    $authResult = <span class="hljs-keyword">$this</span>-&gt;authenticationService-&gt;authenticate();</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">if</span> ($authResult-&gt;isValid()) {</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;redirect()-&gt;toRoute(<span class="hljs-string">'home'</span>);</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ViewModel([</code><code class="line language-php">        <span class="hljs-string">'error'</span> =&gt; <span class="hljs-string">'Your authentication credentials are not valid'</span>,</code><code class="line language-php">    ]);</code><code class="line language-php">}</code><code class="empty"></code></pre>
            
    <p>Of course, doing this in the controller is not the best practice, and
you’d better move that kind of logic to a service layer. But this is how
it works.</p>

            
    <p>Note that when the authentication is valid, we first get the identity :</p>

                <pre class="code-block-table" id="8bd9a287f1fe6e37dac09c29713c33512f94155a"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="8bd9a287f1fe6e37dac09c29713c33512f94155a"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">$identity = $authenticationResult-&gt;getIdentity();</code><code class="empty"></code></pre>
            
    <p>This will return the full entity (in our case, an
<code>Application\Entity\User</code> instance). However, storing a full entity in
session is not a recommended practice. That’s why, when writing the
identity :</p>

                <pre class="code-block-table" id="ba96ad4d06711d9e330d78749ef924b8392b33a0"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="ba96ad4d06711d9e330d78749ef924b8392b33a0"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">$authService-&gt;getStorage()-&gt;write($identity);</code><code class="empty"></code></pre>
            
    <p>The storage automatically extracts ONLY the identifier values and only
store this in session (this avoid to store in session a serialized
entity, which is a bad practice). Later, when you want to retrieve the
logged user :</p>

                <pre class="code-block-table" id="ea6e33cb86686f8416175693239419d23888d131"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="ea6e33cb86686f8416175693239419d23888d131"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">$authenticationService = $services-&gt;get(<span class="hljs-string">'Laminas\Authentication\AuthenticationService'</span>);</code><code class="line language-php">$authenticatedUser = $authenticationService-&gt;getIdentity();</code><code class="empty"></code></pre>
            
    <p>The authentication storage will automatically handle the conversion from
saved data to managed entity and the opposite. It will avoid serializing
entities since that is a strongly discouraged practice.</p>

    </div>
            <div class="section" id="view-helper-and-controller-helper">
            <h3 class="section-header ">
    <a href="#view-helper-and-controller-helper">
        View helper and controller helper
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>You may also need to know if there is an authenticated user within your
other controllers or in views. Laminas provides a controller plugin and
a view helper you may use.</p>

            
    <p>Here is how you use it in your controller :</p>

                <pre class="code-block-table" id="f2c5f36857dd0cd47357d1ebd33d084911d1c389"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f2c5f36857dd0cd47357d1ebd33d084911d1c389"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testAction</span><span class="hljs-params">()</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">if</span> ($user = <span class="hljs-keyword">$this</span>-&gt;identity()) {</code><code class="line language-php">        <span class="hljs-comment">// someone is logged !</span></code><code class="line language-php">    } <span class="hljs-keyword">else</span> {</code><code class="line language-php">        <span class="hljs-comment">// not logged in</span></code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="empty"></code></pre>
            
    <p>And in your view :</p>

                <pre class="code-block-table" id="b1dbb80df694e339afa7fe58707fb6588604a48a"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="b1dbb80df694e339afa7fe58707fb6588604a48a"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">    <span class="hljs-keyword">if</span> ($user = <span class="hljs-keyword">$this</span>-&gt;identity()) {</code><code class="line language-php">        <span class="hljs-keyword">echo</span> <span class="hljs-string">'Logged in as '</span> . <span class="hljs-keyword">$this</span>-&gt;escapeHtml($user-&gt;getUsername());</code><code class="line language-php">    } <span class="hljs-keyword">else</span> {</code><code class="line language-php">        <span class="hljs-keyword">echo</span> <span class="hljs-string">'Not logged in'</span>;</code><code class="line language-php">    }</code><code class="line language-php"><span class="hljs-meta">?&gt;</span></code><code class="empty"></code></pre>
    </div>
    </div>
    </div>
        

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?1546fc"
                            integrity="sha384-ix9eb2EZyp9uayYpxmCQoylbz8msHl5wOg/aqZnD/3cxszNUGePN656MRg5GEgbm"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'doctrine-module';
            var versionSlug = '4.3';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search Doctrine Module for Laminas 4.3'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            </body>
</html>
