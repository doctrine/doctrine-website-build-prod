<!DOCTYPE html>
<html>
    <head>
        <title>Advanced field value conversion using custom mapping types - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://new.doctrine-project.org/css/style.css?29" rel="stylesheet" type="text/css" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://new.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://new.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://new.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://new.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://new.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://new.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://new.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://new.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://new.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://new.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://new.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://new.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://new.doctrine-project.org/images/mstile-310x310.png" />

        <link rel="stylesheet" href="https://new.doctrine-project.org/components/highlightjs/styles/railscasts.css?29" />
        <link rel="alternate" type="application/atom+xml" href="https://new.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
        
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>
    </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://new.doctrine-project.org/"><img src="https://new.doctrine-project.org/images/doctrine-logo.svg" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="https://new.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/lexer/">Lexer</a>
                                                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/search/">Search</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://github.com/doctrine/" target="_blank">Development</a>
                        </li>
                    </ul>
                </div>
            </nav>
        
            <div class="container-fluid">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        
<div class="toc"><ul><li id="advanced-field-value-conversion-using-custom-mapping-types-html-title-1" class="toc-item"><a href="advanced-field-value-conversion-using-custom-mapping-types.html#title.1">Advanced field value conversion using custom mapping types</a></li><ul><li id="advanced-field-value-conversion-using-custom-mapping-types-html-title-1-1" class="toc-item"><a href="advanced-field-value-conversion-using-custom-mapping-types.html#title.1.1">The entity</a></li><li id="advanced-field-value-conversion-using-custom-mapping-types-html-title-1-2" class="toc-item"><a href="advanced-field-value-conversion-using-custom-mapping-types.html#title.1.2">The mapping type</a></li><li id="advanced-field-value-conversion-using-custom-mapping-types-html-title-1-3" class="toc-item"><a href="advanced-field-value-conversion-using-custom-mapping-types.html#title.1.3">Example usage</a></li></ul><li id="aggregate-fields-html-title-1" class="toc-item"><a href="aggregate-fields.html#title.1">Aggregate Fields</a></li><ul><li id="aggregate-fields-html-title-1-1" class="toc-item"><a href="aggregate-fields.html#title.1.1">An example model</a></li><li id="aggregate-fields-html-title-1-2" class="toc-item"><a href="aggregate-fields.html#title.1.2">Using DQL</a></li><li id="aggregate-fields-html-title-1-3" class="toc-item"><a href="aggregate-fields.html#title.1.3">Using your Domain Model</a></li><li id="aggregate-fields-html-title-1-4" class="toc-item"><a href="aggregate-fields.html#title.1.4">Using an Aggregate Field</a></li><li id="aggregate-fields-html-title-1-5" class="toc-item"><a href="aggregate-fields.html#title.1.5">Tackling Race Conditions with Aggregate Fields</a></li><li id="aggregate-fields-html-title-1-6" class="toc-item"><a href="aggregate-fields.html#title.1.6">Keeping Updates and Deletes in Sync</a></li><li id="aggregate-fields-html-title-1-7" class="toc-item"><a href="aggregate-fields.html#title.1.7">Conclusion</a></li></ul><li id="custom-mapping-types-html-title-1" class="toc-item"><a href="custom-mapping-types.html#title.1">Custom Mapping Types</a></li><li id="decorator-pattern-html-title-1" class="toc-item"><a href="decorator-pattern.html#title.1">Persisting the Decorator Pattern</a></li><ul><li id="decorator-pattern-html-title-1-1" class="toc-item"><a href="decorator-pattern.html#title.1.1">Component</a></li><li id="decorator-pattern-html-title-1-2" class="toc-item"><a href="decorator-pattern.html#title.1.2">ConcreteComponent</a></li><li id="decorator-pattern-html-title-1-3" class="toc-item"><a href="decorator-pattern.html#title.1.3">Decorator</a></li><li id="decorator-pattern-html-title-1-4" class="toc-item"><a href="decorator-pattern.html#title.1.4">ConcreteDecorator</a></li><li id="decorator-pattern-html-title-1-5" class="toc-item"><a href="decorator-pattern.html#title.1.5">Examples</a></li></ul><li id="dql-custom-walkers-html-title-1" class="toc-item"><a href="dql-custom-walkers.html#title.1">Extending DQL in Doctrine 2: Custom AST Walkers</a></li><ul><li id="dql-custom-walkers-html-title-1-1" class="toc-item"><a href="dql-custom-walkers.html#title.1.1">Generic count query for pagination</a></li><li id="dql-custom-walkers-html-title-1-2" class="toc-item"><a href="dql-custom-walkers.html#title.1.2">Modify the Output Walker to generate Vendor specific SQL</a></li></ul><li id="dql-user-defined-functions-html-title-1" class="toc-item"><a href="dql-user-defined-functions.html#title.1">DQL User Defined Functions</a></li><ul><li id="dql-user-defined-functions-html-title-1-1" class="toc-item"><a href="dql-user-defined-functions.html#title.1.1">Registering your own DQL functions</a></li><li id="dql-user-defined-functions-html-title-1-2" class="toc-item"><a href="dql-user-defined-functions.html#title.1.2">Date Diff</a></li><li id="dql-user-defined-functions-html-title-1-3" class="toc-item"><a href="dql-user-defined-functions.html#title.1.3">Date Add</a></li><li id="dql-user-defined-functions-html-title-1-4" class="toc-item"><a href="dql-user-defined-functions.html#title.1.4">Conclusion</a></li></ul><li id="entities-in-session-html-title-1" class="toc-item"><a href="entities-in-session.html#title.1">Entities in the Session</a></li><ul><li id="entities-in-session-html-title-1-1" class="toc-item"><a href="entities-in-session.html#title.1.1">Merging entity into an EntityManager</a></li><li id="entities-in-session-html-title-1-2" class="toc-item"><a href="entities-in-session.html#title.1.2">Serializing entities into the session</a></li></ul><li id="implementing-arrayaccess-for-domain-objects-html-title-1" class="toc-item"><a href="implementing-arrayaccess-for-domain-objects.html#title.1">Implementing ArrayAccess for Domain Objects</a></li><ul><li id="implementing-arrayaccess-for-domain-objects-html-title-1-1" class="toc-item"><a href="implementing-arrayaccess-for-domain-objects.html#title.1.1">Option 1</a></li><li id="implementing-arrayaccess-for-domain-objects-html-title-1-2" class="toc-item"><a href="implementing-arrayaccess-for-domain-objects.html#title.1.2">Option 2</a></li><li id="implementing-arrayaccess-for-domain-objects-html-title-1-3" class="toc-item"><a href="implementing-arrayaccess-for-domain-objects.html#title.1.3">Read-only</a></li></ul><li id="implementing-the-notify-changetracking-policy-html-title-1" class="toc-item"><a href="implementing-the-notify-changetracking-policy.html#title.1">Implementing the Notify ChangeTracking Policy</a></li><ul><li id="implementing-the-notify-changetracking-policy-html-title-1-1" class="toc-item"><a href="implementing-the-notify-changetracking-policy.html#title.1.1">Implementing NotifyPropertyChanged</a></li></ul><li id="integrating-with-codeigniter-html-title-1" class="toc-item"><a href="integrating-with-codeigniter.html#title.1">Integrating with CodeIgniter</a></li><ul><li id="integrating-with-codeigniter-html-title-1-1" class="toc-item"><a href="integrating-with-codeigniter.html#title.1.1">Setting up the file structure</a></li><li id="integrating-with-codeigniter-html-title-1-2" class="toc-item"><a href="integrating-with-codeigniter.html#title.1.2">Creating your Doctrine CodeIgniter library</a></li><li id="integrating-with-codeigniter-html-title-1-3" class="toc-item"><a href="integrating-with-codeigniter.html#title.1.3">Now to use it</a></li></ul><li id="mysql-enums-html-title-1" class="toc-item"><a href="mysql-enums.html#title.1">Mysql Enums</a></li><ul><li id="mysql-enums-html-title-1-1" class="toc-item"><a href="mysql-enums.html#title.1.1">Solution 1: Mapping to Varchars</a></li><li id="mysql-enums-html-title-1-2" class="toc-item"><a href="mysql-enums.html#title.1.2">Solution 2: Defining a Type</a></li></ul><li id="resolve-target-entity-listener-html-title-1" class="toc-item"><a href="resolve-target-entity-listener.html#title.1">Keeping your Modules independent</a></li><ul><li id="resolve-target-entity-listener-html-title-1-1" class="toc-item"><a href="resolve-target-entity-listener.html#title.1.1">Background</a></li><li id="resolve-target-entity-listener-html-title-1-2" class="toc-item"><a href="resolve-target-entity-listener.html#title.1.2">Set up</a></li><li id="resolve-target-entity-listener-html-title-1-3" class="toc-item"><a href="resolve-target-entity-listener.html#title.1.3">Final Thoughts</a></li></ul><li id="sql-table-prefixes-html-title-1" class="toc-item"><a href="sql-table-prefixes.html#title.1">SQL-Table Prefixes</a></li><ul><li id="sql-table-prefixes-html-title-1-1" class="toc-item"><a href="sql-table-prefixes.html#title.1.1">Implementing the listener</a></li><li id="sql-table-prefixes-html-title-1-2" class="toc-item"><a href="sql-table-prefixes.html#title.1.2">Telling the EntityManager about our listener</a></li></ul><li id="strategy-cookbook-introduction-html-title-1" class="toc-item"><a href="strategy-cookbook-introduction.html#title.1">Strategy-Pattern</a></li><ul><li id="strategy-cookbook-introduction-html-title-1-1" class="toc-item"><a href="strategy-cookbook-introduction.html#title.1.1">Scenario / Problem</a></li><li id="strategy-cookbook-introduction-html-title-1-2" class="toc-item"><a href="strategy-cookbook-introduction.html#title.1.2">Solution</a></li></ul><li id="validation-of-entities-html-title-1" class="toc-item"><a href="validation-of-entities.html#title.1">Validation of Entities</a></li><li id="working-with-datetime-html-title-1" class="toc-item"><a href="working-with-datetime.html#title.1">Working with DateTime Instances</a></li><ul><li id="working-with-datetime-html-title-1-1" class="toc-item"><a href="working-with-datetime.html#title.1.1">DateTime changes are detected by Reference</a></li><li id="working-with-datetime-html-title-1-2" class="toc-item"><a href="working-with-datetime.html#title.1.2">Default Timezone Gotcha</a></li><li id="working-with-datetime-html-title-1-3" class="toc-item"><a href="working-with-datetime.html#title.1.3">Handling different Timezones with the DateTime Type</a></li></ul></ul></div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                                                
                                        
                                                                <nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/">Projects</a></li>
                                <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/orm/">ORM</a></li>
                                <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/doctrine-orm/en/2.6/">Documentation</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Advanced field value conversion using custom mapping types</li>
                            </ol>
                        </nav>
                                    </div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            <ul class="list-inline">
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-orm/en/latest/cookbook/advanced-field-value-conversion-using-custom-mapping-types.html" class="project-version-switcher badge badge-secondary">master</a>
                                        </li>
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-orm/en/2.6/cookbook/advanced-field-value-conversion-using-custom-mapping-types.html" class="project-version-switcher badge badge-primary">2.6</a>
                                        </li>
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-orm/en/2.5/cookbook/advanced-field-value-conversion-using-custom-mapping-types.html" class="project-version-switcher badge badge-secondary">2.5</a>
                                        </li>
                                                                    </ul>
                            
                            
<a class="section-anchor" id="title.1" name="title.1"></a><h1 class="section-header"><a href="#title.1">Advanced field value conversion using custom mapping types<i class="fas fa-link"></i></a></h1>
<div class="section-author"><p>When creating entities, you sometimes have the need to transform field values
before they are saved to the database. In Doctrine you can use Custom Mapping
Types to solve this (see: <a href="../"></a>).</p></div>
<p>There are several ways to achieve this: converting the value inside the Type
class, converting the value on the database-level or a combination of both.</p>
<p>This article describes the third way by implementing the MySQL specific column
type <a href="http://dev.mysql.com/doc/refman/5.5/en/gis-class-point.html">Point</a>.</p>
<p>The <code>Point</code> type is part of the <a href="http://dev.mysql.com/doc/refman/5.5/en/spatial-extensions.html">Spatial extension</a>
of MySQL and enables you to store a single location in a coordinate space by
using x and y coordinates. You can use the Point type to store a
longitude/latitude pair to represent a geographic location.</p>
<a class="section-anchor" id="title.1.1" name="title.1.1"></a><h2 class="section-header"><a href="#title.1.1">The entity<i class="fas fa-link"></i></a></h2>
<p>We create a simple entity with a field <code>$point</code> which holds a value object
<code>Point</code> representing the latitude and longitude of the position.</p>
<p>The entity class:</p>
<pre><code class="php">&lt;?php

namespace Geo\Entity;

use Doctrine\ORM\Annotation as ORM;

/**
 * @ORM\Entity
 */
class Location
{
    /**
     * @ORM\Column(type=&quot;point&quot;)
     *
     * @var \Geo\ValueObject\Point
     */
    private $point;

    /**
     * @ORM\Column(type=&quot;string&quot;)
     *
     * @var string
     */
    private $address;

    /**
     * @param \Geo\ValueObject\Point $point
     */
    public function setPoint(\Geo\ValueObject\Point $point)
    {
        $this-&gt;point = $point;
    }

    /**
     * @return \Geo\ValueObject\Point
     */
    public function getPoint()
    {
        return $this-&gt;point;
    }

    /**
     * @param string $address
     */
    public function setAddress($address)
    {
        $this-&gt;address = $address;
    }

    /**
     * @return string
     */
    public function getAddress()
    {
        return $this-&gt;address;
    }
}
</code></pre>
<p>We use the custom type <code>point</code> in the <code>@Column</code>  docblock annotation of the
<code>$point</code> field. We will create this custom mapping type in the next chapter.</p>
<p>The point class:</p>
<pre><code class="php">&lt;?php

namespace Geo\ValueObject;

class Point
{

    /**
     * @param float $latitude
     * @param float $longitude
     */
    public function __construct($latitude, $longitude)
    {
        $this-&gt;latitude  = $latitude;
        $this-&gt;longitude = $longitude;
    }

    /**
     * @return float
     */
    public function getLatitude()
    {
        return $this-&gt;latitude;
    }

    /**
     * @return float
     */
    public function getLongitude()
    {
        return $this-&gt;longitude;
    }
}
</code></pre>
<a class="section-anchor" id="title.1.2" name="title.1.2"></a><h2 class="section-header"><a href="#title.1.2">The mapping type<i class="fas fa-link"></i></a></h2>
<p>Now we're going to create the <code>point</code> type and implement all required methods.</p>
<pre><code class="php">&lt;?php

namespace Geo\Types;

use Doctrine\DBAL\Types\Type;
use Doctrine\DBAL\Platforms\AbstractPlatform;

use Geo\ValueObject\Point;

class PointType extends Type
{
    const POINT = 'point';

    public function getName()
    {
        return self::POINT;
    }

    public function getSQLDeclaration(array $fieldDeclaration, AbstractPlatform $platform)
    {
        return 'POINT';
    }

    public function convertToPHPValue($value, AbstractPlatform $platform)
    {
        list($longitude, $latitude) = sscanf($value, 'POINT(%f %f)');

        return new Point($latitude, $longitude);
    }

    public function convertToDatabaseValue($value, AbstractPlatform $platform)
    {
        if ($value instanceof Point) {
            $value = sprintf('POINT(%F %F)', $value-&gt;getLongitude(), $value-&gt;getLatitude());
        }

        return $value;
    }

    public function canRequireSQLConversion()
    {
        return true;
    }

    public function convertToPHPValueSQL($sqlExpr, AbstractPlatform $platform)
    {
        return sprintf('AsText(%s)', $sqlExpr);
    }

    public function convertToDatabaseValueSQL($sqlExpr, AbstractPlatform $platform)
    {
        return sprintf('PointFromText(%s)', $sqlExpr);
    }
}
</code></pre>
<p>We do a 2-step conversion here. In the first step, we convert the <code>Point</code>
object into a string representation before saving to the database (in the
<code>convertToDatabaseValue</code> method) and back into an object after fetching the
value from the database (in the <code>convertToPHPValue</code> method).</p>
<p>The format of the string representation format is called <a href="">Well-known text (WKT)
&lt;https://en.wikipedia.org/wiki/Well-known_text&gt;</a>. The advantage of this format
is, that it is both human readable and parsable by MySQL.</p>
<p>Internally, MySQL stores geometry values in a binary format that is not
identical to the WKT format. So, we need to let MySQL transform the WKT
representation into its internal format.</p>
<p>This is where the <code>convertToPHPValueSQL</code> and  <code>convertToDatabaseValueSQL</code>
methods come into play.</p>
<p>This methods wrap a sql expression (the WKT representation of the Point) into
MySQL functions <a href="http://dev.mysql.com/doc/refman/5.5/en/creating-spatial-values.html#function_pointfromtext">PointFromText</a>
and <a href="http://dev.mysql.com/doc/refman/5.5/en/functions-to-convert-geometries-between-formats.html#function_astext">AsText</a>
which convert WKT strings to and from the internal format of MySQL.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>When using DQL queries, the <code>convertToPHPValueSQL</code> and
<code>convertToDatabaseValueSQL</code> methods only apply to identification variables
and path expressions in SELECT clauses. Expressions in  WHERE clauses are
<strong>not</strong> wrapped!</p>
<p>If you want to use Point values in WHERE clauses, you have to implement a
<a href="dql-user-defined-functions.html">user defined function</a> for
<code>PointFromText</code>.</p>
</div>
<a class="section-anchor" id="title.1.3" name="title.1.3"></a><h2 class="section-header"><a href="#title.1.3">Example usage<i class="fas fa-link"></i></a></h2>
<pre><code class="php">&lt;?php

// Bootstrapping stuff...
// $em = \Doctrine\ORM\EntityManager::create($connectionOptions, $config);

// Setup custom mapping type
use Doctrine\DBAL\Types\Type;

Type::addType('point', 'Geo\Types\PointType');
$em-&gt;getConnection()-&gt;getDatabasePlatform()-&gt;registerDoctrineTypeMapping('point', 'point');

// Store a Location object
use Geo\Entity\Location;
use Geo\ValueObject\Point;

$location = new Location();

$location-&gt;setAddress('1600 Amphitheatre Parkway, Mountain View, CA');
$location-&gt;setPoint(new Point(37.4220761, -122.0845187));

$em-&gt;persist($location);
$em-&gt;flush();
$em-&gt;clear();

// Fetch the Location object
$query = $em-&gt;createQuery(&quot;SELECT l FROM Geo\Entity\Location WHERE l.address = '1600 Amphitheatre Parkway, Mountain View, CA'&quot;);
$location = $query-&gt;getSingleResult();

/** @var Geo\ValueObject\Point $point */
$point = $location-&gt;getPoint();
</code></pre>
                                            </div>
                </div>
            </main>
        </div>
    </div>

                    <footer class="footer">
                <div class="container">
                    <i class="fa fa-copyright"></i> 2018 Doctrine
                </div>
            </footer>
        
        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://new.doctrine-project.org/components/highlightjs/highlight.pack.js?29"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script src="https://new.doctrine-project.org/js/sidebar.js?29"></script>

        <script type="text/javascript">
            // When the user scrolls down 20px from the top of the document, show the button
            window.onscroll = function() {scrollFunction()};

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementById('back-to-top').style.display = "block";
                } else {
                    document.getElementById('back-to-top').style.display = "none";
                }
            }

            // When the user clicks on the button, scroll to the top of the document
            function topFunction() {
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            }
        </script>

        <button onclick="topFunction()" id="back-to-top" title="Go to top">Top</button>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
