<!DOCTYPE html>
<html>
    <head>
        <title>Views and Map-Reduce Queries - CouchDB Object Document Mapper (CouchDB ODM) - Doctrine</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine CouchDB Object Document Mapper Documentation: Views and Map-Reduce Queries ">

        <meta name="keywords" content="couchdb,odm,data,mapper,mapping,object,documentation,views,and,map-reduce,queries">

                    <meta name="robots" content="index, follow">
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine-couchdb-odm/en/latest/reference/map-reduce-queries.html" />
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://www.doctrine-project.org/css/style.css?a4b3e9" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://www.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine-couchdb-odm/en/latest/reference/map-reduce-queries.html" />
        <meta property="og:title" content="Views and Map-Reduce Queries - CouchDB Object Document Mapper (CouchDB ODM) - Doctrine" />
        <meta property="og:description" content="Doctrine CouchDB Object Document Mapper Documentation: Views and Map-Reduce Queries " />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Course",
            "name": "Doctrine CouchDB Object Document Mapper",
            "description": "Views and Map-Reduce Queries",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://www.doctrine-project.org/"><img src="https://www.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="https://www.doctrine-project.org/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item notranslate" href="https://www.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://www.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://www.doctrine-project.org/contribute/" id="navbarContributeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="https://www.doctrine-project.org/contribute/">Contributor Workflow</a>
                                <a class="dropdown-item" href="https://www.doctrine-project.org/contribute/maintainer/">Maintainer Workflow</a>
                                <a class="dropdown-item" href="https://www.doctrine-project.org/contribute/website/">Contribute to Website</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div class="google-translate-dropdown dropdown show d-inline-block mr-2">
                        <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="translateDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Translate
                        </a>

                        <div class="dropdown-menu" aria-labelledby="translateDropdown">
                            <div class="dropdown-item" id="google_translate_element">Loading...</div>
                        </div>
                    </div>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <div class="container-wrapper container-fluid">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        
<div class="toc"><ul><li id="index-html-welcome-to-doctrine-couchdb-documentation" class="toc-item"><a href="../index.html#welcome-to-doctrine-couchdb-documentation">Welcome to Doctrine CouchDB documentation</a></li><li id="association-mapping-html-association-mapping" class="toc-item"><a href="association-mapping.html#association-mapping">Association Mapping</a></li><ul><li id="association-mapping-html-graph-traversal-and-identity-map" class="toc-item"><a href="association-mapping.html#graph-traversal-and-identity-map">Graph Traversal and Identity Map</a></li><li id="association-mapping-html-different-association-mappings" class="toc-item"><a href="association-mapping.html#different-association-mappings">Different Association Mappings</a></li><ul><li id="association-mapping-html-referenceone" class="toc-item"><a href="association-mapping.html#referenceone">ReferenceOne</a></li><li id="association-mapping-html-referencemany" class="toc-item"><a href="association-mapping.html#referencemany">ReferenceMany</a></li><li id="association-mapping-html-inverse-referencemany" class="toc-item"><a href="association-mapping.html#inverse-referencemany">Inverse ReferenceMany</a></li><li id="association-mapping-html-embedone" class="toc-item"><a href="association-mapping.html#embedone">EmbedOne</a></li><li id="association-mapping-html-embedmany" class="toc-item"><a href="association-mapping.html#embedmany">EmbedMany</a></li></ul></ul><li id="attachments-html-attachments" class="toc-item"><a href="attachments.html#attachments">Attachments</a></li><li id="basic-mapping-html-basic-mapping" class="toc-item"><a href="basic-mapping.html#basic-mapping">Basic Mapping</a></li><ul><li id="basic-mapping-html-introduction-to-docblock-annotations" class="toc-item"><a href="basic-mapping.html#introduction-to-docblock-annotations">Introduction to Docblock Annotations</a></li><li id="basic-mapping-html-persistent-classes" class="toc-item"><a href="basic-mapping.html#persistent-classes">Persistent classes</a></li><li id="basic-mapping-html-doctrine-mapping-types" class="toc-item"><a href="basic-mapping.html#doctrine-mapping-types">Doctrine Mapping Types</a></li><li id="basic-mapping-html-field-mapping" class="toc-item"><a href="basic-mapping.html#field-mapping">Field Mapping</a></li><ul><li id="basic-mapping-html-indexing-fields" class="toc-item"><a href="basic-mapping.html#indexing-fields">Indexing Fields</a></li><li id="basic-mapping-html-json-names" class="toc-item"><a href="basic-mapping.html#json-names">Json Names</a></li></ul><li id="basic-mapping-html-id-mapping" class="toc-item"><a href="basic-mapping.html#id-mapping">Id Mapping</a></li><ul><li id="basic-mapping-html-id-generation-strategies" class="toc-item"><a href="basic-mapping.html#id-generation-strategies">Id Generation Strategies</a></li></ul><li id="basic-mapping-html-attachments" class="toc-item"><a href="basic-mapping.html#attachments">Attachments</a></li><li id="basic-mapping-html-document-repositories" class="toc-item"><a href="basic-mapping.html#document-repositories">Document Repositories</a></li></ul><li id="configuration-html-configuration" class="toc-item"><a href="configuration.html#configuration">Configuration</a></li><ul><li id="configuration-html-obtaining-the-documentmanager" class="toc-item"><a href="configuration.html#obtaining-the-documentmanager">Obtaining the DocumentManager</a></li><li id="configuration-html-couchdbclient" class="toc-item"><a href="configuration.html#couchdbclient">CouchDBClient</a></li><ul><li id="configuration-html-http-client-strong-em-required-strong-em" class="toc-item"><a href="configuration.html#http-client-strong-em-required-strong-em">HTTP Client (<strong><em>REQUIRED</strong></em>)</a></li></ul><li id="configuration-html-configuration-options" class="toc-item"><a href="configuration.html#configuration-options">Configuration Options</a></li><ul><li id="configuration-html-proxy-directory-strong-em-required-strong-em" class="toc-item"><a href="configuration.html#proxy-directory-strong-em-required-strong-em">Proxy Directory (<strong><em>REQUIRED</strong></em>)</a></li><li id="configuration-html-proxy-namespace-strong-em-optional-strong-em" class="toc-item"><a href="configuration.html#proxy-namespace-strong-em-optional-strong-em">Proxy Namespace (<strong><em>OPTIONAL</strong></em>)</a></li><li id="configuration-html-metadata-driver-strong-em-required-strong-em" class="toc-item"><a href="configuration.html#metadata-driver-strong-em-required-strong-em">Metadata Driver (<strong><em>REQUIRED</strong></em>)</a></li><li id="configuration-html-metadata-cache-strong-em-recommended-strong-em" class="toc-item"><a href="configuration.html#metadata-cache-strong-em-recommended-strong-em">Metadata Cache (<strong><em>RECOMMENDED</strong></em>)</a></li><li id="configuration-html-lucene-handler-name-strong-em-optional-strong-em" class="toc-item"><a href="configuration.html#lucene-handler-name-strong-em-optional-strong-em">Lucene Handler Name (<strong><em>OPTIONAL</strong></em>)</a></li></ul><li id="configuration-html-proxy-objects" class="toc-item"><a href="configuration.html#proxy-objects">Proxy Objects</a></li><ul><li id="configuration-html-reference-proxies" class="toc-item"><a href="configuration.html#reference-proxies">Reference Proxies</a></li><li id="configuration-html-association-proxies" class="toc-item"><a href="configuration.html#association-proxies">Association proxies</a></li></ul></ul><li id="inheritance-mapping-html-inheritance-mapping" class="toc-item"><a href="inheritance-mapping.html#inheritance-mapping">Inheritance Mapping</a></li><li id="installation-html-installation" class="toc-item"><a href="installation.html#installation">Installation</a></li><ul><li id="installation-html-pear" class="toc-item"><a href="installation.html#pear">PEAR</a></li><li id="installation-html-download" class="toc-item"><a href="installation.html#download">Download</a></li><li id="installation-html-git-github" class="toc-item"><a href="installation.html#git-github">Git/Github</a></li></ul><li id="introduction-html-introduction" class="toc-item"><a href="introduction.html#introduction">Introduction</a></li><ul><li id="introduction-html-features" class="toc-item"><a href="introduction.html#features">Features</a></li><li id="introduction-html-architecture" class="toc-item"><a href="introduction.html#architecture">Architecture</a></li><ul><li id="introduction-html-write-behind" class="toc-item"><a href="introduction.html#write-behind">Write-Behind</a></li><li id="introduction-html-querying" class="toc-item"><a href="introduction.html#querying">Querying</a></li><li id="introduction-html-object-graph-traversal" class="toc-item"><a href="introduction.html#object-graph-traversal">Object-Graph Traversal</a></li></ul><li id="introduction-html-why-nosql" class="toc-item"><a href="introduction.html#why-nosql">Why NoSQL?</a></li><li id="introduction-html-couchdb-document-structure" class="toc-item"><a href="introduction.html#couchdb-document-structure">CouchDB Document Structure</a></li><ul><li id="introduction-html-document-type" class="toc-item"><a href="introduction.html#document-type">Document Type</a></li><li id="introduction-html-associations" class="toc-item"><a href="introduction.html#associations">Associations</a></li><li id="introduction-html-indexes" class="toc-item"><a href="introduction.html#indexes">Indexes</a></li></ul></ul><li id="lucene-queries-html-couchdb-lucene-queries" class="toc-item"><a href="lucene-queries.html#couchdb-lucene-queries">CouchDB Lucene Queries</a></li><li id="map-reduce-queries-html-views-and-map-reduce-queries" class="toc-item"><a href="map-reduce-queries.html#views-and-map-reduce-queries">Views and Map-Reduce Queries</a></li><ul><li id="map-reduce-queries-html-creating-and-managing-views" class="toc-item"><a href="map-reduce-queries.html#creating-and-managing-views">Creating and Managing Views</a></li><li id="map-reduce-queries-html-querying-views" class="toc-item"><a href="map-reduce-queries.html#querying-views">Querying Views</a></li><li id="map-reduce-queries-html-view-results" class="toc-item"><a href="map-reduce-queries.html#view-results">View Results</a></li></ul><li id="tools-html-tools-and-maintenance" class="toc-item"><a href="tools.html#tools-and-maintenance">Tools and Maintenance</a></li><ul><li id="tools-html-couchdb-migrate" class="toc-item"><a href="tools.html#couchdb-migrate">couchdb:migrate</a></li><li id="tools-html-couchdb-maintenance-compact-database" class="toc-item"><a href="tools.html#couchdb-maintenance-compact-database">couchdb:maintenance:compact-database</a></li><li id="tools-html-couchdb-maintenance-compact-view" class="toc-item"><a href="tools.html#couchdb-maintenance-compact-view">couchdb:maintenance:compact-view</a></li><li id="tools-html-couchdb-maintenance-view-cleanup" class="toc-item"><a href="tools.html#couchdb-maintenance-view-cleanup">couchdb:maintenance:view-cleanup</a></li><li id="tools-html-couchdb-odm-update-design-doc" class="toc-item"><a href="tools.html#couchdb-odm-update-design-doc">couchdb:odm:update-design-doc</a></li></ul><li id="working-with-objects-html-working-with-objects" class="toc-item"><a href="working-with-objects.html#working-with-objects">Working with Objects</a></li><ul><li id="working-with-objects-html-understanding" class="toc-item"><a href="working-with-objects.html#understanding">Understanding</a></li><ul><li id="working-with-objects-html-the-size-of-a-unit-of-work" class="toc-item"><a href="working-with-objects.html#the-size-of-a-unit-of-work">The size of a Unit of Work</a></li><li id="working-with-objects-html-the-cost-of-flush" class="toc-item"><a href="working-with-objects.html#the-cost-of-flush">The cost of flush()</a></li><li id="working-with-objects-html-direct-access-to-a-unit-of-work" class="toc-item"><a href="working-with-objects.html#direct-access-to-a-unit-of-work">Direct access to a Unit of Work</a></li></ul><li id="working-with-objects-html-persisting-documents" class="toc-item"><a href="working-with-objects.html#persisting-documents">Persisting documents</a></li><li id="working-with-objects-html-removing-documents" class="toc-item"><a href="working-with-objects.html#removing-documents">Removing documents</a></li><li id="working-with-objects-html-detaching-documents" class="toc-item"><a href="working-with-objects.html#detaching-documents">Detaching documents</a></li><li id="working-with-objects-html-merging-documents" class="toc-item"><a href="working-with-objects.html#merging-documents">Merging documents</a></li><li id="working-with-objects-html-references" class="toc-item"><a href="working-with-objects.html#references">References</a></li><li id="working-with-objects-html-establishing-references" class="toc-item"><a href="working-with-objects.html#establishing-references">Establishing References</a></li><li id="working-with-objects-html-removing-references" class="toc-item"><a href="working-with-objects.html#removing-references">Removing References</a></li><li id="working-with-objects-html-transitive-persistence" class="toc-item"><a href="working-with-objects.html#transitive-persistence">Transitive persistence</a></li><li id="working-with-objects-html-querying" class="toc-item"><a href="working-with-objects.html#querying">Querying</a></li><ul><li id="working-with-objects-html-by-primary-key" class="toc-item"><a href="working-with-objects.html#by-primary-key">By Primary Key</a></li><li id="working-with-objects-html-by-simple-conditions" class="toc-item"><a href="working-with-objects.html#by-simple-conditions">By Simple Conditions</a></li><li id="working-with-objects-html-by-lazy-loading" class="toc-item"><a href="working-with-objects.html#by-lazy-loading">By Lazy Loading</a></li><li id="working-with-objects-html-by-query-objects" class="toc-item"><a href="working-with-objects.html#by-query-objects">By Query Objects</a></li><li id="working-with-objects-html-custom-repositories" class="toc-item"><a href="working-with-objects.html#custom-repositories">Custom Repositories</a></li></ul></ul></ul></div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/couchdb-odm.html">CouchDB ODM</a></li>
                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-couchdb-odm/en/latest/">Documentation</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Views and Map-Reduce Queries</li>
                            </ol>
                        </nav>
                                    </div>

                                    <div class="alert warning bg-light-yellow text-dark border"><i class="fas fa-exclamation-circle text-warning mr-2"></i> This project is not being actively maintained. If you are interested in helping to maintain this project, take a look at the open issues on <a href="https://github.com/doctrine/couchdb-odm/" target="_blank">GitHub</a> and submit pull requests.</div>
                
                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine-couchdb-odm/en/latest/reference/map-reduce-queries.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        master
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                            
                                                <a class="project-version-switcher dropdown-item active" href="/projects/doctrine-couchdb-odm/en/latest/reference/map-reduce-queries.html">
                                                    master

                                                    
                                                                                                    </a>
                                                                                    
                                                                            </div>
                                </div>

                                <a href="https://github.com/doctrine/couchdb-odm/edit/master/docs/en/reference/map-reduce-queries.rst" class="btn btn-primary btn-sm">Edit</a>
                            
                            
<p></p>
<a class="section-anchor" id="views-and-map-reduce-queries" name="views-and-map-reduce-queries"></a><h1 class="section-header"><a href="#views-and-map-reduce-queries">Views and Map-Reduce Queries<i class="fas fa-link"></i></a></h1>
<p>CouchDB uses views filtered through map-reduce to query all the documents of your database. Each view
has a map- and optionally a reduce-function. Doctrine CouchDB ODM allows you to create and query views
in your application.</p>
<a class="section-anchor" id="creating-and-managing-views" name="creating-and-managing-views"></a><h2 class="section-header"><a href="#creating-and-managing-views">Creating and Managing Views<i class="fas fa-link"></i></a></h2>
<p>Views are best managed as a folder structure in the filesystem. Create a Directory &quot;couchdb/views&quot;
and instantiate a <code>FolderDesignDocument</code> in the following way and create the
design document in the database:</p>
<pre><code class="php">&lt;?php
use Doctrine\CouchDB\View\FolderDesignDocument;

$view = new FolderDesignDocument(&quot;path/to/app/couchdb&quot;);
$designDocJson = $view-&gt;getData();

$couchClient-&gt;createDesignDocument(&quot;myapp&quot;, $view);
</code></pre>
<p>If the directory structure now looked like the following:</p>

<pre><code class="">couchdb/
    views/
        username/
            map.js
        article-dates/
            map.js
            reduce.js
</code></pre>
<p>It will create two views &quot;username&quot; and &quot;article-dates&quot; with
corresponding map and reduce functions. For example
the username map.js might look like:</p>
<pre><code class="javascript">function(doc) {
    if (doc.type == 'Doctrine.Tests.Models.CMS.CmsUser') {
        emit(doc.username, doc._id);
    }
}
</code></pre>
<a class="section-anchor" id="querying-views" name="querying-views"></a><h2 class="section-header"><a href="#querying-views">Querying Views<i class="fas fa-link"></i></a></h2>
<p>To query a view from Doctrine CouchDB ODM you have to register it with its design document name
in the CouchDB ODM Configuration:</p>
<pre><code class="php">&lt;?php

$config = $dm-&gt;getConfiguration();
$config-&gt;addDesignDocument(
    &quot;myapp&quot;, 
    &quot;Doctrine\CouchDB\View\FolderDesignDocument&quot;,
    &quot;path/to/app/couchdb&quot;
);
</code></pre>
<p>You can then create either a native or a odm-query by calling
either <code>DocumentManager#createNativeQuery($designDocName, $viewName)</code> or
<code>DocumentManager#createQuery($designDocName, $viewName)</code>.</p>
<p>The difference between both queries is their result and some parameters. The ODM query will
return instances of php objects that map to the CouchDB documents and
the native query will return only convert the json to arrays that have been fetched from
the CouchDB.</p>
<p>Both queries have a common base class with a simple API:</p>
<pre><code class="php">&lt;?php

namespace Doctrine\CouchDB\View;

abstract class AbstractQuery
{
    /**
     * Get HTTP Query Parameter 
     *
     * @param  string $key
     * @return mixed
     */
    public function getParameter($key);

    /**
     * Query the view with the current params.
     *
     * @return Doctrine\CouchDB\View\Result
     */
    public function execute();

    /**
     * Create design document for this query.
     *
     * Method is used internally when querying the view and it doesnt exist yet.
     *
     * @return void
     */
    public function createDesignDocument();
}
</code></pre>
<p>With both query types you just call execute() to retrieve the result from the database.</p>
<p>The following query parameter related methods exist in both the native and odm-query:</p>
<pre><code class="php">&lt;?php
namespace Doctrine\CouchDB\View;

class Query extends AbstractQuery
{
    /**
     * Find key in view.
     *
     * @param  string $val
     * @return Query
     */
    public function setKey($val);

    /**
     * Set starting key to query view for.
     *
     * @param  string $val
     * @return Query
     */
    public function setStartKey($val);

    /**
     * Set ending key to query view for.
     *
     * @param  string $val
     * @return Query
     */
    public function setEndKey($val);

    /**
     * Document id to start with
     *
     * @param  string $val
     * @return Query
     */
    public function setStartKeyDocId($val);

    /**
     * Last document id to include in the output
     *
     * @param  string $val
     * @return Query
     */
    public function setEndKeyDocId($val);

    /**
     * Limit the number of documents in the output
     *
     * @param  int $val
     * @return Query
     */
    public function setLimit($val);

    /**
     * Skip n number of documents
     *
     * @param  int $val
     * @return Query
     */
    public function setSkip($val);

    /**
     * If stale=ok is set CouchDB will not refresh the view even if it is stalled.
     *
     * @param  bool $flag
     * @return Query
     */
    public function setStale($flag);

    /**
     * reverse the output
     *
     * @param  bool $flag
     * @return Query
     */
    public function setDescending($flag);

    /**
     * The group option controls whether the reduce function reduces to a set of distinct keys or to a single result row.
     *
     * @param  bool $flag
     * @return Query
     */
    public function setGroup($flag);

    public function setGroupLevel($level);

    /**
     * Use the reduce function of the view. It defaults to true, if a reduce function is defined and to false otherwise.
     *
     * @param  bool $flag
     * @return Query
     */
    public function setReduce($flag);

    /**
     * Controls whether the endkey is included in the result. It defaults to true.
     *
     * @param  bool $flag
     * @return Query
     */
    public function setInclusiveEnd($flag);

    /**
     * Automatically fetch and include the document which emitted each view entry
     *
     * @param  bool $flag
     * @return Query
     */
    public function setIncludeDocs($flag);
}
</code></pre>
<p>There is a single additional method on the ODM Query that specifies if
you just want to return the documents associated with a view result:</p>
<pre><code class="php">&lt;?php
namespace Doctrine\ODM\CouchDB\View;

class ODMQuery extends Query
{
    public function onlyDocs($flag);
}
</code></pre>
<p>An example execution of the username view given above looks like:</p>
<pre><code class="php">&lt;?php

$query = $dm-&gt;createQuery(&quot;myapp&quot;, &quot;username&quot;);
$result = $query-&gt;setStartKey(&quot;b&quot;)
      -&gt;setEndKey(&quot;c&quot;)
      -&gt;setLimit(100)
      -&gt;setSkip(20)
      -&gt;onlyDocs(true)
      -&gt;execute();
</code></pre>
<p>This will return all usernames starting with &quot;b&quot; and ending with &quot;c&quot;,
skipping the first 20 results and limiting the result to 100 documents.</p>
<a class="section-anchor" id="view-results" name="view-results"></a><h2 class="section-header"><a href="#view-results">View Results<i class="fas fa-link"></i></a></h2>
<p>The result of a view is an instance of <code>Doctrine\CouchDB\View\Result</code>.
It implements <code>Countable</code>, <code>IteratorAggregate</code> and <code>ArrayAccess</code>.
If you specify <code>onlyDocs(true)</code> each result-row will contain only
the associated document, otherwise the document is on the row index &quot;doc&quot;
of the query.</p>
<p>The following snippet shows the difference:</p>
<pre><code class="php">&lt;?php

$query = $dm-&gt;createQuery(&quot;myapp&quot;, &quot;username&quot;);
$result = $query-&gt;setStartKey(&quot;b&quot;)
      -&gt;setEndKey(&quot;c&quot;)
      -&gt;setLimit(100)
      -&gt;setSkip(20)
      -&gt;onlyDocs(true)
      -&gt;execute();

foreach ($result AS $user) {
    echo $user-&gt;getUsername() . &quot;\n&quot;;
}

$query-&gt;onlyDocs(false);
$result = $query-&gt;execute();

foreach ($result AS $userRow) {
    echo $userRow['doc']-&gt;getUsername() . &quot;\n&quot;;
}
</code></pre>
<p></p>
                                            </div>
                </div>
            </main>
        </div>
    </div>

                            
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://www.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://cdn.ravenjs.com/3.24.2/raven.min.js" crossorigin="anonymous"></script>

        <script type="text/javascript">
            Raven.config('https://09ce137590054cfd8f0b7e9324d6ec14@sentry.io/1197701').install()
        </script>

        <script src="https://www.doctrine-project.org/js/main.js?2a2af0"></script>
        <script src="https://www.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = 'couchdb-odm';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }

            function googleTranslateElementInit() {
                $('#google_translate_element').html('');

                new google.translate.TranslateElement(
                    {pageLanguage: 'en'}, 'google_translate_element'
                );

                $('#google_translate_element select').on('change', function() {
                    var language = $('#google_translate_element select option:selected').text();

                    googleAnalyticsEvent('Translate', 'click', language);
                });
            }
        </script>

        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>

            <script src="https://www.doctrine-project.org/js/sidebar.js?01f3db"></script>

    <script type="text/javascript">
        new Sidebar();
    </script>

                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
