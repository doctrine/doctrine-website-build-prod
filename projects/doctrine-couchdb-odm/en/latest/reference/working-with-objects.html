<!DOCTYPE html>
<html>
    <head>
        <title>Working with Objects - CouchDB Object Document Mapper (CouchDB ODM)</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="PHP Doctrine CouchDB Object Document Mapper (ODM) provides transparent persistence for PHP objects to CouchDB.
">

        <meta name="keywords" content="couchdb,odm,mapper,mapping,object">

                    <meta name="robots" content="index, follow">
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine-couchdb-odm/en/latest/reference/working-with-objects.html" />
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://www.doctrine-project.org/css/style.css?ab4e16" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://www.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine-couchdb-odm/en/latest/reference/working-with-objects.html" />
        <meta property="og:title" content="Working with Objects - CouchDB Object Document Mapper (CouchDB ODM)" />
        <meta property="og:description" content="PHP Doctrine CouchDB Object Document Mapper (ODM) provides transparent persistence for PHP objects to CouchDB.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Course",
            "name": "Doctrine CouchDB Object Document Mapper",
            "description": "Working with Objects",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://www.doctrine-project.org/"><img src="https://www.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="https://www.doctrine-project.org/projects.html" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="https://www.doctrine-project.org/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <div class="container-wrapper container-fluid">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        
<div class="toc"><ul><li id="--/index-html-welcome-to-doctrine-couchdb-documentation" class="toc-item"><a href="../index.html#welcome-to-doctrine-couchdb-documentation">Welcome to Doctrine CouchDB documentation</a></li><li id="association-mapping-html-association-mapping" class="toc-item"><a href="association-mapping.html#association-mapping">Association Mapping</a></li><ul><li id="association-mapping-html-graph-traversal-and-identity-map" class="toc-item"><a href="association-mapping.html#graph-traversal-and-identity-map">Graph Traversal and Identity Map</a></li><li id="association-mapping-html-different-association-mappings" class="toc-item"><a href="association-mapping.html#different-association-mappings">Different Association Mappings</a></li><ul><li id="association-mapping-html-referenceone" class="toc-item"><a href="association-mapping.html#referenceone">ReferenceOne</a></li><li id="association-mapping-html-referencemany" class="toc-item"><a href="association-mapping.html#referencemany">ReferenceMany</a></li><li id="association-mapping-html-inverse-referencemany" class="toc-item"><a href="association-mapping.html#inverse-referencemany">Inverse ReferenceMany</a></li><li id="association-mapping-html-embedone" class="toc-item"><a href="association-mapping.html#embedone">EmbedOne</a></li><li id="association-mapping-html-embedmany" class="toc-item"><a href="association-mapping.html#embedmany">EmbedMany</a></li></ul></ul><li id="attachments-html-attachments" class="toc-item"><a href="attachments.html#attachments">Attachments</a></li><li id="basic-mapping-html-basic-mapping" class="toc-item"><a href="basic-mapping.html#basic-mapping">Basic Mapping</a></li><ul><li id="basic-mapping-html-introduction-to-docblock-annotations" class="toc-item"><a href="basic-mapping.html#introduction-to-docblock-annotations">Introduction to Docblock Annotations</a></li><li id="basic-mapping-html-persistent-classes" class="toc-item"><a href="basic-mapping.html#persistent-classes">Persistent classes</a></li><li id="basic-mapping-html-doctrine-mapping-types" class="toc-item"><a href="basic-mapping.html#doctrine-mapping-types">Doctrine Mapping Types</a></li><li id="basic-mapping-html-field-mapping" class="toc-item"><a href="basic-mapping.html#field-mapping">Field Mapping</a></li><ul><li id="basic-mapping-html-indexing-fields" class="toc-item"><a href="basic-mapping.html#indexing-fields">Indexing Fields</a></li><li id="basic-mapping-html-json-names" class="toc-item"><a href="basic-mapping.html#json-names">Json Names</a></li></ul><li id="basic-mapping-html-id-mapping" class="toc-item"><a href="basic-mapping.html#id-mapping">Id Mapping</a></li><ul><li id="basic-mapping-html-id-generation-strategies" class="toc-item"><a href="basic-mapping.html#id-generation-strategies">Id Generation Strategies</a></li></ul><li id="basic-mapping-html-attachments" class="toc-item"><a href="basic-mapping.html#attachments">Attachments</a></li><li id="basic-mapping-html-document-repositories" class="toc-item"><a href="basic-mapping.html#document-repositories">Document Repositories</a></li></ul><li id="configuration-html-configuration" class="toc-item"><a href="configuration.html#configuration">Configuration</a></li><ul><li id="configuration-html-obtaining-the-documentmanager" class="toc-item"><a href="configuration.html#obtaining-the-documentmanager">Obtaining the DocumentManager</a></li><li id="configuration-html-couchdbclient" class="toc-item"><a href="configuration.html#couchdbclient">CouchDBClient</a></li><ul><li id="configuration-html-http-client-strong-em-required-strong-em" class="toc-item"><a href="configuration.html#http-client-strong-em-required-strong-em">HTTP Client (<strong><em>REQUIRED</strong></em>)</a></li></ul><li id="configuration-html-configuration-options" class="toc-item"><a href="configuration.html#configuration-options">Configuration Options</a></li><ul><li id="configuration-html-proxy-directory-strong-em-required-strong-em" class="toc-item"><a href="configuration.html#proxy-directory-strong-em-required-strong-em">Proxy Directory (<strong><em>REQUIRED</strong></em>)</a></li><li id="configuration-html-proxy-namespace-strong-em-optional-strong-em" class="toc-item"><a href="configuration.html#proxy-namespace-strong-em-optional-strong-em">Proxy Namespace (<strong><em>OPTIONAL</strong></em>)</a></li><li id="configuration-html-metadata-driver-strong-em-required-strong-em" class="toc-item"><a href="configuration.html#metadata-driver-strong-em-required-strong-em">Metadata Driver (<strong><em>REQUIRED</strong></em>)</a></li><li id="configuration-html-metadata-cache-strong-em-recommended-strong-em" class="toc-item"><a href="configuration.html#metadata-cache-strong-em-recommended-strong-em">Metadata Cache (<strong><em>RECOMMENDED</strong></em>)</a></li><li id="configuration-html-lucene-handler-name-strong-em-optional-strong-em" class="toc-item"><a href="configuration.html#lucene-handler-name-strong-em-optional-strong-em">Lucene Handler Name (<strong><em>OPTIONAL</strong></em>)</a></li></ul><li id="configuration-html-proxy-objects" class="toc-item"><a href="configuration.html#proxy-objects">Proxy Objects</a></li><ul><li id="configuration-html-reference-proxies" class="toc-item"><a href="configuration.html#reference-proxies">Reference Proxies</a></li><li id="configuration-html-association-proxies" class="toc-item"><a href="configuration.html#association-proxies">Association proxies</a></li></ul></ul><li id="inheritance-mapping-html-inheritance-mapping" class="toc-item"><a href="inheritance-mapping.html#inheritance-mapping">Inheritance Mapping</a></li><li id="installation-html-installation" class="toc-item"><a href="installation.html#installation">Installation</a></li><ul><li id="installation-html-pear" class="toc-item"><a href="installation.html#pear">PEAR</a></li><li id="installation-html-download" class="toc-item"><a href="installation.html#download">Download</a></li><li id="installation-html-git-github" class="toc-item"><a href="installation.html#git-github">Git/Github</a></li></ul><li id="introduction-html-introduction" class="toc-item"><a href="introduction.html#introduction">Introduction</a></li><ul><li id="introduction-html-features" class="toc-item"><a href="introduction.html#features">Features</a></li><li id="introduction-html-architecture" class="toc-item"><a href="introduction.html#architecture">Architecture</a></li><ul><li id="introduction-html-write-behind" class="toc-item"><a href="introduction.html#write-behind">Write-Behind</a></li><li id="introduction-html-querying" class="toc-item"><a href="introduction.html#querying">Querying</a></li><li id="introduction-html-object-graph-traversal" class="toc-item"><a href="introduction.html#object-graph-traversal">Object-Graph Traversal</a></li></ul><li id="introduction-html-why-nosql" class="toc-item"><a href="introduction.html#why-nosql">Why NoSQL?</a></li><li id="introduction-html-couchdb-document-structure" class="toc-item"><a href="introduction.html#couchdb-document-structure">CouchDB Document Structure</a></li><ul><li id="introduction-html-document-type" class="toc-item"><a href="introduction.html#document-type">Document Type</a></li><li id="introduction-html-associations" class="toc-item"><a href="introduction.html#associations">Associations</a></li><li id="introduction-html-indexes" class="toc-item"><a href="introduction.html#indexes">Indexes</a></li></ul></ul><li id="lucene-queries-html-couchdb-lucene-queries" class="toc-item"><a href="lucene-queries.html#couchdb-lucene-queries">CouchDB Lucene Queries</a></li><li id="map-reduce-queries-html-views-and-map-reduce-queries" class="toc-item"><a href="map-reduce-queries.html#views-and-map-reduce-queries">Views and Map-Reduce Queries</a></li><ul><li id="map-reduce-queries-html-creating-and-managing-views" class="toc-item"><a href="map-reduce-queries.html#creating-and-managing-views">Creating and Managing Views</a></li><li id="map-reduce-queries-html-querying-views" class="toc-item"><a href="map-reduce-queries.html#querying-views">Querying Views</a></li><li id="map-reduce-queries-html-view-results" class="toc-item"><a href="map-reduce-queries.html#view-results">View Results</a></li></ul><li id="tools-html-tools-and-maintenance" class="toc-item"><a href="tools.html#tools-and-maintenance">Tools and Maintenance</a></li><ul><li id="tools-html-couchdb-migrate" class="toc-item"><a href="tools.html#couchdb-migrate">couchdb:migrate</a></li><li id="tools-html-couchdb-maintenance-compact-database" class="toc-item"><a href="tools.html#couchdb-maintenance-compact-database">couchdb:maintenance:compact-database</a></li><li id="tools-html-couchdb-maintenance-compact-view" class="toc-item"><a href="tools.html#couchdb-maintenance-compact-view">couchdb:maintenance:compact-view</a></li><li id="tools-html-couchdb-maintenance-view-cleanup" class="toc-item"><a href="tools.html#couchdb-maintenance-view-cleanup">couchdb:maintenance:view-cleanup</a></li><li id="tools-html-couchdb-odm-update-design-doc" class="toc-item"><a href="tools.html#couchdb-odm-update-design-doc">couchdb:odm:update-design-doc</a></li></ul><li id="working-with-objects-html-working-with-objects" class="toc-item"><a href="working-with-objects.html#working-with-objects">Working with Objects</a></li><ul><li id="working-with-objects-html-understanding" class="toc-item"><a href="working-with-objects.html#understanding">Understanding</a></li><ul><li id="working-with-objects-html-the-size-of-a-unit-of-work" class="toc-item"><a href="working-with-objects.html#the-size-of-a-unit-of-work">The size of a Unit of Work</a></li><li id="working-with-objects-html-the-cost-of-flush" class="toc-item"><a href="working-with-objects.html#the-cost-of-flush">The cost of flush()</a></li><li id="working-with-objects-html-direct-access-to-a-unit-of-work" class="toc-item"><a href="working-with-objects.html#direct-access-to-a-unit-of-work">Direct access to a Unit of Work</a></li></ul><li id="working-with-objects-html-persisting-documents" class="toc-item"><a href="working-with-objects.html#persisting-documents">Persisting documents</a></li><li id="working-with-objects-html-removing-documents" class="toc-item"><a href="working-with-objects.html#removing-documents">Removing documents</a></li><li id="working-with-objects-html-detaching-documents" class="toc-item"><a href="working-with-objects.html#detaching-documents">Detaching documents</a></li><li id="working-with-objects-html-merging-documents" class="toc-item"><a href="working-with-objects.html#merging-documents">Merging documents</a></li><li id="working-with-objects-html-references" class="toc-item"><a href="working-with-objects.html#references">References</a></li><li id="working-with-objects-html-establishing-references" class="toc-item"><a href="working-with-objects.html#establishing-references">Establishing References</a></li><li id="working-with-objects-html-removing-references" class="toc-item"><a href="working-with-objects.html#removing-references">Removing References</a></li><li id="working-with-objects-html-transitive-persistence" class="toc-item"><a href="working-with-objects.html#transitive-persistence">Transitive persistence</a></li><li id="working-with-objects-html-querying" class="toc-item"><a href="working-with-objects.html#querying">Querying</a></li><ul><li id="working-with-objects-html-by-primary-key" class="toc-item"><a href="working-with-objects.html#by-primary-key">By Primary Key</a></li><li id="working-with-objects-html-by-simple-conditions" class="toc-item"><a href="working-with-objects.html#by-simple-conditions">By Simple Conditions</a></li><li id="working-with-objects-html-by-lazy-loading" class="toc-item"><a href="working-with-objects.html#by-lazy-loading">By Lazy Loading</a></li><li id="working-with-objects-html-by-query-objects" class="toc-item"><a href="working-with-objects.html#by-query-objects">By Query Objects</a></li><li id="working-with-objects-html-custom-repositories" class="toc-item"><a href="working-with-objects.html#custom-repositories">Custom Repositories</a></li></ul></ul></ul></div>
                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/couchdb-odm.html">CouchDB ODM</a></li>
                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-couchdb-odm/en/latest/">Documentation</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Working with Objects</li>
                            </ol>
                        </nav>
                                    </div>

                                    <div class="alert warning bg-light-yellow text-dark border"><i class="fas fa-exclamation-circle text-warning mr-2"></i> This project is not being actively maintained. If you are interested in helping to maintain this project, take a look at the open issues on <a href="https://github.com/doctrine/couchdb-odm/" target="_blank">GitHub</a> and submit pull requests.</div>
                
                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            <ul class="list-inline">
                                                                            <li class="list-inline-item mr-0">
                                            <a href="/projects/doctrine-couchdb-odm/en/latest/reference/working-with-objects.html" class="project-version-switcher badge badge-warning">master</a>
                                        </li>
                                    
                                    
                                    <li class="list-inline-item ml-2"><a href="https://github.com/doctrine/couchdb-odm/edit/master/docs/en/reference/working-with-objects.rst" class="badge badge-primary">Edit</a></li>

                                </ul>
                            
                            
<p></p>
<a class="section-anchor" id="working-with-objects" name="working-with-objects"></a><h1 class="section-header"><a href="#working-with-objects">Working with Objects<i class="fas fa-link"></i></a></h1>
<a class="section-anchor" id="understanding" name="understanding"></a><h2 class="section-header"><a href="#understanding">Understanding<i class="fas fa-link"></i></a></h2>
<p>In this chapter we will help you understand the <code>DocumentManager</code>
and the <code>UnitOfWork</code>. A Unit of Work is similar to an
object-level transaction. A new Unit of Work is implicitly started
when an DocumentManager is initially created or after
<code>DocumentManager#flush()</code> has been invoked. A Unit of Work is
committed (and a new one started) by invoking
<code>DocumentManager#flush()</code>.</p>
<p>A Unit of Work can be manually closed by calling
<code>DocumentManager#close()</code>. Any changes to objects within this
Unit of Work that have not yet been persisted are lost.</p>
<a class="section-anchor" id="the-size-of-a-unit-of-work" name="the-size-of-a-unit-of-work"></a><h3 class="section-header"><a href="#the-size-of-a-unit-of-work">The size of a Unit of Work<i class="fas fa-link"></i></a></h3>
<p>The size of a Unit of Work mainly refers to the number of managed
documents at a particular point in time.</p>
<a class="section-anchor" id="the-cost-of-flush" name="the-cost-of-flush"></a><h3 class="section-header"><a href="#the-cost-of-flush">The cost of flush()<i class="fas fa-link"></i></a></h3>
<p>How costly a flush operation is in terms of performance mainly
depends on the size. You can get the size of your Unit of Work as
follows:</p>
<pre><code class="php">&lt;?php

$uowSize = $dm-&gt;getUnitOfWork()-&gt;size();
</code></pre>
<p>The size represents the number of managed documents in the Unit of
Work. This size affects the performance of flush() operations due
to change tracking and, of course, memory consumption, so you may
want to check it from time to time during development.</p>
<div class="alert caution bg-light-yellow text-dark border"><i class="fas fa-exclamation-triangle text-danger mr-2"></i><p>Do not invoke <code>flush</code> after every change to a
document or every single invocation of persist/remove/merge/...
This is an anti-pattern and unnecessarily reduces the performance
of your application. Instead, form units of work that operate on
your objects and call <code>flush</code> when you are done. While serving a
single HTTP request there should be usually no need for invoking
<code>flush</code> more than 0-2 times.</p>
</div>
<a class="section-anchor" id="direct-access-to-a-unit-of-work" name="direct-access-to-a-unit-of-work"></a><h3 class="section-header"><a href="#direct-access-to-a-unit-of-work">Direct access to a Unit of Work<i class="fas fa-link"></i></a></h3>
<p>You can get direct access to the Unit of Work by calling
<code>DocumentManager#getUnitOfWork()</code>. This will return the
UnitOfWork instance the DocumentManager is currently using.</p>
<pre><code class="php">&lt;?php

$uow = $dm-&gt;getUnitOfWork();
</code></pre>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>Directly manipulating a UnitOfWork is not recommended.
When working directly with the UnitOfWork API, respect methods
marked as INTERNAL by not using them and carefully read the API
documentation.</p>
</div>
<a class="section-anchor" id="persisting-documents" name="persisting-documents"></a><h2 class="section-header"><a href="#persisting-documents">Persisting documents<i class="fas fa-link"></i></a></h2>
<p>A document can be made persistent by passing it to the
<code>DocumentManager#persist($document)</code> method. By applying the
persist operation on some document, that document becomes MANAGED,
which means that its persistence is from now on managed by an
DocumentManager. As a result the persistent state of such a
document will subsequently be properly synchronized with the
database when <code>DocumentManager#flush()</code> is invoked.</p>
<div class="alert caution bg-light-yellow text-dark border"><i class="fas fa-exclamation-triangle text-danger mr-2"></i><p>Invoking the <code>persist</code> method on a document does NOT
cause an immediate insert to be issued on the database. Doctrine
applies a strategy called &quot;transactional write-behind&quot;, which means
that it will delay most operations until
<code>DocumentManager#flush()</code> is invoked which will then issue all
necessary queries to synchronize your objects with the database in
the most efficient way.</p>
</div>
<p>Example:</p>
<pre><code class="php">&lt;?php

$user = new User();
$user-&gt;setUsername('jwage');
$user-&gt;setPassword('changeme');
$dm-&gt;persist($user);
$dm-&gt;flush();
</code></pre>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>The \_id of a document is available directly after persist
when using the UUID strategy (which is default).</p>
</div>
<p>The semantics of the persist operation, applied on a document X,
are as follows:</p>
<p>-<br />   If X is a new document, it becomes managed. The document X will be
   entered into the database as a result of the flush operation.
-<br />   If X is a pre-existing managed document, it is ignored by the
   persist operation. However, the persist operation is cascaded to
   documents referenced by X, if the relationships from X to these
   other documents are mapped with cascade=PERSIST or cascade=ALL.
-  If X is a removed document, it becomes managed.
-  If X is a detached document, the behavior is undefined.</p>
<div class="alert caution bg-light-yellow text-dark border"><i class="fas fa-exclamation-triangle text-danger mr-2"></i><p>Do not pass detached documents to the persist operation.</p>
</div>
<a class="section-anchor" id="removing-documents" name="removing-documents"></a><h2 class="section-header"><a href="#removing-documents">Removing documents<i class="fas fa-link"></i></a></h2>
<p>A document can be removed from persistent storage by passing it to
the <code>DocumentManager#remove($document)</code> method. By applying the
<code>remove</code> operation on some document, that document becomes
REMOVED, which means that its persistent state will be deleted once
<code>DocumentManager#flush()</code> is invoked. The in-memory state of a
document is unaffected by the <code>remove</code> operation.</p>
<div class="alert caution bg-light-yellow text-dark border"><i class="fas fa-exclamation-triangle text-danger mr-2"></i><p>Just like <code>persist</code>, invoking <code>remove</code> on a
document does NOT cause an immediate query to be issued on the
database. The document will be removed on the next invocation of
<code>DocumentManager#flush()</code> that involves that document.</p>
</div>
<p>Example:</p>
<pre><code class="php">&lt;?php

$dm-&gt;remove($user);
$dm-&gt;flush();
</code></pre>
<p>The semantics of the remove operation, applied to a document X are
as follows:</p>
<p>-<br />   If X is a new document, it is ignored by the remove operation.
   However, the remove operation is cascaded to documents referenced
   by X, if the relationship from X to these other documents is mapped
   with cascade=REMOVE or cascade=ALL.
-<br />   If X is a managed document, the remove operation causes it to
   become removed. The remove operation is cascaded to documents
   referenced by X, if the relationships from X to these other
   documents is mapped with cascade=REMOVE or cascade=ALL.
-<br />   If X is a detached document, an InvalidArgumentException will be
   thrown.
-<br />   If X is a removed document, it is ignored by the remove operation.
-<br />   A removed document X will be removed from the database as a result
   of the flush operation.</p>
<a class="section-anchor" id="detaching-documents" name="detaching-documents"></a><h2 class="section-header"><a href="#detaching-documents">Detaching documents<i class="fas fa-link"></i></a></h2>
<p>A document is detached from an DocumentManager and thus no longer
managed by invoking the <code>DocumentManager#detach($document)</code>
method on it or by cascading the detach operation to it. Changes
made to the detached document, if any (including removal of the
document), will not be synchronized to the database after the
document has been detached.</p>
<p>Doctrine will not hold on to any references to a detached
document.</p>
<pre><code class="php">&lt;?php

$dm-&gt;detach($document);
</code></pre>
<p>The semantics of the detach operation, applied to a document X are
as follows:</p>
<p>-<br />   If X is a managed document, the detach operation causes it to
   become detached. The detach operation is cascaded to documents
   referenced by X, if the relationships from X to these other
   documents is mapped with cascade=DETACH or cascade=ALL. Documents
   which previously referenced X will continue to reference X.
-<br />   If X is a new or detached document, it is ignored by the detach
   operation.
-<br />   If X is a removed document, the detach operation is cascaded to
   documents referenced by X, if the relationships from X to these
   other documents is mapped with cascade=DETACH or
   cascade=ALL/Documents which previously referenced X will continue
   to reference X.</p>
<p>There are several situations in which a document is detached
automatically without invoking the <code>detach</code> method:</p>
<p>-<br />   When <code>DocumentManager#clear()</code> is invoked, all documents that are
   currently managed by the DocumentManager instance become detached.
-<br />   When serializing a document. The document retrieved upon subsequent
   unserialization will be detached (This is the case for all
   documents that are serialized and stored in some cache).</p>
<p>The <code>detach</code> operation is usually not as frequently needed and
used as <code>persist</code> and <code>remove</code>.</p>
<a class="section-anchor" id="merging-documents" name="merging-documents"></a><h2 class="section-header"><a href="#merging-documents">Merging documents<i class="fas fa-link"></i></a></h2>
<p>Merging documents refers to the merging of (usually detached)
documents into the context of an DocumentManager so that they
become managed again. To merge the state of a document into an
DocumentManager use the <code>DocumentManager#merge($document)</code>
method. The state of the passed document will be merged into a
managed copy of this document and this copy will subsequently be
returned.</p>
<pre><code class="php">&lt;?php

$detachedDocument = unserialize($serializedDocument); // some detached document
$document = $dm-&gt;merge($detachedDocument);
// $document now refers to the fully managed copy returned by the merge operation.
// The DocumentManager $dm now manages the persistence of $document as usual.
</code></pre>
<div class="alert caution bg-light-yellow text-dark border"><i class="fas fa-exclamation-triangle text-danger mr-2"></i><p>When you want to serialize/unserialize documents you
have to make all document properties protected, never private. The
reason for this is, if you serialize a class that was a proxy
instance before, the private variables won't be serialized and a
PHP Notice is thrown.</p>
<p>The semantics of the merge operation, applied to a document X, are
as follows:</p>
</div>
<p>-<br />   If X is a detached document, the state of X is copied onto a
   pre-existing managed document instance X' of the same iddocument or
   a new managed copy X' of X is created.
-<br />   If X is a new document instance, an InvalidArgumentException will
   be thrown.
-<br />   If X is a removed document instance, an InvalidArgumentException
   will be thrown.
-<br />   If X is a managed document, it is ignored by the merge operation,
   however, the merge operation is cascaded to documents referenced by
   relationships from X if these relationships have been mapped with
   the cascade element value MERGE or ALL.
-<br />   For all documents Y referenced by relationships from X having the
   cascade element value MERGE or ALL, Y is merged recursively as Y'.
   For all such Y referenced by X, X' is set to reference Y'. (Note
   that if X is managed then X is the same object as X'.)
-<br />   If X is a document merged to X', with a reference to another
   document Y, where cascade=MERGE or cascade=ALL is not specified,
   then navigation of the same association from X' yields a reference
   to a managed object Y' with the same persistent iddocument as Y.</p>
<p>The <code>merge</code> operation is usually not as frequently needed and
used as <code>persist</code> and <code>remove</code>. The most common scenario for
the <code>merge</code> operation is to re-attach documents to an
DocumentManager that come from some cache (and are therefore
detached) and you want to modify and persist such a document.</p>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>If you load some detached documents from a cache and you
do not need to persist or delete them or otherwise make use of them
without the need for persistence services there is no need to use
<code>merge</code>. I.e. you can simply pass detached objects from a cache
directly to the view.</p>
</div>
<a class="section-anchor" id="references" name="references"></a><h2 class="section-header"><a href="#references">References<i class="fas fa-link"></i></a></h2>
<p>References between documents and embedded documents are represented
just like in regular object-oriented PHP, with references to other
objects or collections of objects.</p>
<a class="section-anchor" id="establishing-references" name="establishing-references"></a><h2 class="section-header"><a href="#establishing-references">Establishing References<i class="fas fa-link"></i></a></h2>
<p>Establishing a reference to another document is straight forward. Here
is an example where we add a new comment to an article:</p>
<pre><code class="php">&lt;?php

$comment = new Comment();
// ...

$article-&gt;getComments()-&gt;add($comment);
</code></pre>
<p>Or you can set a single reference:</p>
<pre><code class="php">&lt;?php

$address = new Address();
// ...

$user-&gt;setAddress($address);
</code></pre>
<a class="section-anchor" id="removing-references" name="removing-references"></a><h2 class="section-header"><a href="#removing-references">Removing References<i class="fas fa-link"></i></a></h2>
<p>Removing an association between two documents is similarly
straight-forward. There are two strategies to do so, by key and by
element. Here are some examples:</p>
<pre><code class="php">&lt;?php

$article-&gt;getComments()-&gt;removeElement($comment);
$article-&gt;getComments()-&gt;remove($ithComment);
</code></pre>
<p>Or you can remove a single reference:</p>
<pre><code class="php">&lt;?php

$user-&gt;setAddress(null);
</code></pre>
<p>When working with collections, keep in mind that a Collection is
essentially an ordered map (just like a PHP array). That is why the
<code>remove</code> operation accepts an index/key. <code>removeElement</code> is a
separate method that has O(n) complexity, where n is the size of
the map.</p>
<a class="section-anchor" id="transitive-persistence" name="transitive-persistence"></a><h2 class="section-header"><a href="#transitive-persistence">Transitive persistence<i class="fas fa-link"></i></a></h2>
<p>Persisting, removing, detaching and merging individual documents
can become pretty cumbersome, especially when a larger object graph
with collections is involved. Therefore Doctrine provides a
mechanism for transitive persistence through cascading of these
operations. Each reference to another document or a collection of
documents can be configured to automatically cascade certain
operations. By default, no operations are cascaded.</p>
<p>The following cascade options exist:</p>
<p>-<br />   persist : Cascades persist operations to the associated documents.
-  remove : Cascades remove operations to the associated documents.
-  merge : Cascades merge operations to the associated documents.
-  detach : Cascades detach operations to the associated documents.
-<br />   all : Cascades persist, remove, merge and detach operations to
   associated documents.</p>
<p>The following example shows an association to a number of
addresses. If persist() or remove() is invoked on any User
document, it will be cascaded to all associated Address documents
in the $addresses collection.</p>
<pre><code class="php">&lt;?php

class User 
{
    /** @ReferenceMany(targetDocument=&quot;Address&quot;, cascade={&quot;persist&quot;, &quot;remove&quot;}) */
    private $addresses;
}
</code></pre>
<p>Even though automatic cascading is convenient it should be used
with care. Do not blindly apply cascade=all to all associations as
it will unnecessarily degrade the performance of your application.</p>
<a class="section-anchor" id="querying" name="querying"></a><h2 class="section-header"><a href="#querying">Querying<i class="fas fa-link"></i></a></h2>
<p>Doctrine provides the following ways, in increasing level of power
and flexibility, to query for persistent objects. You should always
start with the simplest one that suits your needs.</p>
<a class="section-anchor" id="by-primary-key" name="by-primary-key"></a><h3 class="section-header"><a href="#by-primary-key">By Primary Key<i class="fas fa-link"></i></a></h3>
<p>The most basic way to query for a persistent object is by its
identifier / primary key using the
<code>DocumentManager#find($documentName, $id)</code> method. Here is an
example:</p>
<pre><code class="php">&lt;?php

$user = $dm-&gt;find('User', $id);
</code></pre>
<p>The return value is either the found document instance or null if
no instance could be found with the given identifier.</p>
<p>Essentially, <code>DocumentManager#find()</code> is just a shortcut for the
following:</p>
<pre><code class="php">&lt;?php

$user = $dm-&gt;getRepository('User')-&gt;find($id);
</code></pre>
<p><code>DocumentManager#getRepository($documentName)</code> returns a
repository object which provides many ways to retrieve documents of
the specified type. By default, the repository instance is of type
<code>Doctrine\ODM\CouchDB\DocumentRepository</code>. You can also use
custom repository classes.</p>
<a class="section-anchor" id="by-simple-conditions" name="by-simple-conditions"></a><h3 class="section-header"><a href="#by-simple-conditions">By Simple Conditions<i class="fas fa-link"></i></a></h3>
<p>To query for one or more documents based on several conditions that
form a logical conjunction, use the <code>findBy</code> and <code>findOneBy</code>
methods on a repository as follows:</p>
<pre><code class="php">&lt;?php

// All users that are 20 years old
$users = $dm-&gt;getRepository('User')-&gt;findBy(array('age' =&gt; 20));

// All users that are 20 years old and have a surname of 'Miller'
$users = $dm-&gt;getRepository('User')-&gt;findBy(array('age' =&gt; 20, 'surname' =&gt; 'Miller'));

// A single user by its nickname
$user = $dm-&gt;getRepository('User')-&gt;findOneBy(array('nickname' =&gt; 'romanb'));
</code></pre>
<div class="alert note bg-light-yellow text-dark border"><i class="fas fa-sticky-note text-primary mr-2"></i><p>Querying by simple conditions only works for documents with indexed fields.</p>
</div>
<p>An DocumentRepository also provides a mechanism for more concise
calls through its use of <code>__call</code>. Thus, the following two
examples are equivalent:</p>
<pre><code class="php">&lt;?php

// A single user by its nickname
$user = $dm-&gt;getRepository('User')-&gt;findOneBy(array('nickname' =&gt; 'romanb'));

// A single user by its nickname (__call magic)
$user = $dm-&gt;getRepository('User')-&gt;findOneByNickname('romanb');
</code></pre>
<a class="section-anchor" id="by-lazy-loading" name="by-lazy-loading"></a><h3 class="section-header"><a href="#by-lazy-loading">By Lazy Loading<i class="fas fa-link"></i></a></h3>
<p>Whenever you have a managed document instance at hand, you can
traverse and use any associations of that document as if they were
in-memory already. Doctrine will automatically load the associated
objects on demand through the concept of lazy-loading.</p>
<a class="section-anchor" id="by-query-objects" name="by-query-objects"></a><h3 class="section-header"><a href="#by-query-objects">By Query Objects<i class="fas fa-link"></i></a></h3>
<p>The most powerful and flexible method to query for persistent
objects is the Query object. The Query object enables you to query
for persistent objects through CouchDB views or the CouchDB Lucene Bridge.</p>
<a class="section-anchor" id="custom-repositories" name="custom-repositories"></a><h3 class="section-header"><a href="#custom-repositories">Custom Repositories<i class="fas fa-link"></i></a></h3>
<p>By default the DocumentManager returns a default implementation of
<code>Doctrine\ODM\CouchDB\DocumentRepository</code> when you call
<code>DocumentManager#getRepository($documentClass)</code>. You can override
this behavior by specifying the class name of your own Document
Repository in the Annotation, XML or YAML metadata. In large
applications that require lots of specialized DQL queries using a
custom repository is one recommended way of grouping these queries
in a central location.</p>
<pre><code class="php">&lt;?php

use Doctrine\ODM\CouchDB\DocumentRepository;

/** @Document(repositoryClass=&quot;UserRepository&quot;) */
class User
{

}

class UserRepository extends DocumentRepository
{
    public function getAllAdminUsers()
    {
        // do stuff
        return $admins;
    }
}
</code></pre>
<p>You can access your repository now by calling:</p>
<pre><code class="php">&lt;?php

$admins = $dm-&gt;getRepository('User')-&gt;getAllAdminUsers();
</code></pre>
<p></p>
                                            </div>
                </div>
            </main>
        </div>
    </div>

                            
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://www.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://www.doctrine-project.org/js/main.js?2a2af0"></script>
        <script src="https://www.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = 'couchdb-odm';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

            <script src="https://www.doctrine-project.org/js/sidebar.js?482a20"></script>

    <script type="text/javascript">
        new Sidebar();
    </script>

                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
