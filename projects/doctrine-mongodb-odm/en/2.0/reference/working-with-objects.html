<!DOCTYPE html>
<html>
    <head>
        <title>        Working with Objects - Doctrine MongoDB Object Document Mapper (MongoDB ODM)
    </title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="Doctrine MongoDB Object Document Mapper Documentation: Working with Objects ">

        <meta name="keywords" content="                    php,mongodb,odm,data,mapper,mapping,object,documentation,working,with,objects
    ">

                    <meta name="robots" content="index, follow">
        
        
                    <link rel="canonical" href="https://www.doctrine-project.org/projects/doctrine-mongodb-odm/en/2.11/reference/working-with-objects.html" />
    
        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?6e5d9f"
                        integrity="sha384-1gHMA2pCh3C7C5PdanZqLyU+p0j9aNUSKdqMxyST9hhhoAcooEmUcqk0Rj7owse5"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/projects/doctrine-mongodb-odm/en/2.0/reference/working-with-objects.html" />
        <meta property="og:title" content="        Working with Objects - Doctrine MongoDB Object Document Mapper (MongoDB ODM)
    " />
        <meta property="og:description" content="Doctrine MongoDB Object Document Mapper Documentation: Working with Objects " />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

                    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Course",
            "name": "Doctrine MongoDB Object Document Mapper",
            "description": "Working with Objects",
            "provider": {
                "@type": "Organization",
                "name": "Doctrine",
                "sameAs": "https://www.doctrine-project.org"
            }
        }
        </script>
    
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/mongodb-odm/edit/2.0.x/docs/en/reference/working-with-objects.rst" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <div class="container-wrapper container">
        <div class="row row-offcanvas row-offcanvas-right">
                            <nav class="col-md-3 d-sm-block bg-light sidebar sidebar-offcanvas" id="sidebar">
                    <div class="sidebar-sticky">
                        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>

                        

            <div class="toc-section">
<h2 class="toc-header">Tutorials</h2><div class="toc">
    <ul class="menu-level">
    <li class="toc-item">
    <a href="../tutorials/getting-started.html#getting-started">Getting Started</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="../tutorials/getting-started.html#example-model-simple-blog">Example Model: Simple Blog</a>


</li>
            <li class="toc-item">
    <a href="../tutorials/getting-started.html#a-first-prototype">A first prototype</a>


</li>
            <li class="toc-item">
    <a href="../tutorials/getting-started.html#persistent-models">Persistent Models</a>


</li>
            <li class="toc-item">
    <a href="../tutorials/getting-started.html#usage">Usage</a>


</li>
                    </ul>
</li>
    </ul>
</div>
</div><div class="toc-section">
<h2 class="toc-header">Reference</h2><div class="toc">
    <ul class="menu-level">
    <li class="toc-item">
    <a href="introduction.html#introduction">Introduction</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="introduction.html#features-overview">Features Overview</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#setup">Setup</a>


</li>
            <li class="toc-item">
    <a href="introduction.html#providing-a-custom-client">Providing a custom client</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="architecture.html#architecture">Architecture</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="architecture.html#documents">Documents</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="architecture.html#document-states">Document states</a>


</li>
            <li class="toc-item">
    <a href="architecture.html#persistent-fields">Persistent fields</a>


</li>
            <li class="toc-item">
    <a href="architecture.html#serializing-documents">Serializing documents</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="architecture.html#the-documentmanager">The DocumentManager</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="architecture.html#transactional-write-behind">Transactional write-behind</a>


</li>
            <li class="toc-item">
    <a href="architecture.html#the-unit-of-work">The Unit of Work</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="console-commands.html#console-commands">Console Commands</a>


</li>
    <li class="toc-item">
    <a href="basic-mapping.html#basic-mapping">Basic Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="basic-mapping.html#mapping-drivers">Mapping Drivers</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#introduction-to-docblock-annotations">Introduction to Docblock Annotations</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#persistent-classes">Persistent classes</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#doctrine-mapping-types">Doctrine Mapping Types</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#property-mapping">Property Mapping</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="basic-mapping.html#identifiers">Identifiers</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#fields">Fields</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="basic-mapping.html#custom-mapping-types">Custom Mapping Types</a>


</li>
            <li class="toc-item">
    <a href="basic-mapping.html#multiple-document-types-in-a-collection">Multiple Document Types in a Collection</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="reference-mapping.html#reference-mapping">Reference Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="reference-mapping.html#collections">Collections</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#reference-one">Reference One</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#reference-many">Reference Many</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#mixing-document-types">Mixing Document Types</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#storing-references">Storing References</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#cascading-operations">Cascading Operations</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#orphan-removal">Orphan Removal</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="bidirectional-references.html#bi-directional-references">Bi-Directional References</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="bidirectional-references.html#owning-and-inverse-sides">Owning and Inverse Sides</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="bidirectional-references.html#one-to-many">One to Many</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="bidirectional-references.html#other-examples">Other Examples</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="bidirectional-references.html#one-to-one">One to One</a>


</li>
            <li class="toc-item">
    <a href="bidirectional-references.html#self-referencing-many-to-many">Self-Referencing Many to Many</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="complex-references.html#complex-references">Complex References</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="complex-references.html#basic-example">Basic Example</a>


</li>
            <li class="toc-item">
    <a href="complex-references.html#criteria-example">criteria Example</a>


</li>
            <li class="toc-item">
    <a href="complex-references.html#repositorymethod-example">repositoryMethod Example</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="indexes.html#indexes">Indexes</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="indexes.html#index-options">Index Options</a>


</li>
            <li class="toc-item">
    <a href="indexes.html#unique-index">Unique Index</a>


</li>
            <li class="toc-item">
    <a href="indexes.html#embedded-indexes">Embedded Indexes</a>


</li>
            <li class="toc-item">
    <a href="indexes.html#geospatial-indexing">Geospatial Indexing</a>


</li>
            <li class="toc-item">
    <a href="indexes.html#partial-indexes">Partial indexes</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="inheritance-mapping.html#inheritance-mapping">Inheritance Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="inheritance-mapping.html#mapped-superclasses">Mapped Superclasses</a>


</li>
            <li class="toc-item">
    <a href="inheritance-mapping.html#single-collection-inheritance">Single Collection Inheritance</a>


</li>
            <li class="toc-item">
    <a href="inheritance-mapping.html#collection-per-class-inheritance">Collection Per Class Inheritance</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="embedded-mapping.html#embedded-mapping">Embedded Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="embedded-mapping.html#embed-one">Embed One</a>


</li>
            <li class="toc-item">
    <a href="embedded-mapping.html#embed-many">Embed Many</a>


</li>
            <li class="toc-item">
    <a href="embedded-mapping.html#mixing-document-types">Mixing Document Types</a>


</li>
            <li class="toc-item">
    <a href="embedded-mapping.html#cascading-operations">Cascading Operations</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="reference-mapping.html#reference-mapping">Reference Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="reference-mapping.html#collections">Collections</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#reference-one">Reference One</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#reference-many">Reference Many</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#mixing-document-types">Mixing Document Types</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#storing-references">Storing References</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#cascading-operations">Cascading Operations</a>


</li>
            <li class="toc-item">
    <a href="reference-mapping.html#orphan-removal">Orphan Removal</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="trees.html#trees">Trees</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="trees.html#full-tree-in-single-document">Full Tree in Single Document</a>


</li>
            <li class="toc-item">
    <a href="trees.html#parent-reference">Parent Reference</a>


</li>
            <li class="toc-item">
    <a href="trees.html#child-reference">Child Reference</a>


</li>
            <li class="toc-item">
    <a href="trees.html#array-of-ancestors">Array of Ancestors</a>


</li>
            <li class="toc-item">
    <a href="trees.html#materialized-paths">Materialized Paths</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="storing-files-with-gridfs.html#storing-files-with-gridfs">Storing Files with GridFS</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="storing-files-with-gridfs.html#about-gridfs">About GridFS</a>


</li>
            <li class="toc-item">
    <a href="storing-files-with-gridfs.html#mapping-documents-as-gridfs-files">Mapping documents as GridFS files</a>


</li>
            <li class="toc-item">
    <a href="storing-files-with-gridfs.html#inserting-files-into-gridfs-buckets">Inserting files into GridFS buckets</a>


</li>
            <li class="toc-item">
    <a href="storing-files-with-gridfs.html#reading-files-from-gridfs-buckets">Reading files from GridFS buckets</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="xml-mapping.html#xml-mapping">XML Mapping</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="xml-mapping.html#simplified-xml-driver">Simplified XML Driver</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="xml-mapping.html#example">Example</a>


</li>
            <li class="toc-item">
    <a href="xml-mapping.html#reference">Reference</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="xml-mapping.html#lock">Lock</a>


</li>
            <li class="toc-item">
    <a href="xml-mapping.html#version">Version</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="annotations-reference.html#annotations-reference">Annotations Reference</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="annotations-reference.html#alsoload">@AlsoLoad</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#changetrackingpolicy">@ChangeTrackingPolicy</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#defaultdiscriminatorvalue">@DefaultDiscriminatorValue</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#discriminatorfield">@DiscriminatorField</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#discriminatormap">@DiscriminatorMap</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#document">@Document</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#embedmany">@EmbedMany</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#embedone">@EmbedOne</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#embeddeddocument">@EmbeddedDocument</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#field">@Field</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#file">@File</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#file-chunksize">@FileChunkSize</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#file-filename">@FileFilename</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#file-length">@FileLength</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#file-metadata">@FileMetadata</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#file-uploaddate">@FileUploadDate</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#haslifecyclecallbacks">@HasLifecycleCallbacks</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#id">@Id</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#index">@Index</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#indexes">@Indexes</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#inheritancetype">@InheritanceType</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#lock">@Lock</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#mappedsuperclass">@MappedSuperclass</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#postload">@PostLoad</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#postpersist">@PostPersist</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#postremove">@PostRemove</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#postupdate">@PostUpdate</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#preflush">@PreFlush</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#preload">@PreLoad</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#prepersist">@PrePersist</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#preremove">@PreRemove</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#preupdate">@PreUpdate</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#readpreference">@ReadPreference</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#referencemany">@ReferenceMany</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#referenceone">@ReferenceOne</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#shardkey">@ShardKey</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#uniqueindex">@UniqueIndex</a>


</li>
            <li class="toc-item">
    <a href="annotations-reference.html#version">@Version</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="metadata-drivers.html#metadata-drivers">Metadata Drivers</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="metadata-drivers.html#core-metadata-drivers">Core Metadata Drivers</a>


</li>
            <li class="toc-item">
    <a href="metadata-drivers.html#implementing-metadata-drivers">Implementing Metadata Drivers</a>


</li>
            <li class="toc-item">
    <a href="metadata-drivers.html#classmetadata">ClassMetadata</a>


</li>
            <li class="toc-item">
    <a href="metadata-drivers.html#getting-classmetadata-instances">Getting ClassMetadata Instances</a>


</li>
                    </ul>
</li>
    <li class="toc-item opened">
    <a href="#working-with-objects">Working with Objects</a>

        <ul class="section-level-1 opened-ul ">
            <li class="toc-item">
    <a href="#understanding">Understanding</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#the-size-of-a-unit-of-work">The size of a Unit of Work</a>


</li>
            <li class="toc-item">
    <a href="#the-cost-of-flush">The cost of flush()</a>


</li>
            <li class="toc-item">
    <a href="#direct-access-to-a-unit-of-work">Direct access to a Unit of Work</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="#persisting-documents">Persisting documents</a>


</li>
            <li class="toc-item">
    <a href="#flush-options">Flush Options</a>


</li>
            <li class="toc-item">
    <a href="#removing-documents">Removing documents</a>


</li>
            <li class="toc-item">
    <a href="#detaching-documents">Detaching documents</a>


</li>
            <li class="toc-item">
    <a href="#merging-documents">Merging documents</a>


</li>
            <li class="toc-item">
    <a href="#references">References</a>


</li>
            <li class="toc-item">
    <a href="#establishing-references">Establishing References</a>


</li>
            <li class="toc-item">
    <a href="#removing-references">Removing References</a>


</li>
            <li class="toc-item">
    <a href="#transitive-persistence">Transitive persistence</a>


</li>
            <li class="toc-item">
    <a href="#querying">Querying</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="#by-primary-key">By Primary Key</a>


</li>
            <li class="toc-item">
    <a href="#by-simple-conditions">By Simple Conditions</a>


</li>
            <li class="toc-item">
    <a href="#by-lazy-loading">By Lazy Loading</a>


</li>
            <li class="toc-item">
    <a href="#by-query-builder-objects">By Query Builder Objects</a>


</li>
            <li class="toc-item">
    <a href="#by-reference">By Reference</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="document-repositories.html#document-repositories">Document Repositories</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="document-repositories.html#custom-repositories">Custom Repositories</a>


</li>
            <li class="toc-item">
    <a href="document-repositories.html#repositories-with-additional-dependencies">Repositories with Additional Dependencies</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="events.html#events">Events</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="events.html#the-event-system">The Event System</a>


</li>
            <li class="toc-item">
    <a href="events.html#lifecycle-events">Lifecycle Events</a>


</li>
            <li class="toc-item">
    <a href="events.html#lifecycle-callbacks">Lifecycle Callbacks</a>


</li>
            <li class="toc-item">
    <a href="events.html#listening-to-lifecycle-events">Listening to Lifecycle Events</a>


</li>
            <li class="toc-item">
    <a href="events.html#implementing-event-listeners">Implementing Event Listeners</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="events.html#prepersist">prePersist</a>


</li>
            <li class="toc-item">
    <a href="events.html#preload">preLoad</a>


</li>
            <li class="toc-item">
    <a href="events.html#postload">postLoad</a>


</li>
            <li class="toc-item">
    <a href="events.html#preremove">preRemove</a>


</li>
            <li class="toc-item">
    <a href="events.html#preflush">preFlush</a>


</li>
            <li class="toc-item">
    <a href="events.html#onflush">onFlush</a>


</li>
            <li class="toc-item">
    <a href="events.html#postflush">postFlush</a>


</li>
            <li class="toc-item">
    <a href="events.html#preupdate">preUpdate</a>


</li>
            <li class="toc-item">
    <a href="events.html#onclear">onClear</a>


</li>
            <li class="toc-item">
    <a href="events.html#documentnotfound">documentNotFound</a>


</li>
            <li class="toc-item">
    <a href="events.html#postupdate-postremove-postpersist">postUpdate, postRemove, postPersist</a>


</li>
            <li class="toc-item">
    <a href="events.html#postcollectionload">postCollectionLoad</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="events.html#load-classmetadata-event">Load ClassMetadata Event</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="migrating-schemas.html#migrating-schemas">Migrating Schemas</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="migrating-schemas.html#renaming-a-field">Renaming a Field</a>


</li>
            <li class="toc-item">
    <a href="migrating-schemas.html#transforming-data">Transforming Data</a>


</li>
            <li class="toc-item">
    <a href="migrating-schemas.html#moving-fields">Moving Fields</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="query-builder-api.html#query-builder-api">Query Builder API</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="query-builder-api.html#finding-documents">Finding Documents</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#creating-a-query-builder">Creating a Query Builder</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="query-builder-api.html#executing-queries">Executing Queries</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#debugging-queries">Debugging Queries</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#getting-single-result">Getting Single Result</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#selecting-fields">Selecting Fields</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#index-hints">Index hints</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#selecting-distinct-values">Selecting Distinct Values</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#refreshing-documents">Refreshing Documents</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#fetching-documents-as-read-only">Fetching Documents as Read-Only</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#disabling-hydration">Disabling Hydration</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#limiting-results">Limiting Results</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#sorting-results">Sorting Results</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#conditional-operators">Conditional Operators</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#text-search">Text Search</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#update-queries">Update Queries</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="query-builder-api.html#updating-multiple-documents">Updating multiple documents</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#modifier-operations">Modifier Operations</a>


</li>
            <li class="toc-item">
    <a href="query-builder-api.html#remove-queries">Remove Queries</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="aggregation-builder.html#aggregation-builder">Aggregation builder</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="aggregation-builder.html#creating-an-aggregation-builder">Creating an Aggregation Builder</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="aggregation-builder.html#adding-pipeline-stages">Adding pipeline stages</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#nesting-expressions">Nesting expressions</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#executing-an-aggregation-pipeline">Executing an aggregation pipeline</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#hydration">Hydration</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#aggregation-pipeline-stages">Aggregation pipeline stages</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="aggregation-builder.html#addfields">$addFields</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#bucket">$bucket</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#bucketauto">$bucketAuto</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#collstats">$collStats</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#count">$count</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#facet">$facet</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#geonear">$geoNear</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#graphlookup">$graphLookup</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#group">$group</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#indexstats">$indexStats</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#lookup">$lookup</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#match">$match</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#out">$out</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#project">$project</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#redact">$redact</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#replaceroot">$replaceRoot</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#sample">$sample</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#sort-limit-and-skip">$sort, $limit and $skip</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#sortbycount">$sortByCount</a>


</li>
            <li class="toc-item">
    <a href="aggregation-builder.html#unwind">$unwind</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="geospatial-queries.html#geospatial-queries">Geospatial Queries</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="geospatial-queries.html#mapping">Mapping</a>


</li>
            <li class="toc-item">
    <a href="geospatial-queries.html#near-query">Near Query</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="find-and-update.html#find-and-modify">Find and Modify</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="find-and-update.html#update">Update</a>


</li>
            <li class="toc-item">
    <a href="find-and-update.html#remove">Remove</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="upserting-documents.html#upserting-documents">Upserting Documents</a>


</li>
    <li class="toc-item">
    <a href="filters.html#filters-1">Filters</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="filters.html#example-filter-class">Example filter class</a>


</li>
            <li class="toc-item">
    <a href="filters.html#configuration">Configuration</a>


</li>
            <li class="toc-item">
    <a href="filters.html#disabling-enabling-filters-and-setting-parameters">Disabling/Enabling Filters and Setting Parameters</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="priming-references.html#priming-references">Priming References</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="priming-references.html#query-builder">Query Builder</a>


</li>
            <li class="toc-item">
    <a href="priming-references.html#inverse-references">Inverse references</a>


</li>
            <li class="toc-item">
    <a href="priming-references.html#primer-callback">Primer Callback</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="capped-collections.html#capped-collections">Capped Collections</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="capped-collections.html#mapping">Mapping</a>


</li>
            <li class="toc-item">
    <a href="capped-collections.html#creating">Creating</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="storage-strategies.html#storage-strategies">Storage Strategies</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="storage-strategies.html#increment">increment</a>


</li>
            <li class="toc-item">
    <a href="storage-strategies.html#addtoset">addToSet</a>


</li>
            <li class="toc-item">
    <a href="storage-strategies.html#set">set</a>


</li>
            <li class="toc-item">
    <a href="storage-strategies.html#setarray">setArray</a>


</li>
            <li class="toc-item">
    <a href="storage-strategies.html#pushall">pushAll</a>


</li>
            <li class="toc-item">
    <a href="storage-strategies.html#atomicset">atomicSet</a>


</li>
            <li class="toc-item">
    <a href="storage-strategies.html#atomicsetarray">atomicSetArray</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="custom-collections.html#custom-collections">Custom Collections</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="custom-collections.html#custom-collection-classes">Custom Collection Classes</a>


</li>
            <li class="toc-item">
    <a href="custom-collections.html#taking-control-of-the-collection-s-constructor">Taking Control of the Collection&#039;s Constructor</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="sharding.html#sharding-1">Sharding</a>


</li>
    <li class="toc-item">
    <a href="transactions-and-concurrency.html#transactions-and-concurrency">Transactions and Concurrency</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#transactions">Transactions</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#limitation">Limitation</a>


</li>
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#workaround">Workaround</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#concurrency">Concurrency</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#optimistic-locking">Optimistic Locking</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#approach">Approach</a>


</li>
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#document-configuration">Document Configuration</a>

        <ul class="section-level-3">
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#choosing-the-field-type">Choosing the Field Type</a>


</li>
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#usage">Usage</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#important-implementation-notes">Important Implementation Notes</a>

        <ul class="section-level-3">
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#workflow">Workflow</a>


</li>
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#example-code">Example Code</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#pessimistic-locking">Pessimistic Locking</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#document-configuration">Document Configuration</a>


</li>
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#lock-modes">Lock Modes</a>


</li>
            <li class="toc-item">
    <a href="transactions-and-concurrency.html#usage">Usage</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="best-practices.html#best-practices">Best Practices</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="best-practices.html#constrain-relationships-as-much-as-possible">Constrain relationships as much as possible</a>


</li>
            <li class="toc-item">
    <a href="best-practices.html#use-events-judiciously">Use events judiciously</a>


</li>
            <li class="toc-item">
    <a href="best-practices.html#use-cascades-judiciously">Use cascades judiciously</a>


</li>
            <li class="toc-item">
    <a href="best-practices.html#don-t-use-special-characters">Don&#039;t use special characters</a>


</li>
            <li class="toc-item">
    <a href="best-practices.html#initialize-collections-in-the-constructor">Initialize collections in the constructor</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="change-tracking-policies.html#change-tracking-policies">Change Tracking Policies</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="change-tracking-policies.html#deferred-implicit">Deferred Implicit</a>


</li>
            <li class="toc-item">
    <a href="change-tracking-policies.html#deferred-explicit">Deferred Explicit</a>


</li>
            <li class="toc-item">
    <a href="change-tracking-policies.html#notify">Notify</a>


</li>
                    </ul>
</li>
    </ul>
</div>
</div><div class="toc-section">
<h2 class="toc-header">Cookbook</h2><div class="toc">
    <ul class="menu-level">
    <li class="toc-item">
    <a href="../cookbook/blending-orm-and-mongodb-odm.html#blending-the-orm-and-mongodb-odm">Blending the ORM and MongoDB ODM</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="../cookbook/blending-orm-and-mongodb-odm.html#define-product">Define Product</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/blending-orm-and-mongodb-odm.html#define-entity">Define Entity</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/blending-orm-and-mongodb-odm.html#event-subscriber">Event Subscriber</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/blending-orm-and-mongodb-odm.html#working-with-products-and-orders">Working with Products and Orders</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="../cookbook/implementing-array-access-for-domain-objects.html#implementing-arrayaccess-for-domain-objects">Implementing ArrayAccess for Domain Objects</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="../cookbook/implementing-array-access-for-domain-objects.html#option-1">Option 1</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/implementing-array-access-for-domain-objects.html#option-2">Option 2</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/implementing-array-access-for-domain-objects.html#read-only">Read-only</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="../cookbook/implementing-the-notify-changetracking-policy.html#implementing-the-notify-changetracking-policy">Implementing the Notify ChangeTracking Policy</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="../cookbook/implementing-the-notify-changetracking-policy.html#implementing-notifypropertychanged">Implementing NotifyPropertyChanged</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="../cookbook/implementing-wakeup-or-clone.html#implementing-wakeup-or-clone">Implementing Wakeup or Clone</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="../cookbook/implementing-wakeup-or-clone.html#safely-implementing-wakeup">Safely implementing __wakeup</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/implementing-wakeup-or-clone.html#safely-implementing-clone">Safely implementing __clone</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/implementing-wakeup-or-clone.html#summary">Summary</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="../cookbook/mapping-classes-to-orm-and-odm.html#mapping-classes-to-the-orm-and-odm">Mapping Classes to the ORM and ODM</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="../cookbook/mapping-classes-to-orm-and-odm.html#test-subject">Test Subject</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/mapping-classes-to-orm-and-odm.html#mapping-information">Mapping Information</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="../cookbook/mapping-classes-to-orm-and-odm.html#orm">ORM</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/mapping-classes-to-orm-and-odm.html#mongodb-odm">MongoDB ODM</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="../cookbook/mapping-classes-to-orm-and-odm.html#repository-classes">Repository Classes</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="../cookbook/resolve-target-document-listener.html#keeping-your-modules-independent">Keeping Your Modules Independent</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="../cookbook/resolve-target-document-listener.html#background">Background</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/resolve-target-document-listener.html#configuration">Configuration</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/resolve-target-document-listener.html#final-thoughts">Final Thoughts</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="../cookbook/simple-search-engine.html#simple-search-engine">Simple Search Engine</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="../cookbook/simple-search-engine.html#sample-model-product">Sample Model: Product</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/simple-search-engine.html#working-with-keywords">Working with Keywords</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/simple-search-engine.html#searching-keywords">Searching Keywords</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="../cookbook/simple-search-engine.html#user-input">User Input</a>


</li>
                    </ul>
</li>
            <li class="toc-item">
    <a href="../cookbook/simple-search-engine.html#embedded-documents">Embedded Documents</a>

        <ul class="section-level-2">
            <li class="toc-item">
    <a href="../cookbook/simple-search-engine.html#definition">Definition</a>


</li>
                    </ul>
</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="../cookbook/soft-delete-extension.html#soft-delete-extension">Soft Delete Extension</a>

        <ul class="section-level-1">
            <li class="toc-item">
    <a href="../cookbook/soft-delete-extension.html#installation">Installation</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/soft-delete-extension.html#setup">Setup</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/soft-delete-extension.html#softdeleteable-interface">SoftDeleteable Interface</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/soft-delete-extension.html#example-implementation">Example Implementation</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/soft-delete-extension.html#usage">Usage</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/soft-delete-extension.html#events">Events</a>


</li>
            <li class="toc-item">
    <a href="../cookbook/soft-delete-extension.html#cascading-soft-deletes">Cascading Soft Deletes</a>


</li>
                    </ul>
</li>
    <li class="toc-item">
    <a href="../cookbook/validation-of-documents.html#validation-of-documents">Validation of Documents</a>


</li>
    </ul>
</div>
</div>
    

                    </div>
                </nav>
            
            <main role="main" class="col-md-9 ml-sm-auto col-lg-9 pt-3 px-4">
                <div class="row">
                                        
                                                                <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
                {
            "@type": "ListItem",
            "position": 1,
            "name": "Projects",
            "item": "https://www.doctrine-project.org/projects.html"
        },                {
            "@type": "ListItem",
            "position": 2,
            "name": "MongoDB ODM",
            "item": "https://www.doctrine-project.org/projects/mongodb-odm.html"
        },                {
            "@type": "ListItem",
            "position": 3,
            "name": "Documentation",
            "item": "https://www.doctrine-project.org/projects/doctrine-mongodb-odm/en/2.0/index.html"
        },                {
            "@type": "ListItem",
            "position": 4,
            "name": "Working with Objects",
            "item": "https://www.doctrine-project.org/projects/doctrine-mongodb-odm/en/2.0/reference/working-with-objects.html"
        }            ]
}
</script>

<nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
    <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects.html">Projects</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a></li>
                                                <li class="breadcrumb-item"><a href="https://www.doctrine-project.org/projects/doctrine-mongodb-odm/en/2.0/index.html">Documentation</a></li>
                                                <li class="breadcrumb-item active" aria-current="page">Working with Objects</li>
                        </ol>
</nav>
                                    </div>

                    
    <div class="alert caution bg-light-yellow text-dark border">
    <table width="100%">
        <tr>
            <td width="10" class="align-top">
                <i class="fas fa-exclamation-circle text-warning mr-2"></i>
            </td>
            <td><p>You are browsing a version that is no longer maintained.</p></td>
        </tr>
    </table>
</div>

                <div class="row">
                    <div class="col-12">
                                                    <button type="button" class="btn btn-primary btn-sm float-right toc-toggle" data-toggle="offcanvas" id="toc-toggle">Table of Contents</button>

                                                            
                                <div class="dropdown show d-inline-block">
                                    <a class="project-version-switcher btn btn-secondary btn-sm dropdown-toggle" href="/projects/doctrine-mongodb-odm/en/2.0/reference/working-with-objects.html" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        2.0.6
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                                                    <h6 class="dropdown-header">Maintained</h6>

                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-mongodb-odm/en/latest/reference/working-with-objects.html">
                                                        2.12

                                                        
                                                                                                                    (upcoming)
                                                                                                            </a>
                                                                                                                                                                                                
                                                    <a class="project-version-switcher dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.11/reference/working-with-objects.html">
                                                        2.11.3

                                                                                                                    (current)
                                                        
                                                                                                            </a>
                                                                                                                                    
                                                                                    <h6 class="dropdown-header">Unmaintained</h6>

                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.10/reference/working-with-objects.html">2.10</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.9/reference/working-with-objects.html">2.9</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.8/reference/working-with-objects.html">2.8</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.7/reference/working-with-objects.html">2.7</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.6/reference/working-with-objects.html">2.6</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.5/reference/working-with-objects.html">2.5</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.4/reference/working-with-objects.html">2.4</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.3/reference/working-with-objects.html">2.3</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.2/reference/working-with-objects.html">2.2</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/2.1/reference/working-with-objects.html">2.1</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item active" href="/projects/doctrine-mongodb-odm/en/2.0/reference/working-with-objects.html">2.0</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/1.3/reference/working-with-objects.html">1.3</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/1.2/reference/working-with-objects.html">1.2</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/1.1/reference/working-with-objects.html">1.1</a>
                                                                                                                                                                                                
                                                    <a class="dropdown-item" href="/projects/doctrine-mongodb-odm/en/1.0/reference/working-with-objects.html">1.0</a>
                                                                                                                                                                        </div>
                                </div>
                            
                            

            <div class="section" id="working-with-objects">
            <h1 class="section-header ">
    <a href="#working-with-objects">
        Working with Objects
        <i class="fas fa-link"></i>
    </a>
</h1>
            <div class="section" id="understanding">
            <h2 class="section-header ">
    <a href="#understanding">
        Understanding
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>In this chapter we will help you understand the <code>DocumentManager</code>
and the <code>UnitOfWork</code>. A Unit of Work is similar to an
object-level transaction. A new Unit of Work is implicitly started
when a DocumentManager is initially created or after
<code>DocumentManager#flush()</code> has been invoked. A Unit of Work is
committed (and a new one started) by invoking
<code>DocumentManager#flush()</code>.</p>

            
    <p>A Unit of Work can be manually closed by calling
<code>DocumentManager#close()</code>. Any changes to objects within this
Unit of Work that have not yet been persisted are lost.</p>

            <div class="section" id="the-size-of-a-unit-of-work">
            <h3 class="section-header ">
    <a href="#the-size-of-a-unit-of-work">
        The size of a Unit of Work
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>The size of a Unit of Work mainly refers to the number of managed
documents at a particular point in time.</p>

    </div>
            <div class="section" id="the-cost-of-flush">
            <h3 class="section-header ">
    <a href="#the-cost-of-flush">
        The cost of flush()
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>How costly a flush operation is in terms of performance mainly
depends on the size. You can get the size of your Unit of Work as
follows:</p>

                <pre class="code-block-table" id="5f7ffdd975d78dafe11d5be44568b5580b458744"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="5f7ffdd975d78dafe11d5be44568b5580b458744"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$uowSize = $dm-&gt;getUnitOfWork()-&gt;size();</code><code class="empty"></code></pre>
            
    <p>The size represents the number of managed documents in the Unit of
Work. This size affects the performance of flush() operations due
to change tracking and, of course, memory consumption, so you may
want to check it from time to time during development.</p>

                        <div class="alert warning-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td>
            <td>
                                                
    <p>Do not invoke <code>flush</code> after every change to a
document or every single invocation of persist/remove/merge/...
This is an anti-pattern and unnecessarily reduces the performance
of your application. Instead, form units of work that operate on
your objects and call <code>flush</code> when you are done. While serving a
single HTTP request there should be usually no need for invoking
<code>flush</code> more than 0-2 times.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="direct-access-to-a-unit-of-work">
            <h3 class="section-header ">
    <a href="#direct-access-to-a-unit-of-work">
        Direct access to a Unit of Work
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>You can get direct access to the Unit of Work by calling
<code>DocumentManager#getUnitOfWork()</code>. This will return the
UnitOfWork instance the DocumentManager is currently using.</p>

                <pre class="code-block-table" id="2f0584336f49af25c843f8c14381f3957983e912"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="2f0584336f49af25c843f8c14381f3957983e912"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$uow = $dm-&gt;getUnitOfWork();</code><code class="empty"></code></pre>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>Directly manipulating a UnitOfWork is not recommended.
When working directly with the UnitOfWork API, respect methods
marked as INTERNAL by not using them and carefully read the API
documentation.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
    </div>
            <div class="section" id="persisting-documents">
            <h2 class="section-header ">
    <a href="#persisting-documents">
        Persisting documents
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>A document can be made persistent by passing it to the
<code>DocumentManager#persist($document)</code> method. By applying the
persist operation on some document, that document becomes MANAGED,
which means that its persistence is from now on managed by an
DocumentManager. As a result the persistent state of such a
document will subsequently be properly synchronized with the
database when <code>DocumentManager#flush()</code> is invoked.</p>

                        <div class="alert warning-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td>
            <td>
                                                
    <p>Invoking the <code>persist</code> method on a document does NOT
cause an immediate insert to be issued on the database. Doctrine
applies a strategy called &quot;transactional write-behind&quot;, which means
that it will delay most operations until
<code>DocumentManager#flush()</code> is invoked which will then issue all
necessary queries to synchronize your objects with the database in
the most efficient way.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>Example:</p>

                <pre class="code-block-table" id="6ad5f56e1c2ccc845fed9ed8aa0baee2edc40d91"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="6ad5f56e1c2ccc845fed9ed8aa0baee2edc40d91"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$user = <span class="hljs-keyword">new</span> User();</code><code class="line language-php">$user-&gt;setUsername(<span class="hljs-string">'jwage'</span>);</code><code class="line language-php">$user-&gt;setPassword(<span class="hljs-string">'changeme'</span>);</code><code class="line language-php">$dm-&gt;persist($user);</code><code class="line language-php">$dm-&gt;flush();</code><code class="empty"></code></pre>
                        <div class="alert warning-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td>
            <td>
                                                
    <p>The document identifier is generated during <code>persist</code> if not previously
specified. Users cannot rely on a document identifier being available during
the <code>prePersist</code> event.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>The semantics of the persist operation, applied on a document X,
are as follows:</p>

            

<ul>
    <li class="dash">If X is a new document, it becomes managed. The document X will be
entered into the database as a result of the flush operation.</li>
    <li class="dash">If X is a preexisting managed document, it is ignored by the
persist operation. However, the persist operation is cascaded to
documents referenced by X, if the relationships from X to these
other documents are mapped with cascade=PERSIST or cascade=ALL.</li>
    <li class="dash">If X is a removed document, it becomes managed.</li>
    <li class="dash">If X is a detached document, the behavior is undefined.</li>
</ul>

                        <div class="alert warning-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td>
            <td>
                                                
    <p>Do not pass detached documents to the persist operation.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="flush-options">
            <a id="flush_options"></a>
            <h2 class="section-header ">
    <a href="#flush-options">
        Flush Options
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>When committing your documents you can specify an array of options to the
<code>flush</code> method. With it you can send options to the underlying database
like <code>safe</code>, <code>fsync</code>, etc.</p>

            
    <p>Example:</p>

                <pre class="code-block-table" id="9988623e33d765dab9466fa9e441597e6e7f56c8"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="9988623e33d765dab9466fa9e441597e6e7f56c8"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$user = $dm-&gt;getRepository(User::class)-&gt;find($userId);</code><code class="line language-php"><span class="hljs-comment">// ...</span></code><code class="line language-php">$user-&gt;setPassword(<span class="hljs-string">'changeme'</span>);</code><code class="line language-php">$dm-&gt;flush(<span class="hljs-keyword">null</span>, [<span class="hljs-string">'safe'</span> =&gt; <span class="hljs-keyword">true</span>, <span class="hljs-string">'fsync'</span> =&gt; <span class="hljs-keyword">true</span>]);</code><code class="empty"></code></pre>
            
    <p>You can configure the default flush options on your <code>Configuration</code> object
if you want to set them globally for all flushes.</p>

            
    <p>Example:</p>

                <pre class="code-block-table" id="02d516be461391d90743f77ea71e104a1e2d1fa7"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="02d516be461391d90743f77ea71e104a1e2d1fa7"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$config-&gt;setDefaultCommitOptions(</code><code class="line language-php">  [</code><code class="line language-php">    <span class="hljs-string">'safe'</span> =&gt; <span class="hljs-keyword">true</span>,</code><code class="line language-php">    <span class="hljs-string">'fsync'</span> =&gt; <span class="hljs-keyword">true</span></code><code class="line language-php">  ]</code><code class="line language-php">);</code><code class="empty"></code></pre>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>Safe is set to true by default for all writes when using the ODM.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="removing-documents">
            <h2 class="section-header ">
    <a href="#removing-documents">
        Removing documents
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>A document can be removed from persistent storage by passing it to
the <code>DocumentManager#remove($document)</code> method. By applying the
<code>remove</code> operation on some document, that document becomes
REMOVED, which means that its persistent state will be deleted once
<code>DocumentManager#flush()</code> is invoked. The in-memory state of a
document is unaffected by the <code>remove</code> operation.</p>

                        <div class="alert warning-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-exclamation-circle text-warning mr-2"></i></td>
            <td>
                                                
    <p>Just like <code>persist</code>, invoking <code>remove</code> on a
document does NOT cause an immediate query to be issued on the
database. The document will be removed on the next invocation of
<code>DocumentManager#flush()</code> that involves that document.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
            
    <p>Example:</p>

                <pre class="code-block-table" id="1545d6cdfc56b035a77828647d47af037cb7d987"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="1545d6cdfc56b035a77828647d47af037cb7d987"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$dm-&gt;remove($user);</code><code class="line language-php">$dm-&gt;flush();</code><code class="empty"></code></pre>
            
    <p>The semantics of the remove operation, applied to a document X are
as follows:</p>

            

<ul>
    <li class="dash">If X is a new document, it is ignored by the remove operation.
However, the remove operation is cascaded to documents referenced
by X, if the relationship from X to these other documents is mapped
with cascade=REMOVE or cascade=ALL.</li>
    <li class="dash">If X is a managed document, the remove operation causes it to
become removed. The remove operation is cascaded to documents
referenced by X, if the relationships from X to these other
documents is mapped with cascade=REMOVE or cascade=ALL.</li>
    <li class="dash">If X is a detached document, an InvalidArgumentException will be
thrown.</li>
    <li class="dash">If X is a removed document, it is ignored by the remove operation.</li>
    <li class="dash">A removed document X will be removed from the database as a result
of the flush operation.</li>
</ul>

    </div>
            <div class="section" id="detaching-documents">
            <h2 class="section-header ">
    <a href="#detaching-documents">
        Detaching documents
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>A document is detached from a DocumentManager and thus no longer
managed by invoking the <code>DocumentManager#detach($document)</code>
method on it or by cascading the detach operation to it. Changes
made to the detached document, if any (including removal of the
document), will not be synchronized to the database after the
document has been detached.</p>

            
    <p>Doctrine will not hold on to any references to a detached
document.</p>

            
    <p>Example:</p>

                <pre class="code-block-table" id="266228153e789cc66bcfe220c61d0b54427a050b"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="266228153e789cc66bcfe220c61d0b54427a050b"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$dm-&gt;detach($document);</code><code class="empty"></code></pre>
            
    <p>The semantics of the detach operation, applied to a document X are
as follows:</p>

            

<ul>
    <li class="dash">If X is a managed document, the detach operation causes it to
become detached. The detach operation is cascaded to documents
referenced by X, if the relationships from X to these other
documents is mapped with cascade=DETACH or cascade=ALL. Documents
which previously referenced X will continue to reference X.</li>
    <li class="dash">If X is a new or detached document, it is ignored by the detach
operation.</li>
    <li class="dash">If X is a removed document, the detach operation is cascaded to
documents referenced by X, if the relationships from X to these
other documents is mapped with cascade=DETACH or
cascade=ALL/Documents which previously referenced X will continue
to reference X.</li>
</ul>

            
    <p>There are several situations in which a document is detached
automatically without invoking the <code>detach</code> method:</p>

            

<ul>
    <li class="dash">When <code>DocumentManager#clear()</code> is invoked, all documents that are
currently managed by the DocumentManager instance become detached.</li>
    <li class="dash">When serializing a document. The document retrieved upon subsequent
unserialization will be detached (This is the case for all
documents that are serialized and stored in some cache).</li>
</ul>

            
    <p>The <code>detach</code> operation is usually not as frequently needed and
used as <code>persist</code> and <code>remove</code>.</p>

    </div>
            <div class="section" id="merging-documents">
            <h2 class="section-header ">
    <a href="#merging-documents">
        Merging documents
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Merging documents refers to the merging of (usually detached)
documents into the context of a DocumentManager so that they
become managed again. To merge the state of a document into an
DocumentManager use the <code>DocumentManager#merge($document)</code>
method. The state of the passed document will be merged into a
managed copy of this document and this copy will subsequently be
returned.</p>

            
    <p>Example:</p>

                <pre class="code-block-table" id="23ba9242de5c7fa64876985c3f6834138ec2ecd9"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="23ba9242de5c7fa64876985c3f6834138ec2ecd9"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$detachedDocument = unserialize($serializedDocument); <span class="hljs-comment">// some detached document</span></code><code class="line language-php">$document = $dm-&gt;merge($detachedDocument);</code><code class="line language-php"><span class="hljs-comment">// $document now refers to the fully managed copy returned by the merge operation.</span></code><code class="line language-php"><span class="hljs-comment">// The DocumentManager $dm now manages the persistence of $document as usual.</span></code><code class="line language-php"></code><code class="line language-php">The semantics of the merge operation, applied to a document X, are</code><code class="line language-php"><span class="hljs-keyword">as</span> follows:</code><code class="empty"></code></pre>
            

<ul>
    <li class="dash">If X is a detached document, the state of X is copied onto a
pre-existing managed document instance X&#039; of the same iddocument or
a new managed copy X&#039; of X is created.</li>
    <li class="dash">If X is a new document instance, an InvalidArgumentException will
be thrown.</li>
    <li class="dash">If X is a removed document instance, an InvalidArgumentException
will be thrown.</li>
    <li class="dash">If X is a managed document, it is ignored by the merge operation,
however, the merge operation is cascaded to documents referenced by
relationships from X if these relationships have been mapped with
the cascade element value MERGE or ALL.</li>
    <li class="dash">For all documents Y referenced by relationships from X having the
cascade element value MERGE or ALL, Y is merged recursively as Y&#039;.
For all such Y referenced by X, X&#039; is set to reference Y&#039;. (Note
that if X is managed then X is the same object as X&#039;.)</li>
    <li class="dash">If X is a document merged to X&#039;, with a reference to another
document Y, where cascade=MERGE or cascade=ALL is not specified,
then navigation of the same association from X&#039; yields a reference
to a managed object Y&#039; with the same persistent iddocument as Y.</li>
</ul>

            
    <p>The <code>merge</code> operation is usually not as frequently needed and
used as <code>persist</code> and <code>remove</code>. The most common scenario for
the <code>merge</code> operation is to reattach documents to an
DocumentManager that come from some cache (and are therefore
detached) and you want to modify and persist such a document.</p>

                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>If you load some detached documents from a cache and you
do not need to persist or delete them or otherwise make use of them
without the need for persistence services there is no need to use
<code>merge</code>. I.e. you can simply pass detached objects from a cache
directly to the view.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="references">
            <h2 class="section-header ">
    <a href="#references">
        References
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>References between documents and embedded documents are represented
just like in regular object-oriented PHP, with references to other
objects or collections of objects.</p>

    </div>
            <div class="section" id="establishing-references">
            <h2 class="section-header ">
    <a href="#establishing-references">
        Establishing References
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Establishing a reference to another document is straight forward:</p>

            
    <p>Here is an example where we add a new comment to an article:</p>

                <pre class="code-block-table" id="e8850650a31738b286aab910c3f2b3a60a64a406"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="e8850650a31738b286aab910c3f2b3a60a64a406"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$comment = <span class="hljs-keyword">new</span> Comment();</code><code class="line language-php"><span class="hljs-comment">// ...</span></code><code class="line language-php"></code><code class="line language-php">$article-&gt;getComments()-&gt;add($comment);</code><code class="empty"></code></pre>
            
    <p>Or you can set a single reference:</p>

                <pre class="code-block-table" id="0bb6f97db03af8b3fffcfc65789a2ba8da0432c3"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="0bb6f97db03af8b3fffcfc65789a2ba8da0432c3"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$address = <span class="hljs-keyword">new</span> Address();</code><code class="line language-php"><span class="hljs-comment">// ...</span></code><code class="line language-php"></code><code class="line language-php">$user-&gt;setAddress($address);</code><code class="empty"></code></pre>
    </div>
            <div class="section" id="removing-references">
            <h2 class="section-header ">
    <a href="#removing-references">
        Removing References
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Removing an association between two documents is similarly
straight-forward. There are two strategies to do so, by key and by
element. Here are some examples:</p>

                <pre class="code-block-table" id="7beedb2083bbf3b3d619895b3b332a1c6d8c5860"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="7beedb2083bbf3b3d619895b3b332a1c6d8c5860"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$article-&gt;getComments()-&gt;removeElement($comment);</code><code class="line language-php">$article-&gt;getComments()-&gt;remove($ithComment);</code><code class="empty"></code></pre>
            
    <p>Or you can remove a single reference:</p>

                <pre class="code-block-table" id="7ca50a34806f0668bd5d11178608c2d860e610de"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="7ca50a34806f0668bd5d11178608c2d860e610de"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$user-&gt;setAddress(<span class="hljs-keyword">null</span>);</code><code class="empty"></code></pre>
            
    <p>When working with collections, keep in mind that a Collection is
essentially an ordered map (just like a PHP array). That is why the
<code>remove</code> operation accepts an index/key. <code>removeElement</code> is a
separate method that has O(n) complexity, where n is the size of
the map.</p>

    </div>
            <div class="section" id="transitive-persistence">
            <h2 class="section-header ">
    <a href="#transitive-persistence">
        Transitive persistence
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Persisting, removing, detaching and merging individual documents
can become pretty cumbersome, especially when a larger object graph
with collections is involved. Therefore Doctrine provides a
mechanism for transitive persistence through cascading of these
operations. Each reference to another document or a collection of
documents can be configured to automatically cascade certain
operations. By default, no operations are cascaded.</p>

            
    <p>The following cascade options exist:</p>

            

<ul>
    <li class="dash">persist : Cascades persist operations to the associated documents.</li>
    <li class="dash">remove : Cascades remove operations to the associated documents.</li>
    <li class="dash">merge : Cascades merge operations to the associated documents.</li>
    <li class="dash">detach : Cascades detach operations to the associated documents.</li>
    <li class="dash">all : Cascades persist, remove, merge and detach operations to
associated documents.</li>
</ul>

            
    <p>The following example shows an association to a number of
addresses. If persist() or remove() is invoked on any User
document, it will be cascaded to all associated Address documents
in the $addresses collection.</p>

                <pre class="code-block-table" id="3265802e8f7440ede1b072f9b5f671adda137de3"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="3265802e8f7440ede1b072f9b5f671adda137de3"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">//...</span></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @ReferenceMany(targetDocument=Address::class, cascade={<span class="hljs-string">"persist"</span>, <span class="hljs-string">"remove"</span>})</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $addresses;</code><code class="line language-php">    <span class="hljs-comment">//...</span></code><code class="line language-php">}</code><code class="empty"></code></pre>
            
    <p>Even though automatic cascading is convenient it should be used
with care. Do not blindly apply cascade=all to all associations as
it will unnecessarily degrade the performance of your application.</p>

    </div>
            <div class="section" id="querying">
            <h2 class="section-header ">
    <a href="#querying">
        Querying
        <i class="fas fa-link"></i>
    </a>
</h2>
            
    <p>Doctrine provides the following ways, in increasing level of power
and flexibility, to query for persistent objects. You should always
start with the simplest one that suits your needs.</p>

            <div class="section" id="by-primary-key">
            <h3 class="section-header ">
    <a href="#by-primary-key">
        By Primary Key
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>The most basic way to query for a persistent object is by its
identifier / primary key using the
<code>DocumentManager#find($documentName, $id)</code> method. Here is an
example:</p>

                <pre class="code-block-table" id="2ec6e06761fa36f0c622da88cddf885701ee35b7"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="2ec6e06761fa36f0c622da88cddf885701ee35b7"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$user = $dm-&gt;find(User::class, $id);</code><code class="empty"></code></pre>
            
    <p>The return value is either the found document instance or null if
no instance could be found with the given identifier.</p>

            
    <p>Essentially, <code>DocumentManager#find()</code> is just a shortcut for the
following:</p>

                <pre class="code-block-table" id="2122950042d7d8796208510b527c7c14e72de3f4"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="2122950042d7d8796208510b527c7c14e72de3f4"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$user = $dm-&gt;getRepository(User::class)-&gt;find($id);</code><code class="empty"></code></pre>
            
    <p><code>DocumentManager#getRepository($documentName)</code> returns a
repository object which provides many ways to retrieve documents of
the specified type. By default, the repository instance is of type
<code>Doctrine\ODM\MongoDB\DocumentRepository</code>. You can also use
custom repository classes.</p>

    </div>
            <div class="section" id="by-simple-conditions">
            <h3 class="section-header ">
    <a href="#by-simple-conditions">
        By Simple Conditions
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>To query for one or more documents based on several conditions that
form a logical conjunction, use the <code>findBy</code> and <code>findOneBy</code>
methods on a repository as follows:</p>

                <pre class="code-block-table" id="b3710f747b89e4c189d0f9707d890e8628515153"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="b3710f747b89e4c189d0f9707d890e8628515153"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">// All users that are 20 years old</span></code><code class="line language-php">$users = $dm-&gt;getRepository(User::class)-&gt;findBy([<span class="hljs-string">'age'</span> =&gt; <span class="hljs-number">20</span>]);</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">// All users that are 20 years old and have a surname of 'Miller'</span></code><code class="line language-php">$users = $dm-&gt;getRepository(User::class)-&gt;findBy([<span class="hljs-string">'age'</span> =&gt; <span class="hljs-number">20</span>, <span class="hljs-string">'surname'</span> =&gt; <span class="hljs-string">'Miller'</span>]);</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">// A single user by its nickname</span></code><code class="line language-php">$user = $dm-&gt;getRepository(User::class)-&gt;findOneBy([<span class="hljs-string">'nickname'</span> =&gt; <span class="hljs-string">'romanb'</span>]);</code><code class="empty"></code></pre>
                        <div class="alert note-admonition bg-light-yellow text-dark border ">
    <table width="100%">
        <tbody>
        <tr>
            <td width="10" class="align-top"><i class="fas fa-sticky-note text-primary mr-2"></i></td>
            <td>
                                                
    <p>You can learn more about Repositories in a <a href="document-repositories.html#document_repositories">dedicated chapter</a>.</p>

            </td>
        </tr>
        </tbody>
    </table>
</div>
    </div>
            <div class="section" id="by-lazy-loading">
            <h3 class="section-header ">
    <a href="#by-lazy-loading">
        By Lazy Loading
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>Whenever you have a managed document instance at hand, you can
traverse and use any associations of that document as if they were
in-memory already. Doctrine will automatically load the associated
objects on demand through the concept of lazy-loading.</p>

    </div>
            <div class="section" id="by-query-builder-objects">
            <h3 class="section-header ">
    <a href="#by-query-builder-objects">
        By Query Builder Objects
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>The most powerful and flexible method to query for persistent
objects is the QueryBuilder object. The QueryBuilder object enables you to query
for persistent objects with a fluent object oriented interface.</p>

            
    <p>You can create a query using
<code>DocumentManager#createQueryBuilder($documentName = null)</code>. Here is a
simple example:</p>

                <pre class="code-block-table" id="9c08ccf3d1633fdd26850d93926cbaed7e7807db"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="9c08ccf3d1633fdd26850d93926cbaed7e7807db"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">// All users with an age between 20 and 30 (inclusive).</span></code><code class="line language-php">$qb = $dm-&gt;createQueryBuilder(User::class)</code><code class="line language-php">    -&gt;field(<span class="hljs-string">'age'</span>)-&gt;range(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>);</code><code class="line language-php">$q = $qb-&gt;getQuery()</code><code class="line language-php">$users = $q-&gt;execute();</code><code class="empty"></code></pre>
    </div>
            <div class="section" id="by-reference">
            <h3 class="section-header ">
    <a href="#by-reference">
        By Reference
        <i class="fas fa-link"></i>
    </a>
</h3>
            
    <p>To query documents with a ReferenceOne association to another document, use the <code>references($document)</code> expression:</p>

                <pre class="code-block-table" id="dc1f9973a83555606083de1465140fa236c0c789"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="dc1f9973a83555606083de1465140fa236c0c789"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$group = $dm-&gt;find(Group::class, $id);</code><code class="line language-php">$usersWithGroup = $dm-&gt;createQueryBuilder(User::class)</code><code class="line language-php">    -&gt;field(<span class="hljs-string">'group'</span>)-&gt;references($group)</code><code class="line language-php">    -&gt;getQuery()-&gt;execute();</code><code class="empty"></code></pre>
            
    <p>To find documents with a ReferenceMany association that includes a certain document, use the <code>includesReferenceTo($document)</code> expression:</p>

                <pre class="code-block-table" id="b6e2db841ee1d49f0de4f73c6d5cb242bd61a215"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="b6e2db841ee1d49f0de4f73c6d5cb242bd61a215"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"></code><code class="line language-php">$users = $dm-&gt;createQueryBuilder(User::class)</code><code class="line language-php">    -&gt;field(<span class="hljs-string">'groups'</span>)-&gt;includesReferenceTo($group)</code><code class="line language-php">    -&gt;getQuery()-&gt;execute();</code><code class="empty"></code></pre>
    </div>
    </div>
    </div>
        

                                                </div>
                </div>
            </main>
        </div>
    </div>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?1546fc"
                            integrity="sha384-ix9eb2EZyp9uayYpxmCQoylbz8msHl5wOg/aqZnD/3cxszNUGePN656MRg5GEgbm"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = 'mongodb-odm';
            var versionSlug = '2.0';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search MongoDB ODM 2.0'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            </body>
</html>
