<!DOCTYPE html>
<html>
    <head>
        <title>Simple Search Engine - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

                    <meta name="robots" content="noindex, follow">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://new.doctrine-project.org/css/style.css?14" rel="stylesheet" type="text/css" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://new.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://new.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://new.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://new.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://new.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://new.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://new.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://new.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://new.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://new.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://new.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://new.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://new.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://new.doctrine-project.org/images/mstile-310x310.png" />

        <link rel="stylesheet" href="https://new.doctrine-project.org/components/highlightjs/styles/railscasts.css?14" />
        <link rel="alternate" type="application/atom+xml" href="https://new.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        
        
        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://new.doctrine-project.org/components/highlightjs/highlight.pack.js?14"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script src="https://new.doctrine-project.org/js/site.js?14"></script>

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>
    </head>
    <body>

        <header>
            <nav class="navbar navbar-expand-md navbar-dark border-bottom fixed-top">
                <a class="navbar-brand text-hide" href="https://new.doctrine-project.org/"><img src="https://new.doctrine-project.org/images/doctrine-logo.svg" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="https://new.doctrine-project.org/projects/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orm/">ORM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/dbal/">DBAL</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/phpcr-odm/">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/couchdb-odm/">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/migrations/">Migrations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/common/">Common</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/mongodb/">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/orientdb-odm/">OrientDB ODM</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/annotations/">Annotations</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/collections/">Collections</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/inflector/">Inflector</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/cache/">Cache</a>
                                                                    <a class="dropdown-item" href="https://new.doctrine-project.org/projects/lexer/">Lexer</a>
                                                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://new.doctrine-project.org/search/">Search</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://github.com/doctrine/" target="_blank">Development</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Begin page content -->
        <main role="main" class="container">
            <div class="row">
                                                    
                                
                                                    <nav class="breadcrumbs d-none d-sm-block d-md-block d-lg-block d-xl-block" aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/">Projects</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/mongodb-odm/">MongoDB ODM</a></li>
                            <li class="breadcrumb-item"><a href="https://new.doctrine-project.org/projects/doctrine-mongodb-odm/en/1.1/">Documentation</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Simple Search Engine</li>
                        </ol>
                    </nav>
                            </div>

            <div class="row">
                                    <div class="left-sidebar col-3 d-none d-lg-block d-xl-block rounded">
                        
<div class="toc"><ul><li id="blending-orm-and-mongodb-odm-html-title-1" class="toc-item"><a href="blending-orm-and-mongodb-odm.html#title.1">Blending the ORM and MongoDB ODM</a></li><ul><li id="blending-orm-and-mongodb-odm-html-title-1-1" class="toc-item"><a href="blending-orm-and-mongodb-odm.html#title.1.1">Define Product</a></li><li id="blending-orm-and-mongodb-odm-html-title-1-2" class="toc-item"><a href="blending-orm-and-mongodb-odm.html#title.1.2">Define Entity</a></li><li id="blending-orm-and-mongodb-odm-html-title-1-3" class="toc-item"><a href="blending-orm-and-mongodb-odm.html#title.1.3">Event Subscriber</a></li><li id="blending-orm-and-mongodb-odm-html-title-1-4" class="toc-item"><a href="blending-orm-and-mongodb-odm.html#title.1.4">Working with Products and Orders</a></li></ul><li id="implementing-array-access-for-domain-objects-html-title-1" class="toc-item"><a href="implementing-array-access-for-domain-objects.html#title.1">Implementing ArrayAccess for Domain Objects</a></li><ul><li id="implementing-array-access-for-domain-objects-html-title-1-1" class="toc-item"><a href="implementing-array-access-for-domain-objects.html#title.1.1">Option 1</a></li><li id="implementing-array-access-for-domain-objects-html-title-1-2" class="toc-item"><a href="implementing-array-access-for-domain-objects.html#title.1.2">Option 2</a></li><li id="implementing-array-access-for-domain-objects-html-title-1-3" class="toc-item"><a href="implementing-array-access-for-domain-objects.html#title.1.3">Read-only</a></li></ul><li id="implementing-the-notify-changetracking-policy-html-title-1" class="toc-item"><a href="implementing-the-notify-changetracking-policy.html#title.1">Implementing the Notify ChangeTracking Policy</a></li><ul><li id="implementing-the-notify-changetracking-policy-html-title-1-1" class="toc-item"><a href="implementing-the-notify-changetracking-policy.html#title.1.1">Implementing NotifyPropertyChanged</a></li></ul><li id="implementing-wakeup-or-clone-html-title-1" class="toc-item"><a href="implementing-wakeup-or-clone.html#title.1">Implementing Wakeup or Clone</a></li><ul><li id="implementing-wakeup-or-clone-html-title-1-1" class="toc-item"><a href="implementing-wakeup-or-clone.html#title.1.1">Safely implementing \_\_wakeup</a></li><li id="implementing-wakeup-or-clone-html-title-1-2" class="toc-item"><a href="implementing-wakeup-or-clone.html#title.1.2">Safely implementing \_\_clone</a></li><li id="implementing-wakeup-or-clone-html-title-1-3" class="toc-item"><a href="implementing-wakeup-or-clone.html#title.1.3">Summary</a></li></ul><li id="mapping-classes-to-orm-and-odm-html-title-1" class="toc-item"><a href="mapping-classes-to-orm-and-odm.html#title.1">Mapping Classes to the ORM and ODM</a></li><ul><li id="mapping-classes-to-orm-and-odm-html-title-1-1" class="toc-item"><a href="mapping-classes-to-orm-and-odm.html#title.1.1">Test Subject</a></li><li id="mapping-classes-to-orm-and-odm-html-title-1-2" class="toc-item"><a href="mapping-classes-to-orm-and-odm.html#title.1.2">Mapping Information</a></li><ul><li id="mapping-classes-to-orm-and-odm-html-title-1-2-1" class="toc-item"><a href="mapping-classes-to-orm-and-odm.html#title.1.2.1">ORM</a></li><li id="mapping-classes-to-orm-and-odm-html-title-1-2-2" class="toc-item"><a href="mapping-classes-to-orm-and-odm.html#title.1.2.2">MongoDB ODM</a></li></ul><li id="mapping-classes-to-orm-and-odm-html-title-1-3" class="toc-item"><a href="mapping-classes-to-orm-and-odm.html#title.1.3">Repository Classes</a></li></ul><li id="resolve-target-document-listener-html-title-1" class="toc-item"><a href="resolve-target-document-listener.html#title.1">Keeping Your Modules Independent</a></li><ul><li id="resolve-target-document-listener-html-title-1-1" class="toc-item"><a href="resolve-target-document-listener.html#title.1.1">Background</a></li><li id="resolve-target-document-listener-html-title-1-2" class="toc-item"><a href="resolve-target-document-listener.html#title.1.2">Configuration</a></li><li id="resolve-target-document-listener-html-title-1-3" class="toc-item"><a href="resolve-target-document-listener.html#title.1.3">Final Thoughts</a></li></ul><li id="simple-search-engine-html-title-1" class="toc-item"><a href="simple-search-engine.html#title.1">Simple Search Engine</a></li><ul><li id="simple-search-engine-html-title-1-1" class="toc-item"><a href="simple-search-engine.html#title.1.1">Sample Model: Product</a></li><li id="simple-search-engine-html-title-1-2" class="toc-item"><a href="simple-search-engine.html#title.1.2">Working with Keywords</a></li><li id="simple-search-engine-html-title-1-3" class="toc-item"><a href="simple-search-engine.html#title.1.3">Searching Keywords</a></li><ul><li id="simple-search-engine-html-title-1-3-1" class="toc-item"><a href="simple-search-engine.html#title.1.3.1">User Input</a></li></ul><li id="simple-search-engine-html-title-1-4" class="toc-item"><a href="simple-search-engine.html#title.1.4">Embedded Documents</a></li><ul><li id="simple-search-engine-html-title-1-4-1" class="toc-item"><a href="simple-search-engine.html#title.1.4.1">Definition</a></li></ul></ul><li id="soft-delete-extension-html-title-1" class="toc-item"><a href="soft-delete-extension.html#title.1">Soft Delete Extension</a></li><ul><li id="soft-delete-extension-html-title-1-1" class="toc-item"><a href="soft-delete-extension.html#title.1.1">Installation</a></li><li id="soft-delete-extension-html-title-1-2" class="toc-item"><a href="soft-delete-extension.html#title.1.2">Setup</a></li><li id="soft-delete-extension-html-title-1-3" class="toc-item"><a href="soft-delete-extension.html#title.1.3">SoftDeleteable Interface</a></li><li id="soft-delete-extension-html-title-1-4" class="toc-item"><a href="soft-delete-extension.html#title.1.4">Example Implementation</a></li><li id="soft-delete-extension-html-title-1-5" class="toc-item"><a href="soft-delete-extension.html#title.1.5">Usage</a></li><li id="soft-delete-extension-html-title-1-6" class="toc-item"><a href="soft-delete-extension.html#title.1.6">Events</a></li><li id="soft-delete-extension-html-title-1-7" class="toc-item"><a href="soft-delete-extension.html#title.1.7">Cascading Soft Deletes</a></li></ul><li id="validation-of-documents-html-title-1" class="toc-item"><a href="validation-of-documents.html#title.1">Validation of Documents</a></li></ul></div>
                    </div>
                
                                <div class="right-content col-xl-9 col-lg-9 col-sm-12 col-xs-12">
                
                                                                        <ul class="list-inline">
                                                                    <li class="list-inline-item mr-0">
                                        <a href="/projects/doctrine-mongodb-odm/en/latest/cookbook/simple-search-engine.html" class="project-version-switcher badge badge-secondary">master</a>
                                    </li>
                                                                    <li class="list-inline-item mr-0">
                                        <a href="/projects/doctrine-mongodb-odm/en/1.2/cookbook/simple-search-engine.html" class="project-version-switcher badge badge-secondary">1.2</a>
                                    </li>
                                                                    <li class="list-inline-item mr-0">
                                        <a href="/projects/doctrine-mongodb-odm/en/1.1/cookbook/simple-search-engine.html" class="project-version-switcher badge badge-primary">1.1</a>
                                    </li>
                                                            </ul>
                        
                        
<a class="section-anchor" name="title.1"></a><h1 class="section-header"><a href="#title.1">Simple Search Engine<i class="fas fa-link"></i></a></h1>
<p>It is very easy to implement a simple keyword search engine with MongoDB. Because of
its flexible schema less nature we can store the keywords we want to search through directly
on the document. MongoDB is capable of indexing the embedded documents so the results are fast
and scalable.</p>
<a class="section-anchor" name="title.1.1"></a><h2 class="section-header"><a href="#title.1.1">Sample Model: Product<i class="fas fa-link"></i></a></h2>
<p>Imagine you had a <code>Product</code> document and you want to search the products by keywords. You can
setup a document like the following with a <code>$keywords</code> property that is mapped as a collection:</p>
<pre><code class="php">&lt;?php

namespace Documents;

/** @Document */
class Product
{
    /** @Id */
    private $id;

    /** @Field(type=&quot;string&quot;) */
    private $title;

    /** @Field(type=&quot;collection&quot;) @Index */
    private $keywords = array();

    // ...
}
</code></pre>
<a class="section-anchor" name="title.1.2"></a><h2 class="section-header"><a href="#title.1.2">Working with Keywords<i class="fas fa-link"></i></a></h2>
<p>Now, create a product and add some keywords:</p>
<pre><code class="php">&lt;?php

$product = new Product();
$product-&gt;setTitle('Nike Air Jordan 2011');
$product-&gt;addKeyword('nike shoes');
$product-&gt;addKeyword('jordan shoes');
$product-&gt;addKeyword('air jordan');
$product-&gt;addKeyword('shoes');
$product-&gt;addKeyword('2011');

$dm-&gt;persist($product);
$dm-&gt;flush();
</code></pre>
<p>The above example populates the keywords manually but you could very easily write some code which
automatically generates your keywords from a string built by the Product that may include the title,
description and other fields. You could also use a tool like the <a href="http://www.alchemyapi.com">AlchemyAPI</a> if you want to do
some more intelligent keyword extraction.</p>
<a class="section-anchor" name="title.1.3"></a><h2 class="section-header"><a href="#title.1.3">Searching Keywords<i class="fas fa-link"></i></a></h2>
<p>Searching the keywords in the <code>Product</code> collection is easy! You can run a query like the following
to find documents that have at least one of the keywords:</p>
<pre><code class="php">&lt;?php

$keywords = array('nike shoes', 'air jordan');

$qb = $dm-&gt;createQueryBuilder('Product')
    -&gt;field('keywords')-&gt;in($keywords);
</code></pre>
<p>You can make the query more strict by using the <code>all()</code> method instead of <code>in()</code>:</p>
<pre><code class="php">&lt;?php

$keywords = array('nike shoes', 'air jordan');

$qb = $dm-&gt;createQueryBuilder('Product')
    -&gt;field('keywords')-&gt;all($keywords);
</code></pre>
<p>The above query would only return products that have both of the keywords!</p>
<a class="section-anchor" name="title.1.3.1"></a><h3 class="section-header"><a href="#title.1.3.1">User Input<i class="fas fa-link"></i></a></h3>
<p>You can easily build keywords from a user search form by exploding whitespace and passing
the results to your query. Here is an example:</p>
<pre><code class="php">&lt;?php

$queryString = $_REQUEST['q'];
$keywords = explode(' ', $queryString);

$qb = $dm-&gt;createQueryBuilder('Product')
    -&gt;field('keywords')-&gt;all($keywords);
</code></pre>
<a class="section-anchor" name="title.1.4"></a><h2 class="section-header"><a href="#title.1.4">Embedded Documents<i class="fas fa-link"></i></a></h2>
<p>If you want to use an embedded document instead of just an array then you can. It will allow you to store
additional information with each keyword, like its weight.</p>
<a class="section-anchor" name="title.1.4.1"></a><h3 class="section-header"><a href="#title.1.4.1">Definition<i class="fas fa-link"></i></a></h3>
<p>You can setup a <code>Keyword</code> document like the following:</p>
<pre><code class="php">&lt;?php

/** @EmbeddedDocument */
class Keyword
{
    /** @Field(type=&quot;string&quot;) @Index */
    private $keyword;

    /** @Field(type=&quot;int&quot;) */
    private $weight;

    public function __construct($keyword, $weight)
    {
        $this-&gt;keyword = $keyword;
        $this-&gt;weight = $weight;
    }

    // ...
}
</code></pre>
<p>Now you can embed the <code>Keyword</code> document many times in the <code>Product</code>:</p>
<pre><code class="php">&lt;?php

namespace Documents;

/** @Document */
class Product
{
    // ...

    /** @EmbedMany(targetDocument=&quot;Keyword&quot;) */
    private $keywords;

    // ...
}
</code></pre>
<p>With the new embedded document to add a keyword to a <code>Product</code> the API is a little different,
you would have to do the following:</p>
<pre><code class="php">&lt;?php

$product-&gt;addKeyword(new Keyword('nike shoes', 1));
</code></pre>
<p>This is a very basic search engine example and can work for many small and simple applications. If you
need better searching functionality you can look at integrating something like <a href="http://lucene.apache.org/solr">Solr</a> in your project.</p>
                        <div style="height: 10000px"></div>
                                    </div>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <i class="fa fa-copyright"></i> 2018 Doctrine
            </div>
        </footer>

        <script type="text/javascript">
            // When the user scrolls down 20px from the top of the document, show the button
            window.onscroll = function() {scrollFunction()};

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementById('back-to-top').style.display = "block";
                } else {
                    document.getElementById('back-to-top').style.display = "none";
                }
            }

            // When the user clicks on the button, scroll to the top of the document
            function topFunction() {
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            }
        </script>

        <button onclick="topFunction()" id="back-to-top" title="Go to top">Top</button>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
