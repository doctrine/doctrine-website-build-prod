<!DOCTYPE html>
<html>
    <head>
        <title>An ORM/ODM Base Class - Doctrine - PHP Database Tools</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
            <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2011/11/21/a-doctrine-orm-odm-base-class.html"
        },
        "headline": "An ORM/ODM Base Class",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2011-11-21T00:00:00+00:00",
        "dateModified": "2011-11-21T00:00:00+00:00",
        "author": {
            "@type": "Person",
            "name": "Benjamin Eberlei"
        },
         "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "One of most common complaints about Doctrine2 is the requirement to
write getters/setters for all th"
    }
    </script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">

        <link href="https://www.doctrine-project.org/css/style.css?3625e4" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

        <link rel="stylesheet" href="https://www.doctrine-project.org/components/highlightjs/styles/railscasts.css?b4f8ae" />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineorm" />
        <meta name="twitter:creator" content="@doctrineorm" />
        <meta property="og:url" content="https://www.doctrine-project.org/2011/11/21/a-doctrine-orm-odm-base-class.html" />
        <meta property="og:title" content="An ORM/ODM Base Class - Doctrine - PHP Database Tools" />
        <meta property="og:description" content="The Doctrine Project is the home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/images/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineorm"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    <nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="https://www.doctrine-project.org/"><img src="https://www.doctrine-project.org/images/doctrine-logo.svg?335f0f" />Doctrine</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="https://www.doctrine-project.org/projects.html" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu projects-dropdown-menu" aria-labelledby="navbarDropdown">
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/annotations.html">Annotations</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/cache.html">Cache</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/couchdb-odm.html">CouchDB ODM</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/mongodb.html">MongoDB</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="https://www.doctrine-project.org/projects/phpcr-odm.html">PHPCR ODM</a>
                                                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/about/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/contribute/">Contribute</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/community/">Community</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="https://www.doctrine-project.org/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.doctrine-project.org/team/">Team</a>
                        </li>
                    </ul>

                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                </div>

                <div class="search-results rounded">
                    <div id="hits">
                        <!-- Hits widget will appear here -->
                    </div>

                    <a href="https://www.algolia.com" target="_blank"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
                </div>
            </nav>
        
            <main role="main" class="container-wrapper container">
            <article>
        <header>
            <h2>An ORM/ODM Base Class <small>post</small></h2>
        </header>

        <p class="lead">
            Posted on 2011-11-21
                            by
                                    Benjamin Eberlei
                                    </p>

        <div>
            <p>One of most common complaints about Doctrine2 is the requirement to
write getters/setters for all the fields and assocations of every
entity. A concern that immediately follows is that Doctrine 2 is not
suitable for Rapid-Application-Development.</p>

<p>The problem is purely a usability concern and there are a bunch of very
easy ways ouf of this problem:</p>

<ul>
<li>A base-object that has &#95;&#95;get/&#95;&#95;set.</li>
<li>The EntityGenerator can generate getters/setters</li>
<li>An IDE that generates getters/setters (Netbeans, PHPStorm)</li>
</ul>

<p>We have been very critical of ActiveRecord since we started the
development of Doctrine 2 for various reasons. Mostly because we don't
think coupling the database to your domain objects is a good choice for
testability an maintainabilty reasons.</p>

<p>However we do see the need for Doctrine 2 to be suitable for RAD
projects. With the launch of Symfony2 and other frameworks with tight
Doctrine 2 integration this requirement has become even more important.</p>

<p>That is why we will introduce a very lightweight base-class into
Doctrine. We managed to write this base-class on an abstract level
against the Common Metadata interface, such that CouchDB-, MongoDB- and
PHPCR-ODM implementations benefit from this as well.</p>

<p>Using a new hook in Doctrine 2.2-DEV you can now inject the
EntityManager (ObjectManager) and the metadata description into each
entity during construction. This metadata is used to implement the magic
&#95;&#95;call hook implementing getters/setters and association management
methods.</p>

<h1 id="example">Example</h1>

<p>A simple example will demonstrate this:</p>

<blockquote>
  <p>\&lt;?php use DoctrineCommonPersistencePersistentObject; use
  DoctrineORMEntityManager;</p>
  
  <dl>
  <dt>/<em>&#42;</em> @Entity</dt>
  <dd>&#42;&#42;/</dd>
  </dl>
  
  <p>class User extends PersistentObject { /<em>&#42; @Id @Column(type="integer")
  @GeneratedValue</em>&#42;/ protected \$id;</p>
  
  <blockquote>
    <p>/<em>&#42; @Column(type="string")</em>&#42;/ protected \$name;</p>
    
    <p>/<em>&#42; @OneToMany(targetEntity="Phonenumber", mappedBy="user")</em>&#42;/
    protected \$phonenumbers;</p>
  </blockquote>
  
  <p>}</p>
</blockquote>

<p>Extending from &#96;PersistentObject&#96; will make getters/setters available
for your entities. Bi-directional associations are handled
automatically.</p>

<pre><code class="sourceCode php">&lt;?php
/**
 * @Entity
 **/
class Phonenumber extends PersistentObject
{
    /** @Id @Column(type="string") **/
    private $number;

    /** @ManyToOne(targetEntity="User", inversedBy="phonenumbers") **/
    private $user;
}
</code></pre>

<p>The only configuration call for the &#96;PersistentObject&#96; is a
registration of the responsible entity/document manager:</p>

<pre><code class="sourceCode php">&lt;?php
$entityManager = EntityManager::create(...);
PersistentObject::setObjectManager($entityManager);
</code></pre>

<p>You can now start using the entities as simple as this:</p>

<pre><code class="sourceCode php">&lt;?php
$number = new Phonenumber();
$number-&gt;setNumber(123454);
$user = new User();
$user-&gt;setName("Benjamin");
$user-&gt;addPhonenumbers($number);

echo $user-&gt;getName();
foreach ($user-&gt;getPhonenumbers() AS $number) {
    echo $number-&gt;getNumber();
}
</code></pre>

<h1 id="future-developments">Future Developments</h1>

<p>First important notice: We will not develop the &#96;PersistentObject&#96;
into a full-fledged active record. Doctrine focuses on being a
DataMapper. We do however provide a bunch of new hooks in version 2.2
that will allow you to turn Doctrine 2 into an active record very
easily:</p>

<ul>
<li>Inject EntityManager and ClassMetadata</li>
</ul>

<p>If your entity implements &#96;DoctrineCommonPersistentObjectManagerAware&#96;
then the ObjectManager and ClassMetadata of the entity will be injected
during construction.</p>

<ul>
<li>EntityManager&#35;flush() can now flush one entity only</li>
</ul>

<p>When you pass a single entity to EntityManager&#35;flush() this entity will
be the only one flushed into the database. Cascade persist rules are
applied to this object. With this feature and access to the
EntityManager inside your entities you can now start implementing an
efficient Active Record with "Record&#35;save()" and "Record&#35;delete()"
methods.</p>

<ul>
<li>PHP 5.4 and Traits</li>
</ul>

<p>The next version of PHP is already in Beta 2 and will probably be
released in the next months. One of the most powerful feature of this
release will be Traits, something very suitable for Doctrine and ORMs in
general.</p>

<p>No worries: Doctrine 2 will always be supporting 5.3, however we will
probably ship with optional features that are using the trait
functionality. High on the list:</p>

<ul>
<li>Porting &#96;PersistentObject&#96; to a trait</li>
<li>Serialization of entities from a trait (ToArray(), ToJson()).
Available as a service to PHP 5.3</li>
<li>ActiveEntity trait that extends the &#96;PersistentObject&#96; one.</li>
</ul>

<p>Based on this feature set it should even be possible to add behaviors to
Doctrine 2, although we won't focus on implementing behaviors in the
core team.</p>

<h1 id="last-words">Last words</h1>

<p>I would really appreciate people starting to test the
&#96;PersistentObject&#96; if they like too and give us feedback.</p>

        </div>
                
                    <nav class="article">
                <ul class="pagination">
                                            <li class="page-item"><a class="page-link previous" href="https://www.doctrine-project.org/2011/09/25/doctrine-maintenance-sep2011.html" title="Maintenance 2.1 Releases for Common, DBAL and ORM and DBAL 2.0.9"><span class="title">Previous: Maintenance 2.1 Releases for Common, DBAL and ORM and DBAL 2.0.9</span></a></li>
                                                                <li class="page-item"><a class="page-link next" href="https://www.doctrine-project.org/2011/11/21/doctrine-maintenance-nov2011.html" title="Doctrine Common 2.1.3, DBAL 2.1.5 and ORM 2.1.3 Releases"><span class="title">Next: Doctrine Common 2.1.3, DBAL 2.1.5 and ORM 2.1.3 Releases</span></a></li>
                                    </ul>
            </nav>
            </article>



    </main>

        
        <button id="back-to-top" title="Go to top">Top</button>

        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>

        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

        <script src="https://www.doctrine-project.org/components/highlightjs/highlight.pack.js?3970aa"></script>

        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>

        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script src="https://www.doctrine-project.org/js/main.js?f32c09"></script>
        <script src="https://www.doctrine-project.org/js/search.js?21d569"></script>

        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            new Main();

            new Search(projectSlug, versionSlug);
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
        
            </body>
</html>
