<!DOCTYPE html>
<html>
    <head>
        <title>MongoDB ODM: MongoDB for eCommerce - Doctrine: PHP Open Source Project</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
            <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2010/07/22/mongodb-for-ecommerce.html"
        },
        "headline": "MongoDB ODM: MongoDB for eCommerce",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2010-07-22T00:00:00-04:00",
        "dateModified": "2010-07-22T00:00:00-04:00",
        "author": {
            "@type": "Person",
            "name": "avalanche123"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "Hi, my name is Bulat S. (my last name won&amp;#039;t make it any easier, but in case you were wondering "
    }
    </script>
    <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/prismjs.css?d2443b"
                            integrity="sha384-IcJ7eow//K0xRBscZjnk8kawYxbm2eUAZ9D6Xf/n0yuAi1NCvwOkep1S8XqPNB3E"
                        crossorigin="anonymous"
    />

        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?209f12"
                        integrity="sha384-VMcQOaUBPJYirNpZMqv0kKw80RSt4Uye4T1Li/d7kiKYAfj1WSzYOgP2OTdON/HM"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/2010/07/22/mongodb-for-ecommerce.html" />
        <meta property="og:title" content="MongoDB ODM: MongoDB for eCommerce - Doctrine: PHP Open Source Project" />
        <meta property="og:description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine-website/edit/master/source/blog/2010-07-22-mongodb-for-ecommerce.md" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
            <article>
        <div class="row">
            <div class="col-lg-8 col-12">
                <header>
                    <h2>MongoDB ODM: MongoDB for eCommerce</h2>
                </header>

                <p class="lead">
                    Posted on <date>July 22, 2010</date>
                                            by
                                                    avalanche123
                                                            </p>
            </div>

            <div class="col-lg-4 col-12">
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>
            </div>
        </div>

        <hr />

        <div>
                
            
                <div style="float: left; width: 300px;">
    <div style="padding: 15px; border: 1px solid #ccc; margin: 0 15px; background: #eee; color: #888">
    <p style="margin: 0;">
                
    <p>Hi, my name is Bulat S. (my last name won&#039;t make it any easier, but in case you were wondering it&#039;s Shakirzyanov), I joined OpenSky in August 2009 (It&#039;s been almost a year since then, but it feels like ages). My official title in the company is Hacker, which also says a lot about me (that I don&#039;t like corporate titles for one).</p>

                </p>
    <p style="margin: 10px 0 0;">
                
    <p>The last 6 weeks were truly amazing for me. Not only was I able to learn a new technology, I also managed to contribute back to the community. But let&#039;s go over everything step by step.</p>

                </p>
    </div>
</div>
                
    <p>Building an eCommerce system is not easy, and building a platform is even harder. When it comes to data in eCommerce, there is nothing definite, no real structure you could stick to, and no final requirements. Something as obvious as the &quot;item you add to cart&quot; could be overly complicated when it comes to data.</p>

                
    <p>There is a good example of how to model the database for handling variable product attributes; <a href="https://magento.com/">Magento</a> is one of the most advanced open source eCommerce solutions available today. It uses <a href="https://en.wikipedia.org/wiki/Entity-attribute-value_model">EAV (Entity Attribute Value)</a> , which solves the problem of variable attributes by sacrificing database level integrity and application performance. The amount of queries you need to perform to select one entity will grow with every attribute data type you introduce; however, it still is a viable solution.</p>

                
    <p>A document store on the other hand lets you save two absolutely different documents in the same collection. Because of its schema-less structure it is also possible to add or remove a document&#039;s properties after saving - it&#039;s a database that adapts to your data structure on the fly.</p>

                
    <p>At <a href="https://www.theopenskyproject.com/">OpenSky</a> , we decided to use <a href="https://www.mongodb.com/">MongoDB</a> for storage of products and use relational databases for order-related data since <a href="https://www.mongodb.com/">MongoDB</a> doesn&#039;t support transactions.</p>

                
    <p>So what is the benefit of using <a href="https://www.mongodb.com/">MongoDB</a> over MySQL, or any other RDBMS, for storing variable attribute data. Performance. This is the pseudo-query we would have to write to select one product, with id 1, and all of its attributes in a typical <a href="https://en.wikipedia.org/wiki/Entity-attribute-value_model">EAV model</a>:</p>

                <div class="right">
                </div>
                    <pre class="code-block-table" id="5b2ed6c2c7d6afe7d09218cb8e17f161245aa32f"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="5b2ed6c2c7d6afe7d09218cb8e17f161245aa32f"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[txt]</code><code class="line language-php">SELECT * FROM `product` WHERE id = <span class="hljs-number">1</span>;</code><code class="line language-php">SELECT * FROM `product_attributes` = WHERE product_id = <span class="hljs-number">1</span>;</code><code class="line language-php">SELECT * FROM `product_values_int` WHERE product_id = <span class="hljs-number">1</span>;</code><code class="line language-php">SELECT * FROM `product_values_varchar` WHERE product_id = <span class="hljs-number">1</span>;</code><code class="line language-php">SELECT * FROM `product_values_datetime` WHERE product_id = <span class="hljs-number">1</span>;</code><code class="line language-php">SELECT * FROM `product_values_text` WHERE product_id = <span class="hljs-number">1</span>;</code><code class="line language-php">SELECT * FROM `product_values_float` WHERE product_id = <span class="hljs-number">1</span>;</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>After the above queries are run, there would be a huge step of data hydration into the product object, which <a href="https://magento.com/">Magento</a> handles quite well, albeit slowly. Contrast this with what we would do in <a href="https://www.mongodb.com/">MongoDB</a>:</p>

                    <pre class="code-block-table" id="a64e492e84f98f41ccb6feab58e0c0c40d1a71b5"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="a64e492e84f98f41ccb6feab58e0c0c40d1a71b5"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[javascript]</code><code class="line language-php">db.products.find({<span class="hljs-string">'_id'</span>: <span class="hljs-string">'1'</span>});</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Not only is the selection simpler, but it also returns a JSON object, which can easily be hydrated into a native PHP object. And here is how a configurable product could be represented in <a href="https://www.mongodb.com/">MongoDB</a>:</p>

                    <pre class="code-block-table" id="1c0ddbd36ddd90cce11e07bee847dd6cfc6b4db2"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="1c0ddbd36ddd90cce11e07bee847dd6cfc6b4db2"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php">[javascript]</code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-string">"_id"</span>: ObjectId(<span class="hljs-string">"4bffd798fdc2120019040000"</span>)</code><code class="line language-php">    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Configurable T-Shirt"</span></code><code class="line language-php">    <span class="hljs-string">"options"</span>: [</code><code class="line language-php">        {</code><code class="line language-php">            <span class="hljs-string">"name"</span>: <span class="hljs-string">"small"</span>,</code><code class="line language-php">            <span class="hljs-string">"price"</span>: <span class="hljs-number">12.99</span></code><code class="line language-php">        },</code><code class="line language-php">        {</code><code class="line language-php">            <span class="hljs-string">"name"</span>: <span class="hljs-string">"medium"</span>,</code><code class="line language-php">            <span class="hljs-string">"price"</span>: <span class="hljs-number">15.99</span></code><code class="line language-php">        },</code><code class="line language-php">        {</code><code class="line language-php">            <span class="hljs-string">"name"</span>: <span class="hljs-string">"large"</span>,</code><code class="line language-php">            <span class="hljs-string">"price"</span>: <span class="hljs-number">17.99</span></code><code class="line language-php">        }</code><code class="line language-php">    ]</code><code class="line language-php">}</code><code class="line language-php"></code><code class="line language-php">**NOTE** There is no need <span class="hljs-keyword">for</span> joins, <span class="hljs-keyword">as</span> product options are a</code><code class="line language-php">collection of embedded objects. Object references (akin foreign key</code><code class="line language-php">relationships in RDBMSs) are also possible, but they are generally</code><code class="line language-php">only necessary <span class="hljs-keyword">if</span> you need to access the object independently. <span class="hljs-keyword">For</span></code><code class="line language-php">instance, <span class="hljs-keyword">if</span> I needed a page to <span class="hljs-keyword">list</span> all product options across all</code><code class="line language-php">products, I would probably put options into their own collection</code><code class="line language-php"><span class="hljs-keyword">and</span> reference them from the product document.</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Of course, there are <a href="https://docs.mongodb.com/ecosystem/drivers/php/#PHPLanguageCenter-LibraryandFrameworkTools">plenty of ORM libraries</a> for <a href="https://www.mongodb.com/">MongoDB</a> , which were either hard-to-extract parts of frameworks, not quite ORMs or used the <a href="https://martinfowler.com/eaaCatalog/activeRecord.html">ActiveRecord pattern</a> (which after using <a href="https://martinfowler.com/eaaCatalog/dataMapper.html">DataMapper</a> for quite some time, I wouldn&#039;t want to go back to). The very same day I started writing an object document mapper (ODM) to use at <a href="https://www.theopenskyproject.com/">OpenSky</a> , <a href="https://www.twitter.com/jwage">Jon Wage</a> (developer for the Doctrine project) released a proof-of-concept <a href="https://www.doctrine-project.org/projects/mongodb_odm">MongoDB ODM</a> , which you can <a href="https://github.com/doctrine/mongodb-odm">find on github</a>. After contacting Jon and giving his library a couple of tries and <a href="https://www.phpunit.de/">tests</a> , I decided to use it for <a href="https://www.theopenskyproject.com/">OpenSky</a>&#039;s products domain layer.</p>

                
    <p>I started to submit patches and <a href="https://www.phpunit.de/">unit tests</a> to the project and soon joined the core team for <a href="https://www.doctrine-project.org/projects/mongodb_odm">MongoDB ODM</a>. Today, we are past first alpha release of the project, and this is my first post on the Doctrine blog (yay!).</p>

                
    <p>Getting back to our example, this is how the product and embedded option classes for the aforementioned data structure could look:</p>

                    <pre class="code-block-table" id="116f386480d5d5a028940379f7bab86dbd459703"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="116f386480d5d5a028940379f7bab86dbd459703"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">// Product.php</span></code><code class="line language-php"><span class="hljs-comment">/**</span></code><code class="line language-php"> * @Document(collection=<span class="hljs-string">"products"</span>)</code><code class="line language-php"> */</code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span></span></code><code class="line language-php">{</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Id</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $id;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @String</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $name;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @EmbedMany(targetDocument=<span class="hljs-string">"Product\Option"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $options = <span class="hljs-keyword">array</span>();</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getId</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;id;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setName</span><span class="hljs-params">($name)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;name = $name;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getName</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;name;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addOption</span><span class="hljs-params">(Product\Option $option)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;options[] = $option</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">//...</span></code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>And the Product class:</p>

                    <pre class="code-block-table" id="e8f28b9cfe2d38a28172aea7822a42d8abbe7817"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="e8f28b9cfe2d38a28172aea7822a42d8abbe7817"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">// Product/Option.php</span></code><code class="line language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Product</span>;</code><code class="line language-php"><span class="hljs-comment">/**</span></code><code class="line language-php"> * @EmbeddedDocument</code><code class="line language-php"> */</code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Option</span></span></code><code class="line language-php">{</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @String</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $name;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Float</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $price;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setName</span><span class="hljs-params">($name)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;name = $name;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getName</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;name;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setPrice</span><span class="hljs-params">($price)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;price = $price;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPrice</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;price;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">//...</span></code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Using the DocumentManager instance, we could easily persist the product with:</p>

                    <pre class="code-block-table" id="8aacd828cc903c3d0299c2a9b05a83b58ae9dcc2"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="8aacd828cc903c3d0299c2a9b05a83b58ae9dcc2"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$product = <span class="hljs-keyword">new</span> Product();</code><code class="line language-php">$product-&gt;setName(<span class="hljs-string">'Configurable T-Shirt'</span>);</code><code class="line language-php"></code><code class="line language-php">$small = <span class="hljs-keyword">new</span> Product\Option();</code><code class="line language-php">$small-&gt;setName(<span class="hljs-string">'small'</span>);</code><code class="line language-php">$small-&gt;setPrice(<span class="hljs-number">12.99</span>);</code><code class="line language-php">$product-&gt;addOption($small);</code><code class="line language-php"></code><code class="line language-php">$medium = <span class="hljs-keyword">new</span> Product\Option();</code><code class="line language-php">$medium-&gt;setName(<span class="hljs-string">'medium'</span>);</code><code class="line language-php">$medium-&gt;setPrice(<span class="hljs-number">15.99</span>);</code><code class="line language-php">$product-&gt;addOption($medium);</code><code class="line language-php"></code><code class="line language-php">$large = <span class="hljs-keyword">new</span> Product\Option();</code><code class="line language-php">$large-&gt;setName(<span class="hljs-string">'large'</span>);</code><code class="line language-php">$large-&gt;setPrice(<span class="hljs-number">15.99</span>);</code><code class="line language-php">$product-&gt;addOption($large);</code><code class="line language-php"></code><code class="line language-php">$documentManager-&gt;persist($product);</code><code class="line language-php">$documentManager-&gt;flush();</code><code class="line language-php"></code><code class="line language-php">**NOTE** MongoDB ODM intelligently uses</code><code class="line language-php">`atomic operators &lt;https:<span class="hljs-comment">//docs.mongodb.com/manual/core/write-operations-atomicity/&gt;`_</span></code><code class="line language-php">to update data, which makes it really fast. It also supports</code><code class="line language-php">inheritance (collection-per-<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">and</span> <span class="hljs-title">single</span>-<span class="hljs-title">collection</span></span></code><code class="line language-php">inheritances), which is similar to table inheritance design</code><code class="line language-php">patterns <span class="hljs-keyword">for</span> ORMs. Check out the official Mongo ODM</code><code class="line language-php">`project documentation &lt;https:<span class="hljs-comment">//www.doctrine-project.org/projects/mongodb_odm/1.0/docs/en&gt;`_</span></code><code class="line language-php"><span class="hljs-keyword">for</span> more information <span class="hljs-keyword">and</span> examples. Complete instructions on how to</code><code class="line language-php">setup your DocumentManager instance</code><code class="line language-php">`can be found here &lt;https:<span class="hljs-comment">//www.doctrine-project.org/projects/mongodb_odm/1.0/docs/reference/introduction/en&gt;`_.</span></code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>The above code would store the product object as a document in <a href="https://www.mongodb.com/">MongoDB</a>.</p>

                
    <p>There is much more to talk about in terms or technologies, techniques and practices we adopt and use at <a href="https://www.theopenskyproject.com/">OpenSky</a> , so this post is definitely not the last one.</p>

        
    
        </div>
    </article>
    </main>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?4a831b"
                            integrity="sha384-ygNM6vWkqMgvV0Lrk5BeKUupSk4CidmuzVPL3OkdAxEVjZQDo9cgbfC+FXAfoAse"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            <script
            src="https://www.doctrine-project.org/frontend/js/prismjs.js?e97886"
                            integrity="sha384-gKhxdEN1Hcl/o+IxbVbpfZRfdDPQe5dwOuCcWYbhCAhhkOl/Vi2VmnWe9/UCD6rW"
                        crossorigin="anonymous">
    </script>
    </body>
</html>
