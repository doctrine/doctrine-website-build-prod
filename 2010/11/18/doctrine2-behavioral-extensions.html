<!DOCTYPE html>
<html>
    <head>
        <title>Doctrine2 Behavioral Extensions - Doctrine: PHP Open Source Project</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
            <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2010/11/18/doctrine2-behavioral-extensions.html"
        },
        "headline": "Doctrine2 Behavioral Extensions",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2010-11-18T00:00:00-05:00",
        "dateModified": "2010-11-18T00:00:00-05:00",
        "author": {
            "@type": "Person",
            "name": "gmorkevicius"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "These behavioral extensions will give you another view on Doctrine2
capabilities handling behaviors "
    }
    </script>
    <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/prismjs.css?d2443b"
                            integrity="sha384-IcJ7eow//K0xRBscZjnk8kawYxbm2eUAZ9D6Xf/n0yuAi1NCvwOkep1S8XqPNB3E"
                        crossorigin="anonymous"
    />

        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?30e146"
                        integrity="sha384-FVDIQoS0d3jPyOKOWC++X74jvxneJJEUqbqH7jYQwuD57vmO+ysmVFKeIqzV7x+Y"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/2010/11/18/doctrine2-behavioral-extensions.html" />
        <meta property="og:title" content="Doctrine2 Behavioral Extensions - Doctrine: PHP Open Source Project" />
        <meta property="og:description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine-website/edit/master/source/blog/2010-11-18-doctrine2-behavioral-extensions.md" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
            <article>
        <div class="row">
            <div class="col-lg-8 col-12">
                <header>
                    <h2>Doctrine2 Behavioral Extensions</h2>
                </header>

                <p class="lead">
                    Posted on <date>November 18, 2010</date>
                                            by
                                                    gmorkevicius
                                                            </p>
            </div>

            <div class="col-lg-4 col-12">
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>
            </div>
        </div>

        <hr />

        <div>
                <p>These behavioral extensions will give you another view on Doctrine2
capabilities handling behaviors through the EventListeners. These
extensions operate like some of the most commonly used behaviors,
leaving the domain objects as clean as possible. Annotations makes it
easy to understand an intended behavior of properties on your Entities.</p>
<div style="float: left; width: 450px;">
    <div style="padding: 15px; border: 1px solid #ccc; margin: 0 15px; background: #eee; color: #888">
    <p style="margin: 0;">

Hi, my name is Gediminas Morkevicius, I have 4 year experience in C++
and PHP 5 and I'm very keen on new technologies and Doctrine2 is one of
them. Development is not only a job for me, but it is my lifestyle and
I'm pleased to give some love back to Doctrine2.

</p>
    <p style="margin: 10px 0 0;">

I would like to thank Doctrine2 and Symfony2 teams for these wonderful
projects. They have great potential.

</p>
    </div>
</div>
<p><strong>NOTE</strong> This blog entry relates to Doctrine2 Beta4 ORM version and
could possibly be outdated depending on what the current version of
Doctrine2 is at the time of you reading this post. Then integrating
these extensions on your project it is recommended to use latest
Doctrine2 library packages, because where are most recent updates
used on extensions for metadata caching and annotations.</p>
<div style="clear:both"></div>
<p>Content:</p>
<ul>
<li>Introduction on behavioral extensions</li>
<li>Setup and autoloading</li>
<li>Translatable extension</li>
<li>Tree extension</li>
<li>Sluggable extension</li>
<li>Timestampable extension</li>
<li>All nested together</li>
</ul>
<p>First of all, this post intends to give an example on how &quot;behaviors&quot;
can be implemented through the Doctrine2 EventListeners. All these
behavioral extensions can be nested and support flush operation which
can include lots of update, insert and remove actions. This is the most
common issue when behavior development process is started.</p>
<p>Furthermore, all extensions are mapped by annotations consequently
leaving domain objects clean from interfaces and their methods. Plus,
the performance speed is even greater if cache driver is used, because
metadata for single Entity is mapped and validated only once.</p>
<p>Before we begin exploring the extensions, I`m glad to mention that
these extensions are already available on Symfony2 Bundle ported by
Christophe Coevoet.</p>
<p>## Setting up the autoloader and listeners</p>
<p>First of all, download this library from public github repository and
setup the autoloading for extensions:</p>
<pre><code class="language-{.sourceCode">&lt;?php
$classLoader = new \Doctrine\Common\ClassLoader('Gedmo', "/path/to/library/DoctrineExtensions/lib");
$classLoader-&gt;register();</code></pre>
<p>Translatable behavior will need additional annotation driver for
Translation Entity metadata. The example below illustrates the chain
driver implementation:</p>
<pre><code class="language-{.sourceCode">&lt;?php
$chainDriverImpl = new \Doctrine\ORM\Mapping\Driver\DriverChain();
$yourDefaultDriverImpl = new \Doctrine\ORM\Mapping\Driver\YamlDriver('/yml/mapping/files'); // only an example
$translatableDriverImpl = $doctrineOrmConfig-&gt;newDefaultAnnotationDriver(
    '/path/to/library/DoctrineExtensions/lib/Gedmo/Translatable/Entity'
);
$chainDriverImpl-&gt;addDriver($yourDefaultDriverImpl, 'Entity');
$chainDriverImpl-&gt;addDriver($translatableDriverImpl, 'Gedmo\Translatable');
$doctrineOrmConfig-&gt;setMetadataDriverImpl($chainDriverImpl);</code></pre>
<h1>Attaching the Event Listeners on the event manager</h1>
<pre><code class="language-{.sourceCode">&lt;?php
$evm = new \Doctrine\Common\EventManager();
// timestampable
$evm-&gt;addEventSubscriber(new \Gedmo\Timestampable\TimestampableListener());
// sluggable
$evm-&gt;addEventSubscriber(new \Gedmo\Sluggable\SluggableListener());
// tree
$evm-&gt;addEventSubscriber(new \Gedmo\Tree\TreeListener());
// translatable
$translationListener = new \Gedmo\Translatable\TranslationListener();
$translationListener-&gt;setTranslatableLocale('en_us');
// in real world app the locale should be loaded from session, example:
// Session::getInstance()-&gt;read('locale');
$evm-&gt;addEventSubscriber($translationListener);
// now this event manager should be passed to entity manager constructor

**NOTE** It is recommended to attach TranslationListener as the
last whereas sluggable extension must create a slug before
translating it.</code></pre>
<p>## Translatable</p>
<p>Translatable behavior offers a very handy solution for translating
specific record fields into different languages. Furthermore, it loads
the translations automatically for the currently used locale. Locale can
be set by TranslationListener during it's initialization or later. It
also leaves the possibility to force a specific locale directly on the
Entity itself.</p>
<p>Feature list:</p>
<ul>
<li>Translates all records automatically when object hydration is used</li>
<li>Supports a separate translation table for each Entity</li>
<li>There can be a default locale specified, which would force entity to
leave its original translation in default locale.</li>
</ul>
<h1>Translatable annotations:</h1>
<ul>
<li>@gedmo:Translatable indicates that the column is translatable</li>
<li>@gedmo:TranslationEntity(class=&quot;my&quot;) this class annotation tells to
use specified Entity to store translations</li>
<li>@gedmo:Locale or @gedmo:Language indicates that the column must not
be mapped and that it may be used to override TranslationListener`s
locale</li>
</ul>
<p>Translatable Entity example:</p>
<pre><code class="language-{.sourceCode">&lt;?php
namespace Entity;

/**
 * @Entity
 */
class Article
{
    /**
     * @Id
     * @GeneratedValue
     * @Column(type="integer")
     */
    private $id;

    /**
     * @gedmo:Translatable
     * @Column(type="string", length=128)
     */
    private $title;

    /**
     * @gedmo:Translatable
     * @Column(type="text")
     */
    private $content;

    /**
     * @gedmo:Locale
     */
    private $locale;

    public function getId()
    {
        return $this-&gt;id;
    }

    public function setTitle($title)
    {
        $this-&gt;title = $title;
    }

    public function getTitle()
    {
        return $this-&gt;title;
    }

    public function setContent($content)
    {
        $this-&gt;content = $content;
    }

    public function getContent()
    {
        return $this-&gt;content;
    }

    public function setTranslatableLocale($locale)
    {
        $this-&gt;locale = $locale;
    }
}</code></pre>
<p>There is no need for any additional operations while working with
Translatable Entities. All processing is done by event listener, just
like in good old behaviors. Except that in Doctrine2 the code is simpler
and easy to understand and you may inspect it and customize if you see
any point in doing that.</p>
<p>Here are standard usage examples, the locale was set to &quot;en_us&quot; on
listener:</p>
<pre><code class="language-{.sourceCode">&lt;?php
$article = new \Entity\Article;
$article-&gt;setTitle('my title in en');
$article-&gt;setContent('my content in en');
$em-&gt;persist($article);
$em-&gt;flush();</code></pre>
<p>This inserted an article and populated the translations for it in
&quot;en_us&quot; locale. Now lets translate it into another language:</p>
<pre><code class="language-{.sourceCode">&lt;?php
// first load the article
$article = $em-&gt;find('Entity\Article', 1 /*article id*/);
$article-&gt;setTitle('my title in de');
$article-&gt;setContent('my content in de');
$article-&gt;setTranslatableLocale('de_de'); // change locale
$em-&gt;persist($article);
$em-&gt;flush();</code></pre>
<p>This updated an article and inserted the translations for it in &quot;de_de&quot;
locale. The TranslationRepository gives some handy methods on retrieving
all translations:</p>
<pre><code class="language-{.sourceCode">&lt;?php
$em-&gt;clear(); // ensure the cache is clean
$article = $em-&gt;find('Entity\Article', 1 /*article id*/);
$repository = $em-&gt;getRepository('Gedmo\Translatable\Entity\Translation');
$translations = $repository-&gt;findTranslations($article);
/* $translations contains:
Array (
    [de_de] =&gt; Array
        (
            [title] =&gt; my title in de
            [content] =&gt; my content in de
        )

    [en_us] =&gt; Array
        (
            [title] =&gt; my title in en
            [content] =&gt; my content in en
        )
)*/
// the locale now is "en_us" and current article::title in db is "my title in de"
echo $article-&gt;getTitle();
// prints: "my title in en" because it loads the translation automatically</code></pre>
<h1>Using the &quot;default locale&quot;:</h1>
<p>In some cases we need the default translation as a fallback if record
does not have a translation on globally used locale. In that case
TranslationListener uses the current value of Entity. But there is a way
to specify a default locale which would force Entity to keep
it<code>s field value on default locale. And if record has already been translated in this locale, the record will not update it</code>s
value, only insert a new translation into translation table. You can
specify the default locale on TranslationListener`s initialization:</p>
<pre><code class="language-{.sourceCode">&lt;?php
$translationListener-&gt;setDefaultLocale('en_us');</code></pre>
<h1>Using a diferent Translation Entity for translation storage:</h1>
<p>In some cases when there are thousands of records we would like to have
a single table for translations of this Entity in order to increase the
performance on translation loading speed. The example below will show
how to specify a diferent Entity for your translations by extending the
translation mapped superclass. Thanks to Christophe Coevoet for the idea
on translation abstraction.</p>
<pre><code class="language-{.sourceCode">&lt;?php
namespace Entity\Translation;

use Gedmo\Translatable\Entity\AbstractTranslation;

/**
 * @Table(name="article_translations", indexes={
 *      @index(name="article_translation_idx", columns={"locale", "entity", "foreign_key", "field"})
 * })
 * @Entity(repositoryClass="Gedmo\Translatable\Repository\TranslationRepository")
 */
class ArticleTranslation extends AbstractTranslation
{
    /**
     * All required columns are mapped through inherited superclass
     */
}</code></pre>
<p>This Entity will be used instead of default Translation Entity only if
we specify a class annotation @gedmo:TranslationEntity(class=&quot;Entity&quot;).
Now lets slightly modify our Article Entity:</p>
<pre><code class="language-{.sourceCode">&lt;?php
/**
 * @Entity
 * @gedmo:TranslationEntity(class="Entity\Translation\ArticleTranslation")
 */
class Article
{
    // ...
}</code></pre>
<p>Now all translations of Article will be stored and queried from a
specific table.</p>
<p>## Tree</p>
<p>Tree behavior is not a Nested Set which it was in the first version of
Doctrine. This one does not require any TreeManager nor NodeWrapper and
it does not support multiple roots on tree because it is meant to be
simple and is implemented through the event listener. All standard Tree
operations are accessible through TreeNodeRepository which is advisable
to be used for Tree structured Entities. This Tree allows all traverse
operations to be done on your nodes. When performance or advanced
customizations becomes an issue, a more advanced implementation like
nested-set by Brandon Turner might be needed.</p>
<p>Tree annotations:</p>
<ul>
<li>@gedmo:TreeLeft identifies the column as storage of Tree left value</li>
<li>@gedmo:TreeRight identifies the column as storage of Tree right
value</li>
<li>@gedmo:TreeParent this will identify this column as a ManyToOne
relation of parent node</li>
</ul>
<p>All these annotations are required for the Tree to be functional. And
here is an example of a simple Tree Entity:</p>
<pre><code class="language-{.sourceCode">&lt;?php
namespace Entity;

/**
 * use repository for handy tree functions
 * @Entity(repositoryClass="Gedmo\Tree\Repository\TreeNodeRepository")
 */
class Category
{
    /**
     * @Column(type="integer")
     * @Id
     * @GeneratedValue
     */
    private $id;

    /**
     * @Column(length=64)
     */
    private $title;

    /**
     * @gedmo:TreeLeft
     * @Column(name="lft", type="integer")
     */
    private $lft;

    /**
     * @gedmo:TreeRight
     * @Column(name="rgt", type="integer")
     */
    private $rgt;

    /**
     * @gedmo:TreeParent
     * @ManyToOne(targetEntity="Category", inversedBy="children")
     */
    private $parent;

    /**
     * @OneToMany(targetEntity="Category", mappedBy="parent")
     * @OrderBy({"lft" = "ASC"})
     */
    private $children;

    public function getId()
    {
        return $this-&gt;id;
    }

    public function setTitle($title)
    {
        $this-&gt;title = $title;
    }

    public function getTitle()
    {
        return $this-&gt;title;
    }

    public function setParent(Category $parent)
    {
        $this-&gt;parent = $parent;
    }

    public function getParent()
    {
        return $this-&gt;parent;
    }
}</code></pre>
<p>Basic usage example:</p>
<pre><code class="language-{.sourceCode">&lt;?php
$food = new Entity\Category();
$food-&gt;setTitle('Food');

$fruits = new Entity\Category();
$fruits-&gt;setTitle('Fruits');
$fruits-&gt;setParent($food);

$vegetables = new Entity\Category();
$vegetables-&gt;setTitle('Vegetables');
$vegetables-&gt;setParent($food);

$carrots = new Entity\Category();
$carrots-&gt;setTitle('Carrots');
$carrots-&gt;setParent($vegetables);

$em-&gt;persist($food);
$em-&gt;persist($fruits);
$em-&gt;persist($vegetables);
$em-&gt;persist($carrots);
$em-&gt;flush();</code></pre>
<p>The result after flush will generate the tree of food chain :)</p>
<pre><code>/food (1-8)
    /fruits (2-3)
    /vegetables (4-7)
        /carrots (5-6)</code></pre>
<h1>Using TreeNodeRepository functions:</h1>
<pre><code class="language-{.sourceCode">&lt;?php
$repo = $em-&gt;getRepository('Entity\Category');

$food = $repo-&gt;findOneByTitle('Food');
echo $repo-&gt;childCount($food);
// prints: 3
echo $repo-&gt;childCount($food, true/*direct*/);
// prints: 2
$children = $repo-&gt;children($food);
// $children contains:
// 3 nodes
$children = $repo-&gt;children($food, false, 'title');
// will sort the children by title
$carrots = $repo-&gt;findOneByTitle('Carrots');
$path = $repo-&gt;getPath($carrots);
/* $path contains:
   0 =&gt; Food
   1 =&gt; Vegetables
   2 =&gt; Carrots
*/

// verification and recovery of tree
$repo-&gt;verify();
$em-&gt;clear(); // ensures cache clean
// can return TRUE if tree is valid, or array of errors found on tree
$repo-&gt;recover();
$em-&gt;clear(); // ensures cache clean
// if tree has errors it will try to fix all tree nodes

// single node removal
$vegies = $repo-&gt;findOneByTitle('Vegitables');
$repo-&gt;removeFromTree($vegies);
// it will remove this node from tree and reparent all children

// reordering the tree
$repo-&gt;reorder(null/*reorder starting from parent*/, 'title');
$em-&gt;clear(); // ensures cache clean
// it will reorder all tree node left-right values by the title

// moving up and down the nodes, by changing their (left, right) values
$carrots = $repo-&gt;findOneByTitle('Carrots');
$repo-&gt;moveUp($carrots, 1/*by one position*/);
// carrots now should be at the top in it`s level
$repo-&gt;moveDown($carrots, true/*to bottom*/);
// carrots now should be at the bottom in it`s level</code></pre>
<p>After using such Tree operations like: reorder, recover, verify it is
recommended to clear the EntityManager cache since it may have cached
nodes with old left and right values. This would be an issue if you plan
on using nodes during the same request after mentioned operations. And
if you need some custom functions on your Node repository - simply
extend the TreeNodeRepository.</p>
<p>## Sluggable</p>
<p>Sluggable behavior will build the slug from annotated fields on a chosen
slug field which should store the generated slug. Slugs can be unique
and styled. Currently this extension does not support unique constraint
on slug field in cases when there are many inserts on a single flush
operation, because it cannot issue a query to ensure uniqueness. Use a
simple index instead.</p>
<h1>Sluggable annotations:</h1>
<ul>
<li>@gedmo:Sluggable all columns identified by this annotation will be
included in a slug</li>
<li>@gedmo:Slug this column will be used to store the generated slug</li>
</ul>
<pre><code class="language-{.sourceCode">&lt;?php
namespace Entity;

/**
 * @Entity
 */
class Article
{
    /** @Id @GeneratedValue @Column(type="integer") */
    private $id;

    /**
     * @gedmo:Sluggable
     * @Column(name="title", type="string", length=64)
     */
    private $title;

    /**
     * @gedmo:Sluggable
     * @Column(name="code", type="string", length=16)
     */
    private $code;

    /**
     * @gedmo:Slug
     * @Column(name="slug", type="string", length=128, unique=true)
     */
    private $slug;

    public function getId()
    {
        return $this-&gt;id;
    }

    public function setTitle($title)
    {
        $this-&gt;title = $title;
    }

    public function getTitle()
    {
        return $this-&gt;title;
    }

    public function setCode($code)
    {
        $this-&gt;code = $code;
    }

    public function getCode()
    {
        return $this-&gt;code;
    }

    public function getSlug()
    {
        return $this-&gt;slug;
    }
}</code></pre>
<p>Basic usage example:</p>
<pre><code class="language-{.sourceCode">&lt;?php
$article = new Entity\Article();
$article-&gt;setTitle('the title');
$article-&gt;setCode('my code');
$em-&gt;persist($article);
$em-&gt;flush();

echo $article-&gt;getSlug();
// prints: the-title-my-code</code></pre>
<p>### Some other configuration options:</p>
<ul>
<li>updatable (optional, default=true) - true to update the slug on
sluggable field changes, false - otherwise</li>
<li>unique (optional, default=true) - true if slug should be unique and
if identical it will be prefixed, false - otherwise</li>
<li>separator (optional, default=&quot;-&quot;) - separator which will separate
words in slug</li>
<li>style (optional, default=&quot;default&quot;) - &quot;default&quot; all letters will be
lowercase, &quot;camel&quot; - first letter will be uppercase</li>
</ul>
<pre><code class="language-{.sourceCode">&lt;?php
// diferent slug configuration example
class Article
{
    // ...
    /**
     * @gedmo:Slug(style="camel", separator="_", updatable=false, unique=false)
     * @Column(name="slug", type="string", length=128, unique=true)
     */
    private $slug;
    // ...
}

// result would be: The_Title_My_Code</code></pre>
<p>## Timestampable</p>
<p>Timestampable behavior will automate the update of date fields on your
Entities. It works through annotations and can update fields on
creation, update or even on specific internal or related Entity property
change.</p>
<h1>Timestampable annotations:</h1>
<ul>
<li>@gedmo:Timestampable this annotation specifies that this column is
timestampable, by default it updates this column on general update.
If column is not (date, datetime or time) it will trigger an
exception. Bellow are listed available configuration options:</li>
</ul>
<p>Available configuration options:</p>
<ul>
<li>on - is the main option and can be: create, update or change. This
option indicates when an update should be triggered</li>
<li>field - only valid if on=&quot;change&quot; is specified, tracks property for
changes</li>
<li>value - only valid if on=&quot;change&quot; is specified, if tracked field has
the specified value when it triggers an update</li>
</ul>
<pre><code class="language-{.sourceCode">&lt;?php
namespace Entity;

/**
 * @Entity
 */
class Article
{
    /** @Id @GeneratedValue @Column(type="integer") */
    private $id;

    /**
     * @Column(type="string", length=128)
     */
    private $title;

    /**
     * @var datetime $created
     *
     * @gedmo:Timestampable(on="create")
     * @Column(type="date")
     */
    private $created;

    /**
     * @var datetime $updated
     *
     * @Column(type="datetime")
     * @gedmo:Timestampable(on="update")
     */
    private $updated;

    public function getId()
    {
        return $this-&gt;id;
    }

    public function setTitle($title)
    {
        $this-&gt;title = $title;
    }

    public function getTitle()
    {
        return $this-&gt;title;
    }

    public function getCreated()
    {
        return $this-&gt;created;
    }

    public function getUpdated()
    {
        return $this-&gt;updated;
    }
}</code></pre>
<p>## All nested together</p>
<pre><code class="language-{.sourceCode">&lt;?php
namespace Entity;

/**
 * @Entity(repositoryClass="Gedmo\Tree\Repository\TreeNodeRepository")
 */
class Category
{
    /**
     * @Column(name="id", type="integer")
     * @Id
     * @GeneratedValue
     */
    private $id;

    /**
     * @gedmo:Translatable
     * @gedmo:Sluggable
     * @Column(length=64)
     */
    private $title;

    /**
     * @gedmo:TreeLeft
     * @Column(type="integer")
     */
    private $lft;

    /**
     * @gedmo:TreeRight
     * @Column(type="integer")
     */
    private $rgt;

    /**
     * @gedmo:TreeParent
     * @ManyToOne(targetEntity="Category", inversedBy="children")
     */
    private $parent;

    /**
     * @OneToMany(targetEntity="Category", mappedBy="parent")
     * @OrderBy({"lft" = "ASC"})
     */
    private $children;

    /**
     * @gedmo:Translatable
     * @gedmo:Slug(style="camel", separator="_")
     * @Column(length=128)
     */
    private $slug;

    /**
     * @gedmo:Timestampable(on="create")
     * @Column(type="date")
     */
    private $created;

    /**
     * @gedmo:Timestampable(on="update")
     * @Column(type="datetime")
     */
    private $updated;

    public function getId()
    {
        return $this-&gt;id;
    }

    public function setTitle($title)
    {
        $this-&gt;title = $title;
    }

    public function getTitle()
    {
        return $this-&gt;title;
    }

    public function setParent(Category $parent)
    {
        $this-&gt;parent = $parent;
    }

    public function getParent()
    {
        return $this-&gt;parent;
    }

    public function getCreated()
    {
        return $this-&gt;created;
    }

    public function getUpdated()
    {
        return $this-&gt;updated;
    }

    public function getSlug()
    {
        return $this-&gt;slug;
    }
}</code></pre>
<p>After running some inserts you will get the expected result. Don`t be
afraid to use concurrent flush with many inserts and updates or even
remove operations, everything is meant to work fine.</p>
<p>Some of you may think that using no interface takes longer to check
Entities on events. In fact, it takes only a single 'if' statement and a
cache check on first request. This way the process is much cleaner.</p>
<p>Maybe these extensions will help some of you realize how clean domain
objects can be and how well the model represents itself. It's much more
convenient than Active Record - browsing several extended classes, going
through magic methods of those classes. While here you see everything in
one grasp.</p>
<p>There will be updates on my blog page and new articles which may
interest some of you. You can give some love back by forking a
repository and creating an ODM Document support on extensions or
suggesting me an idea of improvements or maybe an issue which you have
detected.</p>
        </div>
    </article>
    </main>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?ff3b61"
                            integrity="sha384-N2Oz1dttUU0TaVXAlk6POyhAwbZkGGv8eoZIiydnHJOew7MFr46LOksoWc9U9rdU"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            <script
            src="https://www.doctrine-project.org/frontend/js/prismjs.js?0b6349"
                            integrity="sha384-pkiLd6G8KC8B9KQTaXeVcYYLZgRGLHyx5vkGLK3G3w6Z2nzf8eNqmG/pbAdHx9tm"
                        crossorigin="anonymous">
    </script>
    </body>
</html>
