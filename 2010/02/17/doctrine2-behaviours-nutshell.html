<!DOCTYPE html>
<html>
    <head>
        <title>Doctrine 2 &amp;quot;Behaviours&amp;quot; in a Nutshell - Doctrine: PHP Open Source Project</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
            <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2010/02/17/doctrine2-behaviours-nutshell.html"
        },
        "headline": "Doctrine 2 &quot;Behaviours&quot; in a Nutshell",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2010-02-17T00:00:00-05:00",
        "dateModified": "2010-02-17T00:00:00-05:00",
        "author": {
            "@type": "Person",
            "name": "beberlei"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "NOTE This blog entry relates to an outdated Doctrine 2 Alpha :   version. Please see the documentati"
    }
    </script>
    <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/prismjs.css?d2443b"
                            integrity="sha384-IcJ7eow//K0xRBscZjnk8kawYxbm2eUAZ9D6Xf/n0yuAi1NCvwOkep1S8XqPNB3E"
                        crossorigin="anonymous"
    />

        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?6e5d9f"
                        integrity="sha384-1gHMA2pCh3C7C5PdanZqLyU+p0j9aNUSKdqMxyST9hhhoAcooEmUcqk0Rj7owse5"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/2010/02/17/doctrine2-behaviours-nutshell.html" />
        <meta property="og:title" content="Doctrine 2 &amp;quot;Behaviours&amp;quot; in a Nutshell - Doctrine: PHP Open Source Project" />
        <meta property="og:description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine-website/edit/master/source/blog/2010-02-17-doctrine2-behaviours-nutshell.md" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
            <article>
        <div class="row">
            <div class="col-lg-8 col-12">
                <header>
                    <h2>Doctrine 2 &quot;Behaviours&quot; in a Nutshell</h2>
                </header>

                <p class="lead">
                    Posted on <date>February 17, 2010</date>
                                            by
                                                    beberlei
                                                            </p>
            </div>

            <div class="col-lg-4 col-12">
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>
            </div>
        </div>

        <hr />

        <div>
                
            
                
    <p><strong>NOTE</strong> This blog entry relates to an outdated Doctrine 2 Alpha :   version. Please see the documentation for the most up to date behavior.</p>

                
    <p>One of the most common fallacies out there about Doctrine 2 abandoning Behaviours is that developers now have to implement fancy logic to re-implement them yourself. Doctrine 2&#039;s approach to completly separate ORM from your domain classes allows to build behaviours in a very clean, unobstrusive and simple object-oriented way. This article shows you how to implement some of the Doctrine 1 behaviours in your Doctrine 2 code. For this I will rewrite the Doctrine 1.x manuals examples for each Behaviour.</p>

                
    <p>This example uses Annotations as example, yet this of course works with YAML and XML mappings. Additionally Doctrine 2 allows constructors to have required arguments as of a commit of the last week. This allows for some pretty slick enforcements in user-land code as you will see in this post.</p>

                <h1 class="section-header ">
    <a href="#straightforward-combination-of-behaviours">
        Straightforward combination of &quot;Behaviours&quot;
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>All the code listed below is somehwat more verbose than the Doctrine 1 code, however much more bound to the domain of your model and very straightforward. There is no magic involved and you will fully understand what will be happening in each of the behaviours. The best of all, although not a simple trick, you will be able to combine ALL behaviours in one model class and still be completly on top of their inner workings.</p>

                <h1 class="section-header ">
    <a href="#timestampable">
        Timestampable
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Timestampable is a behaviour that requires you to hook into the pre-update event which is called whenever an entity is updated:</p>

                    <pre class="code-block-table" id="2118897e7e00d4b71a329989749bbc815df8fea6"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="2118897e7e00d4b71a329989749bbc815df8fea6"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">/**</span></code><code class="line language-php"> * @Id</code><code class="line language-php"> * @HasLifecycleCallbacks</code><code class="line language-php"> */</code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogPost</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Column(type=<span class="hljs-string">"DateTime"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $created;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Column(type=<span class="hljs-string">"DateTime"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $updated;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-comment">// constructor is never called by Doctrine</span></code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;created = <span class="hljs-keyword">$this</span>-&gt;updated = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-string">"now"</span>);</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @PreUpdate</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updated</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;updated = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-string">"now"</span>);</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h1 class="section-header ">
    <a href="#sluggable">
        Sluggable
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>The sluggable behaviour is trivial to implement in Doctrine 2:</p>

                    <pre class="code-block-table" id="33bf3ef53ab5f337bc0313f21d43c514201939d7"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="33bf3ef53ab5f337bc0313f21d43c514201939d7"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogPost</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">/** <span class="hljs-doctag">@Column</span>(type="string") */</span></code><code class="line language-php">    <span class="hljs-keyword">private</span> $slug;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/** <span class="hljs-doctag">@Column</span>(type="string") */</span></code><code class="line language-php">    <span class="hljs-keyword">private</span> $title;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setTitle</span><span class="hljs-params">($title)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;slug == <span class="hljs-keyword">null</span>) {</code><code class="line language-php">            <span class="hljs-keyword">$this</span>-&gt;slug = MyStringHelper::slugize($title);</code><code class="line language-php">        }</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;title = $title;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * Put this method in <span class="hljs-keyword">if</span> your slug should be <span class="hljs-string">"editable"</span></code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setSlug</span><span class="hljs-params">($slug)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;slug = $slug;</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>See how its much more explicit in your code how and why the slug is generated.</p>

                <h1 class="section-header ">
    <a href="#nestedset">
        NestedSet
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>This is one of the more complex behaviours in Doctrine 1 and it won&#039;t be necessarily more easy in Doctrine 2. However as this is an important feature we will provide an implementation as a <code>DoctrineExtensions</code> namespaced package that will be maintained by Doctrine Devs.</p>

                <h1 class="section-header ">
    <a href="#searchable">
        Searchable
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>There is currently no plan to port the Searchable behaviour to Doctrine 2, but the possibility to instantiate objects using <em>new</em> allows a very simple integration of a Doctrine 2 model with Apache Solr or Lucene with a little wrapper that re-creates detached instances from this powerful search engines.</p>

                
    <p>For example using <a href="http://ezcomponents.org/docs/api/trunk/introduction_Search.html">ezcSearch</a> we can make our BlogPost accessible for Solr:</p>

                    <pre class="code-block-table" id="60e35679d1d46e11f3d3ee0f9b0ea8cf304be523"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="60e35679d1d46e11f3d3ee0f9b0ea8cf304be523"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogPost</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ezcBasePersistable</span>, <span class="hljs-title">ezcSearchDefinitionProvider</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getState</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">array</span>(</code><code class="line language-php">            <span class="hljs-string">'id'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;id,</code><code class="line language-php">            <span class="hljs-string">'title'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;title,</code><code class="line language-php">            <span class="hljs-string">'body'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;body,</code><code class="line language-php">            <span class="hljs-string">'slug'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;slug,</code><code class="line language-php">        );</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setState</span><span class="hljs-params">($state)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">foreach</span> ($state <span class="hljs-keyword">AS</span> $k =&gt; $v) {</code><code class="line language-php">            <span class="hljs-keyword">$this</span>-&gt;$k = $v;</code><code class="line language-php">        }</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDefinition</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-comment">// define search schema</span></code><code class="line language-php">        <span class="hljs-keyword">return</span> $def;</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>ezcSearch can then index a blog post whenever it is changed by hooking an EventListener into the Doctrine <code>PreUpdate</code> Event:</p>

                    <pre class="code-block-table" id="3e5f116200795d0019c7b3f9dc27f3c8b3a15027"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="3e5f116200795d0019c7b3f9dc27f3c8b3a15027"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EzcSearchListener</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-keyword">private</span> $_searchSession;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(ezcSearchSession $searchSession)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;_searchSession = $searchSession;</code><code class="line language-php">    }</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">preUpdate</span><span class="hljs-params">(LifecycleEventArgs $args)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">if</span> ($args-&gt;getEntity() <span class="hljs-keyword">instanceof</span> ezcBasePersistable) {</code><code class="line language-php">            <span class="hljs-keyword">$this</span>-&gt;_searchSession-&gt;index($args-&gt;getEntity());</code><code class="line language-php">        }</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>You can now hook this event into Doctrine&#039;s EntityManager:</p>

                    <pre class="code-block-table" id="eba2030ce9080f4e413c4c2aa0cfc0c5ee4131f8"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="eba2030ce9080f4e413c4c2aa0cfc0c5ee4131f8"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$searchListener = <span class="hljs-keyword">new</span> EzcSearchListener(...);</code><code class="line language-php">$em-&gt;getEventManager()-&gt;addEventListener(</code><code class="line language-php">    <span class="hljs-keyword">array</span>(Doctrine\ORM\Events::preUpdate), $searchListener</code><code class="line language-php">);</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Now when you search for your entities you get returned <code>BlogPost</code> instances from ezcSearchs Solr interface:</p>

                    <pre class="code-block-table" id="f95d1527de27d69f91853f934ecbff89e5a402f1"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f95d1527de27d69f91853f934ecbff89e5a402f1"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">// initialize a pre-configured query</span></code><code class="line language-php">$q = $session-&gt;createFindQuery( <span class="hljs-string">'BlogPost'</span> );</code><code class="line language-php">$searchWord = <span class="hljs-string">'test'</span>;</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">// where either body or title contains thr $searchWord</span></code><code class="line language-php">$q-&gt;where(</code><code class="line language-php">    $q-&gt;lOr(</code><code class="line language-php">        $q-&gt;eq( <span class="hljs-string">'body'</span>, $searchWord ),</code><code class="line language-php">        $q-&gt;eq( <span class="hljs-string">'title'</span>, $searchWord )</code><code class="line language-php">    )</code><code class="line language-php">);</code><code class="line language-php">$searchedBlogPosts = $session-&gt;find( $q );</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>These instances are detached from the EntityManager when they get returned from ezcSearch and can be merged back into the persistence context:</p>

                    <pre class="code-block-table" id="f3293b2121196217411da42e9b239ef8ba469218"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f3293b2121196217411da42e9b239ef8ba469218"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php">$searchedBlogPosts[<span class="hljs-number">0</span>]-&gt;setTitle(<span class="hljs-string">"ChangeFoo"</span>);</code><code class="line language-php">$em-&gt;merge($searchedBlogPosts[<span class="hljs-number">0</span>]);</code><code class="line language-php"></code><code class="empty"></code></pre>
                
    <p>Read about Merging, Detached instances and other cool stuff of Doctrines object model in the <a href="https://www.doctrine-project.org/projects/doctrine-orm/en/current/reference/working-with-objects.html#merging-entities">Working with Objects</a> chapter of the manual.</p>

                <h1 class="section-header ">
    <a href="#versionable">
        Versionable
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>By default Doctrine 2 comes with a way to set a <em>version</em> column that is automatically incremented on each update. Using the event system it is easy to use this information to implement a versionable audit-log behaviour. The required code is more verbose than the simple configuration of Doctrine 1, however there is much less magic involved and you can implement this behaviour in a way that is trivial to understand for someone new looking at your code:</p>

                    <pre class="code-block-table" id="36fbaa927291ed0521098b07bb86a617f2c5f4e7"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="36fbaa927291ed0521098b07bb86a617f2c5f4e7"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">/**</span></code><code class="line language-php"> * @Entity</code><code class="line language-php"> * @HasLifeCycleCallbacks</code><code class="line language-php"> * @generatedValue(strategy=<span class="hljs-string">"AUTO"</span>)</code><code class="line language-php"> */</code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogPost</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Id</code><code class="line language-php">     * @Column(type=<span class="hljs-string">"integer"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $id;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Column(type=<span class="hljs-string">"string"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $title;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Column(type=<span class="hljs-string">"text"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $body;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Column(type=<span class="hljs-string">"integer"</span>)</code><code class="line language-php">     * @version</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $version;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @OneToMany(targetEntity=<span class="hljs-string">"BlogPostVersion"</span>, mappedBy=<span class="hljs-string">"post"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $auditLog = <span class="hljs-keyword">array</span>();</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @PrePersist</code><code class="line language-php">     * @PreUpdate</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logVersion</span><span class="hljs-params">()</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;auditLog[] = <span class="hljs-keyword">new</span> BlogPostVersion(<span class="hljs-keyword">$this</span>);</code><code class="line language-php">    }</code><code class="line language-php">    <span class="hljs-comment">// getters</span></code><code class="line language-php">}</code><code class="line language-php"></code><code class="line language-php"><span class="hljs-comment">/**</span></code><code class="line language-php"> * @Entity</code><code class="line language-php"> */</code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogPostVersion</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Id</code><code class="line language-php">     * @Column(type=<span class="hljs-string">"integer"</span>)</code><code class="line language-php">     * @generatedValue(strategy=<span class="hljs-string">"AUTO"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $id;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Column(type=<span class="hljs-string">"string"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $title;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Column(type=<span class="hljs-string">"text"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $body;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Column(type=<span class="hljs-string">"integer"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $version;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @ManyToOne(targetEntity=<span class="hljs-string">"BlogPost"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $post;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(BlogPost $post)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;post = $post;</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;title = $post-&gt;getTitle();</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;body = $post-&gt;getBody();</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;version = $post-&gt;getCurrentVersion();</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h1 class="section-header ">
    <a href="#i18n">
        I18N
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Multi-Language content is an important topic and can be implemented in Doctrine 2, since its just a fancy name for a One-To-Many relation. However currently Doctrine 2 does not allow to persist keys by name, which makes a OneToMany implementation a bit more intensive then it could be. We plan to implement primitive value collections however which would simplify any attempt to implement nested structured content, that is not an entity by itself.</p>

                <h1 class="section-header ">
    <a href="#soft-delete">
        Soft Delete
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>We won&#039;t support soft-delete at all. If you want to implement a soft-delete alike behaviour its probably a good idea to look into the State pattern instead.</p>

                <h1 class="section-header ">
    <a href="#blameable">
        Blameable
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Implementing this behaviour is just a matter of adding two fields <em>createdByUserId</em> and <em>modifiedByUserId</em> fields and setting them whenever one of your relevant fields change by hooking into setter methods:</p>

                    <pre class="code-block-table" id="f0c1c9b3c8da9dc09718079939cdb2fd2b51b671"><button
                type="button"
                class="copy-to-clipboard"
                data-copy-element-id="f0c1c9b3c8da9dc09718079939cdb2fd2b51b671"
                title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><code class="empty"></code><code class="line language-php"><span class="hljs-meta">&lt;?php</span></code><code class="line language-php"><span class="hljs-comment">/**</span></code><code class="line language-php"> * @Entity</code><code class="line language-php"> */</code><code class="line language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogPost</span></span></code><code class="line language-php">{</code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Column(type=<span class="hljs-string">"string"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $title;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-comment">/**</span></code><code class="line language-php">     * @Column(type=<span class="hljs-string">"integer"</span>)</code><code class="line language-php">     */</code><code class="line language-php">    <span class="hljs-keyword">private</span> $modifiedByUserId;</code><code class="line language-php"></code><code class="line language-php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateBlogPost</span><span class="hljs-params">($title, ..., User $user)</span></span></code><code class="line language-php">    {</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;title = $title;</code><code class="line language-php">        <span class="hljs-keyword">$this</span>-&gt;modifiedByUserId = $user-&gt;getId();</code><code class="line language-php">    }</code><code class="line language-php">}</code><code class="line language-php"></code><code class="empty"></code></pre>
                <h1 class="section-header ">
    <a href="#sortable">
        Sortable
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Same as I18N, we are planning to support persistence of collection keys in the Doctrine 2 Core. This would allow to sort collections by using the possibilities of the <code>Doctrine\Common\Collections\Collection</code> interface.</p>

                <h1 class="section-header ">
    <a href="#conclusion">
        Conclusion
        <i class="fas fa-link"></i>
    </a>
</h1>
                
    <p>Although slightly more complex than Doctrine 1s simple configuration options, most &quot;behaviours&quot; are still way easy to implement in Doctrine 2. The additional benefit of this straightforward approach: <em>You can combine behaviours in any way, inside your domain model, without having to wonder how the magic works together, you are completly on top of it.</em></p>

        
    
        </div>
    </article>
    </main>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?1546fc"
                            integrity="sha384-ix9eb2EZyp9uayYpxmCQoylbz8msHl5wOg/aqZnD/3cxszNUGePN656MRg5GEgbm"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            <script
            src="https://www.doctrine-project.org/frontend/js/prismjs.js?8aa1bb"
                            integrity="sha384-3EhgfeqnppOxFBVU40g8gS+IVvmh5+wGpe4mG2otPyExrkK9t4aq8uCUy2IDLKkR"
                        crossorigin="anonymous">
    </script>
    </body>
</html>
