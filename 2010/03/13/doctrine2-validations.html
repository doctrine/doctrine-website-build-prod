<!DOCTYPE html>
<html>
    <head>
        <title>Validation of Doctrine 2 Entities - Doctrine: PHP Open Source Project</title>

        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
">

        <meta name="keywords" content="php,mysql,orm,dbal,database,mongodb,odm,annotations,migrations,cache,couchdb">

                    <meta name="robots" content="index, follow">
        
        
            <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.doctrine-project.org/2010/03/13/doctrine2-validations.html"
        },
        "headline": "Validation of Doctrine 2 Entities",
        "image": [
            "https://www.doctrine-project.org/images/og.png"
        ],
        "datePublished": "2010-03-13T00:00:00-05:00",
        "dateModified": "2010-03-13T00:00:00-05:00",
        "author": {
            "@type": "Person",
            "name": "beberlei"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Doctrine",
            "logo": {
                "@type": "ImageObject",
                "url": "https://www.doctrine-project.org/images/og.png"
            }
        },
        "description": "While Doctrine 1 had validation nested inside the Doctrine_Record instance this is not the case in D"
    }
    </script>
    <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/prismjs.css?d2443b"
                            integrity="sha384-IcJ7eow//K0xRBscZjnk8kawYxbm2eUAZ9D6Xf/n0yuAi1NCvwOkep1S8XqPNB3E"
                        crossorigin="anonymous"
    />

        <link
            rel="stylesheet"
            type="text/css"
            href="https://www.doctrine-project.org/frontend/css/index.css?74d1a1"
                        integrity="sha384-dAaEn2ZyD87ZE8ZaTOc39tmNlPuZWU7Tvl3K1W/IXH5rtko68QAI5cdG6HLv97IH"
                        crossorigin="anonymous"
        />

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://www.doctrine-project.org/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://www.doctrine-project.org/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://www.doctrine-project.org/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.doctrine-project.org/images/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://www.doctrine-project.org/images/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://www.doctrine-project.org/images/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://www.doctrine-project.org/images/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://www.doctrine-project.org/images/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="https://www.doctrine-project.org/images/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="Doctrine"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="https://www.doctrine-project.org/images/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="https://www.doctrine-project.org/images/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="https://www.doctrine-project.org/images/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="https://www.doctrine-project.org/images/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="https://www.doctrine-project.org/images/mstile-310x310.png" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@doctrineproject" />
        <meta name="twitter:creator" content="@doctrineproject" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.doctrine-project.org/2010/03/13/doctrine2-validations.html" />
        <meta property="og:title" content="Validation of Doctrine 2 Entities - Doctrine: PHP Open Source Project" />
        <meta property="og:description" content="The Doctrine Project is an open-source PHP project that is home to home to several PHP libraries primarily focused on database storage and object mapping. The core projects are the Object Relational Mapper (ORM) and the Database Abstraction Layer (DBAL) it is built upon.
" />
        <meta property="og:image" content="https://www.doctrine-project.org/images/og.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="1200" />

        <link rel="alternate" type="application/atom+xml" href="https://www.doctrine-project.org/atom.xml" title="Doctrine activity feed" />

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "url": "https://www.doctrine-project.org",
            "logo": "https://www.doctrine-project.org/logos/doctrine-logo.svg"
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://www.doctrine-project.org",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://www.doctrine-project.org?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
        </script>

        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Doctrine",
            "url": "https://www.doctrine-project.org",
            "sameAs": [
                "https://twitter.com/doctrineproject"
            ]
        }
        </script>

        
        
            </head>
    <body>
                    
            <nav class="doctrine-navbar navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap">
                <a class="navbar-brand text-hide" href="/index.html"><img src="https://www.doctrine-project.org/logos/doctrine-logo.svg?1a5b7c" />Doctrine</a>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/projects.html" id="navbarProjectsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Projects
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarProjectsDropdown">
                                                                    <a class="dropdown-item" href="/projects/orm.html">ORM</a>
                                                                    <a class="dropdown-item" href="/projects/dbal.html">DBAL</a>
                                                                    <a class="dropdown-item" href="/projects/mongodb-odm.html">MongoDB ODM</a>
                                                                    <a class="dropdown-item" href="/projects/coding-standard.html">Coding Standard</a>
                                                                    <a class="dropdown-item" href="/projects/collections.html">Collections</a>
                                                                    <a class="dropdown-item" href="/projects/common.html">Common</a>
                                                                    <a class="dropdown-item" href="/projects/data-fixtures.html">Data fixtures</a>
                                                                    <a class="dropdown-item" href="/projects/event-manager.html">Event Manager</a>
                                                                    <a class="dropdown-item" href="/projects/inflector.html">Inflector</a>
                                                                    <a class="dropdown-item" href="/projects/instantiator.html">Instantiator</a>
                                                                    <a class="dropdown-item" href="/projects/lexer.html">Lexer</a>
                                                                    <a class="dropdown-item" href="/projects/migrations.html">Migrations</a>
                                                                    <a class="dropdown-item" href="/projects/phpcr-odm.html">PHPCR ODM</a>
                                                                    <a class="dropdown-item" href="/projects/persistence.html">Persistence</a>
                                                                    <a class="dropdown-item" href="/projects/rst-parser.html">RST Parser</a>
                                                                <a class="dropdown-item bg-secondary text-white font-weight-bold" href="/projects.html">View All</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/contribute/index.html" id="navbarDevelopmentDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Development</a>

                            <div class="dropdown-menu" aria-labelledby="navbarContributeDropdown">
                                <a class="dropdown-item" href="/community/index.html">Community</a>
                                <a class="dropdown-item" href="/contribute/index.html">Contributor Workflow</a>
                                <a class="dropdown-item" href="/contribute/maintainer/index.html">Maintainer Workflow</a>
                                <a class="dropdown-item" href="/contribute/website/index.html">Contribute to Website</a>
                                <a class="dropdown-item" href="/policies.html">Policies</a>
                                <a class="dropdown-item" href="https://github.com/doctrine" target="_blank" rel="noopener noreferrer">GitHub</a>
                                <a class="dropdown-item" href="/styleguide.html">Styleguide</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/sponsorship.html">Sponsorship</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/partners.html">Partners</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="/blog/index.html">Blog</a>
                        </li>
                    </ul>

                    <div class="layout-edit-button d-inline-block mr-2">
                                                    <a href="https://github.com/doctrine/doctrine-website/edit/master/source/blog/2010-03-13-doctrine2-validations.md" class="btn btn-light" target="_blank" rel="noopener noreferrer">Edit</a>
                                            </div>
                </div>
                <div class="nav-outbound">
                    <div id="search-box">
                        <!-- SearchBox widget will appear here -->
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </nav>

            <div class="search-results rounded">
                <div id="hits">
                    <!-- Hits widget will appear here -->
                </div>

                <a href="https://www.algolia.com" target="_blank" rel="noopener noreferrer"><img src="https://www.doctrine-project.org/images/search-by-algolia.png" class="float-right" style="width: 150px;" /></a>
            </div>
        
            <main role="main" class="container-wrapper container">
            <article>
        <div class="row">
            <div class="col-lg-8 col-12">
                <header>
                    <h2>Validation of Doctrine 2 Entities</h2>
                </header>

                <p class="lead">
                    Posted on <date>March 13, 2010</date>
                                            by
                                                    beberlei
                                                            </p>
            </div>

            <div class="col-lg-4 col-12">
                <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7D553W&placement=wwwdoctrine-projectorg" id="_carbonads_js"></script>
            </div>
        </div>

        <hr />

        <div>
                
            
                
    <p>While Doctrine 1 had validation nested inside the <code>Doctrine_Record</code> instance this is not the case in Doctrine 2 anymore. We won&#039;t ship Doctrine 2 with any validators, the reason being that we think all the frameworks out there already ship with quite decents ones that can be integrated into your Domain easily. Besides us being ORM experts not wanting to maintain yet another validation library, moving the responsibility of validation into the domain layer also allows you to integrate it much easier into frameworks form libraries for example.</p>

                
    <p>What we do offer are hooks to execute any kind of validation inside the Doctrine ORM.</p>

                
    <p>Entities can register lifecycle event methods with Doctrine that are called on different occasions. For validation we would need to hook into the events called before persisting and updating. Even though we don&#039;t support validation out of the box, the implementation is even simpler than in Doctrine 1 and you will get the additional benefit of being able to re-use your validation in any other part of your domain.</p>

                
    <p>Say we have an <code>Order</code> with several <code>OrderLine</code> instances. We never want to allow any customer to order for a larger sum than he is allowed to:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="19d9d0166ec207978e5466f6919c1410211857ab"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="19d9d0166ec207978e5466f6919c1410211857ab"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-1" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-1">1</a></td><td class="code-line" rowspan="18"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertCustomerAllowedBuying</span><span class="hljs-params">()</span>
    </span>{
        $orderLimit = <span class="hljs-keyword">$this</span>-&gt;customer-&gt;getOrderLimit();

        $amount = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;orderLines <span class="hljs-keyword">AS</span> $line) {
            $amount += $line-&gt;getAmount();
        }

        <span class="hljs-keyword">if</span> ($amount &gt; $orderLimit) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomerOrderLimitExceededException();
        }
    }
}
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-2" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-3" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-4" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-5" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-6" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-7" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-8" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-9" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-10" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-11" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-12" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-13" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-14" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-15" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-16" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-16">16</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-17" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-17">17</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-19d9d0166ec207978e5466f6919c1410211857ab-18" class="line-number-anchor" /><a href="#line-number-19d9d0166ec207978e5466f6919c1410211857ab-18">18</a></td></tr></table></div></code></pre>
                
    <p>Now this is some pretty important piece of business logic in your code, enforcing it at any time is important so that customers with a unknown reputation don&#039;t owe your business too much money.</p>

                
    <p>We can enforce this constraint in any of the metadata drivers. First Annotations:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="ae1c872d308726029efeeb4acf20ce4285a367bd"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="ae1c872d308726029efeeb4acf20ce4285a367bd"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-1" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-1">1</a></td><td class="code-line" rowspan="13"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@Entity</span>
 * <span class="hljs-doctag">@HasLifecycleCallbacks</span>
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@PrePersist</span> <span class="hljs-doctag">@PreUpdate</span>
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertCustomerAllowedBuying</span><span class="hljs-params">()</span> </span>{}
}
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-2" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-3" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-4" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-5" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-6" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-7" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-8" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-9" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-10" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-11" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-12" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-13" class="line-number-anchor" /><a href="#line-number-ae1c872d308726029efeeb4acf20ce4285a367bd-13">13</a></td></tr></table></div></code></pre>
                
    <p>In XML Mappings:</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="b99851016982c0b13187218223b30ba764304b1d"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="b99851016982c0b13187218223b30ba764304b1d"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-b99851016982c0b13187218223b30ba764304b1d-1" class="line-number-anchor" /><a href="#line-number-b99851016982c0b13187218223b30ba764304b1d-1">1</a></td><td class="code-line" rowspan="10">[xml]
&lt;doctrine-mapping&gt;
    &lt;entity name=<span class="hljs-string">"Order"</span>&gt;
        &lt;lifecycle-callbacks&gt;
            &lt;lifecycle-callback type=<span class="hljs-string">"prePersist"</span> method=<span class="hljs-string">"assertCustomerAllowedBuying"</span> /&gt;
            &lt;lifecycle-callback type=<span class="hljs-string">"preUpdate"</span> method=<span class="hljs-string">"assertCustomerAllowedBuying"</span> /&gt;
        &lt;/lifecycle-callbacks&gt;
    &lt;/entity&gt;
&lt;/doctirne-mapping&gt;
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-b99851016982c0b13187218223b30ba764304b1d-2" class="line-number-anchor" /><a href="#line-number-b99851016982c0b13187218223b30ba764304b1d-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b99851016982c0b13187218223b30ba764304b1d-3" class="line-number-anchor" /><a href="#line-number-b99851016982c0b13187218223b30ba764304b1d-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b99851016982c0b13187218223b30ba764304b1d-4" class="line-number-anchor" /><a href="#line-number-b99851016982c0b13187218223b30ba764304b1d-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b99851016982c0b13187218223b30ba764304b1d-5" class="line-number-anchor" /><a href="#line-number-b99851016982c0b13187218223b30ba764304b1d-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b99851016982c0b13187218223b30ba764304b1d-6" class="line-number-anchor" /><a href="#line-number-b99851016982c0b13187218223b30ba764304b1d-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b99851016982c0b13187218223b30ba764304b1d-7" class="line-number-anchor" /><a href="#line-number-b99851016982c0b13187218223b30ba764304b1d-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b99851016982c0b13187218223b30ba764304b1d-8" class="line-number-anchor" /><a href="#line-number-b99851016982c0b13187218223b30ba764304b1d-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b99851016982c0b13187218223b30ba764304b1d-9" class="line-number-anchor" /><a href="#line-number-b99851016982c0b13187218223b30ba764304b1d-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-b99851016982c0b13187218223b30ba764304b1d-10" class="line-number-anchor" /><a href="#line-number-b99851016982c0b13187218223b30ba764304b1d-10">10</a></td></tr></table></div></code></pre>
                
    <p>YAML needs some little change yet, to allow multiple lifecycle events for one method, this will happen before Beta 1 though.</p>

                
    <p>Now validation is performed whenever you call <code>EntityManager#persist($order)</code> or when you call <code>EntityManager#flush()</code> and an order is about to be updated. Any Exception that happens in the lifecycle callbacks will be catched by the EntityManager and the current transaction is rolled back.</p>

                
    <p>Of course you can do any type of primitive checks, not null, email-validation, string size, integer and date ranges in your validation callbacks.</p>

                <pre class="code-block-table"><code class="php"><button
            type="button"
            class="copy-to-clipboard"
            data-copy-element-id="337f8cf82eb536d44b0afd15fb693c067c9d74ab"
            title="Copy to Clipboard"
        ><i class="fas fa-copy"></i></button><div id="337f8cf82eb536d44b0afd15fb693c067c9d74ab"><table class="code-block-table"><tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-1" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-1">1</a></td><td class="code-line" rowspan="22"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@PrePersist</span> <span class="hljs-doctag">@PreUpdate</span>
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">$this</span>-&gt;plannedShipDate <span class="hljs-keyword">instanceof</span> DateTime)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ValidateException();
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;plannedShipDate-&gt;format(<span class="hljs-string">'U'</span>) &lt; time()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ValidateException();
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;customer == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> OrderRequiresCustomerException();
        }
    }
}
</td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-2" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-2">2</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-3" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-3">3</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-4" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-4">4</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-5" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-5">5</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-6" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-6">6</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-7" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-7">7</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-8" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-8">8</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-9" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-9">9</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-10" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-10">10</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-11" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-11">11</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-12" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-12">12</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-13" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-13">13</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-14" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-14">14</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-15" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-15">15</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-16" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-16">16</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-17" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-17">17</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-18" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-18">18</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-19" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-19">19</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-20" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-20">20</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-21" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-21">21</a></td></tr>
<tr><td class="line-number noselect"><a name="line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-22" class="line-number-anchor" /><a href="#line-number-337f8cf82eb536d44b0afd15fb693c067c9d74ab-22">22</a></td></tr></table></div></code></pre>
                
    <p>What is nice about lifecycle events is, you can also re-use the methods at other places in your domain, for example in combination with your form library. Additionally there is no limitation in the number of methods you register on one particular event, i.e. you can register multiple methods for validation in &quot;PrePersist&quot; or &quot;PreUpdate&quot; or mix and share them in any combinations between those two events.</p>

                
    <p>There is no limit to what you can and can&#039;t validate in &quot;PrePersist&quot; and &quot;PreUpdate&quot; aslong as you don&#039;t create new entity instances. This was already discussed in the previous blog post on the Versionable extension, which requires another type of event called &quot;onFlush&quot;.</p>

                
    <p>Also read:</p>

                

<ul>
    <li class="dash"><a href="https://www.doctrine-project.org/projects/doctrine-orm/en/current/reference/events.html#lifecycle-events">Doctrine 2 Manual: Events</a></li>
    <li class="dash"><a href="https://www.doctrine-project.org/2010/02/24/doctrine2-versionable.html">Doctrine 2 Blog: A reusable Versionable Behaviour</a></li>
</ul>

        
    
        </div>
    </article>
    </main>

        <button id="back-to-top" title="Go to top">Top</button>

                
        <script id="instantsearch-template" type="text/template">
            
    <a href="{{url}}" class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{{_highlightResult.projectName.value}}}: {{{_highlightResult.h1.value}}}</h5>
        </div>

        {{#h2}}
            <p class="mb-1">
                <i class="far fa-arrow-alt-circle-right text-primary"></i>

                {{{_highlightResult.h2.value}}}

                {{#h3}}
                    > {{{_highlightResult.h3.value}}}
                {{/h3}}

                {{#h4}}
                    > {{{_highlightResult.h4.value}}}
                {{/h4}}

                {{#h5}}
                    > {{{_highlightResult.h5.value}}}
                {{/h5}}
            </p>
        {{/h2}}

        {{#content}}
            <div class="content p-2 rounded" style="background-color: rgba(0,0,0,.125);">
                {{{_highlightResult.content.value}}}
            </div>
        {{/content}}
    </a>

        </script>

        <script
            src="https://www.doctrine-project.org/frontend/js/bundle.js?1546fc"
                            integrity="sha384-ix9eb2EZyp9uayYpxmCQoylbz8msHl5wOg/aqZnD/3cxszNUGePN656MRg5GEgbm"
                        crossorigin="anonymous">
        </script>

                
        <script type="text/javascript">
            var projectSlug = '';
            var versionSlug = 'latest';

            var searchBoxSettings = {
                container: '#search-box',
                placeholder: 'Search'
            };

            function googleAnalyticsEvent(eventCategory, eventAction, eventLabel, eventValue, fieldsObject) {
                                ga('send', 'event', eventCategory, eventAction, eventLabel, eventValue, fieldsObject);
                            }
        </script>

        
                    <script type="text/javascript">
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-288343-7', 'auto');
                ga('send', 'pageview');
            </script>
        
            <script
            src="https://www.doctrine-project.org/frontend/js/prismjs.js?8aa1bb"
                            integrity="sha384-3EhgfeqnppOxFBVU40g8gS+IVvmh5+wGpe4mG2otPyExrkK9t4aq8uCUy2IDLKkR"
                        crossorigin="anonymous">
    </script>
    </body>
</html>
